(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{96643:function(e,t,r){Promise.resolve().then(r.bind(r,67615))},67615:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a0}});var a,s,d=r(57437),o=r(2265),n=r(5095);let l="BandukaPOS-DB",i=["products","customers","sales","suppliers","purchaseOrders","supplierInvoices","quotations","users","settings","auditLogs","shifts","cart","orderQueue","timeClockEvents","payouts","layaways","workOrders","salesOrders","heldReceipts","supplierPayments","chartOfAccounts","accountingTransactions","bankDeposits","workOrderMaterials","workOrderPayments"],c=null,m=null;function u(e){return new Promise((t,r)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>r(e.error)})}function x(){return c?Promise.resolve(c):m||(console.log("[DB] Initializing IndexedDB..."),m=new Promise((e,t)=>{let r=indexedDB.open(l,14);r.onupgradeneeded=e=>{let t=e.target.result;console.log("[DB] Upgrading to version ".concat(14,".")),i.forEach(e=>{t.objectStoreNames.contains(e)||(t.createObjectStore(e,{keyPath:"id"}),console.log("[DB] Created '".concat(e,"' store.")))})},r.onsuccess=()=>{c=r.result,console.log("[DB] Database opened successfully."),c.onclose=()=>{console.warn("[DB] Database connection closed."),c=null,m=null},e(c)},r.onerror=()=>{console.error("[DB] Database error:",r.error),m=null,t(r.error)}}))}async function h(e,t){return(await x()).transaction(e,t).objectStore(e)}async function p(e){return u((await h(e,"readonly")).getAll())}async function b(e,t){return u((await h(e,"readonly")).get(t))}async function g(e,t){return u((await h(e,"readwrite")).put(t))}async function f(e,t){let r=await h(e,"readwrite");await u(r.delete(t))}async function k(){try{c&&(c.close(),c=null,m=null),await u(indexedDB.deleteDatabase(l))}catch(e){throw console.error("Error wiping the database:",e),Error("Failed to wipe database. Please clear your browser's site data manually.")}}var y=r(60429);(a=s||(s={})).POS="POS",a.Dashboard="Dashboard",a.Inventory="Inventory",a.Purchases="Purchases",a.Suppliers="Suppliers",a.AccountsPayable="AccountsPayable",a.PaymentSummary="PaymentSummary",a.ShiftReport="ShiftReport",a.SalesHistory="SalesHistory",a.Customers="Customers",a.Quotations="Quotations",a.CreateQuotation="CreateQuotation",a.Staff="Staff",a.TimeSheets="TimeSheets",a.Settings="Settings",a.TaxReport="TaxReport",a.ProfitReport="ProfitReport",a.FiscalPeriodReport="FiscalPeriodReport",a.Accounts="Accounts",a.GeneralLedger="GeneralLedger",a.ChartOfAccounts="ChartOfAccounts",a.ReturnReceipt="ReturnReceipt",a.NewExpense="NewExpense",a.Expenditures="Expenditures",a.SalesOrder="SalesOrder",a.Layaway="Layaway",a.WorkOrder="WorkOrder",a.HeldReceipts="HeldReceipts",a.SalesOrderList="SalesOrderList",a.LayawayList="LayawayList",a.WorkOrderList="WorkOrderList",a.OpenCashDrawer="OpenCashDrawer",a.WhatsAppOrders="WhatsAppOrders";let j=["Cost of Goods Sold","Rent","Salaries & Wages","Utilities (Electricity, Water)","Marketing & Advertising","Office Supplies","Repairs & Maintenance","Transportation & Fuel","Bank Fees & Charges","Insurance","Taxes & Licenses","Travel & Entertainment","Meals & Refreshments","Miscellaneous"],v={id:"banduka_pos_settings",isSetupComplete:!1,businessType:"GeneralRetail",businessInfo:{name:"ERUNS TECHNOLOGIES",kraPin:"",logoUrl:"",location:"",phone:"",email:"admin@pos.pos",branch:"Main Branch",currency:"KES",language:"en-US"},tax:{vatEnabled:!0,vatRate:16,pricingType:"inclusive",etimsEnabled:!1},discount:{enabled:!0,type:"percentage",maxValue:10},receipt:{footer:"Thank you for your business!\nBidhaa zilizouzwa hazirudishwi.",invoicePrefix:"INV-",quotePrefix:"QUO-",poNumberPrefix:"PO-",layawayPrefix:"LAY-",workOrderPrefix:"WO-",salesOrderPrefix:"SO-"},layaway:{minDepositPercentage:20,maxDurationDays:90},hardware:{printer:{type:"ESC/POS",connection:"USB",name:"",address:""},barcodeScanner:{enabled:!0},barcodePrinter:{enabled:!1,type:"Image",connection:"USB",name:""}},loyalty:{enabled:!0,pointsPerKsh:100,redemptionRate:.5,minRedeemablePoints:100,maxRedemptionPercentage:50},measurements:{enabled:!1,units:["pc(s)","in","cm","m","kg","g","sq ft","ltr","hr"]},permissions:{Admin:["view_dashboard","view_pos","view_inventory","edit_inventory","delete_inventory","view_purchases","manage_purchases","view_ap","manage_ap","view_shift_report","view_sales_history","view_customers","manage_customers","view_settings","view_quotations","manage_quotations","view_staff","manage_staff","view_timesheets","manage_timesheets","manage_returns","manage_expenditures","manage_sales_orders","manage_layaways","manage_work_orders","view_held_receipts","open_cash_drawer","view_payment_summary","manage_whatsapp_orders","view_suppliers","manage_suppliers","view_profit_report","view_general_ledger"],Cashier:["view_pos","view_shift_report","view_customers","open_cash_drawer"],Supervisor:["view_dashboard","view_pos","view_inventory","edit_inventory","view_purchases","manage_purchases","view_ap","manage_ap","view_shift_report","view_sales_history","view_customers","manage_customers","view_quotations","manage_quotations","view_staff","view_timesheets","manage_timesheets","manage_returns","manage_expenditures","manage_sales_orders","manage_layaways","manage_work_orders","view_held_receipts","open_cash_drawer","view_payment_summary","manage_whatsapp_orders","view_suppliers","manage_suppliers","view_profit_report","view_general_ledger"],Accountant:["view_dashboard","view_purchases","manage_purchases","view_ap","manage_ap","view_sales_history","view_customers","view_payment_summary","view_suppliers","manage_suppliers","view_profit_report","view_general_ledger"]},paymentMethods:{enabled:!1,displayOnDocuments:["Invoice","Quotation","Receipt"],bank:[],mpesaPaybill:{paybillNumber:"",accountNumber:""},mpesaTill:{tillNumber:""}},inventory:{lowStockThreshold:10,definedCategories:[],expenseCategories:j},accounting:{defaultCashAccountId:"",defaultMpesaAccountId:"",defaultCardAccountId:"",defaultBankAccountId:"",defaultSalesAccountId:"",defaultVatPayableAccountId:"",defaultVatReceivableAccountId:"acc_vat_receivable",defaultCogsAccountId:"",defaultInventoryAccountId:"",defaultSalesReturnAccountId:"",defaultAccountsPayableId:"",defaultCustomerDepositsId:"",defaultShiftClearingId:""}},w={GeneralRetail:{name:"General Retail",description:"For kiosks, shops, boutiques, hardware stores, or any business selling physical items.",icon:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M17.21 9 12.83 2.44a1 1 0 0 0-1.66 0L6.79 9H2l4 12h12l4-12h-4.79Z"}),(0,d.jsx)("path",{d:"M9 9h6l-3-5Z"})]})},Restaurant:{name:"Restaurant / Cafe",description:"For businesses serving food and drinks, with features for table management and kitchen orders.",icon:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 6a3 3 0 0 1 3 3H9a3 3 0 0 1 3-3Z"}),(0,d.jsx)("path",{d:"M21.94 11.3C21.74 10.54 21 10 20.14 10H3.86c-.86 0-1.6.54-1.8 1.3l-1.06 4.24A1 1 0 0 0 2 17h20a1 1 0 0 0 .94-1.46l-1-4.24Z"}),(0,d.jsx)("path",{d:"M2 20h20v2H2z"})]})},Salon:{name:"Salon / Barber",description:"For spas, salons, and barbershops with appointment booking and stylist management.",icon:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M21 2H3v2h18V2Zm0 4H3v2h18V6Zm0 4H3v2h18v-2Zm0 4H3v2h18v-2Z"}),(0,d.jsx)("path",{d:"M7 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm0 2a5 5 0 1 1 0-10 5 5 0 0 1 0 10Zm9.46-3.54L9.5 7.5a1 1 0 0 1 1.41-1.41l6.96 6.96a1 1 0 0 1-1.41 1.42Z"}),(0,d.jsx)("path",{d:"M17 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm0 2a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"})]})},Services:{name:"Professional Services",description:"For consultants, repair shops, or any business selling time-based or custom services.",icon:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46a.5.5 0 0 0-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65A.5.5 0 0 0 14 2H10a.5.5 0 0 0-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1a.5.5 0 0 0-.61.22l-2 3.46a.5.5 0 0 0 .12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65a.5.5 0 0 0-.12.64l2 3.46a.5.5 0 0 0 .61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65a.5.5 0 0 0 .49.42h4a.5.5 0 0 0 .49.42l.38-2.65c.61-.25 1.17-.59-1.69.98l2.49 1a.5.5 0 0 0 .61.22l2-3.46a.5.5 0 0 0-.12-.64l-2.11-1.65ZM12 15.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Z"}),(0,d.jsx)("path",{d:"M12 13.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Z"})]})}},N={pos:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("circle",{cx:"9",cy:"21",r:"1"}),(0,d.jsx)("circle",{cx:"20",cy:"21",r:"1"}),(0,d.jsx)("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]}),dashboard:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,d.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,d.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,d.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]}),inventory:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,d.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,d.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),purchases:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}),(0,d.jsx)("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),(0,d.jsx)("path",{d:"M16 10a4 4 0 0 1-8 0"})]}),suppliers:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M17.5 17.5c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-11 0c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"}),(0,d.jsx)("path",{d:"M22 17.5v-2.2c0-2.09-1.7-3.8-3.79-3.8-1.49 0-2.8.88-3.47 2.22"}),(0,d.jsx)("path",{d:"M2 15.3c0-2.09 1.7-3.8 3.79-3.8 1.49 0 2.8.88 3.47 2.22"}),(0,d.jsx)("path",{d:"M12 11.3V5.5a2 2 0 0 1 2-2h4.5a2 2 0 0 1 2 2v2.5"}),(0,d.jsx)("path",{d:"M12 11.3V5.5a2 2 0 0 0-2-2H5.5a2 2 0 0 0-2 2v2.5"})]}),quotations:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),(0,d.jsx)("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),(0,d.jsx)("path",{d:"m9 14 2 2 4-4"})]}),ap:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M22 8a2 2 0 0 0-2-2h-1a3 3 0 0 0-3 3v2c0 1.1-.9 2-2 2h-4v2h4a4 4 0 0 1 4-4V8Zm-8 4H4a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h10v-6Z"}),(0,d.jsx)("path",{d:"M6.5 6.5A3.5 3.5 0 1 1 3 3a3.5 3.5 0 0 1 3.5 3.5Z"})]}),tax:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Zm-8 14H9v-2h2v2Zm0-4H9v-2h2v2Zm0-4H9V7h2v2Zm4 8h-2v-2h2v2Zm0-4h-2v-2h2v2Zm0-4h-2V7h2v2Z"}),(0,d.jsx)("path",{d:"M9 17h2v-2H9v2Zm0-4h2v-2H9v2Zm0-4h2V7H9v2Zm4 8h2v-2h-2v2Zm0-4h2v-2h-2v2Zm0-4h2V7h-2v2Z"})]}),paymentSummary:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm0 15a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"}),(0,d.jsx)("path",{d:"M12 14c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2Z"})]}),revenue:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm0 15a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"}),(0,d.jsx)("path",{d:"M12 14c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2Z"})]}),shiftReport:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M20 7h-2V4h-4v3H6V4H2v3h2v13h16V7h2V4h-4v3ZM8 6h8V2H8v4Z"}),(0,d.jsx)("path",{d:"M20 7V4h-4v3h-2V4h-4v3H8V4H4v3H2v13h18V7h-2Zm-4 11h-2v-2h2v2Zm0-4h-2v-2h2v2Zm0-4h-2V8h2v2Z"})]}),salesHistory:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M1 4v6h6"}),(0,d.jsx)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]}),customers:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,d.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,d.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,d.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),staff:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4Z"}),(0,d.jsx)("path",{d:"M12 14c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4Z"})]}),timeSheets:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),settings:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,d.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),profitReport:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"})}),install:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7Z"}),(0,d.jsx)("path",{d:"M5 18v2h14v-2H5Z"})]}),bell:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2Zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2Z"})}),moon:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2Z"})}),sun:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41zm12.72 12.72c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41zM5.64 18.36c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0zm12.72-12.72c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0z"})}),logout:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),(0,d.jsx)("polyline",{points:"16 17 21 12 16 7"}),(0,d.jsx)("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),business:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 7V3H2v18h20V7H12ZM6 19H4v-2h2v2Zm0-4H4v-2h2v2Zm0-4H4V9h2v2Zm0-4H4V5h2v2Zm4 12H8v-2h2v2Zm0-4H8v-2h2v2Zm0-4H8V9h2v2Zm0-4H8V5h2v2Zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10Zm-2-8h-2v2h2v-2Zm0 4h-2v2h2v-2Z"}),(0,d.jsx)("path",{d:"M6 5h2v2H6V5Zm0 4h2v2H6V9Zm0 4h2v2H6v-2Zm0 4h2v2H6v-2Zm4-12h2v2h-2V5Zm0 4h2v2h-2V9Zm0 4h2v2h-2v-2Zm6-4h2v2h-2V9Zm0 4h2v2h-2v-2Z"})]}),hardware:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M18 19H6v-4h12v4Z"}),(0,d.jsx)("path",{d:"M18 11H6c-1.66 0-3 1.34-3 3v6h4v-2h10v2h4v-6c0-1.66-1.34-3-3-3Zm1-7H5c-1.1 0-2 .9-2 2v4h18V6c0-1.1-.9-2-2-2Z"})]}),receipt:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M18 17H6v-2h12v2Zm0-4H6v-2h12v2Zm0-4H6V7h12v2ZM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2v20Z"}),(0,d.jsx)("path",{d:"M6 9h12V7H6v2Zm0 4h12v-2H6v2Zm0 4h12v-2H6v2Z"})]}),discount:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12.79 2.29a1 1 0 0 0-1.58 0L2.29 11.21a1 1 0 0 0 0 1.58l8.92 8.92a1 1 0 0 0 1.58 0l8.92-8.92a1 1 0 0 0 0-1.58L12.79 2.29ZM8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4Z"}),(0,d.jsx)("path",{d:"M8 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm8 8a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"})]}),loyalty:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 21.35 10.55 20C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35Z"}),(0,d.jsx)("path",{d:"M7.5 5C5.5 5 4 6.5 4 8.5c0 2.5 2.5 4.5 6 7.5h4c3.5-3 6-5 6-7.5C20 6.5 18.5 5 16.5 5c-1.5 0-2.8.9-3.5 2.1-.2.3-.5.5-.9.5s-.7-.2-.9-.5C10.3 5.9 9 5 7.5 5Z"})]}),rewardManager:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 21.35 10.55 20C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35Z"}),(0,d.jsx)("path",{d:"M7.5 5C5.5 5 4 6.5 4 8.5c0 2.5 2.5 4.5 6 7.5h4c3.5-3 6-5 6-7.5C20 6.5 18.5 5 16.5 5c-1.5 0-2.8.9-3.5 2.1-.2.3-.5.5-.9.5s-.7-.2-.9-.5C10.3 5.9 9 5 7.5 5Z"})]}),measurements:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2Zm0 10H3V8h18v8Z"}),(0,d.jsx)("path",{d:"M9 10h2v4H9v-4Zm4 0h2v4h-2v-4Zm-8-2h2v4H5v-4Z"})]}),users:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 12.25c1.24 0 2.25-1.01 2.25-2.25S13.24 7.75 12 7.75 9.75 8.76 9.75 10s1.01 2.25 2.25 2.25Z"}),(0,d.jsx)("path",{d:"M12 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4Z"})]}),email:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2Zm0 4-8 5-8-5V6l8 5 8-5v2Z"}),(0,d.jsx)("path",{d:"m4 8 8 5 8-5v-2l-8 5-8-5Z"})]}),sms:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2Z"}),(0,d.jsx)("path",{d:"M6 9h12v2H6V9Zm0 3h8v2H6v-2Z"})]}),whatsapp:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M16.75 13.96c.25.41.4 1.12.28 1.66-.12.54-1.03 1.1-1.33 1.15-.3.05-.72.23-2.93-1.07-2.21-1.3-3.66-3.48-3.8-3.68-.14-.2-.72-1.02-.72-1.92s.44-1.35.6-1.55c.16-.2.35-.25.5-.25s.33-.04.48.11c.15.15.48.55.53.59s.05.15.11.39c.06.24.03.4-.03.55-.06.15-.22.38-.33.5s-.22.25-.09.5c.13.25.64 1.13 1.45 1.83.99.88 1.63 1.12 1.88 1.23.25.11.4.1.54-.04.14-.14.61-.7.78-.92.17-.22.34-.18.54-.08l.15.08Z"}),(0,d.jsx)("path",{d:"M20.1 3.9C17.9 1.7 15.1 0 12 0 5.4 0 0 5.4 0 12c0 2.2.6 4.3 1.7 6.1L0 24l6.3-1.6c1.8.9 3.8 1.5 5.9 1.5h.1c6.6 0 12-5.4 12-12 0-3.1-1.2-6-3.3-8.1Z"})]}),mpesa:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2Zm0 18H7V5h10v14Z"}),(0,d.jsx)("path",{d:"M8 7h8v2H8V7Z"})]}),audit:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z"}),(0,d.jsx)("path",{d:"M11 15H8v-2h3v2Zm0-4H8V9h3v2Zm3 4h-2v-2h2v2Zm0-4h-2V9h2v2Z"})]}),accounts:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,d.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),clipboardList:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),(0,d.jsx)("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),(0,d.jsx)("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),(0,d.jsx)("line",{x1:"8",y1:"16",x2:"16",y2:"16"}),(0,d.jsx)("line",{x1:"10",y1:"8",x2:"10",y2:"8"})]}),generalLedger:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z"}),(0,d.jsx)("path",{d:"M11 15H8v-2h3v2Zm0-4H8V9h3v2Zm3 4h-2v-2h2v2Zm0-4h-2V9h2v2Z"})]}),data:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 2C6.5 2 2 3.8 2 6v12c0 2.2 4.5 4 10 4s10-1.8 10-4V6c0-2.2-4.5-4-10-4Z"}),(0,d.jsx)("path",{d:"M12 4c4.4 0 8 1.3 8 3s-3.6 3-8 3-8-1.3-8-3 3.6-3 8-3Z"})]}),reset:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12Z"}),(0,d.jsx)("path",{d:"M19 4h-3.5l-1-1h-5l-1 1H5v2h14V4Z"})]}),barcode:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M4 6h2v12H4V6Zm4 0h2v12H8V6Zm3 0h1v12h-1V6Zm3 0h2v12h-2V6Zm3 0h2v12h-2V6Z"})}),production:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M22 22H2V10l7-5 3 2.25L15 5l7 5v12ZM16 13h-2v2h2v-2Zm0 4h-2v2h2v-2Zm-4-4h-2v2h2v-2Zm0 4h-2v2h2v-2Z"}),(0,d.jsx)("path",{d:"M10 13h2v2h-2v-2Zm0 4h2v2h-2v-2Zm4-4h2v2h-2v-2Zm0 4h2v2h-2v-2Z"})]}),categories:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,d.jsx)("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),returnReceipt:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M7 10h2v7H7v-7Zm4 0h2v7h-2v-7Zm4 0h2v7h-2v-7Z"}),(0,d.jsx)("path",{d:"M19 5H5v3h14V5Z"}),(0,d.jsx)("path",{d:"M20 3H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v2l2.5-1.5L13 21v-2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2Z"})]}),payout:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M15 15H3c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v2h-4c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h4v2c0 1.1-.9 2-2 2Z"}),(0,d.jsx)("path",{d:"M23 7v10c0 1.1-.9 2-2 2h-1V7h3Zm-5 2h2v6h-2V9Z"})]}),salesOrder:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),(0,d.jsx)("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),(0,d.jsx)("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),(0,d.jsx)("line",{x1:"8",y1:"16",x2:"16",y2:"16"}),(0,d.jsx)("line",{x1:"10",y1:"8",x2:"10",y2:"8"})]}),layaway:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),(0,d.jsx)("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]}),workOrder:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,d.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),heldReceipts:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 0 1 5 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H9v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-1.93-1.57-3.5-3.5-3.5S7 3.07 7 5v12.5c0 2.21 1.79 4 4 4s4-1.79 4-4V6h-1.5Z"})}),openDrawer:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M8.5 10.5h7v3h-7v-3Z"}),(0,d.jsx)("path",{d:"M8.5 15.5h7v3h-7v-3Z"}),(0,d.jsx)("path",{d:"M21 4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2Zm-1 14H4V7h16v11Z"})]})},C=[{module:"Core Access",permissions:[{id:"view_dashboard",label:"View Dashboard"},{id:"view_pos",label:"Access Point of Sale"},{id:"view_settings",label:"View Settings"}]},{module:"Point of Sale Actions",permissions:[{id:"manage_returns",label:"Process Returns"},{id:"manage_expenditures",label:"Manage Expenditures"},{id:"manage_sales_orders",label:"Manage Sales Orders"},{id:"manage_layaways",label:"Manage Layaways"},{id:"manage_work_orders",label:"Manage Work Orders"},{id:"view_held_receipts",label:"View Held Receipts"},{id:"open_cash_drawer",label:"Open Cash Drawer Manually"},{id:"manage_whatsapp_orders",label:"Manage WhatsApp Orders"}]},{module:"Inventory & Products",permissions:[{id:"view_inventory",label:"View Inventory"},{id:"edit_inventory",label:"Edit Inventory (add, update stock)"},{id:"delete_inventory",label:"Delete Inventory Items"}]},{module:"Purchasing & Suppliers",permissions:[{id:"view_purchases",label:"View Purchase Orders"},{id:"manage_purchases",label:"Manage Purchase Orders"},{id:"view_suppliers",label:"View Suppliers"},{id:"manage_suppliers",label:"Manage Suppliers"},{id:"view_ap",label:"View Accounts Payable"},{id:"manage_ap",label:"Manage Accounts Payable"}]},{module:"Sales & Customers",permissions:[{id:"view_sales_history",label:"View Sales History"},{id:"view_customers",label:"View Customers"},{id:"manage_customers",label:"Manage Customers"},{id:"view_quotations",label:"View Quotations"},{id:"manage_quotations",label:"Manage Quotations"}]},{module:"Staff & Reporting",permissions:[{id:"view_staff",label:"View Staff Members"},{id:"manage_staff",label:"Manage Staff Members"},{id:"view_timesheets",label:"View Time Sheets"},{id:"manage_timesheets",label:"Manage Time Sheets"},{id:"view_shift_report",label:"View Shift Reports"},{id:"view_payment_summary",label:"View Payment Summary"},{id:"view_profit_report",label:"View Profitability Report"}]}],S=()=>((0,o.useEffect)(()=>{let e=window.document.documentElement;e.classList.remove("dark"),e.classList.add("light")},[]),["light",()=>{console.warn("Theme toggling is disabled.")}]),D=null,P=null;async function T(){return!!(D&&D.opened)}async function I(){if(D)try{await D.releaseInterface(0),await D.close(),console.log("Printer disconnected:",D.productName)}catch(e){console.warn("Error during device disconnect (may be harmless):",e)}finally{D=null,P=null}}async function A(){var e,t;if(!navigator.usb)throw Error("WebUSB not supported. Please use a compatible browser (like Chrome) and ensure the page is served over HTTPS.");await I();try{let t=await navigator.usb.requestDevice({filters:[]});await t.open(),null===t.configuration&&await t.selectConfiguration(1);try{await t.reset()}catch(e){console.warn("Could not reset device, continuing without reset.",e)}await t.claimInterface(0);let r=null===(e=t.configuration)||void 0===e?void 0:e.interfaces[0],a=null==r?void 0:r.alternates[0].endpoints.find(e=>"out"===e.direction);if(!a)throw Error("Could not find an OUT endpoint on the printer.");return D=t,P=a.endpointNumber,console.log("Printer connected:",D.productName),D}catch(e){if("NotFoundError"===e.name)console.log("User cancelled the device selection dialog.");else{let r=(null===(t=e.message)||void 0===t?void 0:t.toLowerCase())||"";if(r.includes("unable to claim interface")||r.includes("access denied")||"SecurityError"===e.name)throw await I(),Error("Direct connection failed. The printer's driver may be blocking access. Try using 'Browser Print' mode instead for wider compatibility.");console.error("WebUSB connection error:",e)}throw await I(),e}}async function M(e,t){var r,a;if(!navigator.usb)throw Error("WebUSB is not supported by this browser. Cannot reconnect.");await I();try{let a=(await navigator.usb.getDevices()).find(r=>r.vendorId===e&&r.productId===t);if(a){await a.open(),null===a.configuration&&await a.selectConfiguration(1);try{await a.reset()}catch(e){console.warn("Could not reset device on reconnect, continuing without reset.",e)}await a.claimInterface(0);let e=null===(r=a.configuration)||void 0===r?void 0:r.interfaces[0],t=null==e?void 0:e.alternates[0].endpoints.find(e=>"out"===e.direction);if(!t)throw Error("Could not find OUT endpoint on reconnect.");D=a,P=t.endpointNumber,console.log("Reconnected to printer:",D.productName)}else throw Error("Previously permitted device not found. Please connect again.")}catch(t){let e=(null===(a=t.message)||void 0===a?void 0:a.toLowerCase())||"";if(e.includes("unable to claim interface")||e.includes("access denied")||"SecurityError"===t.name)throw await I(),Error("Direct connection failed. The printer's driver may be blocking access. Try using 'Browser Print' mode instead for wider compatibility.");throw console.error("WebUSB reconnection error:",t),await I(),t}}async function F(e,t){if(!navigator.usb)return console.warn("WebUSB is not supported by this browser."),null;try{return(await navigator.usb.getDevices()).find(r=>r.vendorId===e&&r.productId===t)||null}catch(e){return console.error("Error finding permitted device:",e),null}}let L=new TextEncoder,O={HW_INIT:[27,64],PAPER_FULL_CUT:[29,86,0],CD_KICK_2:[27,112,0,25,250],TXT_ALIGN_L:[27,97,0],TXT_ALIGN_C:[27,97,1],TXT_ALIGN_R:[27,97,2],TXT_BOLD_ON:[27,69,1],TXT_BOLD_OFF:[27,69,0],TXT_UNDERLINE_OFF:[27,45,0],TXT_UNDERLINE_ON:[27,45,1],TXT_FONT_A:[27,77,0],TXT_FONT_B:[27,77,1],TXT_NORMAL:[29,33,0],TXT_2HEIGHT:[29,33,16],TXT_2WIDTH:[29,33,32]};async function R(e){if(!D||!P)throw Error("Printer is not connected.");return D.transferOut(P,e)}async function B(e){if(await T())return;let{vendorId:t,productId:r}=e;if(t&&r)console.log("Printer not connected, attempting reconnect..."),await M(t,r);else throw Error("Printer not configured. Please connect via Hardware Settings.");if(!await T())throw Error("Printer reconnection failed. Please connect manually in settings.")}async function _(e){await B(e),await R(new Uint8Array(O.CD_KICK_2)),console.log("Cash drawer kick command sent.")}function E(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=t.map(e=>e instanceof Uint8Array?e:new Uint8Array(e)),s=new Uint8Array(a.reduce((e,t)=>e+t.length,0)),d=0;return a.forEach(e=>{s.set(e,d),d+=e.length}),s}function q(e){return L.encode(e)}function V(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:48;return e.padEnd(r-t.length)+t+"\n"}function H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:48;return"".padStart(t,e)+"\n"}async function U(e,t,r){await B(t.hardware.printer),await R(new Uint8Array(O.CD_KICK_2));let a=function(e,t,r){let a=E(O.HW_INIT,O.TXT_ALIGN_C,O.TXT_BOLD_ON,O.TXT_2HEIGHT,q(t.businessInfo.name+"\n"),O.TXT_NORMAL,O.TXT_BOLD_OFF,q(t.businessInfo.location+"\n"),q("Tel: ".concat(t.businessInfo.phone,"\n")),q("PIN: ".concat(t.businessInfo.kraPin,"\n\n")),O.TXT_ALIGN_L,q(H("-",48)),q("Date: ".concat(new Date(e.date).toLocaleString("en-GB"),"\n")),q("Receipt: ".concat(e.id,"\n")),q("Cashier: ".concat(r,"\n")),q(H("-",48))),s=q("");e.items.forEach(e=>{s=E(s,q(function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,s=(r*t).toFixed(2),d="".concat(e," (x").concat(t,")"),o=a-s.length-1;return(d.length>o?d.substring(0,o):d).padEnd(a-s.length)+s+"\n"}(e.name,e.quantity,e.price,48)))}),a=E(a,s,q(H("-",48)));let d=E(q(V("Subtotal",e.subtotal.toFixed(2),48)),e.discountAmount>0?q(V("Discount","-".concat(e.discountAmount.toFixed(2)),48)):new Uint8Array,q(V("VAT",e.tax.toFixed(2),48)),q(H("=",48)),O.TXT_BOLD_ON,O.TXT_2HEIGHT,q(V("TOTAL","Ksh ".concat(e.total.toFixed(2)),24)),O.TXT_NORMAL,O.TXT_BOLD_OFF,q(H("=",48)));a=E(a,d);let o=q("");e.payments.forEach(e=>{o=E(o,q(V(e.method,e.amount.toFixed(2),48)))}),e.change>0&&(o=E(o,O.TXT_BOLD_ON,q(V("Change",e.change.toFixed(2),48)),O.TXT_BOLD_OFF)),a=E(a,o);let n=E(q("\n\n"),O.TXT_ALIGN_C,q(t.receipt.footer+"\n"),q("Goods once sold are not returnable.\n\n\n"),O.PAPER_FULL_CUT);return E(a,n)}(e,t,r);await R(a)}async function W(e){await B(e);let t=E(O.HW_INIT,O.TXT_ALIGN_C,O.TXT_BOLD_ON,O.TXT_2HEIGHT,O.TXT_2WIDTH,q("Banduka POS\n"),O.TXT_NORMAL,O.TXT_BOLD_OFF,q("Printer Test\n"),q(H("=",48)),O.TXT_ALIGN_L,q("This is a test print to confirm your\n"),q("printer is connected and working correctly.\n\n"),O.TXT_BOLD_ON,q("Features:\n"),O.TXT_BOLD_OFF,q("Default Text (Font A)\n"),new Uint8Array(O.TXT_FONT_B),q("Smaller Text (Font B)\n"),new Uint8Array(O.TXT_FONT_A),new Uint8Array(O.TXT_UNDERLINE_ON),q("Underlined Text\n"),new Uint8Array(O.TXT_UNDERLINE_OFF),q("\n"),O.TXT_ALIGN_C,q("Centered Text\n"),O.TXT_ALIGN_R,q("Right-Aligned Text\n"),O.TXT_ALIGN_L,q(H("=",48)),O.TXT_ALIGN_C,q("Connection Successful!\n\n\n"),O.CD_KICK_2,O.PAPER_FULL_CUT);await R(t)}let Z=e=>Math.round((e+Number.EPSILON)*100)/100,z=(e,t,r)=>{if("inclusive"!==t)return{basePrice:e,vatAmount:e*r};{let t=e/(1+r);return{basePrice:t,vatAmount:e-t}}},K=(e,t,r)=>{let a=0,s=0,d=e.map(e=>{let t=e.price*e.quantity;a+=t;let r=0;e.discount&&(r="percentage"===e.discount.type?e.discount.value/100*t:e.discount.value,r=Math.min(t,r)),s+=r;let d=t-r;return{...e,itemGrossTotal:t,itemDiscountAmount:r,itemNetTotal:d}}),o=a-s,n=0;t.value>0&&(n="percentage"===t.type?t.value/100*o:t.value),n=Math.min(o,n);let l=0,i=0;d.forEach(e=>{if(e.itemNetTotal>0&&o>0){let t=e.itemNetTotal/o,a=n*t,{basePrice:s,vatAmount:d}=z(e.itemNetTotal-a,e.pricingType,r);l+=s,i+=d}else{let{basePrice:t,vatAmount:a}=z(e.itemNetTotal,e.pricingType,r);l+=t,i+=a}});let c=s+n,m=l+i;return{subtotal:Z(a),lineItemsDiscountAmount:Z(s),cartDiscountAmount:Z(n),totalDiscountAmount:Z(c),taxableAmount:Z(l),tax:Z(i),total:Z(m)}};y.E.button;let G=e=>{let{view:t,label:r,currentView:a,onClick:s,children:o}=e,n=a===t;return(0,d.jsxs)("button",{onClick:()=>s(t),className:"flex items-center w-full text-left p-3 rounded-lg transition-colors duration-200 group ".concat(n?"bg-primary text-primary-content shadow-md hover:bg-primary-focus":"text-gray-400 hover:bg-primary hover:text-primary-content"),"aria-current":n?"page":void 0,"aria-label":r,children:[(0,d.jsx)("div",{className:"flex-shrink-0 mr-3 w-5 h-5",children:o}),(0,d.jsx)("span",{className:"text-sm font-medium",children:r})]})},Q=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M18 6L12 2L6 6"}),(0,d.jsx)("path",{d:"M2 6v14a2 2 0 002 2h16a2 2 0 002-2V6"}),(0,d.jsx)("path",{d:"M12 22V12"})]}),Y=e=>{let{layout:t="vertical"}=e;return"horizontal"===t?(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"bg-orange-500 p-2 rounded-lg text-white",children:(0,d.jsx)(Q,{})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"font-bold text-base leading-tight text-foreground dark:text-dark-foreground",children:"Banduka POS™"}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Point of Sale System"})]})]}):(0,d.jsxs)("div",{className:"flex items-center p-4 border-b border-gray-700 flex-shrink-0",children:[(0,d.jsx)("div",{className:"bg-orange-500 p-2 rounded-lg mr-3",children:(0,d.jsx)(Q,{})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"font-bold text-base leading-tight",children:"Banduka POS™"}),(0,d.jsx)("p",{className:"text-xs text-gray-400",children:"Point of Sale System"})]})]})},X=[{view:s.Dashboard,label:"Dashboard",icon:N.dashboard,permission:"view_dashboard"},{view:s.POS,label:"Point of Sale",icon:N.pos,permission:"view_pos"},{view:s.Inventory,label:"Inventory",icon:N.inventory,permission:"view_inventory"},{view:s.Customers,label:"Customers",icon:N.customers,permission:"view_customers"},{view:s.Suppliers,label:"Suppliers",icon:N.suppliers,permission:"view_suppliers"},{view:s.AccountsPayable,label:"Accounts Payable",icon:N.ap,permission:"view_ap"},{view:s.Purchases,label:"Purchase Orders",icon:N.clipboardList,permission:"view_purchases"},{view:s.SalesOrderList,label:"Sales Orders",icon:N.clipboardList,permission:"manage_sales_orders"},{view:s.Quotations,label:"Quotations",icon:N.quotations,permission:"view_quotations"},{view:s.WorkOrderList,label:"Work Orders",icon:N.workOrder,permission:"manage_work_orders"},{view:s.LayawayList,label:"Layaways",icon:N.layaway,permission:"manage_layaways"},{view:s.HeldReceipts,label:"Held Receipts",icon:N.heldReceipts,permission:"view_held_receipts"},{view:s.SalesHistory,label:"Sales History",icon:N.salesHistory,permission:"view_sales_history"},{view:s.Staff,label:"Staff",icon:N.staff,permission:"view_staff"},{view:s.TimeSheets,label:"Shifts",icon:N.timeSheets,permission:"view_timesheets"},{view:s.Accounts,label:"Accounts & Finance",icon:N.accounts,permission:"view_general_ledger"},{view:s.ProfitReport,label:"Reports & Analytics",icon:N.profitReport,permission:"view_profit_report"},{view:s.FiscalPeriodReport,label:"Fiscal Period Report",icon:N.generalLedger,permission:"view_profit_report"},{view:s.TaxReport,label:"Tax Report",icon:N.tax,permission:"view_profit_report"},{view:s.Settings,label:"Settings",icon:N.settings,permission:"view_settings"}],J=e=>{let{currentView:t,setCurrentView:r,permissions:a,currentUser:s,onLogout:n}=e,l=(0,o.useMemo)(()=>X.filter(e=>a.includes(e.permission)),[a]),i=(0,o.useMemo)(()=>{if(!s||!s.name)return"";let e=s.name.split(" ").filter(Boolean);return e.length>1?"".concat(e[0][0]).concat(e[1][0]).toUpperCase():e[0]?e[0][0].toUpperCase():""},[s]);return(0,d.jsxs)("div",{className:"w-full md:w-64 bg-gray-800 text-white flex flex-col h-full shadow-lg",children:[(0,d.jsx)(Y,{}),(0,d.jsxs)("nav",{className:"flex-grow p-4 overflow-y-auto",children:[(0,d.jsx)("h2",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:"Main Menu"}),(0,d.jsx)("div",{className:"space-y-1",children:l.map(e=>(0,d.jsx)(G,{view:e.view,label:e.label,currentView:t,onClick:r,children:o.cloneElement(e.icon,{className:"w-5 h-5"})},e.view))})]}),(0,d.jsxs)("div",{className:"mt-auto p-4 border-t border-gray-700 flex-shrink-0",children:[(0,d.jsxs)("div",{className:"flex items-center mb-4",children:[(0,d.jsx)("div",{className:"w-9 h-9 rounded-full bg-gray-600 flex items-center justify-center font-bold text-sm mr-3",children:i}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-semibold",children:s.name}),(0,d.jsx)("p",{className:"text-xs text-gray-400",children:s.role})]})]}),(0,d.jsxs)("button",{onClick:n,className:"w-full flex items-center justify-center p-2 text-sm font-medium text-orange-400 border border-orange-400 rounded-lg hover:bg-orange-400 hover:text-gray-800 transition-colors",children:[(0,d.jsx)("div",{className:"w-5 h-5 mr-2",children:N.logout}),"Logout"]})]})]})};var $=e=>{let{currentView:t,setCurrentView:r,isOpen:a,setIsOpen:s,currentUser:o,onLogout:l,permissions:i,settings:c}=e;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"hidden md:block flex-shrink-0 no-print",children:(0,d.jsx)(J,{currentView:t,setCurrentView:r,permissions:i,settings:c,currentUser:o,onLogout:l})}),(0,d.jsx)(n.M,{children:a&&(0,d.jsxs)("div",{className:"md:hidden no-print",children:[(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>s(!1)}),(0,d.jsx)("div",{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 left-0 h-full z-40 w-64",children:(0,d.jsx)(J,{currentView:t,setCurrentView:e=>{r(e),s(!1)},permissions:i,settings:c,currentUser:o,onLogout:l})})]})})]})},ee=e=>{let{lowStockProducts:t,onClose:r}=e;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 z-10",onClick:r}),(0,d.jsxs)("div",{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"absolute right-0 mt-2 w-80 bg-white/50 dark:bg-dark-card/70 backdrop-blur-2xl rounded-lg shadow-xl py-1 z-20 border border-white/20 dark:border-white/10",children:[(0,d.jsxs)("div",{className:"px-4 py-3 border-b border-white/20 dark:border-white/10",children:[(0,d.jsx)("h4",{className:"font-bold text-foreground dark:text-dark-foreground",children:"Low Stock Alerts"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"The following items are running low on stock."})]}),(0,d.jsx)("div",{className:"max-h-80 overflow-y-auto",children:t.length>0?(0,d.jsx)("ul",{className:"divide-y divide-white/20 dark:divide-white/10",children:t.map(e=>(0,d.jsx)("li",{className:"p-3 hover:bg-white/20 dark:hover:bg-white/10",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-semibold text-sm text-foreground dark:text-dark-foreground",children:e.name}),(0,d.jsxs)("p",{className:"text-xs text-warning font-bold",children:["LOW STOCK (",e.stock," left)"]})]})},e.id))}):(0,d.jsx)("div",{className:"p-4 text-center text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"No low stock alerts. Good job!"})})]})]})};let et=y.E.svg,er=y.E.div,ea=y.E.span,es=y.E.button,ed=()=>(0,d.jsx)(et,{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-secondary dark:text-dark-secondary",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2.5",stroke:"currentColor",animate:{rotate:360},transition:{duration:1.5,repeat:1/0,ease:"linear"},children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-4.991-2.69a8.25 8.25 0 00-11.664 0l-3.181 3.183"})});var eo=e=>{var t,r;let{isOnline:a,isSyncing:s,queuedSalesCount:l,onMenuClick:i,currentUser:c,products:m,settings:u,onInstallClick:x,installPromptEvent:h,activeTimeClockEvent:p,onLogout:b}=e,[g,f]=(0,o.useState)(new Date),[k,y]=(0,o.useState)(!1),[j,v]=(0,o.useState)(!1),[w,C]=(0,o.useState)(""),S=null!==(r=null===(t=u.inventory)||void 0===t?void 0:t.lowStockThreshold)&&void 0!==r?r:3,D=(0,o.useMemo)(()=>m.filter(e=>"Inventory"===e.productType&&e.stock>0&&e.stock<=S),[m,S]);(0,o.useEffect)(()=>{let e=setInterval(()=>f(new Date),1e3);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{let e;if(p){let t=()=>{let e=new Date,t=new Date(p.clockInTime),r=e.getTime()-t.getTime(),a=Math.floor(r/36e5).toString().padStart(2,"0"),s=Math.floor(r%36e5/6e4).toString().padStart(2,"0"),d=Math.floor(r%6e4/1e3).toString().padStart(2,"0");C("".concat(a,":").concat(s,":").concat(d))};t(),e=setInterval(t,1e3)}return()=>clearInterval(e)},[p]);let P=(0,o.useMemo)(()=>{if(!c||!c.name)return"";let e=c.name.split(" ").filter(Boolean);return e.length>1?"".concat(e[0][0]).concat(e[1][0]).toUpperCase():e[0]?e[0][0].toUpperCase():""},[c]);return(0,d.jsxs)("header",{className:"bg-white/30 dark:bg-dark-card/50 backdrop-blur-2xl border-b border-white/20 dark:border-white/10 h-16 flex items-center justify-between px-4 md:px-6 flex-shrink-0 relative z-30 no-print shadow-lg",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsx)("button",{onClick:i,className:"md:hidden text-foreground-muted hover:text-primary dark:text-dark-foreground-muted dark:hover:text-dark-primary p-2 rounded-full hover:bg-muted dark:hover:bg-dark-muted",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,d.jsx)("div",{className:"md:hidden",children:(0,d.jsx)(Y,{layout:"horizontal"})}),(0,d.jsxs)("div",{className:"text-left hidden sm:block",children:[(0,d.jsx)("div",{className:"font-bold text-sm text-foreground dark:text-dark-foreground",children:g.toLocaleTimeString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("div",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:g.toLocaleDateString("en-GB",{day:"numeric",month:"long",timeZone:"Africa/Nairobi"})})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 md:space-x-4",children:[h&&(0,d.jsxs)(es,{onClick:x,whileTap:{scale:.95},className:"hidden sm:flex items-center space-x-2 bg-primary text-primary-content font-bold px-3 py-1.5 rounded-xl transition-shadow shadow-clay-light active:shadow-clay-light-inset dark:bg-dark-primary dark:text-dark-primary-content dark:shadow-clay-dark dark:active:shadow-clay-dark-inset",children:[N.install,(0,d.jsx)("span",{className:"text-sm",children:"Install App"})]}),(0,d.jsxs)("div",{className:"hidden md:flex items-center space-x-2 px-2 py-1.5 bg-muted/50 dark:bg-dark-muted/50 rounded-lg",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(a?"bg-green-500":"bg-red-500"),title:a?"Online":"Offline"}),(0,d.jsxs)("div",{className:"flex items-center space-x-1",title:"".concat(l," unsynced sales"),children:[s?(0,d.jsx)(ed,{}):(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-secondary dark:text-dark-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"})}),(0,d.jsx)("span",{className:"text-sm font-bold text-secondary dark:text-dark-secondary",children:l})]})]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsxs)(es,{whileTap:{scale:.95},onClick:()=>v(!j),className:"p-2 rounded-full transition-all duration-200 hover:shadow-clay-light active:shadow-clay-light-inset dark:hover:shadow-clay-dark dark:active:shadow-clay-dark-inset",children:[N.bell,D.length>0&&(0,d.jsxs)(ea,{className:"absolute -top-0.5 -right-0.5 flex h-3 w-3",initial:{scale:0},animate:{scale:1},children:[(0,d.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-danger opacity-75"}),(0,d.jsx)("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-danger"})]})]}),(0,d.jsx)(n.M,{children:j&&(0,d.jsx)(ee,{lowStockProducts:D,onClose:()=>v(!1)})})]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsxs)("button",{onClick:()=>y(!k),className:"flex items-center space-x-2 p-1 rounded-full transition-all duration-200 hover:shadow-clay-light active:shadow-clay-light-inset dark:hover:shadow-clay-dark dark:active:shadow-clay-dark-inset",children:[(0,d.jsxs)("div",{className:"text-right hidden md:block",children:[(0,d.jsx)("div",{className:"font-bold text-sm text-foreground dark:text-dark-foreground",children:c.name}),(0,d.jsx)("div",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:c.role})]}),(0,d.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-content flex items-center justify-center font-bold text-lg border-2 border-primary/50",children:(0,d.jsx)("span",{children:P})})]}),(0,d.jsx)(n.M,{children:k&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>y(!1)}),(0,d.jsxs)(er,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"absolute right-0 mt-2 w-56 bg-white/50 dark:bg-dark-card/70 backdrop-blur-2xl border border-white/20 dark:border-white/10 rounded-xl shadow-xl py-1 z-20",children:[p&&(0,d.jsx)("div",{className:"px-4 py-2 text-sm text-foreground dark:text-dark-foreground border-b dark:border-white/10",children:(0,d.jsxs)("p",{children:["Shift Active: ",(0,d.jsx)("span",{className:"font-bold",children:w})]})}),(0,d.jsx)("div",{className:"border-t border-border dark:border-white/10 my-1"}),(0,d.jsxs)("button",{onClick:b,className:"w-full text-left px-4 py-2 text-sm text-danger flex items-center space-x-2 hover:bg-danger/10",children:[N.logout,(0,d.jsx)("span",{children:"Logout"})]})]})]})})]})]})]})};let en=y.E.div,el=e=>{let{product:t,onAddToCart:r}=e;return(0,d.jsxs)(en,{layout:!0,whileHover:{y:-4,scale:1.02,boxShadow:"0px 10px 15px -3px rgba(0,0,0,0.05)"},whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:17},className:"bg-card dark:bg-dark-card rounded-lg shadow-md overflow-hidden cursor-pointer flex flex-col border border-border dark:border-dark-border",onClick:()=>r(t),children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("img",{src:t.imageUrl||"https://placehold.co/300x300/e2e8f0/475569?text=".concat(t.name.charAt(0)),alt:t.name,className:"w-full h-32 object-cover"}),t.stock<=0&&"Inventory"===t.productType&&(0,d.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,d.jsx)("span",{className:"text-white font-bold text-sm bg-danger px-2 py-1 rounded",children:"OUT OF STOCK"})})]}),(0,d.jsxs)("div",{className:"p-3 flex flex-col flex-grow",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground text-sm flex-grow",children:t.name}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:t.category}),(0,d.jsxs)("p",{className:"text-primary dark:text-dark-primary font-bold",children:["Ksh ",t.price.toFixed(2)]})]})]})]})},ei=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),ec=e=>{let{product:t,onAddToCart:r}=e;return(0,d.jsxs)(en,{layout:!0,whileHover:{borderColor:"var(--tw-color-primary)",y:-2,boxShadow:"0 4px 12px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05)"},whileTap:{scale:.99},transition:{type:"spring",stiffness:400,damping:20},className:"bg-card dark:bg-dark-card rounded-lg shadow-sm overflow-hidden cursor-pointer flex items-center p-3 space-x-4 w-full border border-border dark:border-dark-border",onClick:()=>r(t),children:[(0,d.jsx)("div",{className:"bg-muted dark:bg-dark-muted p-2 rounded-lg flex-shrink-0",children:(0,d.jsx)(ei,{})}),(0,d.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,d.jsx)("p",{className:"font-bold text-foreground dark:text-dark-foreground truncate",title:t.name,children:t.name}),(0,d.jsxs)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted font-mono",children:["SKU: ",t.inventoryCode]})]}),(0,d.jsxs)("div",{className:"text-right flex-shrink-0 ml-4",children:[(0,d.jsxs)("p",{className:"text-primary dark:text-dark-primary font-bold text-base",children:["KES ",t.price.toFixed(2)]}),(0,d.jsxs)("div",{className:"mt-1 inline-block px-2 py-0.5 rounded bg-black text-white text-xs font-bold",children:["Stock: ",t.stock]})]})]})};var em=e=>{let{products:t,onAddToCart:r,settings:a}=e,[s,n]=(0,o.useState)(""),[l,i]=(0,o.useState)("All"),[c,m]=(0,o.useState)("list"),u=(0,o.useRef)(null);(0,o.useEffect)(()=>{var e;null===(e=u.current)||void 0===e||e.focus()},[]);let x=(0,o.useMemo)(()=>{let e=new Set;return t.forEach(t=>{t.category&&e.add(t.category.split(" > ")[0])}),["All",...Array.from(e).sort()]},[t]),h=(0,o.useMemo)(()=>t.filter(e=>{if(!("All"===l||e.category===l||e.category.startsWith(l+" > ")))return!1;let t=s.toLowerCase();return e.name.toLowerCase().includes(t)||e.inventoryCode.toLowerCase().includes(t)||e.upc&&e.upc.toLowerCase().includes(t)}),[t,s,l]);return(0,d.jsxs)("div",{className:"flex flex-col h-full",children:[(0,d.jsxs)("div",{className:"flex-shrink-0",children:[(0,d.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,d.jsxs)("div",{className:"relative flex-grow",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-foreground-muted dark:text-dark-foreground-muted absolute top-1/2 left-4 -translate-y-1/2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,d.jsx)("input",{ref:u,type:"text",placeholder:"Search products...",className:"w-full pl-12 pr-4 py-3 rounded-lg bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted border border-border dark:border-dark-border focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary",value:s,onChange:e=>n(e.target.value),onKeyDown:e=>{if("Enter"===e.key){let a=s.trim().toLowerCase(),d=t.find(e=>e.inventoryCode.trim().toLowerCase()===a||e.upc&&e.upc.trim().toLowerCase()===a);d&&(e.preventDefault(),r(d),n(""))}}})]}),(0,d.jsxs)("div",{className:"flex bg-muted dark:bg-dark-muted p-1 rounded-lg",children:[(0,d.jsx)("button",{onClick:()=>m("grid"),className:"p-2 rounded-md transition-colors ".concat("grid"===c?"bg-primary text-primary-content":"text-foreground-muted dark:text-dark-foreground-muted hover:bg-border dark:hover:bg-dark-border"),"aria-label":"Grid view",children:(0,d.jsx)(()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),{})}),(0,d.jsx)("button",{onClick:()=>m("list"),className:"p-2 rounded-md transition-colors ".concat("list"===c?"bg-primary text-primary-content":"text-foreground-muted dark:text-dark-foreground-muted hover:bg-border dark:hover:bg-dark-border"),"aria-label":"List view",children:(0,d.jsx)(()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),{})})]})]}),(0,d.jsx)("div",{className:"flex space-x-2 mt-4 overflow-x-auto pb-2",children:x.map(e=>(0,d.jsx)("button",{onClick:()=>i(e),className:"px-4 py-1.5 rounded-md text-sm font-semibold whitespace-nowrap transition-colors duration-200 ".concat(l===e?"bg-primary text-primary-content":"bg-muted text-foreground-muted hover:bg-border dark:bg-dark-muted dark:text-dark-foreground-muted dark:hover:bg-dark-border"),children:e},e))})]}),(0,d.jsxs)("div",{className:"flex-grow overflow-y-auto mt-4 pr-1",children:["grid"===c?(0,d.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:h.map(e=>(0,d.jsx)(el,{product:e,onAddToCart:r},e.id))}):(0,d.jsx)("div",{className:"space-y-2",children:h.map(e=>(0,d.jsx)(ec,{product:e,onAddToCart:r},e.id))}),0===h.length&&(0,d.jsx)("div",{className:"text-center py-10 text-foreground-muted dark:text-dark-foreground-muted",children:(0,d.jsx)("p",{children:"No products found matching your search."})})]})]})},eu=e=>{let{customers:t,selectedCustomerId:r,onCustomerChange:a,disabled:s=!1,filter:n}=e,[l,i]=(0,o.useState)(""),[c,m]=(0,o.useState)(!1),u=(0,o.useRef)(null),x=(0,o.useMemo)(()=>n?t.filter(n):t,[t,n]),h=(0,o.useMemo)(()=>t.find(e=>e.id===r),[t,r]),p=(0,o.useMemo)(()=>{if(!l)return x;let e=l.toLowerCase();return x.filter(t=>t.name.toLowerCase().includes(e)||t.phone.toLowerCase().includes(e))},[x,l]);(0,o.useEffect)(()=>{function e(e){u.current&&!u.current.contains(e.target)&&(m(!1),i(""))}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[u]);let b=e=>{a(e),i(""),m(!1)},g=c?l:(null==h?void 0:h.name)||"";return(0,d.jsxs)("div",{className:"relative",ref:u,children:[(0,d.jsx)("input",{type:"text",value:g,onChange:e=>{i(e.target.value),c||m(!0)},onFocus:()=>{i(""),m(!0)},placeholder:"Search by name or phone...",disabled:s,className:"w-full bg-background dark:bg-dark-card border border-border dark:border-dark-border rounded-md p-2 text-sm text-foreground dark:text-dark-foreground focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary"}),c&&!s&&(0,d.jsx)("ul",{className:"absolute z-10 w-full mt-1 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-lg max-h-60 overflow-y-auto",children:p.length>0?p.map(e=>(0,d.jsxs)("li",{onClick:()=>b(e.id),className:"px-4 py-2 text-sm hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",children:[(0,d.jsx)("p",{className:"font-semibold text-foreground dark:text-dark-foreground",children:e.name}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:e.phone})]},e.id)):(0,d.jsx)("li",{className:"px-4 py-2 text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"No customers found."})})]})};let ex=["m","kg","g","ltr","sq ft"],eh=e=>{var t,r;let{item:a,onApply:s,onClose:n}=e,[l,i]=(0,o.useState)((null===(t=a.discount)||void 0===t?void 0:t.type)||"fixed"),[c,m]=(0,o.useState)((null===(r=a.discount)||void 0===r?void 0:r.value)||""),u=()=>{Number(c)>0?s({type:l,value:Number(c)}):s(void 0),n()};return(0,d.jsxs)("div",{className:"absolute right-0 top-full mt-1 bg-white/50 dark:bg-dark-border/80 backdrop-blur-md p-2 rounded-lg shadow-xl z-20 w-48 border border-white/20 dark:border-white/10",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex bg-muted dark:bg-dark-muted p-0.5 rounded-md mb-2",children:[(0,d.jsx)("button",{onClick:()=>i("fixed"),className:"w-1/2 text-xs py-1 rounded ".concat("fixed"===l?"bg-white dark:bg-dark-card font-bold text-primary dark:text-dark-primary":"text-foreground-muted"),children:"Fixed"}),(0,d.jsx)("button",{onClick:()=>i("percentage"),className:"w-1/2 text-xs py-1 rounded ".concat("percentage"===l?"bg-white dark:bg-dark-card font-bold text-primary dark:text-dark-primary":"text-foreground-muted"),children:"%"})]}),(0,d.jsx)("input",{type:"number",value:c,onChange:e=>m(e.target.value),className:"w-full p-1 border rounded-md text-sm bg-background dark:bg-dark-background border-border dark:border-dark-border",placeholder:"fixed"===l?"e.g. 100":"e.g. 10",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&u()}}),(0,d.jsx)("button",{onClick:u,className:"w-full mt-2 bg-primary text-primary-content text-xs font-bold py-1.5 rounded",children:"Apply"})]})};var ep=e=>{let{cartItems:t,customers:r,selectedCustomerId:a,onCustomerChange:s,updateQuantity:l,updateCartItemDiscount:i,removeItem:c,onCharge:m,isOnline:u,settings:x,activeShift:h,onStartShift:p,onEndShiftRequest:b,onHoldRequest:g,onLayawayRequest:f,currentUser:k,depositApplied:y=0}=e,[j,v]=(0,o.useState)(0),[w,C]=(0,o.useState)(!1),[S,D]=(0,o.useState)(""),[P,T]=(0,o.useState)(null),I=x.discount,A={type:I.type,value:j},{subtotal:M,lineItemsDiscountAmount:F,cartDiscountAmount:L,taxableAmount:O,tax:R,total:B}=(0,o.useMemo)(()=>K(t,A,x.tax.vatRate/100),[t,A,x.tax.vatRate]),_=(e,t,r)=>{l(e,t+r)},E=(e,t)=>{let r=parseFloat(t);isNaN(r)||l(e,r)};return(0,d.jsxs)("div",{className:"flex-1 flex flex-col bg-transparent relative min-h-0",children:[(0,d.jsx)(n.M,{children:w&&(0,d.jsxs)("div",{className:"absolute inset-0 bg-white/50 dark:bg-dark-card/70 backdrop-blur-xl z-20 flex flex-col items-center justify-center p-6 space-y-4",children:[(0,d.jsx)("div",{className:"mx-auto bg-primary-soft text-primary dark:bg-dark-primary-soft dark:text-dark-primary w-16 h-16 rounded-full flex items-center justify-center mb-2",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,d.jsx)("h4",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:"Enter Starting Float"}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"number"==typeof S&&S>=0&&(p(S),C(!1),D(""))},className:"w-full space-y-4",children:[(0,d.jsx)("input",{type:"number",value:S,onChange:e=>D(""===e.target.value?"":Number(e.target.value)),className:"block w-full text-center text-xl font-bold p-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary",placeholder:"e.g., 5000",autoFocus:!0}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsx)("button",{type:"button",onClick:()=>C(!1),whileTap:{scale:.95},className:"flex-1 bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold py-2 rounded-xl transition-shadow shadow-clay-light active:shadow-clay-light-inset dark:shadow-clay-dark dark:active:shadow-clay-dark-inset",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"flex-1 bg-primary dark:bg-dark-primary text-primary-content dark:text-dark-primary-content font-bold py-2 rounded-xl transition-shadow shadow-clay-light active:shadow-clay-light-inset dark:shadow-clay-dark dark:active:shadow-clay-dark-inset",children:"Confirm"})]})]})]})}),(0,d.jsx)("div",{className:"p-4 border-b border-white/20 dark:border-white/10 bg-white/10 dark:bg-black/10",children:(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground",children:"Shift Status"}),(0,d.jsx)("p",{className:"text-sm font-bold ".concat(h?"text-accent dark:text-dark-accent":"text-foreground-muted dark:text-dark-foreground-muted"),children:h?"Active (".concat(new Date(h.startTime).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",timeZone:"Africa/Nairobi"}),")"):"Inactive"})]}),(0,d.jsx)("button",{onClick:()=>{h?b():C(!0)},className:"relative inline-flex items-center h-6 rounded-full w-11 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary shadow-clay-light-inset dark:shadow-clay-dark-inset ".concat(h?"bg-accent dark:bg-dark-accent":"bg-border dark:bg-dark-border"),"aria-label":h?"End Shift":"Start Shift",children:(0,d.jsx)("span",{className:"inline-block w-4 h-4 bg-white rounded-full transform transition-transform shadow-clay-light dark:shadow-clay-dark ".concat(h?"translate-x-6":"translate-x-1")})})]})}),(0,d.jsxs)("div",{className:"p-4 border-b border-white/20 dark:border-white/10",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:"Current Sale"}),t.length>0&&(0,d.jsxs)("span",{className:"text-sm font-bold bg-muted/50 dark:bg-dark-muted/50 text-foreground-muted dark:text-dark-foreground-muted px-2.5 py-1 rounded-full",children:[t.reduce((e,t)=>e+t.quantity,0)," items"]})]}),(0,d.jsx)(eu,{customers:r,selectedCustomerId:a,onCustomerChange:s,disabled:!h})]}),(0,d.jsx)("div",{className:"flex-grow overflow-y-auto",children:0===t.length?(0,d.jsx)("div",{className:"h-full flex items-center justify-center text-foreground-muted dark:text-dark-foreground-muted",children:(0,d.jsx)("p",{children:"Cart is empty. Add products to start."})}):(0,d.jsx)("ul",{className:"divide-y divide-white/20 dark:divide-white/10",children:(0,d.jsx)(n.M,{children:t.map(e=>{let t=ex.includes(e.unitOfMeasure);return(0,d.jsxs)("li",{className:"p-4 flex space-x-3",children:[(0,d.jsxs)("div",{className:"flex-grow",children:[(0,d.jsx)("p",{className:"font-bold text-sm text-foreground dark:text-dark-foreground",children:e.name}),(0,d.jsxs)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:["Ksh ",e.price.toFixed(2)," / ",e.unitOfMeasure]}),e.discount&&(0,d.jsxs)("p",{className:"text-xs text-accent dark:text-dark-accent font-semibold",children:["Discount: -","fixed"===e.discount.type?"Ksh ".concat(e.discount.value.toFixed(2)):"".concat(e.discount.value,"%")]})]}),(0,d.jsx)("div",{className:"flex items-center",children:t?(0,d.jsx)("input",{type:"number",value:e.quantity,onChange:t=>E(e.id,t.target.value),step:"0.01",className:"w-20 p-1 text-center font-bold bg-transparent border border-white/20 dark:border-white/10 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"}):(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("button",{whileTap:{scale:.9},onClick:()=>_(e.id,e.quantity,-1),className:"w-6 h-6 rounded-full bg-background/50 text-foreground hover:bg-border dark:bg-dark-border/50 dark:text-dark-foreground dark:hover:bg-dark-border",children:"-"}),(0,d.jsx)("span",{className:"font-bold w-6 text-center text-foreground dark:text-dark-foreground",children:e.quantity}),(0,d.jsx)("button",{whileTap:{scale:.9},onClick:()=>_(e.id,e.quantity,1),className:"w-6 h-6 rounded-full bg-background/50 text-foreground hover:bg-border dark:bg-dark-border/50 dark:text-dark-foreground dark:hover:bg-dark-border",children:"+"})]})}),(0,d.jsxs)("p",{className:"font-bold w-20 text-right text-foreground dark:text-dark-foreground",children:["Ksh ",(e.price*e.quantity).toFixed(2)]}),(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-1",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("button",{whileTap:{scale:.9},onClick:()=>T(P===e.id?null:e.id),className:"p-1 rounded-full ".concat(e.discount?"text-accent dark:text-dark-accent":"text-foreground-muted dark:text-dark-foreground-muted hover:text-accent"),children:o.cloneElement(N.discount,{className:"h-5 w-5"})}),P===e.id&&(0,d.jsx)(eh,{item:e,onApply:t=>i(e.id,t),onClose:()=>T(null)})]}),(0,d.jsx)("button",{whileTap:{scale:.9},onClick:()=>c(e.id),className:"text-danger/70 hover:text-danger",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},e.id)})})})}),(0,d.jsxs)("div",{className:"p-4 border-t border-white/20 dark:border-white/10 bg-white/10 dark:bg-black/10 space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Gross Subtotal"}),(0,d.jsxs)("span",{className:"font-bold text-foreground dark:text-dark-foreground",children:["Ksh ",M.toFixed(2)]})]}),F>0&&(0,d.jsxs)("div",{className:"flex justify-between text-sm text-danger",children:[(0,d.jsx)("span",{children:"Item Discounts"}),(0,d.jsxs)("span",{children:["- Ksh ",F.toFixed(2)]})]}),I.enabled&&(0,d.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,d.jsxs)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:["Cart Discount (","percentage"===A.type?"%":"KES",")"]}),(0,d.jsx)("input",{type:"number",value:j,onChange:e=>{let t=parseFloat(e.target.value)||0;v(t=Math.max(0,Math.min(I.maxValue,t)))},max:I.maxValue,className:"w-20 text-right font-bold text-foreground dark:text-dark-foreground bg-transparent border rounded-md px-2 py-1 dark:border-white/20"})]}),L>0&&(0,d.jsxs)("div",{className:"flex justify-between text-sm text-danger",children:[(0,d.jsx)("span",{children:"Cart Discount Amount"}),(0,d.jsxs)("span",{children:["- Ksh ",L.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Taxable Amount"}),(0,d.jsxs)("span",{className:"font-bold text-foreground dark:text-dark-foreground",children:["Ksh ",O.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsxs)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:["VAT (",x.tax.vatRate,"%)"]}),(0,d.jsxs)("span",{className:"font-bold text-foreground dark:text-dark-foreground",children:["Ksh ",R.toFixed(2)]})]}),y>0&&(0,d.jsxs)("div",{className:"flex justify-between text-sm text-accent dark:text-dark-accent",children:[(0,d.jsx)("span",{children:"Deposit Paid"}),(0,d.jsxs)("span",{children:["- Ksh ",y.toFixed(2)]})]}),(0,d.jsx)("div",{className:"rounded-xl p-4 bg-gradient-to-r from-primary to-secondary dark:from-dark-primary dark:to-dark-secondary text-primary-content dark:text-dark-primary-content animate-neural-pulse",children:(0,d.jsxs)("div",{className:"flex justify-between text-lg",children:[(0,d.jsx)("span",{className:"font-bold",children:"Total"}),(0,d.jsxs)("span",{className:"font-bold",children:["Ksh ",(B-y).toFixed(2)]})]})}),(0,d.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,d.jsx)("button",{onClick:g,disabled:0===t.length||!h,whileTap:{scale:.98},className:"flex-1 bg-muted dark:bg-dark-background text-foreground dark:text-dark-foreground font-bold py-3 rounded-xl transition-shadow shadow-clay-light active:shadow-clay-light-inset dark:shadow-clay-dark-strong dark:active:shadow-clay-dark-inset disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:shadow-none flex items-center justify-center text-lg",children:"Hold"}),(0,d.jsx)("button",{onClick:f,disabled:0===t.length||!h,whileTap:{scale:.98},className:"flex-1 bg-muted dark:bg-dark-background text-foreground dark:text-dark-foreground font-bold py-3 rounded-xl transition-shadow shadow-clay-light active:shadow-clay-light-inset dark:shadow-clay-dark-strong dark:active:shadow-clay-dark-inset disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:shadow-none flex items-center justify-center text-lg",children:"Layaway"}),(0,d.jsxs)("button",{onClick:()=>m(A),disabled:0===t.length||!h,whileTap:{scale:.98},className:"flex-1 bg-primary dark:bg-dark-primary text-primary-content dark:text-dark-primary-content font-bold py-3 rounded-xl transition-shadow shadow-clay-light active:shadow-clay-light-inset dark:shadow-clay-dark-strong dark:active:shadow-clay-dark-inset disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:shadow-none flex items-center justify-center text-lg",children:["Charge",!u&&(0,d.jsx)("span",{className:"text-xs ml-2",children:"(Offline)"})]})]})]})]})},eb=e=>{let{cartItems:t,discount:r,onClose:a,onCompleteSale:s,customer:l,settings:i,depositApplied:c=0}=e,[m,u]=(0,o.useState)("Cash"),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)("prompting"),[g,f]=(0,o.useState)("N/A"!==l.phone?l.phone:""),[k,y]=(0,o.useState)(null),[j,v]=(0,o.useState)(null),[w,N]=(0,o.useState)(""),[C,S]=(0,o.useState)(!0),[D,P]=(0,o.useState)("keypad"),{total:T}=(0,o.useMemo)(()=>K(t,r,i.tax.vatRate/100),[t,r,i.tax.vatRate]),I=T-c,A=(0,o.useMemo)(()=>i.loyalty.enabled&&l&&"cust001"!==l.id?Math.min(i.loyalty.maxRedemptionPercentage/100*I,l.loyaltyPoints*i.loyalty.redemptionRate):0,[l,I,i.loyalty]),M=(0,o.useMemo)(()=>i.loyalty.enabled&&""!==w?Math.min(Number(w)*i.loyalty.redemptionRate,A):0,[w,A,i.loyalty]),F=I-M,L=(0,o.useMemo)(()=>{if(""===x)return 0;let e=Number(x);return isNaN(e)?0:Math.max(0,e-F)},[x,F]),O=(0,o.useMemo)(()=>{if(F<=0)return[];let e=[],t=Math.ceil(F);for(let r of(e.push(t),[100,200,500,1e3,2e3,5e3]))r>t&&e.push(r);if(t>100){let r=100*Math.ceil(t/100);r>t&&e.push(r)}if(t>1e3){let r=1e3*Math.ceil(t/1e3);r>t&&e.push(r)}return[...new Set(e)].sort((e,t)=>e-t).slice(0,4)},[F]),R=async()=>{b("sending"),v(null),console.log("Initiating STK Push to",g,"for",F),setTimeout(()=>{b("waiting"),setTimeout(()=>{Math.random()>.2?(b("success"),y("R".concat(Math.random().toString(36).substring(2,12).toUpperCase()))):(b("failure"),v("The transaction was cancelled by the user."))},5e3)},1e3)},B=e=>{let{onKeyPress:t}=e;return(0,d.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["7","8","9","4","5","6","1","2","3",".","0","⌫"].map(e=>(0,d.jsx)("button",{type:"button",whileTap:{scale:.95},onClick:()=>t(e),className:"bg-muted/50 dark:bg-dark-muted/50 text-foreground dark:text-dark-foreground font-bold py-4 rounded-xl text-xl hover:bg-border dark:hover:bg-dark-border transition-colors shadow-clay active:shadow-clay-inset",children:e},e))})},_=e=>{if("⌫"===e)h(e=>e.slice(0,-1));else{if("."===e&&x.includes("."))return;h(t=>"".concat(t).concat(e))}},E=e=>{let{onAdd:t}=e;return(0,d.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[1e3,500,200,100,50,20,10,5].map(e=>(0,d.jsxs)("button",{type:"button",whileTap:{scale:.95},onClick:()=>t(e),className:"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-800 dark:text-emerald-300 font-bold py-3 rounded-xl text-sm hover:bg-emerald-200 dark:hover:bg-emerald-800 transition-colors shadow-clay active:shadow-clay-inset",children:["Ksh ",e]},e))})},q=e=>{h(t=>String((Number(t)||0)+e))};return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:a,children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-white/50 dark:bg-dark-card/50 backdrop-blur-2xl border border-white/20 dark:border-white/10 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-6 border-b border-white/20 dark:border-white/10",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Finalize Payment"}),(0,d.jsx)("button",{onClick:a,className:"text-foreground/60 hover:text-foreground dark:text-dark-foreground/60 dark:hover:text-dark-foreground text-2xl",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"flex-grow flex flex-col md:flex-row overflow-hidden",children:[(0,d.jsxs)("div",{className:"w-full md:w-1/3 border-b md:border-b-0 md:border-r border-white/20 dark:border-white/10 p-6 space-y-4 overflow-y-auto",children:[(0,d.jsx)("h3",{className:"font-bold text-lg",children:"Order Summary"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground/70 dark:text-dark-foreground/70",children:"Total (Pre-deposit)"})," ",(0,d.jsx)("span",{className:"font-mono",children:T.toFixed(2)})]}),c>0&&(0,d.jsxs)("div",{className:"flex justify-between text-accent dark:text-dark-accent",children:[(0,d.jsx)("span",{children:"Deposit Paid"})," ",(0,d.jsxs)("span",{className:"font-mono",children:["- ",c.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground/70 dark:text-dark-foreground/70",children:"Balance Due"})," ",(0,d.jsx)("span",{className:"font-mono",children:I.toFixed(2)})]}),i.loyalty.enabled&&"cust001"!==l.id&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"pt-2 border-t border-white/20 dark:border-white/10"}),(0,d.jsx)("label",{className:"block font-medium",children:"Use Loyalty Points"}),(0,d.jsxs)("p",{className:"text-xs text-foreground/60 dark:text-dark-foreground/60",children:["Balance: ",l.loyaltyPoints," pts (Max Value: Ksh ",A.toFixed(2),")"]}),(0,d.jsx)("input",{type:"number",value:w,onChange:e=>N(""===e.target.value?"":Math.max(0,Math.min(Number(e.target.value),l.loyaltyPoints))),className:"w-full p-2 border rounded-lg bg-white/20 dark:bg-dark-background/50 border-white/20 dark:border-dark-border"}),M>0&&(0,d.jsxs)("div",{className:"flex justify-between text-accent dark:text-dark-accent",children:[(0,d.jsx)("span",{children:"Points Value"})," ",(0,d.jsxs)("span",{className:"font-mono",children:["- ",M.toFixed(2)]})]})]})]}),(0,d.jsxs)("div",{className:"pt-4 border-t border-white/20 dark:border-white/10 text-2xl font-bold text-primary dark:text-dark-primary flex justify-between",children:[(0,d.jsx)("span",{children:"To Pay"}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",F.toFixed(2)]})]})]}),(0,d.jsxs)("div",{className:"w-full md:w-2/3 p-6 flex flex-col overflow-y-auto",children:[(0,d.jsx)("div",{className:"flex bg-background/50 dark:bg-dark-background/50 p-1 rounded-xl mb-4",children:[{type:"Cash",name:"Cash"},{type:"M-Pesa",name:"M-Pesa"},{type:"Card",name:"Card"}].map(e=>(0,d.jsx)("button",{onClick:()=>u(e.type),className:"w-1/3 py-2 text-sm font-bold transition-colors rounded-lg ".concat(m===e.type?"bg-card dark:bg-dark-card shadow text-primary dark:text-dark-primary":"text-foreground/70 dark:text-dark-foreground/70"),children:e.name},e.type))}),(0,d.jsx)(n.M,{mode:"wait",children:(0,d.jsx)("div",{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:(()=>{switch(m){case"Cash":return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"space-y-2 text-center",children:[(0,d.jsx)("label",{htmlFor:"cashReceived",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Cash Received"}),(0,d.jsx)("input",{id:"cashReceived",type:"text",inputMode:"decimal",value:x,onChange:e=>{let t=e.target.value;/^$|^\d*\.?\d*$/.test(t)&&h(t)},className:"block w-full text-center text-4xl font-bold p-2 bg-transparent border-0 border-b-2 border-border dark:border-dark-border focus:outline-none focus:ring-0 focus:border-primary dark:focus:border-dark-primary transition-colors",placeholder:F.toFixed(2),autoFocus:!0}),(0,d.jsx)("div",{className:"flex flex-wrap gap-2 justify-center pt-2",children:O.map(e=>(0,d.jsx)("button",{type:"button",whileTap:{scale:.95},onClick:()=>h(String(e)),className:"bg-muted/50 dark:bg-dark-muted/50 text-foreground dark:text-dark-foreground font-bold py-1 px-4 rounded-xl text-sm hover:bg-border dark:hover:bg-dark-border shadow-clay active:shadow-clay-inset",children:e},e))}),L>0&&(0,d.jsxs)("div",{className:"text-center font-bold text-xl text-primary dark:text-dark-primary pt-2",children:["Change Due: Ksh ",L.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"w-full max-w-xs mx-auto pt-2",children:[(0,d.jsxs)("div",{className:"flex justify-center bg-background/50 dark:bg-dark-background/50 p-1 rounded-xl mb-2",children:[(0,d.jsx)("button",{type:"button",onClick:()=>P("keypad"),className:"px-4 py-1.5 rounded-lg text-sm font-bold transition-colors w-1/2 ".concat("keypad"===D?"bg-card dark:bg-dark-card shadow text-primary dark:text-dark-primary":"text-foreground/70 dark:text-dark-foreground/70"),children:"Keypad"}),(0,d.jsx)("button",{type:"button",onClick:()=>P("notes"),className:"px-4 py-1.5 rounded-lg text-sm font-bold transition-colors w-1/2 ".concat("notes"===D?"bg-card dark:bg-dark-card shadow text-primary dark:text-dark-primary":"text-foreground/70 dark:text-dark-foreground/70"),children:"Notes"})]}),(0,d.jsx)(n.M,{mode:"wait",children:(0,d.jsx)("div",{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:"keypad"===D?(0,d.jsx)(B,{onKeyPress:_}):(0,d.jsx)(E,{onAdd:q})},D)})]})]});case"M-Pesa":return(0,d.jsxs)("div",{className:"space-y-4 text-center",children:["prompting"===p&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{className:"text-sm text-foreground/70 dark:text-dark-foreground/70",children:"Enter customer's phone number to trigger STK push."}),(0,d.jsx)("input",{type:"tel",value:g,onChange:e=>f(e.target.value),className:"block w-full text-center text-lg font-bold p-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-xl shadow-sm",placeholder:"0712345678"}),(0,d.jsx)("button",{whileTap:{scale:.95},onClick:R,className:"w-full bg-accent dark:bg-dark-accent text-white font-bold py-2 rounded-xl shadow-clay active:shadow-clay-inset",children:"Send STK Push"})]}),("sending"===p||"waiting"===p)&&(0,d.jsxs)("div",{className:"flex flex-col items-center p-4 space-y-2",children:[(0,d.jsx)("div",{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-8 h-8 border-4 border-accent dark:border-dark-accent border-t-transparent rounded-full"}),(0,d.jsx)("p",{className:"font-semibold",children:"sending"===p?"Sending request to phone...":"Waiting for customer to enter M-Pesa PIN..."})]}),"success"===p&&(0,d.jsxs)("div",{className:"p-4 bg-accent/10 text-accent dark:text-dark-accent rounded-xl space-y-1",children:[(0,d.jsx)("h4",{className:"font-bold",children:"Payment Successful!"}),(0,d.jsxs)("p",{className:"text-sm",children:["Ref: ",k]})]}),"failure"===p&&(0,d.jsxs)("div",{className:"p-4 bg-danger/10 text-danger rounded-xl space-y-1",children:[(0,d.jsx)("h4",{className:"font-bold",children:"Payment Failed"}),(0,d.jsx)("p",{className:"text-sm",children:j}),(0,d.jsx)("button",{onClick:()=>b("prompting"),className:"text-sm font-bold underline",children:"Try Again"})]})]});case"Card":return(0,d.jsxs)("div",{className:"text-center p-4 bg-accent/10 dark:bg-dark-accent/20 text-accent dark:text-dark-accent rounded-xl font-semibold",children:["Please use your card terminal to process Ksh ",F.toFixed(2),"."]});default:return null}})()},m)})]})]}),(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-t border-white/20 dark:border-white/10",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",id:"autoPrint",checked:C,onChange:e=>S(e.target.checked),className:"h-4 w-4 text-primary rounded border-border focus:ring-primary"}),(0,d.jsx)("label",{htmlFor:"autoPrint",className:"ml-2 text-sm font-medium text-foreground dark:text-dark-foreground",children:"Print receipt after sale"})]}),(0,d.jsx)("button",{onClick:()=>{let{subtotal:e,totalDiscountAmount:a,lineItemsDiscountAmount:d,cartDiscountAmount:o,taxableAmount:n,tax:u}=K(t,r,i.tax.vatRate/100),h=[];"Cash"===m?h.push({method:"Cash",amount:Number(x)||F}):"M-Pesa"===m?h.push({method:"M-Pesa",amount:F,details:{transactionCode:k||"N/A_MANUAL",phoneNumber:g}}):"Card"===m&&h.push({method:"Card",amount:F}),M>0&&h.push({method:"Points",amount:M}),s({items:t,subtotal:e,lineItemsDiscountAmount:d,cartDiscountAmount:o,cartDiscount:r,discountAmount:a,taxableAmount:n,tax:u,total:F,payments:h,change:L,customerId:l.id,date:new Date,pointsUsed:Number(w)||0,pointsValue:M||0,depositApplied:c},{autoPrint:C})},disabled:"M-Pesa"===m&&"success"!==p||"Cash"===m&&Number(x)<F,className:"bg-primary text-primary-content font-bold py-3 px-8 rounded-xl text-lg transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset disabled:bg-slate-400 dark:disabled:bg-slate-600",whileTap:{scale:.98},children:"Complete Sale"})]})]})})},eg=r(35819),ef=r(3891),ek=r.n(ef);let ey=()=>(0,d.jsx)("div",{className:"border-t border-dashed border-black my-2"});var ej=e=>{var t;let{sale:r,cashierName:a,settings:s,layaway:n}=e,l=r.payments.find(e=>"Cash"===e.method),i=l&&r.change>0?l.amount:null,c=(0,o.useRef)(null),m=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(c.current&&r.kraQrCodeData&&eg.toCanvas(c.current,r.kraQrCodeData,{width:128,margin:1},e=>{e&&console.error("KRA QR Code Error:",e)}),m.current&&r.id)try{ek()(m.current,r.id,{format:"CODE128",width:1,height:40,displayValue:!1,margin:0})}catch(e){console.error("Barcode generation failed:",e)}},[r.id,r.kraQrCodeData]);let u=!!n,x=!u&&r.grandTotal&&(void 0!==r.balanceDue||void 0!==r.depositApplied),h=u&&n.payments.length>0&&n.payments[0].saleId===r.id,p=u&&h?n.items:r.items,b=u&&n.balance<=0,g="SALE RECEIPT";return u&&(g=h?"LAYAWAY DEPOSIT RECEIPT":b?"LAYAWAY - PAID IN FULL":"LAYAWAY INSTALLMENT"),(0,d.jsxs)("div",{className:"bg-white p-4 font-mono text-xs text-black w-full max-w-xs mx-auto",children:[(0,d.jsxs)("div",{className:"text-center mb-2",children:[s.businessInfo.logoUrl&&(0,d.jsx)("img",{src:s.businessInfo.logoUrl,alt:"Business Logo",className:"mx-auto h-16 w-auto object-contain mb-2"}),(0,d.jsx)("h2",{className:"text-base font-bold uppercase",children:s.businessInfo.name}),s.businessInfo.branch&&(0,d.jsx)("p",{className:"font-semibold",children:s.businessInfo.branch}),(0,d.jsx)("p",{children:s.businessInfo.location}),(0,d.jsxs)("p",{children:["Tel: ",s.businessInfo.phone]}),s.businessInfo.email&&(0,d.jsxs)("p",{children:["Email: ",s.businessInfo.email]}),s.tax.etimsEnabled&&s.businessInfo.kraPin&&(0,d.jsxs)("p",{children:["VAT PIN: ",s.businessInfo.kraPin]})]}),(0,d.jsx)(ey,{}),(0,d.jsx)("div",{className:"text-center font-bold text-base my-1",children:g}),(0,d.jsx)("table",{className:"w-full",children:(0,d.jsx)("tbody",{children:(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{className:"text-left",children:["Date: ",new Date(r.date).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})]}),(0,d.jsxs)("td",{className:"text-right",children:["Time: ",new Date(r.date).toLocaleTimeString("en-GB",{hour12:!1,timeZone:"Africa/Nairobi"})]})]})})}),(0,d.jsxs)("p",{children:["Receipt No: ",r.id]}),(0,d.jsxs)("p",{children:["Serial No: ",r.id]}),(0,d.jsxs)("p",{children:["Cashier: ",a]}),(0,d.jsx)(ey,{}),(0,d.jsxs)("table",{className:"w-full",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"font-bold border-b border-dashed border-black",children:[(0,d.jsx)("th",{className:"text-left py-1",colSpan:3,children:"Item"}),(0,d.jsx)("th",{className:"text-right py-1",children:"Total"})]})}),(0,d.jsx)("tbody",{children:(p||[]).map(e=>{let t=e.price*Math.abs(e.quantity),r=0;return e.discount&&(r="percentage"===e.discount.type?e.discount.value/100*t:e.discount.value,r=Math.min(t,r)),(0,d.jsxs)(o.Fragment,{children:[(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:4,className:"pt-1 font-semibold",children:e.name})}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{colSpan:3,className:"pl-2 text-xs",children:[Math.abs(e.quantity)," x ",e.price.toFixed(2)]}),(0,d.jsx)("td",{className:"text-right",children:t.toFixed(2)})]}),r>0&&(0,d.jsx)("tr",{children:(0,d.jsxs)("td",{colSpan:4,className:"text-right text-xs italic text-gray-600",children:["Discount: -",r.toFixed(2)]})})]},e.id)})})]}),(0,d.jsx)(ey,{}),(0,d.jsx)("table",{className:"w-full",children:(0,d.jsx)("tbody",{children:u&&n?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Layaway Total Value:"}),(0,d.jsx)("td",{className:"text-right py-0.5 font-semibold",children:n.total.toFixed(2)})]}),!h&&(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Previous Balance:"}),(0,d.jsx)("td",{className:"text-right py-0.5 font-semibold",children:(n.balance+r.total).toFixed(2)})]}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{className:"py-0.5",children:[h?"Deposit Paid":"Amount Paid Now",":"]}),(0,d.jsx)("td",{className:"text-right py-0.5 font-semibold",children:r.total.toFixed(2)})]}),(0,d.jsxs)("tr",{className:"font-bold",children:[(0,d.jsx)("td",{className:"py-0.5",children:"Total Paid to Date:"}),(0,d.jsx)("td",{className:"text-right py-0.5",children:(n.total-n.balance).toFixed(2)})]}),(0,d.jsxs)("tr",{className:"font-bold text-base border-y-2 border-double border-black my-1",children:[(0,d.jsx)("td",{className:"py-1",children:"BALANCE DUE:"}),(0,d.jsxs)("td",{className:"text-right py-1",children:["KSH ",n.balance.toFixed(2)]})]}),(0,d.jsx)("tr",{children:(0,d.jsxs)("td",{colSpan:2,className:"py-1 text-xs",children:["Due By: ",new Date(n.expiryDate).toLocaleDateString("en-GB")]})})]}):x?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Order Total:"}),(0,d.jsx)("td",{className:"text-right py-0.5 font-semibold",children:(r.grandTotal||0).toFixed(2)})]}),r.depositApplied&&r.depositApplied>0&&(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Less Deposit Paid:"}),(0,d.jsxs)("td",{className:"text-right py-0.5 font-semibold",children:["-",r.depositApplied.toFixed(2)]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Amount Paid Now:"}),(0,d.jsx)("td",{className:"text-right py-0.5 font-semibold",children:r.total.toFixed(2)})]}),(0,d.jsxs)("tr",{className:"font-bold text-base border-y-2 border-double border-black my-1",children:[(0,d.jsx)("td",{className:"py-1",children:"TOTAL PAID TO DATE:"}),(0,d.jsxs)("td",{className:"text-right py-1",children:["KSH ",((r.depositApplied||0)+r.total).toFixed(2)]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Balance Due:"}),(0,d.jsx)("td",{className:"text-right py-0.5 font-semibold",children:(null!==(t=r.balanceDue)&&void 0!==t?t:0).toFixed(2)})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Gross Total:"}),(0,d.jsx)("td",{className:"text-right py-0.5 font-semibold",children:r.subtotal.toFixed(2)})]}),r.discountAmount>0&&(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Total Discounts:"}),(0,d.jsxs)("td",{className:"text-right py-0.5 font-semibold",children:["-",r.discountAmount.toFixed(2)]})]}),(0,d.jsxs)("tr",{className:"font-bold text-base border-y-2 border-double border-black my-1",children:[(0,d.jsx)("td",{className:"py-1",children:"TOTAL PAID:"}),(0,d.jsxs)("td",{className:"text-right py-1",children:["KSH ",r.total.toFixed(2)]})]})]})})}),s.tax.vatEnabled&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ey,{}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("p",{className:"font-bold",children:"VAT Breakdown:"}),(0,d.jsx)("table",{className:"w-full",children:(0,d.jsxs)("tbody",{children:[(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Taxable Amount:"}),(0,d.jsx)("td",{className:"text-right py-0.5",children:r.taxableAmount.toFixed(2)})]}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{className:"py-0.5",children:["VAT (",s.tax.vatRate,"%):"]}),(0,d.jsx)("td",{className:"text-right py-0.5",children:r.tax.toFixed(2)})]})]})})]})]}),(0,d.jsx)(ey,{}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-bold mb-1",children:"Payment Details:"}),(0,d.jsx)("table",{className:"w-full",children:(0,d.jsxs)("tbody",{children:[null!==i&&(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5",children:"Amount Tendered (Cash):"}),(0,d.jsx)("td",{className:"text-right py-0.5",children:i.toFixed(2)})]}),r.payments.map((e,t)=>"Cash"===e.method&&null!==i?null:(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{className:"py-0.5",children:["Points"===e.method?"Loyalty Points":e.method,":"]}),(0,d.jsx)("td",{className:"text-right py-0.5",children:"Points"===e.method?"-".concat(e.amount.toFixed(2)):e.amount.toFixed(2)})]},t)),r.change>0&&(0,d.jsxs)("tr",{className:"font-bold",children:[(0,d.jsx)("td",{className:"py-0.5",children:"Change:"}),(0,d.jsx)("td",{className:"text-right py-0.5",children:r.change.toFixed(2)})]})]})})]}),s.tax.etimsEnabled&&r.kraIcn&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ey,{}),(0,d.jsxs)("div",{className:"text-center my-2",children:[(0,d.jsx)("p",{className:"font-bold",children:"KRA eTIMS INVOICE"}),(0,d.jsxs)("p",{className:"text-xs",children:["ICN: ",(0,d.jsx)("span",{className:"font-mono",children:r.kraIcn})]}),(0,d.jsx)("div",{className:"flex justify-center my-2",children:(0,d.jsx)("canvas",{ref:c})}),(0,d.jsx)("p",{className:"text-[10px]",children:"This is an official KRA receipt."})]})]}),(0,d.jsx)("div",{className:"flex flex-col items-center my-4",children:(0,d.jsx)("canvas",{ref:m})}),(0,d.jsx)("div",{className:"text-center space-y-1",children:s.receipt.footer.split("\n").map((e,t)=>(0,d.jsx)("p",{children:e},t))})]})};let ev=e=>{let{sale:t,layaway:r,onNewSale:a,currentUser:s,settings:n,onWhatsAppReceiptRequest:l,shouldAutoPrint:i,onAutoPrintDone:c,showToast:m}=e,u=async()=>{let{type:e,vendorId:r,productId:a}=n.hardware.printer;if("ESC/POS"===e){if(!r||!a){m("ESC/POS printer not configured. Please connect one in Settings > Hardware.","warning"),setTimeout(()=>window.print(),500);return}try{await U(t,n,t.cashierName)}catch(e){var s;console.error("Direct print failed:",e),(null===(s=e.message)||void 0===s?void 0:s.includes("driver may be blocking access"))?(m("Direct print failed. Falling back to Browser Print.","warning"),setTimeout(()=>window.print(),500)):m(e.message||"Direct print failed. Please check printer connection.","error")}}else window.print()};return(0,o.useEffect)(()=>{if(i){let e=setTimeout(()=>{u(),c&&c()},500);return()=>clearTimeout(e)}},[i,c,n.hardware.printer.type]),(0,d.jsx)("div",{className:"h-full flex flex-col bg-background dark:bg-dark-background p-4 md:p-8 md:items-center md:justify-center",children:(0,d.jsxs)("div",{className:"w-full max-w-5xl flex flex-col md:flex-row gap-8 h-full md:h-auto",children:[(0,d.jsxs)("div",{className:"flex-shrink-0 md:flex-grow bg-card dark:bg-dark-card p-8 rounded-2xl shadow-lg text-center flex flex-col items-center justify-center no-print",children:[(0,d.jsx)("div",{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20,delay:.2},className:"bg-success/10 dark:bg-dark-success/10 rounded-full p-4 mb-4",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-success dark:text-dark-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Sale Complete!"}),(0,d.jsxs)("p",{className:"text-foreground/70 dark:text-dark-foreground/70 mt-2",children:["Transaction ID: ",t.id]}),n.tax.etimsEnabled&&(0,d.jsx)("div",{className:"mt-4",children:t.kraIcn?(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},className:"bg-success/10 dark:bg-dark-success/10 text-success dark:text-dark-success text-sm font-semibold px-4 py-2 rounded-full inline-block",children:"eTIMS Submission Successful"}):(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},className:"bg-amber-100 dark:bg-dark-warning/10 text-amber-800 dark:text-dark-warning text-sm font-semibold px-4 py-2 rounded-full inline-block",children:"eTIMS submission pending, will retry automatically."})}),(0,d.jsxs)("div",{className:"mt-8 flex flex-wrap justify-center gap-4",children:[(0,d.jsx)("button",{onClick:a,whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-primary dark:bg-dark-primary text-primary-content dark:text-dark-primary-content font-bold py-3 px-8 rounded-xl hover:bg-primary-focus dark:hover:bg-dark-primary-focus transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset text-lg",children:r?"Close":"New Sale"}),(0,d.jsxs)("button",{onClick:()=>l(t.id,t.customerId),whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-[#25D366] text-white font-bold py-3 px-6 rounded-xl hover:bg-[#1EAE53] transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset text-lg flex items-center",children:[(0,d.jsx)("div",{className:"w-5 h-5 mr-2",children:N.whatsapp}),"WhatsApp"]}),(0,d.jsx)("button",{onClick:u,whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-foreground/80 dark:bg-dark-border text-white font-bold py-3 px-6 rounded-lg hover:bg-foreground dark:hover:bg-dark-border/80 transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset text-lg flex items-center",children:"Print"})]})]}),(0,d.jsx)("div",{className:"flex-grow w-full md:w-96 md:flex-grow-0 flex-shrink-0 overflow-y-auto print-area",children:(0,d.jsx)("div",{id:"receipt-container",children:(0,d.jsx)("div",{id:"receipt-to-print",children:(0,d.jsx)(ej,{sale:t,cashierName:t.cashierName,settings:n,layaway:r})})})})]})})},ew=e=>{let{label:t,value:r,isNegative:a,isBold:s}=e;return(0,d.jsxs)("div",{className:"flex justify-between items-center py-2 ".concat(s?"font-bold":""),children:[(0,d.jsx)("span",{className:"text-foreground/70 dark:text-dark-foreground/70",children:t}),(0,d.jsxs)("span",{className:"font-mono ".concat(a?"text-danger":"text-foreground dark:text-dark-foreground"),children:[a?"-":"","Ksh ",Math.abs(r).toFixed(2)]})]})};var eN=e=>{let{activeShift:t,sales:r,expenses:a,onConfirmEndShift:s,onCancel:n}=e,[l,i]=(0,o.useState)(""),[c,m]=(0,o.useState)(""),u=(0,o.useMemo)(()=>{let e=r.filter(e=>t.salesIds.includes(e.id)),s=a.filter(e=>{var r;return null===(r=t.expenseIds)||void 0===r?void 0:r.includes(e.id)}).reduce((e,t)=>e+t.amount,0),d={},o=0;e.forEach(e=>{e.payments.forEach(e=>{d[e.method]=(d[e.method]||0)+e.amount}),o+=e.change});let n=t.startingFloat+(d.Cash||0)-o-s;return{breakdown:d,expectedCash:n,cashChange:o,cashSales:d.Cash||0,totalPayouts:s}},[t,r,a]),x=(0,o.useMemo)(()=>""===l?0:Number((Number(l)-u.expectedCash).toFixed(2)),[l,u.expectedCash]);return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-8",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"End Shift & Reconcile"}),(0,d.jsx)("button",{onClick:n,className:"text-foreground/60 hover:text-foreground dark:text-dark-foreground/60 dark:hover:text-dark-foreground",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("div",{className:"bg-background dark:bg-dark-background/50 p-4 rounded-lg space-y-1 text-sm",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground/90 mb-2",children:"Cash Reconciliation"}),(0,d.jsx)(ew,{label:"Starting Float",value:t.startingFloat}),(0,d.jsx)(ew,{label:"Cash Received",value:u.cashSales}),(0,d.jsx)(ew,{label:"Change Given",value:u.cashChange,isNegative:!0}),u.totalPayouts>0&&(0,d.jsx)(ew,{label:"Cash Expenses",value:u.totalPayouts,isNegative:!0}),(0,d.jsx)("div",{className:"border-t border-border dark:border-dark-border !my-2"}),(0,d.jsx)(ew,{label:"Expected in Drawer",value:u.expectedCash,isBold:!0})]}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(Number(l)||0,c)},className:"mt-6 space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"actualCash",className:"block text-sm font-medium text-foreground/80 dark:text-dark-foreground/80",children:"Actual Counted Cash in Drawer"}),(0,d.jsx)("input",{type:"number",id:"actualCash",value:l,onChange:e=>i(""===e.target.value?"":parseFloat(e.target.value)),placeholder:"Enter counted amount",required:!0,autoFocus:!0,className:"mt-1 block w-full text-lg font-bold p-3 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"shiftNotes",className:"block text-sm font-medium text-foreground/80 dark:text-dark-foreground/80",children:"Shift Notes (Optional)"}),(0,d.jsx)("textarea",{id:"shiftNotes",value:c,onChange:e=>m(e.target.value),rows:2,placeholder:"e.g., Stayed late to restock shelves.",className:"mt-1 block w-full p-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm"})]}),""!==l&&(0,d.jsxs)("div",{className:"p-4 rounded-lg font-bold text-center text-lg\n                            ".concat(0===x?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-400"),children:[0===x&&"Drawer is Balanced",x>0&&"Overage: Ksh ".concat(x.toFixed(2)),x<0&&"Shortage: Ksh ".concat(Math.abs(x).toFixed(2))]}),(0,d.jsxs)("div",{className:"pt-4 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:n,whileTap:{scale:.95},className:"px-4 py-2 text-sm font-bold bg-background text-foreground dark:bg-dark-border dark:text-dark-foreground rounded-md hover:bg-border dark:hover:bg-dark-border/50",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.98},className:"px-6 py-2 text-sm font-bold text-white rounded-md bg-primary hover:bg-primary-focus",children:"Confirm & End Shift"})]})]})]})})},eC=r(53375),eS=r(24457),eD=r.n(eS);let eP=e=>{let{title:t}=e;return(0,d.jsx)("div",{className:"my-3",children:(0,d.jsx)("p",{className:"font-bold tracking-wider uppercase",style:{textDecoration:"underline",textUnderlineOffset:"4px",textDecorationThickness:"1px"},children:t})})},eT=e=>{let{label:t,value:r,isBold:a,className:s=""}=e;return(0,d.jsxs)("div",{className:"flex justify-between items-center ".concat(a?"font-bold":""," ").concat(s),children:[(0,d.jsxs)("span",{children:[t,":"]}),(0,d.jsx)("span",{children:"number"==typeof r?eM(r,""):r})]})},eI=()=>(0,d.jsx)("div",{className:"border-t border-dashed border-black my-2"}),eA=()=>(0,d.jsx)("div",{className:"border-t border-solid border-black my-2"}),eM=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"KES",r=t?"".concat(t," "):"";return e<0?"-".concat(r).concat(Math.abs(e).toFixed(2)):"".concat(r).concat(e.toFixed(2))};var eF=e=>{var t,r,a,s,n;let{shift:l,sales:i,expenses:c,supplierPayments:m,bankDeposits:u,onClose:x,settings:h,isHistoricalView:p=!1}=e,b=(0,o.useRef)(null),[g,f]=(0,o.useState)(!1),k=i.filter(e=>l.salesIds.includes(e.id)),y=k.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity,0),0),j=k.reduce((e,t)=>e+t.subtotal,0),v=k.reduce((e,t)=>e+t.discountAmount,0),w=k.reduce((e,t)=>e+t.tax,0),N=l.totalSales||0,C=(null===(t=l.paymentBreakdown)||void 0===t?void 0:t.Cash)||0,S=k.reduce((e,t)=>e+t.change,0),D=c.filter(e=>{var t;return(null===(t=l.expenseIds)||void 0===t?void 0:t.includes(e.id))&&"Cash Drawer"===e.source}),P=D.reduce((e,t)=>e+t.amount,0),T=m.filter(e=>e.shiftId===l.id&&"Cash"===e.method),I=T.reduce((e,t)=>e+t.amount,0),A=u.filter(e=>e.shiftId===l.id).reduce((e,t)=>e+t.breakdown.cash,0),M=Object.values(l.paymentBreakdown||{}).reduce((e,t)=>e+(Number(t)||0),0),F=l.endTime?new Date(l.endTime).getTime()-new Date(l.startTime).getTime():0,L=l.cashVariance||0,O=async()=>{if(b.current&&!g){f(!0);try{let e=await eD()(b.current,{scale:2,useCORS:!0,backgroundColor:"#ffffff"}),t=e.toDataURL("image/png"),r=new eC.ZP("p","mm","a4"),a=r.internal.pageSize.getWidth(),s=e.height*a/e.width;r.addImage(t,"PNG",0,0,a,s),r.save("ZReport_".concat(l.id,".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF.")}finally{f(!1)}}};return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-slate-100 dark:bg-slate-900/80 z-40 p-4 md:p-8 overflow-y-auto no-print",children:(0,d.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,d.jsxs)("div",{id:"shift-report-container",ref:b,className:"bg-white text-black font-mono text-xs w-full p-4 print:shadow-none print:border-none",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start text-[10px] mb-2",children:[(0,d.jsxs)("span",{children:[new Date().toLocaleDateString("en-US",{timeZone:"Africa/Nairobi"}),", ",new Date().toLocaleTimeString("en-US",{timeZone:"Africa/Nairobi"})]}),(0,d.jsxs)("span",{children:["Z-Report - Shift ",l.id.substring(0,10)]})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("h2",{className:"text-xl font-bold uppercase",children:h.businessInfo.name}),(0,d.jsx)("p",{className:"text-lg font-bold",children:"Z-REPORT"}),(0,d.jsx)("p",{className:"text-[10px]",children:"Shift Closure Report"}),(0,d.jsx)("p",{className:"text-[10px]",children:l.endTime?new Date(l.endTime).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"}):"N/A"})]}),(0,d.jsx)(eA,{}),(0,d.jsx)(eP,{title:"SHIFT INFORMATION"}),(0,d.jsx)(eT,{label:"Shift ID",value:l.id.substring(0,8)}),(0,d.jsx)(eT,{label:"Staff Member",value:l.userName}),(0,d.jsx)(eT,{label:"Shift Start",value:new Date(l.startTime).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)(eT,{label:"Shift End",value:l.endTime?new Date(l.endTime).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"}):"N/A"}),(0,d.jsx)(eT,{label:"Duration",value:"".concat(Math.floor(F/36e5)," hours")}),(0,d.jsx)(eI,{}),(0,d.jsx)(eP,{title:"SALES SUMMARY"}),(0,d.jsx)(eT,{label:"Total Transactions",value:l.salesIds.length}),(0,d.jsx)(eT,{label:"Items Sold",value:y}),(0,d.jsx)(eT,{label:"Gross Sales",value:eM(j)}),(0,d.jsx)(eT,{label:"Total Discounts",value:eM(-v)}),(0,d.jsx)(eT,{label:"VAT (".concat(h.tax.vatRate,"%)"),value:eM(w)}),(0,d.jsx)("div",{className:"border-t border-black my-1 font-bold",children:(0,d.jsx)(eT,{label:"NET SALES",value:eM(N),isBold:!0})}),(0,d.jsx)(eI,{}),(0,d.jsx)(eP,{title:"PAYMENT BREAKDOWN"}),(0,d.jsx)(eT,{label:"Cash Sales",value:eM((null===(r=l.paymentBreakdown)||void 0===r?void 0:r.Cash)||0)}),(0,d.jsx)(eT,{label:"M-Pesa Sales",value:eM((null===(a=l.paymentBreakdown)||void 0===a?void 0:a["M-Pesa"])||0)}),(0,d.jsx)(eT,{label:"Card Sales",value:eM((null===(s=l.paymentBreakdown)||void 0===s?void 0:s.Card)||0)}),(0,d.jsx)(eT,{label:"Loyalty Points",value:eM((null===(n=l.paymentBreakdown)||void 0===n?void 0:n.Points)||0)}),(0,d.jsx)(eT,{label:"Total Payments",value:eM(M),isBold:!0}),(0,d.jsx)(eI,{}),(0,d.jsx)(eP,{title:"CASH PAYOUTS"}),0===D.length&&0===T.length?(0,d.jsx)("p",{className:"text-center text-gray-500 text-[10px]",children:"No cash payouts recorded this shift."}):(0,d.jsxs)(d.Fragment,{children:[D.map(e=>(0,d.jsx)(eT,{label:e.reason,value:eM(e.amount)},e.id)),T.map(e=>(0,d.jsx)(eT,{label:"Supplier Pymt: ".concat(e.invoiceId.slice(-6)),value:eM(e.amount)},e.id))]}),(0,d.jsx)(eI,{}),(0,d.jsx)(eP,{title:"CASH RECONCILIATION"}),(0,d.jsx)(eT,{label:"Starting Float",value:eM(l.startingFloat)}),(0,d.jsx)(eT,{label:"Cash Sales",value:"+"+eM(C)}),S>0&&(0,d.jsx)(eT,{label:"Change Given",value:"-"+eM(S)}),P>0&&(0,d.jsx)(eT,{label:"Cash Expenses",value:"-"+eM(P)}),I>0&&(0,d.jsx)(eT,{label:"Supplier Payments",value:"-"+eM(I)}),A>0&&(0,d.jsx)(eT,{label:"Cash Banked",value:"-"+eM(A)}),(0,d.jsx)(eI,{}),(0,d.jsx)(eT,{label:"Expected Cash",value:eM(l.expectedCashInDrawer||0),isBold:!0}),(0,d.jsx)(eT,{label:"Actual Cash Count",value:eM(l.actualCashInDrawer||0),isBold:!0}),(0,d.jsxs)("div",{className:"flex justify-between items-center font-bold text-base my-1 ".concat(0===L?"text-green-600":""),children:[(0,d.jsx)("span",{children:"Variance:"}),(0,d.jsx)("span",{children:(L>=0?"+":"")+eM(L)})]}),(0,d.jsx)(eI,{}),(0,d.jsx)("div",{className:"my-3 p-2 text-center border font-bold ".concat(0===L?"border-green-600 text-green-600":"border-red-600 text-red-600"),children:0===L?"✓ PERFECT BALANCE - NO VARIANCE":L>0?"OVERAGE OF ".concat(eM(L)):"SHORTAGE OF ".concat(eM(Math.abs(L)))}),(0,d.jsx)(eA,{}),(0,d.jsxs)("div",{className:"text-center text-[10px] space-y-1 mt-4",children:[(0,d.jsx)("p",{children:"This is an official Z-Report"}),(0,d.jsx)("p",{className:"font-bold",children:h.businessInfo.name})]}),(0,d.jsx)("div",{className:"text-right text-[9px] mt-4",children:"1/2"})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,d.jsx)("button",{onClick:x,whileTap:{scale:.95},className:"bg-slate-200 text-slate-800 font-semibold px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors",children:"Close"}),(0,d.jsxs)("div",{className:"flex space-x-3",children:[(0,d.jsxs)("button",{onClick:()=>window.print(),whileTap:{scale:.95},className:"bg-slate-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors flex items-center gap-2",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h1v-4a1 1 0 011-1h10a1 1 0 011 1v4h1a2 2 0 002-2v-6a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z",clipRule:"evenodd"})}),"Print"]}),(0,d.jsxs)("button",{onClick:O,disabled:g,whileTap:{scale:.95},className:"bg-primary text-white font-semibold px-4 py-2 rounded-lg hover:bg-primary-focus transition-colors flex items-center gap-2 disabled:bg-slate-400",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),g?"Downloading...":"Download PDF"]})]})]})]})})};let eL=y.E.button,eO=y.E.span,eR=y.E.div;var eB=e=>{let{products:t,cart:r,customers:a,selectedCustomerId:s,onCustomerChange:l,addToCart:i,updateCartItemQuantity:c,updateCartItemDiscount:m,removeFromCart:u,clearCart:x,completeSale:h,isOnline:p,currentUser:b,settings:g,sales:f,payouts:k,supplierPayments:y,bankDeposits:j,activeShift:v,onStartShift:w,onEndShiftRequest:N,isEndingShift:C,onConfirmEndShift:S,onCancelEndShift:D,shiftReportToShow:P,onCloseShiftReport:T,onEmailReceiptRequest:I,onWhatsAppReceiptRequest:A,onHoldRequest:M,onLayawayRequest:F,workOrders:L,originatingWorkOrderId:O,salesOrders:R,originatingSalesOrderId:B,showToast:_}=e,[E,q]=(0,o.useState)(!1),[V,H]=(0,o.useState)({type:"percentage",value:0}),[U,W]=(0,o.useState)(null),[Z,z]=(0,o.useState)(!1),[K,G]=(0,o.useState)(!1),Q=(0,o.useMemo)(()=>a.find(e=>e.id===s),[a,s]),Y=(0,o.useMemo)(()=>0,[]),X=async(e,t)=>{try{let r=await h(e);W(r),(null==t?void 0:t.autoPrint)&&G(!0)}catch(e){console.error("Sale completion failed in PosView:",e)}finally{q(!1),z(!1)}},J=(0,o.useCallback)(()=>{x(),W(null),G(!1)},[x]),$=!!v&&!C&&!P;if(U)return(0,d.jsx)(ev,{sale:U,onNewSale:J,currentUser:b,settings:g,onEmailReceiptRequest:I,onWhatsAppReceiptRequest:A,shouldAutoPrint:K,onAutoPrintDone:()=>G(!1),showToast:_});let ee={cartItems:r,customers:a,selectedCustomerId:s,onCustomerChange:l,updateQuantity:c,updateCartItemDiscount:m,removeItem:u,onCharge:e=>{0!==r.length&&(H(e),q(!0))},isOnline:p,settings:g,activeShift:v,onStartShift:w,onEndShiftRequest:N,onHoldRequest:M,onLayawayRequest:F,currentUser:b,depositApplied:Y};return(0,d.jsxs)("div",{className:"h-full flex flex-col md:grid md:grid-cols-[1fr_auto] md:overflow-hidden relative",children:[(0,d.jsxs)(n.M,{children:[C&&v&&(0,d.jsx)(eN,{activeShift:v,sales:f,expenses:k,onConfirmEndShift:S,onCancel:D}),P&&(0,d.jsx)(eF,{shift:P,sales:f,expenses:k,supplierPayments:y,bankDeposits:j,onClose:T,settings:g})]}),(0,d.jsx)("div",{className:"flex-1 p-4 overflow-y-auto transition-opacity duration-300 ".concat($?"opacity-100":"opacity-20 pointer-events-none"),children:(0,d.jsx)(em,{products:t,onAddToCart:i,settings:g})}),(0,d.jsx)("div",{className:"hidden md:flex md:w-96 bg-card dark:bg-dark-card shadow-lg flex-col min-h-0 transition-opacity duration-300 ".concat(v?"opacity-100":"opacity-50"),children:(0,d.jsx)(ep,{...ee})}),(0,d.jsx)("div",{className:"md:hidden fixed bottom-6 right-6 z-20",children:(0,d.jsxs)(eL,{onClick:()=>z(!0),whileTap:{scale:.95},className:"bg-primary dark:bg-dark-primary text-white rounded-full p-4 flex items-center justify-center shadow-clay-light dark:shadow-clay-dark active:shadow-clay-light-inset dark:active:shadow-clay-dark-inset transition-shadow","aria-label":"View Cart (".concat(r.length," items)"),children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),r.length>0&&(0,d.jsx)(eO,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 bg-danger text-white text-xs font-semibold rounded-full h-5 w-5 flex items-center justify-center border-2 border-white dark:border-dark-background",children:r.reduce((e,t)=>e+t.quantity,0)})]})}),(0,d.jsx)(n.M,{children:Z&&(0,d.jsxs)("div",{className:"md:hidden fixed inset-0 z-30","aria-modal":"true",role:"dialog",children:[(0,d.jsx)(eR,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>z(!1)}),(0,d.jsxs)(eR,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:400,damping:40},className:"absolute bottom-0 left-0 right-0 max-h-[90vh] h-auto bg-card dark:bg-dark-card rounded-t-2xl flex flex-col",children:[(0,d.jsx)("div",{className:"p-4 flex-shrink-0 cursor-grab",onPointerDown:()=>z(!1),children:(0,d.jsx)("div",{className:"mx-auto block w-12 h-1.5 bg-border dark:bg-dark-border/50 rounded-full"})}),(0,d.jsx)(ep,{...ee})]})]})}),(0,d.jsx)(n.M,{children:E&&Q&&$&&(0,d.jsx)(eb,{cartItems:r,discount:V,onClose:()=>q(!1),onCompleteSale:X,customer:Q,settings:g,depositApplied:Y})})]})},e_=r(60474),eE=r(47625),eq=r(21156),eV=r(56940),eH=r(97059),eU=r(62994),eW=r(8147),eZ=r(22190),ez=r(54061),eK=r(75169),eG=r(3574),eQ=r(20407);let eY=e=>{let{title:t,value:r,children:a,className:s=""}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border flex items-center space-x-4 ".concat(s),variants:{hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},children:[(0,d.jsx)("div",{className:"bg-muted dark:bg-dark-muted text-primary dark:text-dark-primary p-3 rounded-lg",children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-semibold",children:t}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:r})]})]})},eX=e=>{let{label:t,range:r,activeRange:a,onClick:s}=e;return(0,d.jsx)("button",{onClick:()=>s(r),className:"px-4 py-1.5 text-sm font-bold rounded-lg transition-colors duration-200 ".concat(a===r?"bg-card dark:bg-dark-card text-primary dark:text-dark-primary shadow-sm":"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground"),children:t})},eJ=e=>{let{cx:t,cy:r,innerRadius:a,outerRadius:s,startAngle:o,endAngle:n,fill:l,payload:i,percent:c}=e;return(0,d.jsxs)("g",{children:[(0,d.jsx)("text",{x:t,y:r,dy:-5,textAnchor:"middle",fill:l,className:"font-bold text-base",children:i.name}),(0,d.jsx)("text",{x:t,y:r,dy:15,textAnchor:"middle",fill:"#64748b",className:"text-xs",children:"".concat((100*c).toFixed(2),"%")}),(0,d.jsx)(e_.L,{cx:t,cy:r,innerRadius:a,outerRadius:s+4,startAngle:o,endAngle:n,fill:l})]})},e$={revenue:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm0 15a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"}),(0,d.jsx)("path",{d:"M12 14c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2Z"})]}),profit:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"})}),cogs:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M2 13h10v9H2v-9Z"}),(0,d.jsx)("path",{d:"m22 8-10 5-10-5 10-5 10 5Z"}),(0,d.jsx)("path",{d:"M12 13h10v9H12v-9Z"})]}),payout:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M15 15H3c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v2h-4c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h4v2c0 1.1-.9 2-2 2Z"}),(0,d.jsx)("path",{d:"M23 7v10c0 1.1-.9 2-2 2h-1V7h3Zm-5 2h2v6h-2V9Z"})]}),workOrder:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,d.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})})},e0=e=>{let{sales:t,products:r,suppliers:a,supplierInvoices:s,settings:n,expenses:l,workOrders:i}=e,[c]=S(),[m,u]=(0,o.useState)("7d"),[x,h]=(0,o.useState)(0),p=(0,o.useMemo)(()=>new Map(r.map(e=>[e.id,e.costPrice||0])),[r]),{filteredSales:b,filteredExpenses:g}=(0,o.useMemo)(()=>{let e=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date;return"today"===m?a=r:"7d"===m?a=new Date(new Date().setDate(r.getDate()-6)):"30d"===m&&(a=new Date(new Date().setDate(r.getDate()-29))),a.setHours(0,0,0,0),{filteredSales:t.filter(e=>new Date(e.date)>=a),filteredExpenses:l.filter(e=>new Date(e.date)>=a)}},[t,l,m]),f=(0,o.useMemo)(()=>{let e=b.reduce((e,t)=>e+t.total,0),t=b.reduce((e,t)=>e+t.items.reduce((e,t)=>e+(p.get(t.id)||0)*Math.abs(t.quantity),0),0),r=g.reduce((e,t)=>e+t.amount,0);return{totalRevenue:e,netProfit:e-t-r,totalCogs:t,totalPayouts:r,openWorkOrders:i.filter(e=>"Pending"===e.status||"InProgress"===e.status).length,outstandingWoBalance:i.reduce((e,t)=>e+t.balanceDue,0)}},[b,g,p,i]),k=(0,o.useMemo)(()=>{let e={};b.forEach(t=>{let r=new Date(t.date).toLocaleDateString("en-CA",{timeZone:"Africa/Nairobi"});e[r]||(e[r]={sales:0,profit:0});let a=t.items.reduce((e,t)=>e+(p.get(t.id)||0)*Math.abs(t.quantity),0);e[r].sales+=t.total,e[r].profit+=t.total-a}),g.forEach(t=>{let r=new Date(t.date).toLocaleDateString("en-CA",{timeZone:"Africa/Nairobi"});e[r]?e[r].profit-=t.amount:e[r]={sales:0,profit:-t.amount}});let t=[],r="today"===m?1:"7d"===m?7:30,a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());for(let a=r-1;a>=0;a--){var d,o;let r=new Date(s.getTime()-864e5*a),n=r.toLocaleDateString("en-CA",{timeZone:"Africa/Nairobi"}),l=r.toLocaleDateString("en-GB",{month:"short",day:"numeric",timeZone:"Africa/Nairobi"});t.push({name:l,Sales:(null===(d=e[n])||void 0===d?void 0:d.sales)||0,"Net Profit":(null===(o=e[n])||void 0===o?void 0:o.profit)||0})}return t},[b,g,m,p]),y=(0,o.useMemo)(()=>{let e={};return b.forEach(t=>{t.payments.forEach(t=>{e[t.method]=(e[t.method]||0)+t.amount})}),Object.entries(e).map(e=>{let[t,r]=e;return{name:t,value:r}})},[b]),j="dark"===c?["#34d399","#60a5fa","#fde047","#c4b5fd"]:["#10b981","#3b82f6","#facc15","#a78bfa"];return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Dashboard"}),(0,d.jsxs)("div",{className:"flex space-x-1 bg-muted dark:bg-dark-muted p-1 rounded-lg",children:[(0,d.jsx)(eX,{label:"Today",range:"today",activeRange:m,onClick:u}),(0,d.jsx)(eX,{label:"Last 7 Days",range:"7d",activeRange:m,onClick:u}),(0,d.jsx)(eX,{label:"Last 30 Days",range:"30d",activeRange:m,onClick:u})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-6",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},initial:"hidden",animate:"visible",children:[(0,d.jsx)(eY,{title:"Total Revenue",value:"Ksh ".concat(f.totalRevenue.toFixed(2)),children:e$.revenue}),(0,d.jsx)(eY,{title:"Net Profit",value:"Ksh ".concat(f.netProfit.toFixed(2)),className:f.netProfit<0?"text-danger dark:text-dark-danger":"text-success dark:text-dark-success",children:e$.profit}),(0,d.jsx)(eY,{title:"Expenses",value:"Ksh ".concat(f.totalPayouts.toFixed(2)),children:e$.payout}),(0,d.jsx)(eY,{title:"COGS",value:"Ksh ".concat(f.totalCogs.toFixed(2)),children:e$.cogs}),(0,d.jsx)(eY,{title:"Open Work Orders",value:"".concat(f.openWorkOrders),children:e$.workOrder}),(0,d.jsx)(eY,{title:"Outstanding Balances",value:"Ksh ".concat(f.outstandingWoBalance.toFixed(2)),className:f.outstandingWoBalance>0?"text-warning dark:text-dark-warning":"",children:e$.workOrder})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{className:"lg:col-span-2 bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground mb-4",children:"Sales & Profit Over Time"}),(0,d.jsx)(eE.h,{width:"100%",height:300,children:(0,d.jsxs)(eq.w,{data:k,children:[(0,d.jsx)(eV.q,{strokeDasharray:"3 3",strokeOpacity:.2}),(0,d.jsx)(eH.K,{dataKey:"name",stroke:"dark"===c?"#94a3b8":"#64748b",fontSize:12}),(0,d.jsx)(eU.B,{stroke:"dark"===c?"#94a3b8":"#64748b",fontSize:12}),(0,d.jsx)(eW.u,{contentStyle:{backgroundColor:"dark"===c?"#1e293b":"#ffffff",border:"1px solid #334155"}}),(0,d.jsx)(eZ.D,{}),(0,d.jsx)(ez.x,{type:"monotone",dataKey:"Sales",stroke:"#3b82f6",strokeWidth:2}),(0,d.jsx)(ez.x,{type:"monotone",dataKey:"Net Profit",stroke:"#10b981",strokeWidth:2})]})})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground mb-4",children:"Payments by Type"}),(0,d.jsx)(eE.h,{width:"100%",height:300,children:(0,d.jsx)(eK.u,{children:(0,d.jsx)(eG.b,{data:y,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,activeIndex:x,activeShape:eJ,onMouseEnter:(e,t)=>h(t),children:y.map((e,t)=>(0,d.jsx)(eQ.b,{fill:j[t%j.length]},"cell-".concat(t)))})})})]})]})]})};var e2=e=>{var t,r;let{onClose:a,onSave:s,product:n,settings:l,products:i}=e,c=!!n,[m,u]=(0,o.useState)({name:"",upc:"",description:"",category:"Uncategorized",price:0,pricingType:l.tax.pricingType,productType:"Inventory",costPrice:0,unitOfMeasure:"pc(s)",imageUrl:""});(0,o.useEffect)(()=>{n&&u({name:n.name,upc:n.upc||"",description:n.description||"",category:n.category,price:n.price,pricingType:n.pricingType,productType:n.productType,costPrice:n.costPrice||0,unitOfMeasure:n.unitOfMeasure||"pc(s)",imageUrl:n.imageUrl||""})},[n]);let{profitMargin:x,grossProfit:h}=(0,o.useMemo)(()=>{let{price:e,costPrice:t}=m;if(t<=0||e<=0)return{profitMargin:0,grossProfit:0};let r=e/(1+l.tax.vatRate/100)-t;return{profitMargin:r/t*100,grossProfit:r}},[m.price,m.costPrice,l.tax.vatRate]),p=e=>{let{name:t,value:r}=e.target,a=["price","costPrice"].includes(t);u(e=>({...e,[t]:a?parseFloat(r)||0:r}))},b=(null===(t=l.inventory)||void 0===t?void 0:t.definedCategories)||[];return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-border dark:border-dark-border",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:c?"Edit Product":"Add New Product"}),(0,d.jsx)("button",{onClick:a,className:"text-foreground-muted hover:text-foreground",children:"\xd7"})]}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c&&n?s({...n,...m}):s(m)},className:"p-6 space-y-4 overflow-y-auto",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Product Name *"}),(0,d.jsx)("input",{type:"text",name:"name",value:m.name,onChange:p,required:!0,className:"mt-1 w-full p-2 border rounded-md"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Product Type"}),(0,d.jsxs)("select",{name:"productType",value:m.productType,onChange:p,className:"mt-1 w-full p-2 border rounded-md",children:[(0,d.jsx)("option",{value:"Inventory",children:"Inventory (Track Stock)"}),(0,d.jsx)("option",{value:"Service",children:"Service (No Stock)"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Category"}),(0,d.jsx)("input",{type:"text",name:"category",value:m.category,onChange:p,list:"category-suggestions",className:"mt-1 w-full p-2 border rounded-md"}),(0,d.jsx)("datalist",{id:"category-suggestions",children:b.map(e=>(0,d.jsx)("option",{value:e.path},e.path))})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Selling Price (incl. VAT) *"}),(0,d.jsx)("input",{type:"number",name:"price",value:m.price,onChange:p,required:!0,min:"0",step:"0.01",className:"mt-1 w-full p-2 border rounded-md"})]}),"Inventory"===m.productType&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Cost Price (excl. VAT)"}),(0,d.jsx)("input",{type:"number",name:"costPrice",value:m.costPrice,onChange:p,min:"0",step:"0.01",className:"mt-1 w-full p-2 border rounded-md"})]})]}),"Inventory"===m.productType&&m.costPrice>0&&m.price>0&&(0,d.jsxs)("div",{className:"p-3 bg-muted dark:bg-dark-muted rounded-md text-sm border border-border dark:border-dark-border",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Gross Profit (per item):"}),(0,d.jsxs)("span",{className:"font-semibold font-mono text-green-600 dark:text-green-400",children:["Ksh ",h.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Profit Margin:"}),(0,d.jsxs)("span",{className:"font-semibold font-mono text-green-600 dark:text-green-400",children:[x.toFixed(2),"%"]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"SKU / Inventory Code"}),(0,d.jsx)("input",{type:"text",value:(null==n?void 0:n.inventoryCode)||"Auto-generated",readOnly:!0,className:"mt-1 w-full p-2 border rounded-md bg-muted dark:bg-dark-muted"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"UPC / Barcode"}),(0,d.jsx)("input",{type:"text",name:"upc",value:m.upc,onChange:p,className:"mt-1 w-full p-2 border rounded-md"})]})]}),"Inventory"===m.productType&&(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Unit of Measure"}),(0,d.jsx)("input",{type:"text",name:"unitOfMeasure",value:m.unitOfMeasure,onChange:p,list:"unit-suggestions",className:"mt-1 w-full p-2 border rounded-md"}),(0,d.jsx)("datalist",{id:"unit-suggestions",children:null===(r=l.measurements)||void 0===r?void 0:r.units.map(e=>(0,d.jsx)("option",{value:e},e))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Current Stock"}),(0,d.jsx)("input",{type:"number",value:(null==n?void 0:n.stock)||0,readOnly:!0,className:"mt-1 w-full p-2 border rounded-md bg-muted dark:bg-dark-muted"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Description"}),(0,d.jsx)("textarea",{name:"description",value:m.description,onChange:p,rows:3,className:"mt-1 w-full p-2 border rounded-md"})]}),(0,d.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:a,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted font-bold px-4 py-2 rounded-lg",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-lg",children:"Save Product"})]})]})]})})};let e1=[{key:"name",label:"Product Name"},{key:"upc",label:"Barcode"},{key:"costPrice",label:"Unit Cost"},{key:"price",label:"Selling Price"},{key:"description",label:"Description"},{key:"inventoryCode",label:"SKU / Barcode"},{key:"stock",label:"Stock Quantity"},{key:"category",label:"Category"},{key:"unitOfMeasure",label:"Unit of Measure"}];var e4=e=>{let{onClose:t,onExport:r}=e,[a,s]=(0,o.useState)(e1.map(e=>e.key)),n=e=>{s(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},l=e=>{if(0===a.length){alert("Please select at least one field to export.");return}r(a,e)};return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:t,children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-6 border-b border-border dark:border-dark-border",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Export Inventory"}),(0,d.jsx)("button",{onClick:t,className:"text-foreground-muted hover:text-foreground dark:text-dark-foreground-muted dark:hover:text-dark-foreground",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"p-6 overflow-y-auto space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Select Fields to Export"}),(0,d.jsxs)("div",{className:"space-x-2",children:[(0,d.jsx)("button",{onClick:()=>s(e1.map(e=>e.key)),className:"text-xs font-semibold text-primary dark:text-dark-primary",children:"Select All"}),(0,d.jsx)("button",{onClick:()=>s([]),className:"text-xs font-semibold text-primary dark:text-dark-primary",children:"Deselect All"})]})]}),(0,d.jsx)("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2 p-4 border border-border dark:border-dark-border rounded-lg bg-background dark:bg-dark-background",children:e1.map(e=>(0,d.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:a.includes(e.key),onChange:()=>n(e.key),className:"h-4 w-4 rounded text-primary border-border focus:ring-primary"}),(0,d.jsx)("span",{className:"text-sm text-foreground dark:text-dark-foreground",children:e.label})]},e.key))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground mb-2",children:"Export Format"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("button",{onClick:()=>l("xls"),className:"flex flex-col items-center justify-center p-4 border-2 border-border dark:border-dark-border rounded-lg hover:border-primary dark:hover:border-dark-primary transition-colors",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-green-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:"Excel (.xls)"})]}),(0,d.jsxs)("button",{onClick:()=>l("csv"),className:"flex flex-col items-center justify-center p-4 border-2 border-border dark:border-dark-border rounded-lg hover:border-primary dark:hover:border-dark-primary transition-colors",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-blue-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:"CSV (.csv)"})]})]})]})]}),(0,d.jsx)("div",{className:"flex-shrink-0 mt-auto flex justify-end p-6 border-t border-border dark:border-dark-border",children:(0,d.jsx)("button",{type:"button",onClick:t,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold px-4 py-2 rounded-lg hover:bg-border dark:hover:bg-dark-border",children:"Cancel"})})]})})};let e3=e=>{let{title:t,value:r,subtitle:a,icon:s,iconBgColor:o}=e;return(0,d.jsxs)("div",{className:"bg-white dark:bg-dark-card p-4 rounded-lg shadow-sm flex items-center space-x-4",children:[(0,d.jsx)("div",{className:"p-3 rounded-lg ".concat(o),children:s}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:r}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:a})]})]})};var e5=e=>{var t,r;let{products:a,onAddProduct:s,onUpdateProduct:l,onDeleteProductRequest:i,permissions:c,onImportProducts:m,onPrintBarcodeRequest:u,onAddToPORequest:x,settings:h}=e,[p,b]=(0,o.useState)(""),[g,f]=(0,o.useState)(!1),[k,y]=(0,o.useState)(!1),[j,v]=(0,o.useState)(void 0),w=(0,o.useRef)(null),C=c.includes("edit_inventory"),S=c.includes("delete_inventory"),D=(0,o.useMemo)(()=>a.filter(e=>{let t=p.toLowerCase();return e.name.toLowerCase().includes(t)||e.inventoryCode.toLowerCase().includes(t)||e.upc&&e.upc.toLowerCase().includes(t)}).sort((e,t)=>e.name.localeCompare(t.name)),[a,p]),P=e=>{v(e),f(!0)},T=async e=>{"id"in e?l(e):await s(e),f(!1),v(void 0)},I=null!==(r=null===(t=h.inventory)||void 0===t?void 0:t.lowStockThreshold)&&void 0!==r?r:10,A=a.filter(e=>"Inventory"===e.productType&&e.stock<=I).length,M=a.reduce((e,t)=>e+(t.costPrice||0)*t.stock,0),F=a.reduce((e,t)=>e+t.price*t.stock,0),L=e=>"".concat(h.businessInfo.currency," ").concat(e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),O=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,d.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),R=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,d.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,d.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,d.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]});return(0,d.jsxs)("div",{className:"p-4 md:p-6 bg-muted dark:bg-dark-muted min-h-full",children:[(0,d.jsxs)(n.M,{children:[g&&(0,d.jsx)(e2,{onClose:()=>f(!1),onSave:T,product:j,settings:h,products:a}),k&&(0,d.jsx)(e4,{onClose:()=>y(!1),onExport:(e,t)=>{let r=a.map(t=>e.map(e=>{let r=t[e];return null==r?"":String(r).replace(/"/g,'""')})),s=(e,t,r)=>{let a=new Blob([e],{type:t}),s=document.createElement("a"),d=URL.createObjectURL(a);s.setAttribute("href",d),s.setAttribute("download",r),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(d)};"csv"===t?s([e.join(","),...r.map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n"),"text/csv;charset=utf-8;","inventory.csv"):s('\n                <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">\n                <head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Inventory</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head>\n                <body><table>\n                    <thead><tr>'.concat(e.map(e=>"<th>".concat(e,"</th>")).join(""),"</tr></thead>\n                    <tbody>").concat(r.map(e=>"<tr>".concat(e.map(e=>"<td>".concat(e,"</td>")).join(""),"</tr>")).join(""),"</tbody>\n                </table></body></html>"),"application/vnd.ms-excel","inventory.xls"),y(!1)}})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Inventory Management"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"Manage your products and stock levels"})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"file",ref:w,className:"hidden",accept:".csv",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&m(r)}}),(0,d.jsxs)("button",{onClick:()=>{var e;null===(e=w.current)||void 0===e||e.click()},whileTap:{scale:.95},className:"bg-white text-gray-700 font-bold px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors shadow-sm flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Import"]}),(0,d.jsxs)("button",{onClick:()=>y(!0),whileTap:{scale:.95},className:"bg-white text-gray-700 font-bold px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors shadow-sm flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export"]}),C&&(0,d.jsxs)("button",{onClick:()=>{v(void 0),f(!0)},whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-sm flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Product"]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,d.jsx)(e3,{title:"Total Products",value:String(a.length),subtitle:"Active products",icon:o.cloneElement(N.inventory,{className:"w-6 h-6"}),iconBgColor:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300"}),(0,d.jsx)(e3,{title:"Low Stock Items",value:String(A),subtitle:"Need reordering",icon:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),(0,d.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,d.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),iconBgColor:"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-300"}),(0,d.jsx)(e3,{title:"Total Stock Value",value:L(M),subtitle:"At cost price",icon:o.cloneElement(N.profitReport,{className:"w-6 h-6"}),iconBgColor:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-300"}),(0,d.jsx)(e3,{title:"Potential Retail Value",value:L(F),subtitle:"At selling price",icon:o.cloneElement(N.revenue,{className:"w-6 h-6"}),iconBgColor:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-300"})]}),(0,d.jsx)("div",{className:"mb-4",children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-foreground-muted dark:text-dark-foreground-muted absolute top-1/2 left-4 -translate-y-1/2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,d.jsx)("input",{type:"text",placeholder:"Search products by name or SKU...",className:"w-full pl-12 pr-4 py-3 rounded-lg border-0 bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary",value:p,onChange:e=>b(e.target.value)})]})}),(0,d.jsxs)("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow-sm",children:[(0,d.jsx)("div",{className:"p-4 border-b border-border dark:border-dark-border",children:(0,d.jsx)("h2",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground",children:"Products"})}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Product"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"SKU"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Category"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Price"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Stock"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Status"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Actions"})]})}),(0,d.jsxs)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:[D.map(e=>(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsx)("td",{scope:"row",className:"px-6 py-4 font-semibold text-foreground dark:text-dark-foreground whitespace-nowrap",children:e.name}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono",children:e.inventoryCode}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.category}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono",children:L(e.price)}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsxs)("span",{className:"px-2.5 py-1 text-xs font-semibold text-white bg-gray-800 rounded-full",children:[e.stock," ","pc(s)"===e.unitOfMeasure?"piece".concat(1===e.stock?"":"s"):e.unitOfMeasure]})}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("span",{className:"px-2.5 py-1 text-xs font-semibold text-white bg-gray-800 rounded-full",children:"Active"})}),(0,d.jsxs)("td",{className:"px-6 py-4 text-right space-x-4 whitespace-nowrap",children:[C&&(0,d.jsx)("button",{onClick:()=>P(e),className:"text-foreground-muted hover:text-primary",children:(0,d.jsx)(O,{})}),S&&(0,d.jsx)("button",{onClick:()=>i(e),className:"text-foreground-muted hover:text-danger",children:(0,d.jsx)(R,{})})]})]},e.id)),0===D.length&&(0,d.jsx)("tr",{children:(0,d.jsxs)("td",{colSpan:7,className:"text-center py-10",children:[(0,d.jsx)("p",{className:"font-semibold",children:"No products found."}),(0,d.jsx)("p",{className:"text-sm",children:"Add a new product to get started."})]})})]})]})})]})]})},e6=e=>{var t;let{suppliers:r,products:a,onSave:s,onClose:n,prefilledItems:l,salesOrderId:i}=e,[c,m]=(0,o.useState)((null===(t=r[0])||void 0===t?void 0:t.id)||""),[u,x]=(0,o.useState)(new Date().toISOString().split("T")[0]),[h,p]=(0,o.useState)(()=>{let e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]}),[b,g]=(0,o.useState)(l||[]),[f,k]=(0,o.useState)(""),[y,j]=(0,o.useState)(null),[v,w]=(0,o.useState)(1),[N,C]=(0,o.useState)(""),S=(0,o.useMemo)(()=>f?a.filter(e=>e.name.toLowerCase().includes(f.toLowerCase())).slice(0,5):[],[f,a]),D=e=>{j(e),k(e.name),C(e.costPrice||""),setTimeout(()=>k(""),100)},P=e=>{g(t=>t.filter((t,r)=>r!==e))},T=async()=>{if(!c||0===b.length){alert("Please select a supplier and add at least one item.");return}let e={supplierId:c,items:b,status:"Draft",expectedDate:new Date(h),salesOrderId:i,orderDate:u};await s(e)};return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:-20},className:"bg-card dark:bg-dark-card w-full max-w-3xl rounded-lg shadow-xl overflow-hidden",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-border dark:border-dark-border",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:"Create Purchase Order"}),(0,d.jsx)("button",{onClick:n,className:"text-2xl",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Supplier *"}),(0,d.jsxs)("select",{value:c,onChange:e=>m(e.target.value),className:"w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background",children:[(0,d.jsx)("option",{value:"",children:"Select supplier"}),r.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Order Date"}),(0,d.jsx)("input",{type:"date",value:u,onChange:e=>x(e.target.value),className:"w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Expected Delivery Date"}),(0,d.jsx)("input",{type:"date",value:h,onChange:e=>p(e.target.value),className:"w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background"})]})]}),(0,d.jsxs)("div",{className:"p-4 border border-border dark:border-dark-border rounded-lg",children:[(0,d.jsx)("h3",{className:"font-semibold mb-2",children:"Add Items (Prices include VAT)"}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),y&&v&&""!==N&&(g(e=>e.find(e=>e.productId===y.id)?e.map(e=>e.productId===y.id?{...e,quantity:e.quantity+Number(v)}:e):[...e,{productId:y.id,productName:y.name,quantity:Number(v),cost:Number(N),unitOfMeasure:y.unitOfMeasure}]),j(null),k(""),w(1),C(""))},className:"grid grid-cols-12 gap-2 items-end",children:[(0,d.jsxs)("div",{className:"col-span-12 md:col-span-5 relative",children:[(0,d.jsx)("label",{className:"text-xs",children:"Select product"}),(0,d.jsx)("input",{type:"text",value:f,onChange:e=>k(e.target.value),placeholder:"Search product...",className:"w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background"}),S.length>0&&f&&(0,d.jsx)("ul",{className:"absolute z-10 w-full bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-lg mt-1 max-h-40 overflow-y-auto",children:S.map(e=>(0,d.jsx)("li",{onClick:()=>D(e),className:"px-3 py-2 hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",children:e.name},e.id))})]}),(0,d.jsxs)("div",{className:"col-span-4 md:col-span-2",children:[(0,d.jsx)("label",{className:"text-xs",children:"Quantity"}),(0,d.jsx)("input",{type:"number",value:v,onChange:e=>w(""===e.target.value?"":Number(e.target.value)),min:"1",className:"w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background"})]}),(0,d.jsxs)("div",{className:"col-span-4 md:col-span-3",children:[(0,d.jsx)("label",{className:"text-xs",children:"Unit Cost (incl. VAT)"}),(0,d.jsx)("input",{type:"number",value:N,onChange:e=>C(""===e.target.value?"":Number(e.target.value)),step:"0.01",min:"0",className:"w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background"})]}),(0,d.jsx)("div",{className:"col-span-4 md:col-span-2",children:(0,d.jsx)("button",{type:"submit",className:"w-full bg-foreground dark:bg-dark-foreground text-background dark:text-dark-background font-bold py-2 px-4 rounded-md h-full",children:"Add Item"})})]})]}),b.length>0&&(0,d.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,d.jsx)("h4",{className:"text-sm font-bold",children:"Order Items"}),b.map((e,t)=>(0,d.jsxs)("div",{className:"flex justify-between items-center bg-muted dark:bg-dark-muted p-2 rounded",children:[(0,d.jsxs)("p",{children:[e.productName," (",e.quantity," x ",e.cost.toFixed(2),")"]}),(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("p",{className:"font-mono",children:(e.quantity*e.cost).toFixed(2)}),(0,d.jsx)("button",{onClick:()=>P(t),className:"text-danger",children:"\xd7"})]})]},t))]})]}),(0,d.jsxs)("div",{className:"flex justify-end items-center p-4 border-t border-border dark:border-dark-border bg-muted dark:bg-dark-muted/50",children:[(0,d.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 rounded-md font-semibold mr-2",children:"Cancel"}),(0,d.jsx)("button",{type:"button",onClick:T,className:"px-6 py-2 bg-primary text-primary-content rounded-md font-semibold",children:"Create Purchase Order"})]})]})})};let e9=o.forwardRef((e,t)=>{let{purchaseOrder:r,supplier:a,products:s,settings:o}=e,{poNumber:n,createdDate:l,expectedDate:i,totalCost:c,items:m}=r;return(0,d.jsxs)("div",{ref:t,className:"bg-white p-8 font-sans text-sm text-black w-full max-w-4xl mx-auto shadow-lg border",children:[(0,d.jsxs)("header",{className:"flex justify-between items-start pb-4 border-b",children:[(0,d.jsxs)("div",{children:[o.businessInfo.logoUrl&&(0,d.jsx)("img",{src:o.businessInfo.logoUrl,alt:"Company Logo",className:"h-16 max-w-xs object-contain mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:o.businessInfo.name}),(0,d.jsx)("p",{className:"text-slate-600",children:o.businessInfo.location}),(0,d.jsxs)("p",{className:"text-slate-600",children:["Tel: ",o.businessInfo.phone]}),o.tax.etimsEnabled&&o.businessInfo.kraPin&&(0,d.jsxs)("p",{className:"text-slate-600",children:["PIN: ",o.businessInfo.kraPin]})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold uppercase text-slate-700 tracking-wide",children:"Purchase Order"}),(0,d.jsxs)("div",{className:"mt-2 text-xs",children:[(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"PO Number:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:n})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Date Issued:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(l).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Expected By:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(i).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]})]})]})]}),(0,d.jsxs)("section",{className:"mt-8 flex justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Ship To"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:o.businessInfo.name}),(0,d.jsx)("p",{className:"text-slate-600",children:o.businessInfo.location})]}),a&&(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Supplier"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:a.name}),(0,d.jsx)("p",{className:"text-slate-600",children:a.contact}),(0,d.jsx)("p",{className:"text-slate-600",children:a.email})]})]}),(0,d.jsx)("section",{className:"mt-8",children:(0,d.jsxs)("table",{className:"w-full text-left",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-slate-100 text-slate-600 uppercase text-xs",children:[(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Item Description"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-center",children:"Qty"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Unit Cost"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Total"})]})}),(0,d.jsx)("tbody",{children:m.map(e=>(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-3",children:e.productName}),(0,d.jsx)("td",{className:"p-3 text-center",children:e.quantity}),(0,d.jsx)("td",{className:"p-3 text-right font-mono",children:e.cost.toFixed(2)}),(0,d.jsx)("td",{className:"p-3 text-right font-mono font-semibold",children:(e.cost*e.quantity).toFixed(2)})]},e.productId))})]})}),(0,d.jsx)("section",{className:"flex justify-end mt-8",children:(0,d.jsx)("div",{className:"w-full max-w-xs space-y-2",children:(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2 mt-2",children:[(0,d.jsx)("span",{className:"text-slate-800",children:"Total Amount"}),(0,d.jsxs)("span",{className:"font-mono text-slate-800",children:["Ksh ",c.toFixed(2)]})]})})}),(0,d.jsx)("footer",{className:"mt-16 pt-4 border-t text-xs text-slate-500 text-center",children:(0,d.jsx)("p",{children:"Thank you for your business!"})})]})}),e8=e=>Promise.all(Array.from(e.getElementsByTagName("img")).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>t(),e.onerror=()=>{console.warn("Could not load image for PDF generation: ".concat(e.src)),t()})})));var e7=e=>{let{purchaseOrder:t,supplier:r,products:a,onBack:s,onWhatsAppRequest:n,settings:l,onSendPO:i,onReceivePORequest:c,canManage:m}=e,u=(0,o.useRef)(null),[x,h]=(0,o.useState)(!1),{id:p,poNumber:b,status:g}=t,f=m&&"Draft"===g,k=m&&("Sent"===g||"Partially Received"===g),y=async()=>{if(u.current&&!x){h(!0);try{await e8(u.current);let e=await eD()(u.current,{scale:2,useCORS:!0}),t=e.toDataURL("image/png"),r=new eC.ZP("p","mm","a4"),a=r.internal.pageSize.getWidth(),s=e.height*a/e.width;r.addImage(t,"PNG",0,0,a,s),r.save("PurchaseOrder_".concat(b,".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF. The logo might be causing an issue.")}finally{h(!1)}}};return(0,d.jsx)("div",{className:"h-full overflow-y-auto bg-background dark:bg-dark-background",children:(0,d.jsxs)("div",{className:"p-4 md:p-8 space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[(0,d.jsxs)("button",{onClick:s,className:"flex items-center text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to All Purchases"]}),(0,d.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[(0,d.jsxs)("button",{onClick:y,whileTap:{scale:.95},disabled:x,className:"bg-primary text-primary-content font-bold px-3 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-sm flex items-center text-sm disabled:bg-slate-400",children:[(0,d.jsx)(()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),{})," ",x?"Downloading...":"Download PDF"]}),f&&(0,d.jsx)("button",{onClick:()=>i(t.id),whileTap:{scale:.95},className:"bg-blue-600 text-white font-bold px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors shadow-sm flex items-center text-sm",children:"Mark as Sent"}),k&&(0,d.jsx)("button",{onClick:()=>c(t),whileTap:{scale:.95},className:"bg-green-600 text-white font-bold px-3 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-sm flex items-center text-sm",children:"Receive Stock"})]})]}),(0,d.jsx)("div",{id:"pdf-content-wrapper",children:(0,d.jsx)(e9,{ref:u,purchaseOrder:t,supplier:r,products:a,settings:l})})]})})};let te=e=>{let{status:t}=e,r="px-2 py-1 text-xs font-semibold rounded-full";switch(t){case"Received":return(0,d.jsx)("span",{className:"".concat(r," text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300"),children:"Received"});case"Partially Received":return(0,d.jsx)("span",{className:"".concat(r," text-sky-800 bg-sky-100 dark:bg-sky-900/50 dark:text-sky-300"),children:"Partially Received"});case"Sent":return(0,d.jsx)("span",{className:"".concat(r," text-blue-800 bg-blue-100 dark:bg-blue-900/50 dark:text-blue-300"),children:"Sent"});case"Draft":return(0,d.jsx)("span",{className:"".concat(r," text-yellow-800 bg-yellow-100 dark:bg-yellow-900/50 dark:text-yellow-300"),children:"Draft"});case"Cancelled":return(0,d.jsx)("span",{className:"".concat(r," text-red-800 bg-red-100 dark:bg-red-900/50 dark:text-red-300"),children:"Cancelled"});default:return(0,d.jsx)("span",{className:"".concat(r," text-slate-800 bg-slate-100 dark:bg-slate-700 dark:text-slate-300"),children:"Unknown"})}},tt=e=>{let{purchaseOrders:t,suppliers:r,products:a,onReceivePORequest:s,onAddPurchaseOrder:n,onAddSupplier:l,permissions:i,onSendPO:c,onWhatsAppPORequest:m,settings:u,salesOrderForPO:x,onClearSalesOrderForPO:h}=e,[p,b]=(0,o.useState)("list"),[g,f]=(0,o.useState)(null),[k,y]=(0,o.useState)(null),[j,v]=(0,o.useState)(void 0),[w,N]=(0,o.useState)({});(0,o.useEffect)(()=>{x&&(y(x.items.filter(e=>"Pending"===e.status).map(e=>{var t,r;return{productId:e.productId,productName:e.description,quantity:e.quantity,cost:(null===(t=a.find(t=>t.id===e.productId))||void 0===t?void 0:t.costPrice)||0,unitOfMeasure:(null===(r=a.find(t=>t.id===e.productId))||void 0===r?void 0:r.unitOfMeasure)||"pc(s)",salesOrderItemId:e.id}})),v(x.id),b("create"),h())},[x,a,h]);let C=(0,o.useMemo)(()=>r.reduce((e,t)=>(e[t.id]=t.name,e),{}),[r]),S=i.includes("manage_purchases"),D=(0,o.useMemo)(()=>{var e,t;let r=null!==(t=null===(e=u.inventory)||void 0===e?void 0:e.lowStockThreshold)&&void 0!==t?t:3;return a.filter(e=>"Inventory"===e.productType&&e.stock<=r)},[a,u.inventory.lowStockThreshold]),P=(e,t)=>{let r=parseInt(t,10);N(t=>({...t,[e]:isNaN(r)||r<0?0:r}))},T=(0,o.useMemo)(()=>Object.values(w).filter(e=>e>0).length,[w]),I=async e=>{let t=await n(e);b("list"),y(null),v(void 0),N({}),f(t)};return"create"===p?(0,d.jsx)(e6,{suppliers:r,products:a,onSave:I,onCancel:()=>{b("list"),y(null),v(void 0)},onAddSupplier:l,prefilledItems:k||void 0,salesOrderId:j}):g?(0,d.jsx)(e7,{purchaseOrder:g,supplier:r.find(e=>e.id===g.supplierId),onBack:()=>f(null),onWhatsAppRequest:m,products:a,settings:u,onSendPO:c,onReceivePORequest:s,canManage:S}):(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto bg-background dark:bg-dark-background",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Purchases"}),S&&(0,d.jsxs)("button",{onClick:()=>{y(null),b("create")},whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Purchase Order"]})]}),S&&D.length>0&&(0,d.jsxs)("div",{layout:!0,initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8 bg-warning/10 dark:bg-dark-warning/10 p-4 rounded-xl border border-warning/20 dark:border-dark-warning/20",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsxs)("h2",{className:"text-xl font-bold text-warning dark:text-dark-warning",children:["Items to Reorder (",D.length,")"]}),(0,d.jsxs)("button",{onClick:()=>{let e=D.filter(e=>(w[e.id]||0)>0).map(e=>({productId:e.id,productName:e.name,quantity:w[e.id],cost:e.costPrice||0,unitOfMeasure:e.unitOfMeasure}));if(0===e.length){alert("Please enter a quantity greater than 0 for at least one item.");return}y(e),v(void 0),b("create")},disabled:0===T,whileTap:{scale:.95},className:"bg-warning text-white font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center text-sm disabled:bg-slate-400 disabled:shadow-none disabled:cursor-not-allowed",children:["Create PO for ",T>0?"".concat(T," Item(s)"):"Items"]})]}),(0,d.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:D.map(e=>(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-3 rounded-lg flex justify-between items-center shadow-sm",children:[(0,d.jsxs)("div",{className:"flex-grow",children:[(0,d.jsx)("p",{className:"font-bold text-foreground dark:text-dark-foreground",children:e.name}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted font-mono",children:e.inventoryCode})]}),(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("p",{className:"text-xs font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:"Stock"}),(0,d.jsx)("p",{className:"font-bold text-danger",children:e.stock})]}),(0,d.jsxs)("div",{className:"w-24",children:[(0,d.jsx)("label",{htmlFor:"reorder-qty-".concat(e.id),className:"block text-xs font-semibold text-center text-foreground-muted dark:text-dark-foreground-muted mb-1",children:"Qty to Order"}),(0,d.jsx)("input",{id:"reorder-qty-".concat(e.id),type:"number",value:w[e.id]||0,onChange:t=>P(e.id,t.target.value),min:"0",className:"w-full p-1 border border-border dark:border-dark-border rounded-md text-center bg-background dark:bg-dark-background",onClick:e=>e.stopPropagation()})]})]})]},e.id))})]}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-bold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"PO Number"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Supplier"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Status"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Expected Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Total Cost (Ksh)"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsx)("tbody",{children:t.map(e=>(0,d.jsxs)("tr",{className:"bg-card dark:bg-dark-card border-b dark:border-dark-border hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>f(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-bold text-foreground dark:text-dark-foreground",children:e.poNumber}),(0,d.jsx)("td",{className:"px-6 py-4",children:C[e.supplierId]||"Unknown"}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)(te,{status:e.status})}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.expectedDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono",children:e.totalCost.toFixed(2)}),(0,d.jsxs)("td",{className:"px-6 py-4 text-right",children:[S&&"Draft"===e.status&&(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),c(e.id)},className:"font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 bg-blue-50 dark:bg-blue-900/50 hover:bg-blue-100 px-3 py-1 rounded-md",children:"Send PO"}),S&&("Sent"===e.status||"Partially Received"===e.status)&&(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"font-medium text-primary dark:text-dark-primary hover:text-primary-focus bg-primary/10 dark:bg-dark-primary/20 hover:bg-primary/20 px-3 py-1 rounded-md",children:"Receive Stock"}),("Received"===e.status||"Cancelled"===e.status)&&(0,d.jsx)("span",{className:"font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"View Details"})]})]},e.id))})]})})]})};var tr=e=>{let{onClose:t,onSave:r,invoice:a,supplierName:s,activeShift:n,sales:l,payouts:i,settings:c,accountingTransactions:m,chartOfAccounts:u}=e,x=Math.round((a.totalAmount-a.paidAmount)*100)/100,[h,p]=(0,o.useState)(x),[b,g]=(0,o.useState)(new Date().toISOString().split("T")[0]),[f,k]=(0,o.useState)(n?"Cash":"Bank Transfer"),[y,j]=(0,o.useState)(""),v=(0,o.useMemo)(()=>{let e=e=>{if(!e)return 0;let t=u.find(t=>t.id===e);if(!t)return 0;let r=m.flatMap(e=>e.entries).filter(t=>t.accountId===e).reduce((e,t)=>e+t.debit-t.credit,0);return["Assets","Expenses"].includes(t.type)?r:-r};return{Cash:e(c.accounting.defaultCashAccountId),"M-Pesa":e(c.accounting.defaultMpesaAccountId),"Bank Transfer":e(c.accounting.defaultBankAccountId)}},[m,u,c]),w=(0,o.useMemo)(()=>"number"==typeof h&&!(h<=0)&&("Cash"===f&&!n||h>(v[f]||0)),[h,f,v,n]),N="block text-sm font-medium text-foreground dark:text-dark-foreground",C="mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border rounded-md shadow-sm focus:outline-none sm:text-lg ".concat(w?"border-danger":"border-border dark:border-dark-border");return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-8 border border-transparent dark:border-dark-border",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Record Payment"}),(0,d.jsx)("button",{onClick:t,className:"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("div",{className:"bg-muted dark:bg-dark-muted p-4 rounded-lg mb-6 space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Invoice:"}),(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:a.invoiceNumber})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Supplier:"}),(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:s})]}),(0,d.jsx)("div",{className:"border-t border-border dark:border-dark-border !my-2"}),(0,d.jsxs)("div",{className:"flex justify-between text-lg",children:[(0,d.jsx)("span",{className:"font-bold text-foreground dark:text-dark-foreground",children:"Amount Due:"}),(0,d.jsxs)("span",{className:"font-bold text-danger",children:["Ksh ",x.toFixed(2)]})]})]}),(0,d.jsxs)("div",{className:"bg-dark-muted border border-dark-border p-4 rounded-lg mb-6 space-y-2 text-sm",children:[(0,d.jsx)("h4",{className:"font-bold text-blue-400",children:"Available Funds"}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"font-medium text-dark-foreground-muted",children:"Cash on Hand:"}),(0,d.jsxs)("span",{className:"font-semibold font-mono text-dark-foreground",children:["Ksh ",v.Cash.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"font-medium text-dark-foreground-muted",children:"M-Pesa Balance:"}),(0,d.jsxs)("span",{className:"font-semibold font-mono text-dark-foreground",children:["Ksh ",v["M-Pesa"].toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"font-medium text-dark-foreground-muted",children:"Bank Balance:"}),(0,d.jsxs)("span",{className:"font-semibold font-mono text-dark-foreground",children:["Ksh ",v["Bank Transfer"].toFixed(2)]})]})]}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=Math.round((a.totalAmount-a.paidAmount)*100)/100;if("number"!=typeof h||h<=0||h>t){alert("Payment amount must be between 0.01 and ".concat(t.toFixed(2),"."));return}if("Cash"===f&&!n){alert("An active shift is required to pay with cash from the drawer.");return}if(w){alert("Payment amount exceeds available funds for the selected method.");return}r({amount:h,paymentDate:new Date(b),method:f,referenceNumber:y||void 0})},className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"method",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Payment Method"}),(0,d.jsxs)("select",{name:"method",id:"method",value:f,onChange:e=>k(e.target.value),required:!0,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base bg-card dark:bg-dark-background border-border dark:border-dark-border focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm rounded-md",children:[(0,d.jsx)("option",{value:"Bank Transfer",children:"Bank Transfer"}),(0,d.jsx)("option",{value:"Cash",disabled:!n,children:"Cash (from Drawer)"}),(0,d.jsx)("option",{value:"M-Pesa",children:"M-Pesa"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"amount",className:N,children:"Payment Amount (Ksh)"}),(0,d.jsx)("input",{type:"number",name:"amount",id:"amount",value:h,onChange:e=>p(""===e.target.value?"":parseFloat(e.target.value)),required:!0,max:x,min:"0.01",step:"0.01",className:C}),w&&(0,d.jsx)("p",{className:"text-xs text-danger mt-1",children:"Cash"!==f||n?"Payment amount exceeds available funds for the selected method.":"An active shift is required to pay with cash."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"paymentDate",className:N,children:"Payment Date"}),(0,d.jsx)("input",{type:"date",name:"paymentDate",id:"paymentDate",value:b,onChange:e=>g(e.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"referenceNumber",className:N,children:"Reference Number (Optional)"}),(0,d.jsx)("input",{type:"text",id:"referenceNumber",value:y,onChange:e=>j(e.target.value),className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm",placeholder:"e.g. Cheque No, M-Pesa Code"})]}),(0,d.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:t,whileTap:{scale:.95},className:"bg-dark-muted text-dark-foreground font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay-dark active:shadow-clay-dark-inset",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",disabled:w,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-xl transition-shadow shadow-clay-dark active:shadow-clay-dark-inset disabled:bg-slate-600 disabled:shadow-none disabled:cursor-not-allowed",children:"Confirm Payment"})]})]})]})})};let ta=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),(0,d.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,d.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,d.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),ts=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),td=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),(0,d.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,d.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),to=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,d.jsx)("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),tn=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mx-auto h-12 w-12 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),tl=e=>{let{title:t,value:r,icon:a,colorClass:s="text-primary dark:text-dark-primary"}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm flex items-center space-x-4 border border-border dark:border-dark-border",children:[(0,d.jsx)("div",{className:"p-3 rounded-lg bg-muted dark:bg-dark-muted ".concat(s),children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-semibold",children:t}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:r})]})]})},ti=e=>{let{status:t}=e,r="px-2.5 py-1 text-xs font-bold rounded-full";switch(t){case"Paid":return(0,d.jsx)("span",{className:"".concat(r," bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"),children:"Paid"});case"Partially Paid":return(0,d.jsx)("span",{className:"".concat(r," bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"),children:"Partially Paid"});case"Unpaid":return(0,d.jsx)("span",{className:"".concat(r," bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300"),children:"Unpaid"});default:return(0,d.jsx)("span",{className:"".concat(r," bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"),children:"Unknown"})}};var tc=e=>{let{invoices:t,suppliers:r,onRecordPayment:a,onViewInvoice:s,activeShift:l,sales:i,payouts:c,accountingTransactions:m,chartOfAccounts:u,settings:x}=e,[h,p]=(0,o.useState)(!1),[b,g]=(0,o.useState)(null),f=(0,o.useMemo)(()=>r.reduce((e,t)=>(e[t.id]=t.businessName||t.name,e),{}),[r]),k=(0,o.useMemo)(()=>{let e=new Date;e.setHours(0,0,0,0);let r={current:0,due1_30:0,due31_60:0,due60_plus:0};return t.forEach(t=>{if("Paid"===t.status)return;let a=t.totalAmount-t.paidAmount,s=new Date(t.dueDate);if(s.setHours(0,0,0,0),s<e){let t=Math.ceil((e.getTime()-s.getTime())/864e5);t<=30?r.due1_30+=a:t<=60?r.due31_60+=a:r.due60_plus+=a}else r.current+=a}),r},[t]),y=(0,o.useMemo)(()=>t.filter(e=>"Unpaid"===e.status||"Partially Paid"===e.status).sort((e,t)=>new Date(e.dueDate).getTime()-new Date(t.dueDate).getTime()),[t]),j=e=>{g(e),p(!0)},v=e=>"Ksh ".concat(e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));return(0,d.jsxs)("div",{className:"p-4 md:p-6 h-full overflow-y-auto bg-background dark:bg-dark-background",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Accounts Payable"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-1",children:"Manage outstanding invoices and payments to suppliers."})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 my-6",children:[(0,d.jsx)(tl,{title:"Current",value:v(k.current),icon:(0,d.jsx)(ta,{}),colorClass:"text-green-500"}),(0,d.jsx)(tl,{title:"Overdue 1-30 Days",value:v(k.due1_30),icon:(0,d.jsx)(ts,{}),colorClass:"text-yellow-500"}),(0,d.jsx)(tl,{title:"Overdue 31-60 Days",value:v(k.due31_60),icon:(0,d.jsx)(td,{}),colorClass:"text-orange-500"}),(0,d.jsx)(tl,{title:"Overdue 60+ Days",value:v(k.due60_plus),icon:(0,d.jsx)(to,{}),colorClass:"text-red-500"})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border p-6",children:[(0,d.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Outstanding Supplier Invoices"}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted uppercase",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"py-3 px-4",children:"Invoice #"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Supplier"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Due Date"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Total"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Amount Due"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Status"}),(0,d.jsx)("th",{className:"py-3 px-4",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsxs)("tbody",{children:[y.map(e=>{let t=e.totalAmount-e.paidAmount;return(0,d.jsxs)("tr",{onClick:()=>s(e),className:"border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",children:[(0,d.jsx)("td",{className:"py-3 px-4 font-bold text-foreground dark:text-dark-foreground",children:e.invoiceNumber}),(0,d.jsx)("td",{className:"py-3 px-4 text-foreground dark:text-dark-foreground",children:f[e.supplierId]||"Unknown"}),(0,d.jsx)("td",{className:"py-3 px-4 text-foreground dark:text-dark-foreground",children:new Date(e.dueDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"py-3 px-4 font-mono",children:v(e.totalAmount)}),(0,d.jsx)("td",{className:"py-3 px-4 font-mono font-bold text-foreground dark:text-dark-foreground",children:v(t)}),(0,d.jsx)("td",{className:"py-3 px-4",children:(0,d.jsx)(ti,{status:e.status})}),(0,d.jsx)("td",{className:"py-3 px-4 text-right space-x-2",children:"Paid"!==e.status&&(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),j(e)},className:"font-medium text-primary dark:text-dark-primary hover:underline",children:"Record Payment"})})]},e.id)}),0===y.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:7,children:(0,d.jsxs)("div",{className:"text-center py-16 text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)(tn,{}),(0,d.jsx)("p",{className:"mt-4 font-semibold",children:"All caught up!"}),(0,d.jsx)("p",{children:"There are no outstanding supplier invoices."})]})})})]})]})})]}),(0,d.jsx)(n.M,{children:h&&b&&(0,d.jsx)(tr,{onClose:()=>p(!1),onSave:e=>{b&&a(b.id,e),p(!1),g(null)},invoice:b,supplierName:f[b.supplierId],activeShift:l,sales:i,payouts:c,accountingTransactions:m,chartOfAccounts:u,settings:x})})]})};let tm=e=>{let{title:t,value:r,className:a=""}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm border border-border dark:border-dark-border ".concat(a),children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-medium",children:t}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:r})]})},tu=e=>{let{label:t,filterKey:r,activeFilter:a,onClick:s}=e;return(0,d.jsx)("button",{onClick:()=>s(r),className:"px-4 py-1.5 text-sm font-bold rounded-lg transition-colors duration-200 ".concat(a===r?"bg-primary dark:bg-dark-primary text-primary-content dark:text-dark-primary-content shadow-sm":"bg-card dark:bg-dark-card text-foreground-muted dark:text-dark-foreground-muted hover:bg-muted dark:hover:bg-dark-muted"),children:t})};var tx=e=>{let{shifts:t,sales:r,expenses:a,supplierPayments:s,bankDeposits:n,settings:l}=e,[i,c]=(0,o.useState)(null),[m,u]=(0,o.useState)("today"),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)(""),g=e=>{u(e);let t=new Date,r=new Date;r.setDate(t.getDate()-1);let a=t.getDay(),s=t.getDate()-a+(0===a?-6:1),d=new Date(t.setDate(s)),o=new Date(d);o.setDate(d.getDate()-7);let n=new Date(o);n.setDate(o.getDate()+6);let l=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth(),0),c=new Date(i.getFullYear(),i.getMonth(),1),m=e=>e.toISOString().split("T")[0];switch(h(""),b(""),e){case"today":h(m(new Date)),b(m(new Date));break;case"yesterday":h(m(r)),b(m(r));break;case"this_week":h(m(d)),b(m(new Date));break;case"last_week":h(m(o)),b(m(n));break;case"this_month":h(m(l)),b(m(new Date));break;case"last_month":h(m(c)),b(m(i))}};(0,o.useEffect)(()=>{g("today")},[]);let f=(e,t)=>{u("custom"),"from"===t?h(e.target.value):b(e.target.value)},k=(0,o.useMemo)(()=>{let e=x?new Date(x):null;e&&e.setHours(0,0,0,0);let r=p?new Date(p):null;return r&&r.setHours(23,59,59,999),t.filter(e=>"closed"===e.status&&e.endTime).filter(t=>{let a=new Date(t.endTime);return(!e||!(a<e))&&(!r||!(a>r))}).sort((e,t)=>new Date(t.startTime).getTime()-new Date(e.startTime).getTime())},[t,x,p]),y=(0,o.useMemo)(()=>k.reduce((e,t)=>{var r;return e.totalSales+=t.totalSales||0,e.totalPayouts+=t.totalPayouts||0,e.cashSales+=(null===(r=t.paymentBreakdown)||void 0===r?void 0:r.Cash)||0,e.cashVariance+=t.cashVariance||0,e},{totalSales:0,totalPayouts:0,cashSales:0,cashVariance:0}),[k]),j=e=>"Ksh ".concat(e.toFixed(2));return i?(0,d.jsx)("div",{className:"h-full bg-slate-100",children:(0,d.jsx)(eF,{shift:i,sales:r,expenses:a,supplierPayments:s,bankDeposits:n,settings:l||v,onClose:()=>c(null),isHistoricalView:!0})}):(0,d.jsxs)("div",{className:"p-4 md:p-8 space-y-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Z-Reports (Closed Shifts)"}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border space-y-4",children:[(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,d.jsx)(tu,{label:"Today",filterKey:"today",activeFilter:m,onClick:g}),(0,d.jsx)(tu,{label:"Yesterday",filterKey:"yesterday",activeFilter:m,onClick:g}),(0,d.jsx)(tu,{label:"This Week",filterKey:"this_week",activeFilter:m,onClick:g}),(0,d.jsx)(tu,{label:"Last Week",filterKey:"last_week",activeFilter:m,onClick:g}),(0,d.jsx)(tu,{label:"This Month",filterKey:"this_month",activeFilter:m,onClick:g}),(0,d.jsx)(tu,{label:"Last Month",filterKey:"last_month",activeFilter:m,onClick:g})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2 border-t border-border dark:border-dark-border",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"dateFrom",className:"text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"From"}),(0,d.jsx)("input",{type:"date",id:"dateFrom",value:x,onChange:e=>f(e,"from"),className:"w-full mt-1 px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"dateTo",className:"text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"To"}),(0,d.jsx)("input",{type:"date",id:"dateTo",value:p,onChange:e=>f(e,"to"),className:"w-full mt-1 px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background"})]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,d.jsx)(tm,{title:"Total Sales",value:j(y.totalSales),className:"!text-primary dark:!text-dark-primary"}),(0,d.jsx)(tm,{title:"Cash Sales",value:j(y.cashSales)}),(0,d.jsx)(tm,{title:"Total Payouts",value:j(y.totalPayouts),className:"!text-warning dark:!text-dark-warning"}),(0,d.jsx)(tm,{title:"Net Cash Variance",value:j(y.cashVariance),className:y.cashVariance<0?"!text-danger":"!text-green-600"})]}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-md overflow-x-auto border border-border dark:border-dark-border",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Cashier"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Shift Start"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Shift End"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Total Sales"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Cash Variance"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsxs)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:[k.map(e=>{let t=e.cashVariance||0;return(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>c(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-medium text-foreground dark:text-dark-foreground",children:e.userName}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.startTime).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.endTime?new Date(e.endTime).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"}):"N/A"}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono",children:j(e.totalSales||0)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono font-semibold ".concat(0===t?"text-foreground dark:text-dark-foreground":t>0?"text-warning":"text-danger"),children:j(t)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right",children:(0,d.jsx)("button",{className:"font-medium text-primary dark:text-dark-primary hover:underline",children:"View Report"})})]},e.id)}),0===k.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:6,className:"text-center py-10 text-foreground-muted dark:text-dark-foreground-muted",children:"No closed shifts found for the selected period."})})]})]})})]})},th=e=>{let{sales:t,customers:r,users:a,onViewSaleRequest:s}=e,[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(1),[m,u]=(0,o.useState)(""),[x,h]=(0,o.useState)(""),p=(0,o.useMemo)(()=>new Map(r.map(e=>[e.id,e.name])),[r]),b=(0,o.useMemo)(()=>{let e=m?new Date(m):null;e&&e.setHours(0,0,0,0);let r=x?new Date(x):null;return r&&r.setHours(23,59,59,999),t.filter(t=>{let a=new Date(t.date);return(!e||!(a<e))&&(!r||!(a>r))}).filter(e=>{let t=p.get(e.customerId)||"",r=n.toLowerCase();return e.id.toLowerCase().includes(r)||t.toLowerCase().includes(r)||e.cashierName.toLowerCase().includes(r)}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())},[t,n,m,x,p]),g=(0,o.useMemo)(()=>{let e=(i-1)*15;return b.slice(e,e+15)},[b,i]),f=Math.ceil(b.length/15),k=(0,o.useMemo)(()=>({totalRevenue:b.reduce((e,t)=>e+(t.depositApplied?t.total+t.depositApplied:t.total),0),transactionCount:b.length}),[b]);return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsx)("h1",{className:"text-4xl font-bold text-foreground dark:text-dark-foreground",children:"Sales History"}),(0,d.jsxs)("div",{className:"my-6 p-4 bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsx)("input",{type:"text",placeholder:"Search by ID, Customer, Cashier...",className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary",value:n,onChange:e=>l(e.target.value)}),(0,d.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card"}),(0,d.jsx)("input",{type:"date",value:x,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-border dark:border-dark-border",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-bold",children:"Total Revenue"}),(0,d.jsxs)("p",{className:"text-2xl font-bold text-primary dark:text-dark-primary",children:["Ksh ",k.totalRevenue.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-bold",children:"Transactions"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-primary dark:text-dark-primary",children:k.transactionCount})]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:[(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-semibold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Receipt ID"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Customer"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Cashier"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4 text-right",children:"Total (Ksh)"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsx)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:g.map(e=>(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>s(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-bold text-foreground dark:text-dark-foreground font-mono text-xs",children:e.id}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.date).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:p.get(e.customerId)||"Unknown"}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.cashierName}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono font-semibold",children:(e.total+(e.depositApplied||0)).toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right",children:(0,d.jsx)("button",{className:"font-medium text-primary dark:text-dark-primary hover:underline",children:"View"})})]},e.id))})]}),f>1&&(0,d.jsxs)("div",{className:"flex justify-between items-center p-4 text-sm border-t border-border dark:border-dark-border",children:[(0,d.jsx)("button",{onClick:()=>c(e=>Math.max(1,e-1)),disabled:1===i,className:"px-3 py-1 border rounded-md disabled:opacity-50 border-border dark:border-dark-border",children:"Previous"}),(0,d.jsxs)("span",{children:["Page ",i," of ",f]}),(0,d.jsx)("button",{onClick:()=>c(e=>Math.min(f,e+1)),disabled:i===f,className:"px-3 py-1 border rounded-md disabled:opacity-50 border-border dark:border-dark-border",children:"Next"})]})]})]})};let tp=e=>Promise.all(Array.from(e.getElementsByTagName("img")).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>t(),e.onerror=()=>{console.warn("Could not load image for PDF generation: ".concat(e.src)),t()})})));var tb=e=>{let{sale:t,layaway:r,onBack:a,currentUser:s,settings:n,onWhatsAppReceiptRequest:l,showToast:i}=e,c=(0,o.useRef)(null),[m,u]=(0,o.useState)(!1),x=async()=>{let{type:e,vendorId:r,productId:a}=n.hardware.printer;if("ESC/POS"===e){if(!r||!a){i("ESC/POS printer not configured. Please connect one in Settings > Hardware.","warning"),setTimeout(()=>window.print(),500);return}try{await U(t,n,t.cashierName)}catch(e){var s;console.error("Direct print failed:",e),(null===(s=e.message)||void 0===s?void 0:s.includes("driver may be blocking access"))?(i("Direct print failed. Falling back to Browser Print.","warning"),setTimeout(()=>window.print(),500)):i(e.message||"Direct print failed. Please check printer connection.","error")}}else window.print()},h=async()=>{c.current&&!m&&(u(!0),setTimeout(async()=>{try{if(!c.current)throw Error("PDF reference is not available.");await tp(c.current);let e=await eD()(c.current,{scale:2,useCORS:!0,backgroundColor:"#ffffff"}),r=e.toDataURL("image/png"),a=new eC.ZP("p","mm",[80,297]),s=a.internal.pageSize.getWidth(),d=e.height*s/e.width;a.addImage(r,"PNG",0,0,s,d),a.save("Receipt_".concat(t.id,".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF. The logo, barcode, or QR code might be causing an issue.")}finally{u(!1)}},100))};return(0,d.jsx)("div",{className:"h-full flex flex-col bg-background dark:bg-dark-background p-4 md:p-8 md:items-center md:justify-center",children:(0,d.jsxs)("div",{className:"w-full max-w-5xl flex flex-col md:flex-row gap-8 h-full md:h-auto",children:[(0,d.jsxs)("div",{className:"flex-shrink-0 md:flex-grow bg-card dark:bg-dark-card p-8 rounded-xl shadow-sm border border-border dark:border-dark-border flex flex-col items-center justify-center",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Receipt Details"}),(0,d.jsxs)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2 font-mono text-sm",children:["ID: ",t.id]}),(0,d.jsxs)("div",{className:"mt-8 flex flex-wrap justify-center gap-4",children:[(0,d.jsx)("button",{onClick:a,whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold py-3 px-6 rounded-lg hover:bg-border dark:hover:bg-dark-border transition-colors shadow-sm text-lg",children:"← Back to List"}),(0,d.jsx)("button",{onClick:h,whileHover:{scale:1.05},whileTap:{scale:.95},disabled:m,className:"bg-secondary text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-600 transition-colors shadow-md text-lg flex items-center disabled:bg-slate-400",children:m?"Downloading...":"Download PDF"}),(0,d.jsxs)("button",{onClick:()=>l("Receipt",t.id,t.customerId),whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-[#25D366] text-white font-bold py-3 px-6 rounded-lg hover:bg-[#1EAE53] transition-colors shadow-md text-lg flex items-center",children:[(0,d.jsx)("div",{className:"w-5 h-5 mr-2",children:N.whatsapp}),"WhatsApp"]}),(0,d.jsxs)("button",{onClick:x,whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-foreground/80 dark:bg-dark-border text-white font-bold py-3 px-6 rounded-lg hover:bg-foreground dark:hover:bg-dark-border/80 transition-colors shadow-md text-lg flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h1v-4a1 1 0 011-1h10a1 1 0 011 1v4h1a2 2 0 002-2v-6a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z",clipRule:"evenodd"})}),"Print"]})]})]}),(0,d.jsx)("div",{className:"flex-grow w-full md:w-96 md:flex-grow-0 flex-shrink-0 overflow-y-auto",children:(0,d.jsx)("div",{id:"receipt-container",children:(0,d.jsx)("div",{ref:c,children:(0,d.jsx)(ej,{sale:t,cashierName:t.cashierName,settings:n,layaway:r})})})})]})})},tg=e=>{let{settings:t,onUpdateSettings:r,showToast:a,isSetupWizard:s=!1,onWizardNext:n}=e,[l,i]=(0,o.useState)(t.businessInfo),[c,m]=(0,o.useState)(t.businessInfo.logoUrl),u=e=>{let{name:t,value:r}=e.target;i(e=>({...e,[t]:r}))};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({businessInfo:{...l,logoUrl:c||""}}),n&&n()},className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-foreground dark:text-white",children:"Company Name"}),(0,d.jsx)("input",{type:"text",name:"name",id:"name",value:l.name,onChange:u,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none sm:text-sm text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-foreground dark:text-white",children:"Business Location"}),(0,d.jsx)("input",{type:"text",name:"location",id:"location",value:l.location,onChange:u,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none sm:text-sm text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-foreground dark:text-white",children:"Business Phone"}),(0,d.jsx)("input",{type:"tel",name:"phone",id:"phone",value:l.phone,onChange:u,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none sm:text-sm text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-foreground dark:text-white",children:"Business Email"}),(0,d.jsx)("input",{type:"email",name:"email",id:"email",value:l.email||"",onChange:u,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none sm:text-sm text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"branch",className:"block text-sm font-medium text-foreground dark:text-white",children:"Branch Name"}),(0,d.jsx)("input",{type:"text",name:"branch",id:"branch",value:l.branch||"",onChange:u,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none sm:text-sm text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted"})]})]}),(0,d.jsxs)("div",{className:"md:col-span-1",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-white",children:"Business Logo"}),(0,d.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-border dark:border-dark-border border-dashed rounded-xl",children:(0,d.jsxs)("div",{className:"space-y-1 text-center",children:[c?(0,d.jsx)("img",{src:c,alt:"Logo preview",className:"mx-auto h-24 w-24 object-contain rounded-md"}):(0,d.jsx)("svg",{className:"mx-auto h-12 w-12 text-foreground-muted dark:text-dark-foreground-muted",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,d.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,d.jsxs)("div",{className:"flex text-sm text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-card dark:bg-dark-card rounded-md font-medium text-primary dark:text-dark-primary hover:text-primary-focus focus-within:outline-none",children:[(0,d.jsx)("span",{children:"Upload a file"}),(0,d.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){let e=new FileReader;e.onloadend=()=>{m(e.result),a("Logo preview updated. Save to persist.","info")},e.readAsDataURL(r)}},accept:"image/*"})]}),(0,d.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"PNG, JPG, GIF up to 10MB"})]})})]})]}),(0,d.jsx)("div",{className:"flex justify-end pt-6 ".concat(!s&&"border-t border-border dark:border-dark-border mt-6"),children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-gradient-to-br from-primary to-primary-focus text-primary-content font-semibold px-6 py-2 rounded-xl transition-all transform hover:-translate-y-0.5 shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:s?"Save & Continue":"Save Business Info"})})]})};let tf=e=>{let{settings:t,onUpdateSettings:r}=e,[a,s]=(0,o.useState)(t.tax),[l,i]=(0,o.useState)(t.businessInfo.kraPin),c=e=>{let{name:t,value:r,type:a}=e.target;if("checkbox"===a){let{checked:r}=e.target;s(e=>({...e,[t]:r}))}else s(e=>({...e,[t]:"vatRate"===t?parseFloat(r):r}))};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({tax:a,businessInfo:{...t.businessInfo,kraPin:l}})},className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-4 bg-muted dark:bg-dark-muted rounded-xl",children:[(0,d.jsx)("span",{className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Enable VAT Calculations"}),(0,d.jsxs)("label",{htmlFor:"vat-toggle",className:"inline-flex relative items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",name:"vatEnabled",checked:a.vatEnabled,onChange:c,id:"vat-toggle",className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-focus:ring-4 peer-focus:ring-primary dark:peer-focus:ring-dark-primary peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"})]})]}),(0,d.jsx)(n.M,{children:a.vatEnabled&&(0,d.jsxs)("div",{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-6 overflow-hidden",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"vatRate",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Default VAT Rate (%)"}),(0,d.jsx)("input",{type:"number",name:"vatRate",id:"vatRate",value:a.vatRate,onChange:c,className:"mt-1 block w-full max-w-xs px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-xl shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Default Pricing Model"}),(0,d.jsxs)("div",{className:"mt-2 flex space-x-4",children:[(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"radio",name:"pricingType",value:"inclusive",checked:"inclusive"===a.pricingType,onChange:c,className:"focus:ring-primary h-4 w-4 text-primary border-border"}),(0,d.jsx)("span",{className:"ml-2 text-sm",children:"VAT Inclusive (Prices include VAT)"})]}),(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"radio",name:"pricingType",value:"exclusive",checked:"exclusive"===a.pricingType,onChange:c,className:"focus:ring-primary h-4 w-4 text-primary border-border"}),(0,d.jsx)("span",{className:"ml-2 text-sm",children:"VAT Exclusive (VAT is added on top)"})]})]})]}),(0,d.jsxs)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-xl space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Enable eTIMS Compliance"}),(0,d.jsxs)("label",{htmlFor:"etims-toggle",className:"inline-flex relative items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",name:"etimsEnabled",checked:a.etimsEnabled,onChange:c,id:"etims-toggle",className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-focus:ring-4 peer-focus:ring-primary dark:peer-focus:ring-dark-primary peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"})]})]}),a.etimsEnabled&&(0,d.jsxs)("div",{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"kraPin",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"KRA PIN"}),(0,d.jsx)("input",{type:"text",name:"kraPin",id:"kraPin",value:l,onChange:e=>i(e.target.value),className:"mt-1 block w-full max-w-xs px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-xl shadow-sm"})]}),(0,d.jsx)("div",{className:"p-2 bg-warning/10 border border-warning/20 rounded-md text-xs text-warning",children:"Note: eTIMS integration requires a backend service to communicate with the KRA API. This toggle is for UI demonstration purposes."})]})]})]})}),(0,d.jsx)("div",{className:"flex justify-end pt-6 border-t border-border dark:border-dark-border mt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:"Save Tax Settings"})})]})};var tk=e=>{let{settings:t,onUpdateSettings:r}=e,a=(e,a,s)=>{let d=t.permissions[e],o=s?[...d,a]:d.filter(e=>e!==a);r({permissions:{...t.permissions,[e]:o}})};return(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsx)("div",{className:"rounded-xl shadow-sm border border-border dark:border-dark-border",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Permission"}),Object.keys(t.permissions).map(e=>(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-center",children:e},e))]})}),(0,d.jsx)("tbody",{children:C.map(e=>{let{module:r,permissions:s}=e;return(0,d.jsxs)(o.Fragment,{children:[(0,d.jsx)("tr",{className:"bg-background dark:bg-dark-background/50",children:(0,d.jsx)("td",{colSpan:1+Object.keys(t.permissions).length,className:"px-6 py-2 font-bold text-foreground-muted dark:text-dark-foreground-muted",children:r})}),s.map(e=>(0,d.jsxs)("tr",{className:"bg-card dark:bg-dark-card border-b dark:border-dark-border last:border-b-0 hover:bg-muted dark:hover:bg-dark-muted/50",children:[(0,d.jsx)("td",{className:"px-6 py-4 font-medium text-foreground dark:text-dark-foreground",children:e.label}),Object.keys(t.permissions).map(r=>(0,d.jsx)("td",{className:"px-6 py-4 text-center",children:(0,d.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-border dark:border-dark-border text-primary focus:ring-primary dark:bg-dark-card",checked:t.permissions[r].includes(e.id),onChange:t=>a(r,e.id,t.target.checked),disabled:"Admin"===r})},"".concat(e.id,"-").concat(r)))]},e.id))]},r)})})]})})})},ty=e=>{let{settings:t,onUpdateSettings:r}=e,[a,s]=(0,o.useState)(t.receipt),n=e=>{let{name:t,value:r}=e.target;s(e=>({...e,[t]:r}))};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({receipt:a})},className:"space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"footer",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Receipt Footer Text"}),(0,d.jsx)("textarea",{name:"footer",id:"footer",value:a.footer,onChange:n,rows:3,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"}),(0,d.jsx)("p",{className:"mt-2 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"This text will appear at the bottom of all receipts and invoices."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Number Prefixes"}),(0,d.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"invoicePrefix",className:"block text-xs font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Invoice Prefix"}),(0,d.jsx)("input",{type:"text",name:"invoicePrefix",id:"invoicePrefix",value:a.invoicePrefix,onChange:n,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"quotePrefix",className:"block text-xs font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Quotation Prefix"}),(0,d.jsx)("input",{type:"text",name:"quotePrefix",id:"quotePrefix",value:a.quotePrefix,onChange:n,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"poNumberPrefix",className:"block text-xs font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Purchase Order Prefix"}),(0,d.jsx)("input",{type:"text",name:"poNumberPrefix",id:"poNumberPrefix",value:a.poNumberPrefix,onChange:n,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"layawayPrefix",className:"block text-xs font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Layaway Prefix"}),(0,d.jsx)("input",{type:"text",name:"layawayPrefix",id:"layawayPrefix",value:a.layawayPrefix,onChange:n,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"workOrderPrefix",className:"block text-xs font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Work Order Prefix"}),(0,d.jsx)("input",{type:"text",name:"workOrderPrefix",id:"workOrderPrefix",value:a.workOrderPrefix,onChange:n,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"salesOrderPrefix",className:"block text-xs font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Sales Order Prefix"}),(0,d.jsx)("input",{type:"text",name:"salesOrderPrefix",id:"salesOrderPrefix",value:a.salesOrderPrefix,onChange:n,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]})]})]}),(0,d.jsx)("div",{className:"flex justify-end pt-6 border-t border-border dark:border-dark-border mt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:"Save Receipt Settings"})})]})},tj=e=>{let{auditLogs:t,users:r,onDriveBackupAuditLogs:a,isDriveAuthenticated:s}=e,[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)("all"),[m,u]=(0,o.useState)(""),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)(1),g=(0,o.useMemo)(()=>{let e=m?new Date(m):null;e&&e.setHours(0,0,0,0);let r=x?new Date(x):null;return r&&r.setHours(23,59,59,999),t.filter(e=>"all"===i||e.userId===i).filter(t=>{let a=new Date(t.timestamp);return(!e||!(a<e))&&(!r||!(a>r))}).filter(e=>e.action.toLowerCase().includes(n.toLowerCase())||e.details.toLowerCase().includes(n.toLowerCase())||e.userName.toLowerCase().includes(n.toLowerCase()))},[t,n,i,m,x]),f=(0,o.useMemo)(()=>{let e=(p-1)*20;return g.slice(e,e+20)},[g,p]),k=Math.ceil(g.length/20),y=e=>{if(0===g.length){alert("No logs to export with current filters.");return}let t="banduka_pos_audit_logs_".concat(new Date().toISOString().split("T")[0]),r="",a="";"csv"===e?(r=["id,timestamp,userId,userName,action,details",...g.map(e=>[e.id,new Date(e.timestamp).toISOString(),e.userId,'"'.concat(e.userName.replace(/"/g,'""'),'"'),e.action,'"'.concat(e.details.replace(/"/g,'""'),'"')].join(","))].join("\n"),a="text/csv;charset=utf-8;"):(r=JSON.stringify(g,null,2),a="application/json;charset=utf-8;");let s=new Blob([r],{type:a}),d=document.createElement("a");d.href=URL.createObjectURL(s),d.download="".concat(t,".").concat(e),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(d.href)};return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-lg border border-border dark:border-dark-border space-y-4",children:[(0,d.jsx)("h4",{className:"font-semibold text-foreground dark:text-dark-foreground",children:"Filters"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,d.jsx)("input",{type:"text",placeholder:"Search logs...",value:n,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"}),(0,d.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full block pl-3 pr-10 py-2 text-base bg-card dark:bg-dark-card border border-border dark:border-dark-border focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm rounded-md",children:[(0,d.jsx)("option",{value:"all",children:"All Users"}),r.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,d.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"}),(0,d.jsx)("input",{type:"date",value:x,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]})]}),(0,d.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,d.jsx)("button",{onClick:()=>y("csv"),className:"bg-primary/80 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:bg-primary",children:"Export as CSV"}),(0,d.jsx)("button",{onClick:()=>y("json"),className:"bg-primary/80 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:bg-primary",children:"Export as JSON"}),(0,d.jsx)("button",{onClick:a,disabled:!s,className:"bg-blue-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-slate-400 disabled:cursor-not-allowed",children:"Backup to Drive"})]}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-lg shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Timestamp"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"User"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Action"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Details"})]})}),(0,d.jsxs)("tbody",{children:[f.map(e=>(0,d.jsxs)("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.timestamp).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4 font-medium text-foreground dark:text-dark-foreground",children:e.userName}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("span",{className:"font-mono text-xs bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground px-2 py-1 rounded",children:e.action})}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.details})]},e.id)),0===g.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:4,className:"text-center py-8",children:"No logs found matching criteria."})})]})]})}),k>1&&(0,d.jsxs)("div",{className:"flex justify-between items-center mt-4 text-sm",children:[(0,d.jsx)("button",{onClick:()=>b(e=>Math.max(1,e-1)),disabled:1===p,className:"px-3 py-1 border border-border dark:border-dark-border rounded-md disabled:opacity-50",children:"Previous"}),(0,d.jsxs)("span",{children:["Page ",p," of ",k]}),(0,d.jsx)("button",{onClick:()=>b(e=>Math.min(k,e+1)),disabled:p===k,className:"px-3 py-1 border border-border dark:border-dark-border rounded-md disabled:opacity-50",children:"Next"})]})]})};let tv=e=>{let{id:t,name:r,checked:a,onChange:s}=e;return(0,d.jsxs)("label",{htmlFor:t,className:"inline-flex relative items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",name:r,checked:a,onChange:s,id:t,className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-slate-200 dark:bg-dark-muted rounded-full peer peer-checked:bg-primary dark:peer-checked:bg-dark-primary transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"})]})};var tw=e=>{let{settings:t,onUpdateSettings:r}=e,[a,s]=(0,o.useState)(t.loyalty),l=e=>{let{name:t,value:r,type:a,checked:d}=e.target;s(e=>({...e,[t]:"checkbox"===a?d:parseFloat(r)||0}))};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({loyalty:a})},className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-clay-light dark:shadow-clay-dark flex justify-between items-center",children:[(0,d.jsx)("label",{htmlFor:"loyalty-toggle",className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Enable Loyalty Program"}),(0,d.jsx)(tv,{id:"loyalty-toggle",name:"enabled",checked:a.enabled,onChange:l})]}),(0,d.jsx)(n.M,{children:a.enabled&&(0,d.jsx)("div",{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-6 pt-6 border-t border-border dark:border-dark-border overflow-hidden",children:(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"pointsPerKsh",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Points Earning Rule"}),(0,d.jsxs)("div",{className:"mt-1 flex items-center space-x-2 text-foreground dark:text-dark-foreground",children:[(0,d.jsx)("span",{children:"1 point per every"}),(0,d.jsx)("input",{type:"number",name:"pointsPerKsh",id:"pointsPerKsh",value:a.pointsPerKsh,onChange:l,min:"1",className:"w-24 px-2 py-1 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none"}),(0,d.jsx)("span",{children:"Ksh spent"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"redemptionRate",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Points Redemption Rule"}),(0,d.jsxs)("div",{className:"mt-1 flex items-center space-x-2 text-foreground dark:text-dark-foreground",children:[(0,d.jsx)("span",{children:"1 point is worth"}),(0,d.jsx)("input",{type:"number",name:"redemptionRate",id:"redemptionRate",value:a.redemptionRate,onChange:l,min:"0",step:"0.01",className:"w-24 px-2 py-1 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none"}),(0,d.jsx)("span",{children:"Ksh"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"minRedeemablePoints",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Minimum Points to Redeem"}),(0,d.jsx)("input",{type:"number",name:"minRedeemablePoints",id:"minRedeemablePoints",value:a.minRedeemablePoints,onChange:l,min:"0",className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none"}),(0,d.jsx)("p",{className:"mt-1 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Customer must have at least this many points to start redeeming."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"maxRedemptionPercentage",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Max Redemption per Sale (%)"}),(0,d.jsx)("input",{type:"number",name:"maxRedemptionPercentage",id:"maxRedemptionPercentage",value:a.maxRedemptionPercentage,onChange:l,min:"0",max:"100",className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none"}),(0,d.jsx)("p",{className:"mt-1 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Maximum percentage of a sale's total that can be paid with points."})]})]})})}),(0,d.jsx)("div",{className:"flex justify-end pt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.98},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-xl transition-shadow shadow-clay-light dark:shadow-clay-dark active:shadow-clay-light-inset dark:active:shadow-clay-dark-inset",children:"Save Loyalty Settings"})})]})};let tN=e=>{let{name:t,value:r,label:a,checked:s,onChange:o}=e;return(0,d.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,d.jsx)("input",{type:"radio",name:t,value:r,checked:s,onChange:o,className:"sr-only peer"}),(0,d.jsx)("div",{className:"relative flex items-center justify-center w-5 h-5 rounded-full border-2 border-slate-400 dark:border-dark-foreground-muted peer-checked:border-primary dark:peer-checked:border-dark-primary transition-colors",children:(0,d.jsx)("div",{className:"w-2.5 h-2.5 bg-primary dark:bg-dark-primary rounded-full scale-0 peer-checked:scale-100 transition-transform"})}),(0,d.jsx)("span",{className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:a})]})},tC=e=>{let{id:t,name:r,checked:a,onChange:s}=e;return(0,d.jsxs)("label",{htmlFor:t,className:"inline-flex relative items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",name:r,checked:a,onChange:s,id:t,className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-slate-200 dark:bg-dark-muted rounded-full peer peer-checked:bg-primary dark:peer-checked:bg-dark-primary transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"})]})};var tS=e=>{let{settings:t,onUpdateSettings:r}=e,[a,s]=(0,o.useState)(t.discount),l=e=>{let{name:t,value:r,type:a,checked:d}=e.target;s(e=>({...e,[t]:"checkbox"===a?d:"number"===a?parseFloat(r):r}))},i=e=>{let{name:t,value:r}=e.target;s(e=>({...e,[t]:r}))};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({discount:a})},className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-clay-light dark:shadow-clay-dark flex justify-between items-center",children:[(0,d.jsx)("label",{htmlFor:"discount-toggle",className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Enable Discounts"}),(0,d.jsx)(tC,{id:"discount-toggle",name:"enabled",checked:a.enabled,onChange:l})]}),(0,d.jsx)(n.M,{children:a.enabled&&(0,d.jsx)("div",{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-6 pt-6 border-t border-border dark:border-dark-border overflow-hidden",children:(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground mb-3",children:"Discount Type"}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)(tN,{name:"type",value:"percentage",label:"Percentage (%)",checked:"percentage"===a.type,onChange:i}),(0,d.jsx)(tN,{name:"type",value:"fixed",label:"Fixed Amount (KES)",checked:"fixed"===a.type,onChange:i})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("label",{htmlFor:"maxValue",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:["Maximum Discount Value (","percentage"===a.type?"%":"KES",")"]}),(0,d.jsx)("input",{type:"number",name:"maxValue",id:"maxValue",value:a.maxValue,onChange:l,min:"0",className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border-0 rounded-xl shadow-clay-light-inset dark:shadow-clay-dark-inset focus:outline-none sm:text-sm text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted"}),(0,d.jsx)("p",{className:"mt-2 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Set the maximum discount a cashier can apply."})]})]})})}),(0,d.jsx)("div",{className:"flex justify-end pt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.98},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-xl transition-shadow shadow-clay-light dark:shadow-clay-dark active:shadow-clay-light-inset dark:active:shadow-clay-dark-inset",children:"Save Discount Settings"})})]})};let tD=e=>{let{name:t,value:r,label:a,checked:s,onChange:o}=e;return(0,d.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,d.jsx)("input",{type:"radio",name:t,value:r,checked:s,onChange:o,className:"sr-only peer"}),(0,d.jsx)("div",{className:"relative flex items-center justify-center w-5 h-5 rounded-full border-2 border-slate-400 dark:border-dark-foreground-muted peer-checked:border-primary dark:peer-checked:border-dark-primary transition-colors",children:(0,d.jsx)("div",{className:"w-2.5 h-2.5 bg-primary dark:bg-dark-primary rounded-full scale-0 peer-checked:scale-100 transition-transform"})}),(0,d.jsx)("span",{className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:a})]})},tP=e=>{let{id:t,name:r,checked:a,onChange:s}=e;return(0,d.jsxs)("label",{htmlFor:t,className:"inline-flex relative items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",name:r,checked:a,onChange:s,id:t,className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-slate-200 dark:bg-dark-muted rounded-full peer peer-checked:bg-primary dark:peer-checked:bg-dark-primary transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"})]})};var tT=e=>{let{settings:t,onUpdateSettings:r,showToast:a,onTestBarcodePrint:s}=e,[l,i]=(0,o.useState)(t.hardware),[c,m]=(0,o.useState)(null);(0,o.useEffect)(()=>{let{vendorId:e,productId:t}=l.printer;e&&t&&F(e,t).then(e=>{e&&m("".concat(e.productName," (Permission granted)"))})},[l.printer]);let u=e=>{let{name:t,value:r}=e.target,a="vendorId"===t||"productId"===t?parseInt(r)||void 0:r;i(e=>({...e,printer:{...e.printer,[t]:a}}))},x=async()=>{try{let e=await A(),t={...l.printer,vendorId:e.vendorId,productId:e.productId,name:e.productName};i(e=>({...e,printer:t})),m(e.productName||"Unnamed Device"),a("Connected to ".concat(e.productName,"!"),"success"),r({hardware:{...l,printer:t}})}catch(t){var e;if("NotFoundError"===t.name)return;if(null===(e=t.message)||void 0===e?void 0:e.includes("driver may be blocking access")){let e={...l.printer,type:"Browser"},t={...l,printer:e};i(t),r({hardware:t}),a("Direct connection failed. Switched to 'Browser Print' mode for compatibility.","warning")}else a(t.message||"Failed to connect.","error");console.error("Printer connection error:",t)}},h=async e=>{var t,d;if("Receipt Printer"===e){if("ESC/POS"!==l.printer.type){a("Test print is only available for ESC/POS direct printers.","info");return}if(!l.printer.vendorId||!l.printer.productId){a("Printer not configured. Please connect one using the 'Connect Printer' button before testing.","error");return}try{a("Sending test print...","info"),await W(l.printer),a("Test print sent successfully!","success")}catch(e){if("NotFoundError"===e.name)return;if(null===(t=e.message)||void 0===t?void 0:t.includes("driver may be blocking access")){let e={...l.printer,type:"Browser"},t={...l,printer:e};i(t),r({hardware:t}),a("Test print failed. Switched to 'Browser Print' for compatibility.","warning")}else a(e.message||"Test print failed.","error");console.error("Test print error:",e)}}else if("Cash Drawer"===e){if("ESC/POS"!==l.printer.type){a("Cash drawer test is only available for ESC/POS direct printers.","info");return}if(!l.printer.vendorId||!l.printer.productId){a("Printer not configured. Please connect one to test the cash drawer.","error");return}try{a("Sending open drawer signal...","info"),await _(l.printer),a("Open drawer signal sent!","success")}catch(e){if("NotFoundError"===e.name)return;if(null===(d=e.message)||void 0===d?void 0:d.includes("driver may be blocking access")){let e={...l.printer,type:"Browser"},t={...l,printer:e};i(t),r({hardware:t}),a("Cash drawer test failed. Switched to 'Browser Print' for compatibility.","warning")}else a(e.message||"Failed to open drawer.","error");console.error("Cash drawer test error:",e)}}else{if("ZPL"===l.barcodePrinter.type){a("Direct ZPL printing requires a backend or browser bridge application, which is not available in this version.","info");return}s()}};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({hardware:l})},className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-2xl shadow-clay-light dark:shadow-clay-dark",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:"Receipt Printer & Cash Drawer"}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0 ml-4",children:[(0,d.jsx)("button",{type:"button",onClick:()=>h("Cash Drawer"),whileTap:{scale:.95},className:"bg-card dark:bg-dark-card text-primary dark:text-dark-primary text-sm font-semibold px-4 py-2 rounded-xl hover:bg-muted dark:hover:bg-dark-muted transition-shadow border border-primary dark:border-dark-primary shadow-clay-light dark:shadow-clay-dark active:shadow-clay-light-inset dark:active:shadow-clay-dark-inset",children:"Test Drawer"}),(0,d.jsx)("button",{type:"button",onClick:()=>h("Receipt Printer"),whileTap:{scale:.95},className:"bg-card dark:bg-dark-card text-primary dark:text-dark-primary text-sm font-semibold px-4 py-2 rounded-xl hover:bg-muted dark:hover:bg-dark-muted transition-shadow border border-primary dark:border-dark-primary shadow-clay-light dark:shadow-clay-dark active:shadow-clay-light-inset dark:active:shadow-clay-dark-inset",children:"Test Print"})]})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Printer Type"}),(0,d.jsxs)("div",{className:"mt-2 flex space-x-6",children:[(0,d.jsx)(tD,{name:"type",value:"Browser",label:"Browser Print",checked:"Browser"===l.printer.type,onChange:u}),(0,d.jsx)(tD,{name:"type",value:"ESC/POS",label:"ESC/POS Direct",checked:"ESC/POS"===l.printer.type,onChange:u})]}),(0,d.jsx)("p",{className:"mt-2 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Browser Print uses the standard browser print dialog. ESC/POS attempts to communicate directly with compatible receipt printers."})]}),(0,d.jsx)(n.M,{children:"ESC/POS"===l.printer.type&&(0,d.jsxs)("div",{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4 pt-4 border-t border-border dark:border-dark-border overflow-hidden",children:[(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Direct USB printing via WebUSB requires user permission for each device."}),(0,d.jsx)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-lg border border-border dark:border-dark-border",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"USB Connection"}),(0,d.jsx)("p",{className:"text-xs font-semibold ".concat((null==c?void 0:c.includes("Permission"))?"text-warning":c?"text-primary":"text-foreground-muted"),children:c||"Not Connected"})]}),(0,d.jsx)("button",{type:"button",onClick:x,whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-3 py-1.5 rounded-lg hover:bg-primary-focus transition-colors text-sm shadow-clay-dark active:shadow-clay-dark-inset",children:"Connect Printer"})]})})]})})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-2xl shadow-clay-light dark:shadow-clay-dark",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground mb-4",children:"Barcode Scanner"}),(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("label",{htmlFor:"scanner-enabled-toggle",className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Enable Barcode Scanning"}),(0,d.jsx)(tP,{id:"scanner-enabled-toggle",name:"enabled",checked:l.barcodeScanner.enabled,onChange:e=>{let{name:t,checked:r}=e.target;i(e=>({...e,barcodeScanner:{...e.barcodeScanner,[t]:r}}))}})]}),(0,d.jsx)("p",{className:"mt-4 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Most USB scanners work by emulating a keyboard and should function automatically on the POS screen. This setting confirms the feature is active."})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-2xl shadow-clay-light dark:shadow-clay-dark",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:"Barcode Label Printer"}),(0,d.jsx)("button",{type:"button",onClick:()=>h("Label Printer"),disabled:!l.barcodePrinter.enabled,whileTap:{scale:.95},className:"bg-card dark:bg-dark-card text-primary dark:text-dark-primary text-sm font-semibold px-4 py-2 rounded-xl hover:bg-muted dark:hover:bg-dark-muted transition-shadow border border-primary dark:border-dark-primary shadow-clay-light dark:shadow-clay-dark active:shadow-clay-light-inset dark:active:shadow-clay-dark-inset disabled:opacity-50 disabled:cursor-not-allowed",children:"Test Label"})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("label",{htmlFor:"barcode-printer-enabled-toggle",className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Enable Label Printing"}),(0,d.jsx)(tP,{id:"barcode-printer-enabled-toggle",name:"enabled",checked:l.barcodePrinter.enabled,onChange:e=>{let{name:t,value:r,type:a}=e.target,s="checkbox"===a,d=e.target.checked;i(e=>({...e,barcodePrinter:{...e.barcodePrinter,[t]:s?d:r}}))}})]}),(0,d.jsx)("p",{className:"mt-4 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:'Configure a printer for barcode labels from the inventory section. "Image" format is recommended for standard printers.'})]}),(0,d.jsx)("div",{className:"flex justify-end pt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-xl transition-shadow shadow-clay-light dark:shadow-clay-dark active:shadow-clay-light-inset dark:active:shadow-clay-dark-inset",children:"Save Hardware Settings"})})]})};let tI=e=>{let{label:t,name:r,value:a,onChange:s,placeholder:o}=e;return(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:r,className:"block text-sm font-medium text-foreground dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("input",{type:"text",name:r,id:r,value:a,onChange:s,placeholder:o,className:"mt-1 block w-full px-3 py-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})},tA=e=>{let{id:t,name:r,checked:a,onChange:s}=e;return(0,d.jsxs)("label",{htmlFor:t,className:"inline-flex relative items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",name:r,checked:a,onChange:s,id:t,className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-muted dark:bg-dark-muted rounded-full peer peer-checked:bg-primary transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"})]})};var tM=e=>{var t,r,a,s,l,i,c,m,u,x;let{settings:h,onUpdateSettings:p,showToast:b}=e,[g,f]=(0,o.useState)({enabled:null!==(i=null===(t=h.paymentMethods)||void 0===t?void 0:t.enabled)&&void 0!==i&&i,displayOnDocuments:null!==(c=null===(r=h.paymentMethods)||void 0===r?void 0:r.displayOnDocuments)&&void 0!==c?c:[],bank:null!==(m=null===(a=h.paymentMethods)||void 0===a?void 0:a.bank)&&void 0!==m?m:[],mpesaPaybill:null!==(u=null===(s=h.paymentMethods)||void 0===s?void 0:s.mpesaPaybill)&&void 0!==u?u:{paybillNumber:"",accountNumber:""},mpesaTill:null!==(x=null===(l=h.paymentMethods)||void 0===l?void 0:l.mpesaTill)&&void 0!==x?x:{tillNumber:""}}),k=e=>{let{value:t,checked:r}=e.target;f(e=>{let a=e.displayOnDocuments;return r?{...e,displayOnDocuments:[...a,t]}:{...e,displayOnDocuments:a.filter(e=>e!==t)}})},y=(e,t,r)=>{f(a=>({...a,bank:a.bank.map(a=>a.id===e?{...a,[t]:r}:a)}))},j=e=>{f(t=>({...t,bank:t.bank.filter(t=>t.id!==e)}))},v=(e,t)=>{let{name:r,value:a}=e.target;f(e=>({...e,[t]:{...e[t],[r]:a}}))};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),p({paymentMethods:g}),b("Payment methods saved successfully!","success")},className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-clay-light dark:shadow-clay-dark flex justify-between items-center",children:[(0,d.jsx)("span",{className:"text-sm font-medium text-foreground dark:text-dark-foreground",children:"Display Payment Methods on Documents"}),(0,d.jsx)(tA,{id:"payment-methods-toggle",name:"enabled",checked:g.enabled,onChange:e=>{f(t=>({...t,enabled:e.target.checked}))}})]}),(0,d.jsx)(n.M,{children:g.enabled&&(0,d.jsxs)("div",{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-6 overflow-hidden",children:[(0,d.jsxs)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-xl",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground mb-2",children:"Display On:"}),(0,d.jsx)("div",{className:"flex flex-wrap gap-4",children:["Receipt","Quotation","Proforma-Invoice"].map(e=>(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",value:e,checked:g.displayOnDocuments.includes(e),onChange:k,className:"focus:ring-primary h-4 w-4 text-primary border-border rounded"}),(0,d.jsx)("span",{className:"ml-2 text-sm text-foreground dark:text-dark-foreground",children:e.replace("-"," ")})]},e))})]}),(0,d.jsxs)("div",{className:"pt-4 border-t dark:border-dark-border",children:[(0,d.jsx)("h4",{className:"font-semibold text-foreground dark:text-dark-foreground mb-2",children:"M-Pesa Details"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"p-4 border dark:border-dark-border rounded-lg space-y-2",children:[(0,d.jsx)("p",{className:"font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Paybill"}),(0,d.jsx)(tI,{label:"Paybill Number",name:"paybillNumber",value:g.mpesaPaybill.paybillNumber,onChange:e=>v(e,"mpesaPaybill")}),(0,d.jsx)(tI,{label:"Account Number / Instructions",name:"accountNumber",value:g.mpesaPaybill.accountNumber,onChange:e=>v(e,"mpesaPaybill"),placeholder:"e.g. Your Name"})]}),(0,d.jsxs)("div",{className:"p-4 border dark:border-dark-border rounded-lg space-y-2",children:[(0,d.jsx)("p",{className:"font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Buy Goods (Till)"}),(0,d.jsx)(tI,{label:"Till Number",name:"tillNumber",value:g.mpesaTill.tillNumber,onChange:e=>v(e,"mpesaTill")})]})]})]}),(0,d.jsxs)("div",{className:"pt-4 border-t dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:"Your Business Bank Accounts"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mb-4",children:"Add and manage the bank accounts your business uses. These will be available when recording bank deposits."}),(0,d.jsx)("div",{className:"space-y-4",children:g.bank.map((e,t)=>(0,d.jsxs)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-lg border dark:border-dark-border relative",children:[(0,d.jsx)("button",{type:"button",onClick:()=>j(e.id),className:"absolute top-2 right-2 text-danger/50 hover:text-danger",children:"\xd7"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(tI,{label:"Bank Name",name:"bankName-".concat(t),value:e.bankName,onChange:t=>y(e.id,"bankName",t.target.value)}),(0,d.jsx)(tI,{label:"Account Name",name:"accountName-".concat(t),value:e.accountName,onChange:t=>y(e.id,"accountName",t.target.value)}),(0,d.jsx)(tI,{label:"Account Number",name:"accountNumber-".concat(t),value:e.accountNumber,onChange:t=>y(e.id,"accountNumber",t.target.value)}),(0,d.jsx)(tI,{label:"Branch",name:"branch-".concat(t),value:e.branch,onChange:t=>y(e.id,"branch",t.target.value)})]})]},e.id))}),(0,d.jsx)("button",{type:"button",onClick:()=>{f(e=>({...e,bank:[...e.bank,{id:crypto.randomUUID(),bankName:"",accountName:"",accountNumber:"",branch:""}]}))},whileTap:{scale:.95},className:"mt-4 bg-card dark:bg-dark-card border border-border dark:border-dark-border text-foreground dark:text-dark-foreground font-semibold px-4 py-2 rounded-lg hover:bg-muted dark:hover:bg-dark-muted transition-colors text-sm",children:"Add Bank Account"})]})]})}),(0,d.jsx)("div",{className:"flex justify-end pt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:"Save Payment Settings"})})]})},tF=e=>{var t,r;let{settings:a,onUpdateSettings:s}=e,[n,l]=(0,o.useState)(null!==(r=null===(t=a.inventory)||void 0===t?void 0:t.lowStockThreshold)&&void 0!==r?r:3);return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s({inventory:{...a.inventory,lowStockThreshold:Number(n)}})},className:"space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"lowStockThreshold",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Low Stock Threshold"}),(0,d.jsx)("input",{type:"number",name:"lowStockThreshold",id:"lowStockThreshold",value:n,onChange:e=>l(Number(e.target.value)),min:"0",className:"mt-1 block w-full max-w-xs px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"}),(0,d.jsx)("p",{className:"mt-2 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:'Products with stock quantity less than this number will be flagged as "Low Stock".'})]}),(0,d.jsx)("div",{className:"flex justify-end pt-6 border-t border-border dark:border-dark-border mt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-md",children:"Save Inventory Settings"})})]})},tL=e=>{let{onBackup:t,onRestoreRequest:r,onFactoryResetRequest:a,onClose:s,isDriveInitializing:n,isDriveReady:l,isDriveAuthenticated:i,driveUser:c,onDriveSignIn:m,onDriveSignOut:u,onDriveBackup:x,onDriveRestore:h,isDriveConfigured:p}=e,b=(0,o.useRef)(null);return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("input",{type:"file",ref:b,onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(r(a),s()),e.target&&(e.target.value="")},accept:".json,application/json",className:"hidden"}),(0,d.jsxs)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-lg border border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground mb-2",children:"Local Backup"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mb-4",children:"Export all application data to a JSON file on your computer. Keep this file in a safe place."}),(0,d.jsxs)("div",{className:"flex gap-4",children:[(0,d.jsxs)("button",{onClick:()=>{t(),s()},whileTap:{scale:.95},className:"flex-1 bg-primary text-primary-content font-semibold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center justify-center",children:[(0,d.jsx)("div",{className:"w-5 h-5 mr-2",children:N.data}),"Export All Data (JSON)"]}),(0,d.jsxs)("button",{onClick:()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.click()},whileTap:{scale:.95},className:"flex-1 bg-card text-foreground dark:bg-dark-card dark:text-dark-foreground font-semibold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center justify-center",children:[(0,d.jsx)("div",{className:"w-5 h-5 mr-2",children:N.data}),"Import from Backup (JSON)"]})]})]}),(0,d.jsxs)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-lg border border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground mb-2",children:"Cloud Backup (Google Drive)"}),i&&c?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3 p-2 bg-card dark:bg-dark-card rounded-lg",children:[(0,d.jsx)("img",{src:c.picture,alt:"User",className:"w-10 h-10 rounded-full"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-semibold text-foreground dark:text-dark-foreground",children:c.name}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:c.email})]})]}),(0,d.jsxs)("div",{className:"flex gap-4",children:[(0,d.jsx)("button",{onClick:x,whileTap:{scale:.95},className:"flex-1 bg-blue-600 text-white font-semibold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center justify-center",children:"Backup to Drive"}),(0,d.jsx)("button",{onClick:h,whileTap:{scale:.95},className:"flex-1 bg-blue-600 text-white font-semibold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center justify-center",children:"Restore from Drive"})]}),(0,d.jsx)("button",{onClick:u,className:"w-full text-center text-xs text-foreground-muted dark:text-dark-foreground-muted hover:underline mt-2",children:"Disconnect Google Account"})]}):(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mb-4",children:"Securely back up and restore your data using your Google Drive account."}),p?(0,d.jsxs)("button",{onClick:m,disabled:n||!l,whileTap:{scale:.95},className:"w-full bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground font-semibold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,d.jsxs)("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 48 48",children:[(0,d.jsx)("path",{fill:"#4285F4",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),(0,d.jsx)("path",{fill:"#34A853",d:"M46.98 24.55c0-1.57-.15-3.09-.42-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),(0,d.jsx)("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),(0,d.jsx)("path",{fill:"#EA4335",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"}),(0,d.jsx)("path",{fill:"none",d:"M0 0h48v48H0z"})]}),n?"Initializing...":"Connect to Google Drive"]}):(0,d.jsxs)("div",{className:"text-center p-3 bg-warning/10 border border-warning/20 rounded-lg text-sm text-warning dark:text-dark-warning",children:[(0,d.jsx)("p",{className:"font-bold",children:"Feature Not Configured"}),(0,d.jsx)("p",{children:"Google Drive integration is disabled because API keys are not provided in the application configuration."})]})]})]}),(0,d.jsxs)("div",{className:"p-4 bg-danger/10 border border-danger/20 rounded-lg",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-danger mb-2",children:"Factory Reset"}),(0,d.jsx)("p",{className:"text-sm text-danger/80 mb-4",children:"Permanently delete all data in this application, including sales, inventory, and settings. This action cannot be undone."}),(0,d.jsxs)("button",{onClick:()=>{a(),s()},whileTap:{scale:.95},className:"w-full bg-danger text-white font-semibold px-4 py-2 rounded-xl transition-shadow shadow-clay-dark active:shadow-clay-dark-inset flex items-center justify-center",children:[(0,d.jsx)("div",{className:"w-5 h-5 mr-2",children:N.reset}),"Initiate Factory Reset"]})]})]})},tO=e=>{let{settings:t,onUpdateSettings:r}=e,[a,s]=(0,o.useState)(t.layaway||{minDepositPercentage:20,maxDurationDays:90}),n=e=>{let{name:t,value:r}=e.target;s(e=>({...e,[t]:Number(r)}))};return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({layaway:a})},className:"space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"minDepositPercentage",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Minimum Deposit Percentage (%)"}),(0,d.jsx)("input",{type:"number",name:"minDepositPercentage",id:"minDepositPercentage",value:a.minDepositPercentage,onChange:n,min:"0",max:"100",className:"mt-1 block w-full max-w-xs px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"}),(0,d.jsx)("p",{className:"mt-2 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"The minimum percentage of the total value required as a deposit to start a layaway plan."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"maxDurationDays",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Maximum Layaway Duration (Days)"}),(0,d.jsx)("input",{type:"number",name:"maxDurationDays",id:"maxDurationDays",value:a.maxDurationDays,onChange:n,min:"1",className:"mt-1 block w-full max-w-xs px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"}),(0,d.jsx)("p",{className:"mt-2 text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"The default and maximum period a customer has to complete their payments."})]}),(0,d.jsx)("div",{className:"flex justify-end pt-6 border-t border-border dark:border-dark-border mt-6",children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:"Save Layaway Settings"})})]})},tR=e=>{let{title:t,message:r,onConfirm:a,onClose:s,confirmText:n="Confirm",isDestructive:l=!1,requiresConfirmationText:i=!1}=e,[c,m]=(0,o.useState)(""),u=!i||c===n;return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:s,children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:400,damping:30},className:"bg-card dark:bg-dark-card rounded-2xl shadow-2xl w-full max-w-md p-6 border border-border dark:border-dark-border",onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("h3",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:t}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mt-2 whitespace-pre-line",children:r}),i&&(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsxs)("label",{htmlFor:"confirm-input",className:"block text-sm font-medium text-foreground dark:text-dark-foreground mb-1",children:['To confirm, type "',(0,d.jsx)("span",{className:"font-bold",children:n}),'" in the box below.']}),(0,d.jsx)("input",{id:"confirm-input",type:"text",value:c,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-lg shadow-sm",autoFocus:!0})]}),(0,d.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,d.jsx)("button",{onClick:s,whileTap:{scale:.95},className:"px-4 py-2 text-sm font-bold bg-muted text-foreground hover:bg-border dark:bg-dark-muted dark:text-dark-foreground dark:hover:bg-dark-border transition-colors rounded-lg",children:"Cancel"}),(0,d.jsx)("button",{onClick:a,disabled:!u,whileTap:{scale:.95},className:"px-4 py-2 text-sm font-bold rounded-lg transition-colors disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:cursor-not-allowed ".concat(l?"bg-danger text-white hover:bg-red-700":"bg-primary text-primary-content hover:bg-primary-focus"),children:n})]})]})})};let tB=e=>{let{onClose:t,onSave:r,categoryToEdit:a,allCategories:s}=e,[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)("#FF5722"),[x,h]=(0,o.useState)("root");return o.useEffect(()=>{if(a){let e=a.path.split(" > "),t=e.pop()||"",r=e.join(" > ");l(t),c(a.description),u(a.color),h(r||"root")}},[a]),(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:t,children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-6",onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("h2",{className:"text-xl font-bold mb-4",children:a?"Edit Category":"Add New Category"}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n.trim()&&r({name:n,description:i,color:m,parentPath:x},a||void 0)},className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground-muted",children:"Category Name"}),(0,d.jsx)("input",{type:"text",value:n,onChange:e=>l(e.target.value),required:!0,autoFocus:!0,className:"w-full mt-1 p-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground-muted",children:"Description"}),(0,d.jsx)("textarea",{value:i,onChange:e=>c(e.target.value),rows:3,className:"w-full mt-1 p-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground-muted",children:"Color"}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,d.jsx)("input",{type:"color",value:m,onChange:e=>u(e.target.value),className:"p-0 h-10 w-10 block bg-white dark:bg-dark-card border-none cursor-pointer rounded-md"}),(0,d.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),className:"w-full p-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground-muted",children:"Parent Category"}),(0,d.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"w-full mt-1 p-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md",children:[(0,d.jsx)("option",{value:"root",children:"-- No Parent (Root) --"}),s.filter(e=>e.path!==(null==a?void 0:a.path)&&!e.path.startsWith("".concat(null==a?void 0:a.path," > "))).sort((e,t)=>e.path.localeCompare(t.path)).map(e=>(0,d.jsx)("option",{value:e.path,children:e.path},e.path))]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,d.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 bg-muted dark:bg-dark-muted rounded-md font-semibold",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",className:"px-4 py-2 bg-primary text-primary-content rounded-md font-semibold",children:a?"Save Changes":"Create Category"})]})]})]})})},t_=e=>{var t;let{settings:r,onUpdateSettings:a,showToast:s}=e,[l,i]=(0,o.useState)(!1),[c,m]=(0,o.useState)(null),[u,x]=(0,o.useState)(null),[h,p]=(0,o.useState)(""),b=(0,o.useMemo)(()=>{var e;return((null===(e=r.inventory)||void 0===e?void 0:e.definedCategories)||[]).sort((e,t)=>e.path.localeCompare(t.path))},[null===(t=r.inventory)||void 0===t?void 0:t.definedCategories]),g=(0,o.useMemo)(()=>b.filter(e=>e.path.toLowerCase().includes(h.toLowerCase())),[b,h]),f=e=>{m(e),i(!0)};return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)(n.M,{children:[l&&(0,d.jsx)(tB,{onClose:()=>i(!1),onSave:(e,t)=>{var d;let o="root"===e.parentPath?e.name:"".concat(e.parentPath," > ").concat(e.name),n=(null===(d=r.inventory)||void 0===d?void 0:d.definedCategories)||[];if(t){let d=t.path;if(d!==o&&n.some(e=>e.path===o)){s("A category with this name and parent already exists.","error");return}let l=n.map(t=>t.path===d?{path:o,description:e.description,color:e.color}:t.path.startsWith("".concat(d," > "))?{...t,path:t.path.replace("".concat(d," > "),"".concat(o," > "))}:t);a({inventory:{...r.inventory,definedCategories:l}}),s("Category updated!","success")}else{if(n.some(e=>e.path===o)){s("A category with this name and parent already exists.","error");return}let t=[...n,{path:o,description:e.description,color:e.color}];a({inventory:{...r.inventory,definedCategories:t}}),s("Category added!","success")}i(!1)},categoryToEdit:c,allCategories:b}),u&&(0,d.jsx)(tR,{title:"Delete Category?",message:'Are you sure you want to delete "'.concat(u.path,'"? This will also delete all its sub-categories.'),onConfirm:()=>{var e;if(!u)return;let t=((null===(e=r.inventory)||void 0===e?void 0:e.definedCategories)||[]).filter(e=>e.path!==u.path&&!e.path.startsWith("".concat(u.path," > ")));a({inventory:{...r.inventory,definedCategories:t}}),x(null),s("Category and its sub-categories deleted.","success")},onClose:()=>x(null),confirmText:"Delete",isDestructive:!0})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsxs)("div",{className:"relative flex-grow max-w-sm",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-foreground/40 dark:text-dark-foreground/40 absolute top-1/2 left-3 -translate-y-1/2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,d.jsx)("input",{type:"text",placeholder:"Search categories...",value:h,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,d.jsx)("button",{onClick:()=>{m(null),i(!0)},whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-4 py-2 rounded-lg",children:"Add New Category"})]}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-6 py-3",children:"Category Name"}),(0,d.jsx)("th",{className:"px-6 py-3",children:"Description"}),(0,d.jsx)("th",{className:"px-6 py-3",children:"Color"}),(0,d.jsx)("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),(0,d.jsxs)("tbody",{children:[g.map(e=>(0,d.jsxs)("tr",{className:"border-b dark:border-dark-border last:border-0",children:[(0,d.jsxs)("td",{className:"px-6 py-3 font-semibold text-foreground dark:text-dark-foreground flex items-center",children:[(0,d.jsx)("span",{className:"w-4 h-4 rounded-full mr-3 flex-shrink-0",style:{backgroundColor:e.color}}),e.path]}),(0,d.jsx)("td",{className:"px-6 py-3 text-foreground-muted dark:text-dark-foreground-muted",children:e.description||"-"}),(0,d.jsx)("td",{className:"px-6 py-3 font-mono text-xs",children:e.color}),(0,d.jsxs)("td",{className:"px-6 py-3 text-right space-x-4",children:[(0,d.jsx)("button",{onClick:()=>f(e),className:"font-medium text-primary dark:text-dark-primary hover:underline",children:"Edit"}),(0,d.jsx)("button",{onClick:()=>x(e),className:"font-medium text-danger hover:underline",children:"Delete"})]})]},e.path)),0===g.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:4,className:"text-center py-10 text-foreground-muted dark:text-dark-foreground-muted",children:"No categories found."})})]})]})})]})},tE=e=>{let{title:t,onClose:r,children:a}=e;return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:r,children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:400,damping:40},className:"bg-background dark:bg-dark-background rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-border dark:border-dark-border bg-secondary dark:bg-dark-card text-primary-content dark:text-dark-foreground rounded-t-xl flex-shrink-0",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:t}),(0,d.jsx)("button",{onClick:r,className:"hover:opacity-75",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsx)("div",{className:"p-6 overflow-y-auto",children:a})]})})},tq=e=>{let{title:t,description:r,icon:a,onClick:s}=e;return(0,d.jsxs)("div",{onClick:s,className:"bg-card dark:bg-dark-card p-6 rounded-2xl shadow-sm hover:shadow-lg border border-border dark:border-dark-border cursor-pointer flex flex-col justify-between h-full",whileHover:{y:-6,scale:1.02},transition:{type:"spring",stiffness:300,damping:20},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"bg-muted text-primary dark:bg-dark-muted dark:text-dark-primary w-12 h-12 rounded-lg flex items-center justify-center mb-4",children:a}),(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:t}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mt-1 flex-grow",children:r})]}),(0,d.jsx)("div",{className:"text-right mt-4 text-sm font-bold text-primary dark:text-dark-primary",children:"Manage →"})]})};var tV=e=>{let[t,r]=(0,o.useState)(null);(0,o.useEffect)(()=>{e.openModalId&&r(e.openModalId)},[e.openModalId]),(0,o.useEffect)(()=>{e.onInitDrive&&e.onInitDrive()},[e.onInitDrive]);let a=()=>{r(null),e.onModalOpened&&e.onModalOpened()},s=t=>{e.onUpdateSettings(t),a(),e.showToast("Settings saved!","success")},l={"business-info":{title:"Business Information",description:"Set your company name, KRA PIN, logo, and location.",icon:N.business,component:(0,d.jsx)(tg,{settings:e.settings,onUpdateSettings:s,showToast:e.showToast})},"hardware-settings":{title:"Hardware & Peripherals",description:"Configure receipt printers, barcode scanners, and other hardware.",icon:N.hardware,component:(0,d.jsx)(tT,{settings:e.settings,onUpdateSettings:s,showToast:e.showToast,onTestBarcodePrint:e.onTestBarcodePrint})},"receipt-settings":{title:"Receipt & Invoice",description:"Customize receipt footers and document numbering.",icon:N.receipt,component:(0,d.jsx)(ty,{settings:e.settings,onUpdateSettings:s})},"tax-config":{title:"VAT & Tax",description:"Configure VAT rates and default product pricing.",icon:N.tax,component:(0,d.jsx)(tf,{settings:e.settings,onUpdateSettings:s})},"discount-settings":{title:"Discounts",description:"Enable and set limits for POS transaction discounts.",icon:N.discount,component:(0,d.jsx)(tS,{settings:e.settings,onUpdateSettings:s})},"loyalty-settings":{title:"Loyalty Program",description:"Manage how customers earn and redeem loyalty points.",icon:N.loyalty,component:(0,d.jsx)(tw,{settings:e.settings,onUpdateSettings:s})},"layaway-settings":{title:"Layaway Program",description:"Set minimum deposit percentages and maximum payment durations.",icon:N.layaway,component:(0,d.jsx)(tO,{settings:e.settings,onUpdateSettings:s})},"payment-methods":{title:"Payment Methods Display",description:"Configure bank accounts, M-Pesa details, etc., to display on your invoices and quotes.",icon:N.mpesa,component:(0,d.jsx)(tM,{settings:e.settings,onUpdateSettings:s,showToast:e.showToast})},"inventory-settings":{title:"Inventory Settings",description:"Manage stock alerts and other inventory settings.",icon:N.inventory,component:(0,d.jsx)(tF,{settings:e.settings,onUpdateSettings:s})},"category-settings":{title:"Product Categories & Units",description:"Add, edit, and organize product categories and measurement units.",icon:N.categories,component:(0,d.jsx)(t_,{settings:e.settings,onUpdateSettings:e.onUpdateSettings,showToast:e.showToast})},"users-perms":{title:"Users & Permissions",description:"Manage access rights and permissions for each staff role.",icon:N.users,component:(0,d.jsx)(tk,{settings:e.settings,onUpdateSettings:e.onUpdateSettings})},"audit-log":{title:"Audit Log",description:"View a log of all important actions taken in the system.",icon:N.audit,component:(0,d.jsx)(tj,{auditLogs:e.auditLogs,users:e.users,onDriveBackupAuditLogs:e.onDriveBackupAuditLogs,isDriveAuthenticated:e.isDriveAuthenticated})},"data-management":{title:"Data Management",description:"Backup, restore, or reset all application data.",icon:N.data,component:(0,d.jsx)(tL,{onBackup:e.onBackup,onRestoreRequest:e.onRestoreRequest,onFactoryResetRequest:e.onFactoryResetRequest,onClose:a,isDriveInitializing:e.isDriveInitializing,isDriveReady:e.isDriveReady,isDriveAuthenticated:e.isDriveAuthenticated,driveUser:e.driveUser,onDriveSignIn:e.onDriveSignIn,onDriveSignOut:e.onDriveSignOut,onDriveBackup:e.onDriveBackup,onDriveRestore:e.onDriveRestore,isDriveConfigured:e.isDriveConfigured})}};return(0,d.jsxs)("div",{className:"p-4 md:p-8",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground mb-6",children:"Settings"}),(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Object.entries(l).map(e=>{let[t,a]=e;return(0,d.jsx)(tq,{title:a.title,description:a.description,icon:a.icon,onClick:()=>r(t)},t)})}),(0,d.jsx)(n.M,{children:t&&l[t]&&(0,d.jsx)(tE,{title:l[t].title,onClose:a,children:l[t].component})})]})};let tH={success:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),error:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),info:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})};var tU=e=>{let{message:t,type:r}=e;return(0,d.jsxs)("div",{layout:!0,initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},transition:{type:"spring",stiffness:500,damping:30},className:"fixed top-5 right-5 z-[100] flex items-center w-full max-w-xs p-4 text-foreground dark:text-dark-foreground bg-card/80 dark:bg-dark-card/80 backdrop-blur-lg rounded-xl shadow-lg border border-border/50 dark:border-dark-border/50",role:"alert",children:[(0,d.jsx)("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8 rounded-lg",children:tH[r]}),(0,d.jsx)("div",{className:"ml-3 text-sm font-semibold",children:t})]})},tW=e=>{let{customer:t,settings:r,onUpdateCustomer:a}=e,[s,n]=(0,o.useState)(t.measurements||{}),[l,i]=(0,o.useState)(""),[c,m]=(0,o.useState)(""),[u,x]=(0,o.useState)(!1),h=e=>{if(!e)return;let t=r.measurements.templates.find(t=>t.name===e);if(t){let e=t.fields.reduce((e,t)=>(s.hasOwnProperty(t)||(e[t]=""),e),{});n({...s,...e}),x(!0)}},p=(e,t)=>{n(r=>({...r,[e]:t})),x(!0)},b=e=>{let{[e]:t,...r}=s;n(r),x(!0)};return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-sm border border-border dark:border-dark-border space-y-4",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h3",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:"Customer Measurements"}),u&&(0,d.jsx)("button",{onClick:()=>{a({...t,measurements:s}),x(!1)},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-md",whileTap:{scale:.95},children:"Save Changes"})]}),(0,d.jsx)("div",{className:"flex gap-2",children:(0,d.jsxs)("select",{onChange:e=>h(e.target.value),className:"flex-grow block w-full pl-3 pr-10 py-2 text-base border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm rounded-md",children:[(0,d.jsx)("option",{value:"",children:"-- Apply a Template --"}),r.measurements.templates.map(e=>(0,d.jsx)("option",{value:e.name,children:e.name},e.name))]})}),(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.keys(s).sort().map(e=>(0,d.jsxs)("div",{className:"relative group",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:e}),(0,d.jsx)("input",{type:"text",value:s[e],onChange:t=>p(e,t.target.value),placeholder:"Enter ".concat(e,"..."),className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"}),(0,d.jsx)("button",{onClick:()=>b(e),className:"absolute top-0 right-0 p-1 text-danger-400 hover:text-danger opacity-0 group-hover:opacity-100 transition-opacity",children:"\xd7"})]},e))}),(0,d.jsxs)("div",{className:"pt-4 border-t border-border dark:border-dark-border space-y-2",children:[(0,d.jsx)("h4",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground",children:"Add Custom Field"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[(0,d.jsx)("input",{value:l,onChange:e=>i(e.target.value),placeholder:"Field Name (e.g., Shoulder)",className:"md:col-span-1 px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm"}),(0,d.jsx)("input",{value:c,onChange:e=>m(e.target.value),placeholder:"Value (e.g., 18 in)",className:"md:col-span-1 px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm"}),(0,d.jsx)("button",{onClick:()=>{l&&!s.hasOwnProperty(l)&&(n(e=>({...e,[l]:c})),i(""),m(""),x(!0))},whileTap:{scale:.95},className:"bg-foreground/80 text-white font-semibold py-2 rounded-lg text-sm hover:bg-foreground transition-colors dark:bg-dark-border dark:hover:bg-dark-border/80",children:"Add Field"})]})]})]})};let tZ=e=>{let{title:t,value:r}=e;return(0,d.jsxs)("div",{className:"bg-muted dark:bg-dark-muted p-4 rounded-lg text-center",children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-bold",children:t}),(0,d.jsx)("p",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:r})]})},tz=e=>{let{label:t,isActive:r,onClick:a}=e;return(0,d.jsxs)("button",{onClick:a,className:"px-4 py-2 text-sm font-bold rounded-t-md relative transition-colors ".concat(r?"text-primary dark:text-dark-primary":"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground"),children:[t,r&&(0,d.jsx)("div",{layoutId:"customer-tab-underline",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary dark:bg-dark-primary"})]})};var tK=e=>{let{customer:t,sales:r,onBack:a,settings:s,onUpdateCustomer:n}=e,[l,i]=(0,o.useState)("history"),c=(0,o.useMemo)(()=>{let e=r.reduce((e,t)=>e+t.total,0),t=r.length;return{totalSpent:e,totalOrders:t,avgOrderValue:t>0?e/t:0}},[r]),m=e=>"Ksh ".concat(e.toFixed(2));return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsx)("div",{className:"mb-6",children:(0,d.jsxs)("button",{onClick:a,className:"flex items-center text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to All Customers"]})}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-sm border border-border dark:border-dark-border mb-8",children:(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:t.name}),(0,d.jsxs)("div",{className:"mt-2 space-y-1 text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Phone:"})," ",t.phone]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Email:"})," ",t.email]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Address:"})," ",t.address,", ",t.city]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Customer Since:"})," ",new Date(t.dateAdded).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mt-4 md:mt-0 w-full md:w-auto",children:[(0,d.jsx)(tZ,{title:"Total Spent",value:m(c.totalSpent)}),(0,d.jsx)(tZ,{title:"Total Orders",value:c.totalOrders}),(0,d.jsx)(tZ,{title:"Avg. Order",value:m(c.avgOrderValue)}),(0,d.jsxs)("div",{className:"bg-indigo-100 dark:bg-indigo-900/50 p-4 rounded-lg text-center",children:[(0,d.jsx)("p",{className:"text-sm text-indigo-500 dark:text-indigo-400 font-bold",children:"Loyalty Points"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-indigo-800 dark:text-indigo-300",children:t.loyaltyPoints})]})]})]})}),(0,d.jsxs)("div",{className:"flex space-x-2 border-b border-border dark:border-dark-border mb-4",children:[(0,d.jsx)(tz,{label:"Purchase History",isActive:"history"===l,onClick:()=>i("history")}),s.measurements.enabled&&(0,d.jsx)(tz,{label:"Measurements",isActive:"measurements"===l,onClick:()=>i("measurements")})]}),(0,d.jsx)("div",{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:"history"===l?(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-bold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Receipt ID"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Items"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Total (Ksh)"})]})}),(0,d.jsxs)("tbody",{children:[r.map(e=>(0,d.jsxs)("tr",{className:"border-b dark:border-dark-border hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsx)("td",{className:"px-6 py-4 font-semibold text-foreground dark:text-dark-foreground",children:new Date(e.date).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono text-xs",children:e.id}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("ul",{className:"list-disc list-inside",children:e.items.map(e=>(0,d.jsxs)("li",{children:[e.name," (x",e.quantity,")"]},e.id))})}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono text-right font-bold",children:e.total.toFixed(2)})]},e.id)),0===r.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:4,className:"text-center py-8 text-foreground-muted dark:text-dark-foreground-muted",children:"No purchase history found for this customer."})})]})]})}):(0,d.jsx)(tW,{customer:t,settings:s,onUpdateCustomer:n})},l)]})},tG=e=>{let{onClose:t,onSave:r,customer:a}=e,[s,n]=(0,o.useState)({name:"",phone:"",email:"",address:"",city:""});(0,o.useEffect)(()=>{a&&n({name:a.name,phone:a.phone,email:a.email,address:a.address,city:a.city})},[a]);let l=e=>{let{name:t,value:r}=e.target;n(e=>({...e,[t]:r}))};return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-8",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:a?"Edit Customer":"Add New Customer"}),(0,d.jsx)("button",{onClick:t,className:"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a?r({...a,...s}):r(s)},className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Full Name"}),(0,d.jsx)("input",{type:"text",name:"name",id:"name",value:s.name,onChange:l,required:!0,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Phone Number"}),(0,d.jsx)("input",{type:"tel",name:"phone",id:"phone",value:s.phone,onChange:l,required:!0,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Email Address"}),(0,d.jsx)("input",{type:"email",name:"email",id:"email",value:s.email,onChange:l,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Address"}),(0,d.jsx)("input",{type:"text",name:"address",id:"address",value:s.address,onChange:l,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"City"}),(0,d.jsx)("input",{type:"text",name:"city",id:"city",value:s.city,onChange:l,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),(0,d.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:t,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold px-4 py-2 rounded-lg hover:bg-border dark:hover:bg-dark-border transition-colors",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-md",children:"Save Customer"})]})]})]})})},tQ=e=>{let{customers:t,sales:r,onAddCustomer:a,onUpdateCustomer:s,onDeleteCustomer:l,permissions:i,settings:c}=e,[m,u]=(0,o.useState)(null),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)(!1),[g,f]=(0,o.useState)(void 0),[k,y]=(0,o.useState)(null),j=i.includes("manage_customers"),v=(0,o.useMemo)(()=>t.map(e=>{let t=r.filter(t=>t.customerId===e.id),a=t.reduce((e,t)=>e+t.total,0),s=t.length>0?new Date(Math.max(...t.map(e=>new Date(e.date).getTime()))):null;return{...e,totalSpent:a,lastPurchase:s}}).filter(e=>e.name.toLowerCase().includes(x.toLowerCase())||e.phone.toLowerCase().includes(x.toLowerCase())||e.email.toLowerCase().includes(x.toLowerCase())),[t,r,x]),w=e=>{f(e),b(!0)};if(m){let e=v.find(e=>e.id===m.id);return(0,d.jsx)(tK,{customer:e||m,sales:r.filter(e=>e.customerId===m.id),onBack:()=>u(null),settings:c,onUpdateCustomer:s})}return(0,d.jsxs)("div",{className:"p-4 md:p-8",children:[(0,d.jsxs)(n.M,{children:[p&&(0,d.jsx)(tG,{onClose:()=>b(!1),onSave:e=>{"id"in e?s(e):a(e),b(!1)},customer:g}),k&&(0,d.jsx)(tR,{title:"Delete ".concat(k.name,"?"),message:"Are you sure? This will remove the customer and all associated history. This action cannot be undone.",onConfirm:()=>{k&&(l(k.id),y(null))},onClose:()=>y(null),confirmText:"Delete",isDestructive:!0})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-4xl font-bold text-foreground dark:text-dark-foreground",children:"Customer Management"}),(0,d.jsx)("div",{className:"flex items-center space-x-2",children:j&&(0,d.jsxs)("button",{onClick:()=>w(),whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})}),"Add Customer"]})})]}),(0,d.jsx)("div",{className:"mb-4",children:(0,d.jsx)("input",{type:"text",placeholder:"Search customers by name, phone, or email...",className:"w-full max-w-sm px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary",value:x,onChange:e=>h(e.target.value)})}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm overflow-x-auto",children:[(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-bold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Name"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Contact"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Loyalty Points"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Total Spent (Ksh)"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Last Purchase"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsx)("tbody",{children:v.map(e=>(0,d.jsxs)("tr",{className:"border-b dark:border-dark-border hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>u(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-semibold text-foreground dark:text-dark-foreground",children:e.name}),(0,d.jsxs)("td",{className:"px-6 py-4",children:[(0,d.jsx)("div",{children:e.phone}),(0,d.jsx)("div",{className:"text-xs",children:e.email})]}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono font-semibold text-indigo-600 dark:text-indigo-400",children:e.loyaltyPoints}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono",children:e.totalSpent.toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.lastPurchase?new Date(e.lastPurchase).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"}):"N/A"}),(0,d.jsx)("td",{className:"px-6 py-4 text-right",onClick:e=>e.stopPropagation(),children:j&&"cust001"!==e.id&&(0,d.jsxs)("div",{className:"space-x-4",children:[(0,d.jsx)("button",{onClick:()=>w(e),className:"font-medium text-primary hover:underline",children:"Edit"}),(0,d.jsx)("button",{onClick:()=>y(e),className:"font-medium text-danger hover:underline",children:"Delete"})]})})]},e.id))})]}),0===v.length&&(0,d.jsxs)("div",{className:"text-center py-10",children:[(0,d.jsx)("p",{className:"font-semibold",children:"No customers found."}),(0,d.jsx)("p",{className:"text-sm",children:"Add a new customer to get started."})]})]})]})},tY=e=>{let{onClose:t,onSave:r,supplier:a}=e,[s,n]=(0,o.useState)({name:"",businessName:"",contact:"",email:"",creditTerms:"Net 30"});(0,o.useEffect)(()=>{a&&n({name:a.name,businessName:a.businessName||"",contact:a.contact,email:a.email,creditTerms:a.creditTerms})},[a]);let l=e=>{let{name:t,value:r}=e.target;n(e=>({...e,[t]:r}))},i=async e=>{e.preventDefault(),await r(s)},c="mt-1 block w-full px-4 py-2 bg-white border-0 rounded-lg text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",m="block text-sm font-medium text-slate-300";return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:t,children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-slate-800 rounded-2xl shadow-lg w-full max-w-lg p-6",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-white",children:a?"Edit Supplier":"Add New Supplier"}),(0,d.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-white",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("form",{onSubmit:i,className:"space-y-5",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"businessName",className:m,children:"Business Name"}),(0,d.jsx)("input",{type:"text",name:"businessName",id:"businessName",value:s.businessName,onChange:l,required:!0,autoFocus:!0,className:c})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"name",className:m,children:"Contact Person Name"}),(0,d.jsx)("input",{type:"text",name:"name",id:"name",value:s.name,onChange:l,required:!0,className:c})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"contact",className:m,children:"Contact Phone"}),(0,d.jsx)("input",{type:"tel",name:"contact",id:"contact",value:s.contact,onChange:l,required:!0,className:c})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"email",className:m,children:"Contact Email"}),(0,d.jsx)("input",{type:"email",name:"email",id:"email",value:s.email,onChange:l,className:c})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"creditTerms",className:m,children:"Credit Terms"}),(0,d.jsxs)("select",{name:"creditTerms",id:"creditTerms",value:s.creditTerms,onChange:l,className:c,children:[(0,d.jsx)("option",{children:"On Delivery"}),(0,d.jsx)("option",{children:"Net 15"}),(0,d.jsx)("option",{children:"Net 30"}),(0,d.jsx)("option",{children:"Net 45"}),(0,d.jsx)("option",{children:"Net 60"})]})]}),(0,d.jsxs)("div",{className:"pt-4 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:t,whileTap:{scale:.95},className:"bg-slate-600 hover:bg-slate-700 text-white font-bold px-5 py-2 rounded-lg transition-colors",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-orange-500 hover:bg-orange-600 text-white font-bold px-5 py-2 rounded-lg transition-colors",children:"Save Supplier"})]})]})]})})};let tX=o.forwardRef((e,t)=>{let{supplier:r,invoices:a,payments:s,settings:n,purchaseOrders:l}=e,i=o.useMemo(()=>[...a.map(e=>({date:new Date(e.invoiceDate),description:"Invoice #".concat(e.invoiceNumber),debit:e.totalAmount,credit:0})),...s.map(e=>({date:new Date(e.paymentDate),description:"Payment via ".concat(e.method),debit:0,credit:e.amount}))].sort((e,t)=>e.date.getTime()-t.date.getTime()),[a,s]),c=0,m=a.reduce((e,t)=>e+t.totalAmount,0),u=s.reduce((e,t)=>e+t.amount,0);return(0,d.jsxs)("div",{ref:t,className:"bg-white p-8 font-sans text-sm text-black w-full max-w-4xl mx-auto shadow-lg border",children:[(0,d.jsxs)("header",{className:"flex justify-between items-start pb-4 border-b",children:[(0,d.jsxs)("div",{children:[n.businessInfo.logoUrl&&(0,d.jsx)("img",{src:n.businessInfo.logoUrl,alt:"Company Logo",className:"h-16 max-w-xs object-contain mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:n.businessInfo.name}),(0,d.jsx)("p",{className:"text-slate-600",children:n.businessInfo.location}),(0,d.jsxs)("p",{className:"text-slate-600",children:["Tel: ",n.businessInfo.phone]})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold uppercase text-slate-700 tracking-wide",children:"Supplier Statement"}),(0,d.jsxs)("p",{className:"text-xs mt-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Date Issued:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date().toLocaleDateString("en-GB")})]})]})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Statement For"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:r.businessName||r.name}),(0,d.jsx)("p",{className:"text-slate-600",children:r.contact}),(0,d.jsx)("p",{className:"text-slate-600",children:r.email})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Purchase Orders"}),(0,d.jsxs)("table",{className:"w-full text-left",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-slate-100 text-slate-600 uppercase text-xs",children:[(0,d.jsx)("th",{className:"p-3 font-semibold",children:"PO #"}),(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Date"}),(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Status"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Total"})]})}),(0,d.jsx)("tbody",{children:l.length>0?l.map(e=>(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-3 font-semibold",children:e.poNumber}),(0,d.jsx)("td",{className:"p-3",children:new Date(e.createdDate).toLocaleDateString("en-GB")}),(0,d.jsx)("td",{className:"p-3",children:e.status}),(0,d.jsx)("td",{className:"p-3 text-right font-mono",children:e.totalCost.toFixed(2)})]},e.id)):(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:4,className:"p-3 text-center text-slate-500",children:"No purchase orders found."})})})]})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Financial Statement"}),(0,d.jsxs)("table",{className:"w-full text-left",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-slate-100 text-slate-600 uppercase text-xs",children:[(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Date"}),(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Transaction Details"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Debit (Invoiced)"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Credit (Paid)"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Balance"})]})}),(0,d.jsx)("tbody",{children:i.map((e,t)=>(c+=e.debit-e.credit,(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-3",children:e.date.toLocaleDateString("en-GB")}),(0,d.jsx)("td",{className:"p-3",children:e.description}),(0,d.jsx)("td",{className:"p-3 text-right font-mono",children:e.debit>0?e.debit.toFixed(2):"-"}),(0,d.jsx)("td",{className:"p-3 text-right font-mono text-green-600",children:e.credit>0?e.credit.toFixed(2):"-"}),(0,d.jsx)("td",{className:"p-3 text-right font-mono font-semibold",children:c.toFixed(2)})]},t)))})]})]}),(0,d.jsx)("section",{className:"flex justify-end mt-8",children:(0,d.jsxs)("div",{className:"w-full max-w-sm space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Total Invoiced:"})," ",(0,d.jsx)("span",{className:"font-mono text-slate-800",children:m.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Total Paid:"})," ",(0,d.jsx)("span",{className:"font-mono text-green-600",children:u.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2 mt-2",children:[(0,d.jsx)("span",{className:"text-slate-800",children:"Balance Due:"}),(0,d.jsxs)("span",{className:"font-mono text-red-600",children:["Ksh ",(m-u).toFixed(2)]})]})]})}),(0,d.jsx)("footer",{className:"mt-16 pt-4 border-t text-xs text-slate-500 text-center",children:(0,d.jsx)("p",{children:"This is a computer-generated statement and does not require a signature."})})]})}),tJ=e=>Promise.all(Array.from(e.getElementsByTagName("img")).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>t(),e.onerror=()=>{console.warn("Could not load image for PDF generation: ".concat(e.src)),t()})})));var t$=e=>{let{supplier:t,purchaseOrders:r,supplierInvoices:a,supplierPayments:s,settings:n,onBack:l}=e,i=(0,o.useRef)(null),[c,m]=(0,o.useState)(!1),u=async()=>{if(i.current&&!c){m(!0);try{await tJ(i.current);let e=await eD()(i.current,{scale:2,useCORS:!0}),r=e.toDataURL("image/png"),a=new eC.ZP("p","mm","a4"),s=a.internal.pageSize.getWidth(),d=e.height*s/e.width;a.addImage(r,"PNG",0,0,s,d),a.save("Statement_".concat(t.name.replace(/\s/g,"_"),".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF. The logo might be causing an issue.")}finally{m(!1)}}};return(0,d.jsx)("div",{className:"h-full overflow-y-auto bg-background dark:bg-dark-background",children:(0,d.jsxs)("div",{className:"p-4 md:p-8 space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center no-print",children:[(0,d.jsxs)("button",{onClick:l,className:"flex items-center text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to Suppliers"]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("button",{onClick:()=>{window.print()},whileTap:{scale:.95},className:"bg-foreground/80 dark:bg-dark-border text-white font-bold px-3 py-2 rounded-lg hover:bg-foreground dark:hover:bg-dark-border/80 transition-colors shadow-sm flex items-center text-sm",children:"Print"}),(0,d.jsx)("button",{onClick:u,whileTap:{scale:.95},disabled:c,className:"bg-primary text-primary-content font-bold px-3 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-sm flex items-center text-sm disabled:bg-slate-400",children:c?"Downloading...":"Download PDF"})]})]}),(0,d.jsx)("div",{id:"pdf-content-wrapper",children:(0,d.jsx)(tX,{ref:i,supplier:t,purchaseOrders:r,invoices:a,payments:s,settings:n})})]})})};let t0=e=>{let{title:t,value:r}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border",children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground mt-1",children:r})]})};var t2=e=>{let{suppliers:t,purchaseOrders:r,supplierInvoices:a,supplierPayments:s,onAddSupplier:l,onUpdateSupplier:i,onDeleteSupplier:c,permissions:m,settings:u}=e,[x,h]=(0,o.useState)(!1),[p,b]=(0,o.useState)(void 0),[g,f]=(0,o.useState)(null),[k,y]=(0,o.useState)(""),[j,v]=(0,o.useState)(null),[w]=S(),N=m.includes("manage_suppliers"),C=e=>{b(e),h(!0)},D=async e=>{"id"in e?await i(e):await l(e),h(!1)},P=async()=>{g&&(await c(g.id),f(null))},T=(0,o.useMemo)(()=>t.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||e.businessName&&e.businessName.toLowerCase().includes(k.toLowerCase())||e.contact.toLowerCase().includes(k.toLowerCase())),[t,k]),{totalOwed:I,topSuppliersData:A}=(0,o.useMemo)(()=>{let e={};return t.forEach(t=>{e[t.id]={name:t.businessName||t.name,value:0}}),a.forEach(t=>{e[t.supplierId]&&"Paid"!==t.status&&(e[t.supplierId].value+=t.totalAmount-t.paidAmount)}),{totalOwed:Object.values(e).reduce((e,t)=>e+t.value,0),topSuppliersData:Object.values(e).filter(e=>e.value>0).sort((e,t)=>t.value-e.value).slice(0,5)}},[a,t]),M="dark"===w?["#34d399","#60a5fa","#fde047","#c4b5fd","#fca5a5"]:["#10b981","#3b82f6","#facc15","#a78bfa","#f87171"];return j?(0,d.jsx)(t$,{supplier:j,purchaseOrders:r.filter(e=>e.supplierId===j.id),supplierInvoices:a.filter(e=>e.supplierId===j.id),supplierPayments:s.filter(e=>a.some(t=>t.id===e.invoiceId&&t.supplierId===j.id)),settings:u,onBack:()=>v(null)}):(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsxs)(n.M,{children:[x&&(0,d.jsx)(tY,{onClose:()=>h(!1),onSave:D,supplier:p}),g&&(0,d.jsx)(tR,{title:"Delete ".concat(g.name,"?"),message:"Are you sure you want to permanently delete this supplier? This action cannot be undone.",confirmText:"Delete",onConfirm:P,onClose:()=>f(null),isDestructive:!0})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Suppliers"}),N&&(0,d.jsx)("button",{onClick:()=>C(),whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center",children:"Add Supplier"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[(0,d.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,d.jsx)(t0,{title:"Total Suppliers",value:String(t.length)}),(0,d.jsx)(t0,{title:"Total Amount Owed",value:"Ksh ".concat(I.toFixed(2))})]}),(0,d.jsxs)("div",{className:"lg:col-span-2 bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground mb-2",children:"Top 5 Suppliers by Amount Owed"}),A.length>0?(0,d.jsx)(eE.h,{width:"100%",height:200,children:(0,d.jsxs)(eK.u,{children:[(0,d.jsx)(eG.b,{data:A,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,children:A.map((e,t)=>(0,d.jsx)(eQ.b,{fill:M[t%M.length]},"cell-".concat(t)))}),(0,d.jsx)(eW.u,{formatter:e=>"Ksh ".concat(Number(e).toFixed(2))}),(0,d.jsx)(eZ.D,{})]})}):(0,d.jsx)("div",{className:"flex items-center justify-center h-full text-foreground-muted dark:text-dark-foreground-muted",children:"No outstanding balances."})]})]}),(0,d.jsx)("div",{className:"mb-4",children:(0,d.jsx)("input",{type:"text",placeholder:"Search by name, business, or contact...",className:"w-full max-w-sm px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary",value:k,onChange:e=>y(e.target.value)})}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 font-bold",children:"Business Name"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 font-bold",children:"Contact Person"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 font-bold",children:"Phone"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 font-bold",children:"Amount Owed"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsx)("tbody",{children:T.map(e=>{var t;let r=(null===(t=A.find(t=>t.name===(e.businessName||e.name)))||void 0===t?void 0:t.value)||0;return(0,d.jsxs)("tr",{className:"border-b dark:border-dark-border hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsx)("td",{className:"px-6 py-4 font-semibold text-foreground dark:text-dark-foreground",children:e.businessName||e.name}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.name}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.contact}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono font-semibold ".concat(r>0?"text-danger":""),children:r.toFixed(2)}),(0,d.jsxs)("td",{className:"px-6 py-4 text-right space-x-4",children:[(0,d.jsx)("button",{onClick:()=>v(e),className:"font-medium text-secondary hover:underline",children:"View Statement"}),N&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:()=>C(e),className:"font-medium text-primary hover:underline",children:"Edit"}),(0,d.jsx)("button",{onClick:()=>f(e),className:"font-medium text-danger hover:underline",children:"Delete"})]})]})]},e.id)})})]})})]})};let t1=e=>{let{status:t}=e,r="px-2 py-1 text-xs font-semibold rounded-full";switch(t){case"Paid":return(0,d.jsx)("span",{className:"".concat(r," text-purple-800 bg-purple-100 dark:bg-purple-900/50 dark:text-purple-300"),children:"Paid"});case"Sent":return(0,d.jsx)("span",{className:"".concat(r," text-blue-800 bg-blue-100 dark:bg-blue-900/50 dark:text-blue-300"),children:"Sent"});case"Draft":return(0,d.jsx)("span",{className:"".concat(r," text-yellow-800 bg-yellow-100 dark:bg-yellow-900/50 dark:text-yellow-300"),children:"Draft"});case"Invoiced":return(0,d.jsx)("span",{className:"".concat(r," text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300"),children:"Invoiced"});case"Expired":return(0,d.jsx)("span",{className:"".concat(r," text-red-800 bg-red-100 dark:bg-red-900/50 dark:text-red-300"),children:"Expired"});default:return(0,d.jsx)("span",{className:"".concat(r," text-slate-800 bg-slate-100 dark:bg-slate-700 dark:text-slate-300"),children:"Unknown"})}};var t4=e=>{let{quotations:t,sales:r,onSelectQuotation:a,onCreateQuoteRequest:s,permissions:n}=e,[l,i]=(0,o.useState)(""),c=n.includes("manage_quotations"),m=(0,o.useMemo)(()=>{let e=new Map;return r.forEach(t=>{t.quotationId&&e.set(t.quotationId,t)}),e},[r]),u=(0,o.useMemo)(()=>t.filter(e=>e.quoteNumber.toLowerCase().includes(l.toLowerCase())||e.customerName.toLowerCase().includes(l.toLowerCase())),[t,l]);return(0,d.jsxs)("div",{className:"p-4 md:p-8",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Quotations"}),c&&(0,d.jsxs)("button",{onClick:s,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create New Quote"]})]}),(0,d.jsx)("div",{className:"mb-4",children:(0,d.jsx)("input",{type:"text",placeholder:"Search quotations by number or customer...",className:"w-full max-w-sm px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary",value:l,onChange:e=>i(e.target.value)})}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-bold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Quote #"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Customer"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Status"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Expires"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Total (Ksh)"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Actions"})]})}),(0,d.jsx)("tbody",{children:0===u.length?(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:7,className:"text-center py-10",children:"No quotations found."})}):u.map(e=>{let t=m.has(e.id)?"Paid":e.status;return(0,d.jsxs)("tr",{className:"bg-card dark:bg-dark-card border-b dark:border-dark-border hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>a(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-bold text-foreground dark:text-dark-foreground",children:e.quoteNumber}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.customerName}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)(t1,{status:t})}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.createdDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.expiryDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono",children:e.total.toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right",children:(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),a(e)},className:"font-medium text-primary dark:text-dark-primary hover:underline",children:"View"})})]},e.id)})})]})})]})},t3=e=>{let{onClose:t,onSave:r,user:a}=e,[s,n]=(0,o.useState)({name:"",username:"",role:"Cashier",pin:""}),[l,i]=(0,o.useState)(""),[c,m]=(0,o.useState)(""),[u,x]=(0,o.useState)(""),h=!!a,p=h&&!!(null==a?void 0:a.email);(0,o.useEffect)(()=>{a&&n({name:a.name,username:a.username,role:a.role,pin:a.pin||""})},[a]);let b=e=>{let{name:t,value:r}=e.target;"pin"===t&&r.length>4||n(e=>({...e,[t]:r}))},g="block text-sm font-medium text-foreground dark:text-dark-foreground-muted",f="mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm disabled:bg-muted dark:disabled:bg-dark-muted";return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-8 border border-border dark:border-dark-border",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:h?"Edit Staff Member":"Add New Staff"}),(0,d.jsx)("button",{onClick:t,className:"text-foreground-muted hover:text-foreground dark:text-dark-foreground-muted dark:hover:text-dark-foreground",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),p&&(0,d.jsx)("div",{className:"p-4 mb-4 bg-primary-soft border border-primary/20 text-primary rounded-lg text-sm dark:bg-dark-primary-soft dark:border-dark-primary/30 dark:text-dark-primary",children:"The primary business account holder's details cannot be modified from this screen. For changes, please contact support."}),(0,d.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),x(""),l!==c){x("Passcodes do not match.");return}if(!h&&!l){x("Passcode is required for new users.");return}if(l&&l.length<6){x("Passcode must be at least 6 characters long.");return}if(s.pin&&4!==s.pin.length){x("PIN must be exactly 4 digits.");return}if(!s.username.trim()){x("Username is required.");return}let t={...s};l&&(t.password=l),h&&a?r({...a,...t}):r(t)},className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"name",className:g,children:"Full Name"}),(0,d.jsx)("input",{type:"text",name:"name",id:"name",value:s.name,onChange:b,required:!0,autoFocus:!0,disabled:p,className:f})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"username",className:g,children:"Username"}),(0,d.jsx)("input",{type:"text",name:"username",id:"username",value:s.username,onChange:b,required:!0,disabled:p,className:f})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"role",className:g,children:"Role"}),(0,d.jsxs)("select",{name:"role",id:"role",value:s.role,onChange:b,disabled:p,className:f,children:[(0,d.jsx)("option",{children:"Cashier"}),(0,d.jsx)("option",{children:"Supervisor"}),(0,d.jsx)("option",{children:"Accountant"}),(0,d.jsx)("option",{children:"Admin"})]})]})]}),(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"pin",className:g,children:"4-Digit PIN Code (for screen lock)"}),(0,d.jsx)("input",{type:"text",inputMode:"numeric",pattern:"\\d{4}",name:"pin",id:"pin",value:s.pin,onChange:b,disabled:p,className:f,maxLength:4})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"password",className:g,children:"Passcode"}),(0,d.jsx)("input",{id:"password",type:"password",required:!h,value:l,onChange:e=>i(e.target.value),disabled:p,className:f,placeholder:h?"Leave blank to keep same":""})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"confirmPassword",className:g,children:"Confirm Passcode"}),(0,d.jsx)("input",{id:"confirmPassword",type:"password",required:!h||l.length>0,value:c,onChange:e=>m(e.target.value),disabled:p,className:f})]})]}),u&&(0,d.jsx)("p",{className:"text-sm text-danger text-center",children:u}),(0,d.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:t,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",disabled:p,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:shadow-none",children:"Save Staff Member"})]})]})]})})},t5=e=>{let{user:t,onClose:r,onSave:a}=e,[s,n]=(0,o.useState)(""),[l,i]=(0,o.useState)(""),[c,m]=(0,o.useState)("");return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-md p-6",children:[(0,d.jsxs)("h2",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:["Reset Passcode for ",(0,d.jsx)("span",{className:"text-primary dark:text-dark-primary",children:t.name})]}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Enter a new passcode for the user. They will be required to use this new passcode to log in."}),(0,d.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),m(""),s.length<6){m("New passcode must be at least 6 characters long.");return}if(s!==l){m("Passcodes do not match.");return}a(t.id,s)},className:"mt-4 space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"new-passcode",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"New Passcode"}),(0,d.jsx)("input",{type:"password",id:"new-passcode",value:s,onChange:e=>n(e.target.value),required:!0,autoFocus:!0,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"confirm-passcode",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Confirm New Passcode"}),(0,d.jsx)("input",{type:"password",id:"confirm-passcode",value:l,onChange:e=>i(e.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm"})]}),c&&(0,d.jsx)("p",{className:"text-sm text-danger",children:c}),(0,d.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:r,whileTap:{scale:.95},className:"px-4 py-2 text-sm font-bold bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground rounded-md hover:bg-border dark:hover:bg-dark-border",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"px-4 py-2 text-sm font-bold text-white bg-primary rounded-md hover:bg-primary-focus",children:"Save New Passcode"})]})]})]})})};let t6=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})}),t9=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H5v-2H3v-2h2v-2h2v-2h2l2.05-2.05A6 6 0 0121 11z"})}),t8=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),t7=e=>{let{title:t,value:r,icon:a}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm flex items-center space-x-4",children:[(0,d.jsx)("div",{className:"p-3 rounded-lg bg-muted dark:bg-dark-muted text-primary dark:text-dark-primary",children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:r})]})]})};var re=e=>{let{users:t,permissions:r,onAddUser:a,onUpdateUser:s,onDeleteUser:l,onManagePermissionsRequest:i}=e,[c,m]=(0,o.useState)(!1),[u,x]=(0,o.useState)(void 0),[h,p]=(0,o.useState)(null),[b,g]=(0,o.useState)(null),f=r.includes("manage_staff"),k=(0,o.useMemo)(()=>new Set(t.map(e=>e.role)).size,[t]),y=e=>{x(e),m(!0)};return(0,d.jsxs)("div",{className:"p-4 md:p-6 bg-muted dark:bg-dark-muted min-h-full",children:[(0,d.jsxs)(n.M,{children:[c&&(0,d.jsx)(t3,{onClose:()=>m(!1),onSave:e=>{"id"in e?s(e):a(e),m(!1)},user:u}),h&&(0,d.jsx)(tR,{title:"Delete User ".concat(h.name,"?"),message:"Are you sure you want to permanently delete this user? This action cannot be undone.",confirmText:"Delete",onConfirm:()=>{h&&(l(h.id),p(null))},onClose:()=>p(null),isDestructive:!0}),b&&(0,d.jsx)(t5,{user:b,onClose:()=>g(null),onSave:(e,r)=>{let a=t.find(t=>t.id===e);a&&s({...a,password:r}),g(null)}})]}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Staff Management"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"Add, edit, and manage staff members and their roles."})]}),f&&(0,d.jsxs)("div",{className:"flex items-center space-x-2 mt-4 md:mt-0",children:[(0,d.jsx)("button",{onClick:i,whileTap:{scale:.95},className:"bg-card text-foreground dark:bg-dark-card dark:text-dark-foreground font-bold px-4 py-2 rounded-lg border border-border dark:border-dark-border hover:bg-border dark:hover:bg-dark-border transition-colors shadow-sm",children:"Manage Roles"}),(0,d.jsx)("button",{onClick:()=>y(),whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-sm flex items-center",children:"+ Add New Staff"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,d.jsx)(t7,{title:"Total Staff",value:t.length,icon:N.users}),(0,d.jsx)(t7,{title:"Active Roles",value:k,icon:N.staff})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-lg shadow-sm",children:[(0,d.jsx)("div",{className:"p-4 border-b border-border dark:border-dark-border",children:(0,d.jsx)("h2",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground",children:"Staff List"})}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Staff Member"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Login ID"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Role"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Actions"})]})}),(0,d.jsx)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:t.map(e=>{let t=!!e.email;return(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsxs)("td",{className:"px-6 py-4 font-semibold text-foreground dark:text-dark-foreground flex items-center gap-2",children:[e.name,t&&(0,d.jsx)("span",{title:"Primary Business Account Holder",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-amber-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 1 1 0 000-2z",clipRule:"evenodd"})})})]}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono text-xs",children:e.email||e.username}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("span",{className:"px-2.5 py-1 text-xs font-semibold text-white bg-gray-800 rounded-full",children:e.role})}),(0,d.jsx)("td",{className:"px-6 py-4 text-right",children:f&&!t?(0,d.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,d.jsx)("button",{onClick:()=>y(e),className:"p-1.5 rounded-md text-blue-500 hover:bg-blue-100 dark:hover:bg-blue-900/50",title:"Edit User",children:(0,d.jsx)(t6,{})}),(0,d.jsx)("button",{onClick:()=>g(e),className:"p-1.5 rounded-md text-amber-500 hover:bg-amber-100 dark:hover:bg-amber-900/50",title:"Reset Passcode",children:(0,d.jsx)(t9,{})}),(0,d.jsx)("button",{onClick:()=>p(e),className:"p-1.5 rounded-md text-danger hover:bg-danger/10",title:"Delete User",children:(0,d.jsx)(t8,{})})]}):(0,d.jsx)("span",{className:"text-xs font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:"Locked"})})]},e.id)})})]})})]})]})},rt=e=>{let{purchaseOrder:t,supplier:r,products:a,onConfirm:s,onClose:n}=e,[l,i]=(0,o.useState)([]),c=(0,o.useMemo)(()=>[...new Set(a.map(e=>e.category).filter(Boolean))].sort(),[a]);(0,o.useEffect)(()=>{i((t.items||[]).map(e=>{let t=a.find(t=>t.id===e.productId),r=e.quantityReceived||0,s=e.quantity-r;return{productId:e.productId,productName:e.productName,quantityOrdered:e.quantity,quantityPreviouslyReceived:r,quantityReceivingNow:Math.max(0,s),cost:e.cost,category:(null==t?void 0:t.category)||"",upc:(null==t?void 0:t.upc)||"",unitOfMeasure:e.unitOfMeasure,salesOrderItemId:e.salesOrderItemId}}))},[t,a]);let m=(e,t,r,a)=>{i(s=>s.map(s=>{if(s[e?"productId":"productName"]===(e||t)){if("quantityReceivingNow"===r){let e=s.quantityOrdered-s.quantityPreviouslyReceived,t=Math.max(0,Math.min(Number(a),e));return{...s,[r]:t}}return{...s,[r]:a}}return s}))},u=(0,o.useMemo)(()=>l.reduce((e,t)=>e+t.cost*t.quantityReceivingNow,0),[l]);return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col",children:[(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-6 border-b border-slate-200 dark:border-slate-700",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:"Receive Purchase Order"}),(0,d.jsx)("button",{onClick:n,className:"text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-100",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("div",{className:"p-6 overflow-y-auto",children:[(0,d.jsxs)("p",{className:"text-slate-500 dark:text-slate-400 mb-6",children:["Confirm quantities and details for items received from ",(0,d.jsx)("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:null==r?void 0:r.name})," for PO ",(0,d.jsx)("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:t.poNumber}),"."]}),(0,d.jsxs)("div",{className:"space-y-4",children:[l.map((e,t)=>{let r=a.find(t=>t.id===e.productId),s=r?r.stock:0,o=s+e.quantityReceivingNow;return(0,d.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-end bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg",children:[(0,d.jsxs)("div",{className:"col-span-12 md:col-span-4",children:[(0,d.jsx)("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400",children:"Product"}),(0,d.jsx)("p",{className:"font-semibold text-slate-800 dark:text-slate-100",children:e.productName})]}),(0,d.jsxs)("div",{className:"col-span-4 md:col-span-1 text-center md:text-left",children:[(0,d.jsx)("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400",children:"Ordered"}),(0,d.jsx)("p",{className:"text-slate-800 dark:text-slate-100 font-mono",children:e.quantityOrdered})]}),(0,d.jsxs)("div",{className:"col-span-4 md:col-span-1 text-center md:text-left",children:[(0,d.jsx)("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400",children:"Received"}),(0,d.jsx)("p",{className:"text-slate-800 dark:text-slate-100 font-mono",children:e.quantityPreviouslyReceived})]}),(0,d.jsxs)("div",{className:"col-span-4 md:col-span-2",children:[(0,d.jsx)("label",{htmlFor:"qty-".concat(t),className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Receiving Now"}),(0,d.jsx)("input",{id:"qty-".concat(t),type:"number",value:e.quantityReceivingNow,onChange:t=>m(e.productId,e.productName,"quantityReceivingNow",parseInt(t.target.value)||0),max:e.quantityOrdered-e.quantityPreviouslyReceived,min:"0",className:"mt-1 block w-full px-2 py-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm"}),r&&"Inventory"===r.productType&&(0,d.jsxs)("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Stock: ",s," → ",(0,d.jsx)("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:o})]})]}),(0,d.jsxs)("div",{className:"col-span-6 md:col-span-2",children:[(0,d.jsx)("label",{htmlFor:"cat-".concat(t),className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Category"}),(0,d.jsx)("input",{type:"text",id:"cat-".concat(t),list:"categories-list",value:e.category,onChange:t=>m(e.productId,e.productName,"category",t.target.value),className:"mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm"})]}),(0,d.jsxs)("div",{className:"col-span-6 md:col-span-2",children:[(0,d.jsx)("label",{htmlFor:"upc-".concat(t),className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"UPC / Barcode"}),(0,d.jsx)("input",{id:"upc-".concat(t),type:"text",value:e.upc,onChange:t=>m(e.productId,e.productName,"upc",t.target.value),className:"mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm"})]})]},e.productId||e.productName)}),(0,d.jsx)("datalist",{id:"categories-list",children:c.map(e=>(0,d.jsx)("option",{value:e},e))})]})]}),(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-6 border-t border-slate-200 dark:border-slate-700 mt-auto",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:"New Invoice Total (for this batch)"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:"Ksh ".concat(u.toFixed(2))})]}),(0,d.jsxs)("div",{className:"flex space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:n,whileTap:{scale:.95},className:"bg-slate-100 text-slate-700 font-semibold px-4 py-2 rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition-colors",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{s(l.filter(e=>{let t=a.find(t=>t.id===e.productId);return e.quantityReceivingNow>0||t&&(e.category!==t.category||e.upc!==t.upc)}).map(e=>({productId:e.productId,productName:e.productName,quantity:e.quantityOrdered,cost:e.cost,unitOfMeasure:e.unitOfMeasure,quantityReceived:e.quantityReceivingNow,category:e.category,upc:e.upc,salesOrderItemId:e.salesOrderItemId})))},whileTap:{scale:.98},className:"bg-emerald-600 text-white font-bold py-2 px-6 rounded-lg text-lg hover:bg-emerald-700 transition-colors shadow-lg",children:"Confirm & Receive"})]})]})]})})},rr=e=>{var t,r;let{product:a,purchaseOrders:s,suppliers:n,onConfirm:l,onClose:i}=e,[c,m]=(0,o.useState)(1),[u,x]=(0,o.useState)("new"),[h,p]=(0,o.useState)((null===(t=n[0])||void 0===t?void 0:t.id)||""),b=(0,o.useMemo)(()=>s.filter(e=>"Draft"===e.status||"Sent"===e.status),[s]),g=(0,o.useMemo)(()=>!(c<=0)&&("new"!==u||!!h),[c,u,h]);return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-8",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Add to Purchase Order"}),(0,d.jsx)("button",{onClick:i,className:"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("div",{className:"bg-muted dark:bg-dark-muted p-4 rounded-lg mb-6",children:[(0,d.jsx)("p",{className:"font-bold text-lg text-foreground dark:text-dark-foreground",children:a.name}),(0,d.jsxs)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:["Current Stock: ",(0,d.jsx)("span",{className:"font-semibold text-danger",children:a.stock})]}),(0,d.jsxs)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:["Unit Cost: ",(0,d.jsxs)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:["Ksh ",(null===(r=a.costPrice)||void 0===r?void 0:r.toFixed(2))||"0.00"]})]})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"quantity",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Order Quantity"}),(0,d.jsx)("input",{type:"number",id:"quantity",value:c,onChange:e=>m(parseInt(e.target.value)||1),min:"1",className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-lg"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"po-select",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Purchase Order"}),(0,d.jsxs)("select",{id:"po-select",value:u,onChange:e=>x(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm rounded-md",children:[(0,d.jsx)("option",{value:"new",children:"-- Create New PO --"}),b.map(e=>{var t;return(0,d.jsxs)("option",{value:e.id,children:[e.poNumber," (",null===(t=n.find(t=>t.id===e.supplierId))||void 0===t?void 0:t.name,") - ",e.status]},e.id)})]})]}),"new"===u&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"supplier-select",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Supplier"}),(0,d.jsxs)("select",{id:"supplier-select",value:h,onChange:e=>p(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm rounded-md",children:[(0,d.jsx)("option",{value:"",disabled:!0,children:"-- Select a Supplier --"}),n.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,d.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:i,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-semibold px-4 py-2 rounded-lg hover:bg-border dark:hover:bg-dark-border transition-colors",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{g&&l(a,c,u,"new"===u?h:void 0)},disabled:!g,whileTap:{scale:.98},className:"bg-primary text-primary-content font-bold py-2 px-6 rounded-lg text-lg hover:bg-primary-focus transition-colors shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed",children:"Confirm"})]})]})})},ra=e=>{let{product:t,onClose:r}=e,[a,s]=(0,o.useState)(t.upc?"upc":"inventoryCode"),[n,l]=(0,o.useState)(null),[i,c]=(0,o.useState)(12),[m,u]=(0,o.useState)(40),[x,h]=(0,o.useState)(30),[p,b]=(0,o.useState)(2),[g,f]=(0,o.useState)(8),k=(0,o.useMemo)(()=>"upc"===a&&t.upc?t.upc:t.inventoryCode,[a,t]);return(0,o.useEffect)(()=>{if(l(null),k)try{ek()(".barcode-svg",k,{format:"upc"===a&&t.upc?"UPCA":"CODE128",displayValue:!0,fontSize:14,margin:2,height:30,width:1.5,valid:e=>{e||l("The provided ".concat(a.toUpperCase()," is not valid for this barcode type."))}})}catch(e){console.error("Barcode generation failed:",e),l(e.message||"Failed to generate ".concat(a.toUpperCase()," barcode."))}else l("No ".concat("upc"===a?"UPC":"Inventory Code"," code available for this product."))},[k,a,i,p,m,x,t.upc]),(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-6 border-b border-border dark:border-dark-border",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Print Barcode Labels"}),(0,d.jsx)("button",{onClick:r,className:"text-foreground-muted hover:text-foreground dark:text-dark-foreground-muted dark:hover:text-dark-foreground",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("div",{className:"flex-grow flex flex-col md:flex-row overflow-hidden",children:[(0,d.jsxs)("div",{className:"w-full md:w-80 flex-shrink-0 p-6 space-y-4 border-r border-border dark:border-dark-border overflow-y-auto",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground",children:"Print Settings"}),t.upc&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Barcode Type"}),(0,d.jsxs)("div",{className:"mt-1 flex justify-center bg-muted dark:bg-dark-muted p-1 rounded-lg",children:[(0,d.jsx)("button",{onClick:()=>s("inventoryCode"),className:"px-4 py-1.5 rounded-md text-sm font-bold transition-colors w-1/2 ".concat("inventoryCode"===a?"bg-card dark:bg-dark-card shadow text-primary dark:text-dark-primary":"text-foreground-muted dark:text-dark-foreground-muted"),children:"Inv. Code"}),(0,d.jsx)("button",{onClick:()=>s("upc"),className:"px-4 py-1.5 rounded-md text-sm font-bold transition-colors w-1/2 ".concat("upc"===a?"bg-card dark:bg-dark-card shadow text-primary dark:text-dark-primary":"text-foreground-muted dark:text-dark-foreground-muted"),children:"UPC"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"quantity",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Quantity to Print"}),(0,d.jsx)("input",{id:"quantity",type:"number",value:i,onChange:e=>c(Number(e.target.value)),min:"1",className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"columns",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Columns per Row"}),(0,d.jsx)("input",{id:"columns",type:"number",value:p,onChange:e=>b(Number(e.target.value)),min:"1",className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"labelWidth",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Label Width (mm)"}),(0,d.jsx)("input",{id:"labelWidth",type:"number",value:m,onChange:e=>u(Number(e.target.value)),className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"labelHeight",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Label Height (mm)"}),(0,d.jsx)("input",{id:"labelHeight",type:"number",value:x,onChange:e=>h(Number(e.target.value)),className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"fontSize",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Font Size (pt)"}),(0,d.jsx)("input",{id:"fontSize",type:"number",value:g,onChange:e=>f(Number(e.target.value)),className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md"})]})]}),(0,d.jsx)("div",{className:"flex-grow p-4 overflow-auto bg-background dark:bg-dark-background",children:n?(0,d.jsx)("div",{className:"h-full flex items-center justify-center text-danger font-semibold text-sm p-4 text-center",children:n}):(0,d.jsx)("div",{id:"barcode-to-print",style:{display:"grid",gridTemplateColumns:"repeat(".concat(p,", 1fr)"),gap:"1mm",justifyItems:"center"},children:Array.from({length:i}).map((e,r)=>(0,d.jsxs)("div",{style:{width:"".concat(m,"mm"),height:"".concat(x,"mm"),padding:"1mm",border:"1px dashed #ccc",boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pageBreakInside:"avoid",backgroundColor:"white",overflow:"hidden"},children:[(0,d.jsx)("p",{className:"text-black font-bold text-center",style:{fontSize:"".concat(g,"pt"),lineHeight:1.1,margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%"},children:t.name}),(0,d.jsxs)("p",{className:"text-black font-semibold text-center",style:{fontSize:"".concat(g-1,"pt"),lineHeight:1.1,margin:0},children:["Ksh ",t.price.toFixed(2)]}),(0,d.jsx)("svg",{className:"barcode-svg",style:{maxWidth:"100%",height:"auto"}})]},r))})})]}),(0,d.jsxs)("div",{className:"flex-shrink-0 mt-auto flex justify-end space-x-3 p-6 border-t border-border dark:border-dark-border",children:[(0,d.jsx)("button",{type:"button",onClick:r,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold px-4 py-2 rounded-lg hover:bg-border dark:hover:bg-dark-border transition-colors",children:"Cancel"}),(0,d.jsxs)("button",{onClick:()=>{window.print()},disabled:!!n,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-md flex items-center disabled:bg-slate-400 disabled:cursor-not-allowed",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h1v-4a1 1 0 011-1h10a1 1 0 011 1v4h1a2 2 0 002-2v-6a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z",clipRule:"evenodd"})}),"Print Labels"]})]})]})})},rs=e=>{var t;let{customers:r,products:a,settings:s,onSave:l,onCancel:i}=e,[c,m]=(0,o.useState)((null===(t=r.find(e=>"cust001"!==e.id))||void 0===t?void 0:t.id)||""),[u,x]=(0,o.useState)([]),[h,p]=(0,o.useState)(""),[b,g]=(0,o.useState)(null),f=(0,o.useMemo)(()=>h?a.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())).slice(0,5):[],[h,a]),k=(0,o.useMemo)(()=>{let e=new Map;for(let t of(a.forEach(t=>{let r=t.category||"Uncategorized";e.has(r)||e.set(r,[]),e.get(r).push(t)}),e.keys()))e.get(t).sort((e,t)=>e.name.localeCompare(t.name));return Array.from(e.entries()).sort((e,t)=>e[0].localeCompare(t[0]))},[a]),{subtotal:y,tax:j,total:v,discountAmount:w}=(0,o.useMemo)(()=>{let{subtotal:e,tax:t,total:r,totalDiscountAmount:a}=K(u,{type:"percentage",value:0},s.tax.vatRate/100);return{subtotal:e,tax:t,total:r,discountAmount:a}},[u,s.tax.vatRate]),N=e=>{x(t=>t.find(t=>t.productId===e.id)?t.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1}:t):[...t,{productId:e.id,productName:e.name,quantity:1,price:e.price,pricingType:e.pricingType}]),p("")},C=(e,t)=>{t<=0?x(t=>t.filter(t=>t.productId!==e)):x(r=>r.map(r=>r.productId===e?{...r,quantity:t}:r))},S=e=>{if(!r.find(e=>e.id===c)||0===u.length){alert("Please select a customer and add at least one item.");return}l({customerId:c,items:u,status:e},e)};return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto bg-background dark:bg-dark-background",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Create Quotation"}),(0,d.jsxs)("div",{className:"flex space-x-3",children:[(0,d.jsx)("button",{onClick:i,whileTap:{scale:.95},className:"bg-muted text-foreground dark:bg-dark-muted dark:text-dark-foreground font-semibold px-4 py-2 rounded-lg hover:bg-border dark:hover:bg-dark-border",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>S("Draft"),whileTap:{scale:.95},className:"bg-foreground/80 text-white font-semibold px-4 py-2 rounded-lg hover:bg-foreground dark:bg-dark-border dark:hover:bg-dark-border/80",children:"Save as Draft"}),(0,d.jsx)("button",{onClick:()=>S("Sent"),whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-lg hover:bg-primary-focus shadow-md",children:"Create Quotation"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,d.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-sm space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"customer",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Customer"}),(0,d.jsx)("div",{className:"mt-1 max-w-sm",children:(0,d.jsx)(eu,{customers:r,selectedCustomerId:c,onCustomerChange:m,filter:e=>"cust001"!==e.id})})]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("label",{htmlFor:"product-search",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Add Product via Search"}),(0,d.jsx)("input",{id:"product-search",type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"Type to search products...",className:"mt-1 block w-full p-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md"}),f.length>0&&(0,d.jsx)("ul",{className:"absolute z-10 w-full bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-lg mt-1 max-h-60 overflow-y-auto",children:f.map(e=>(0,d.jsxs)("li",{onClick:()=>N(e),className:"px-4 py-2 hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",children:[e.name," - Ksh ",e.price.toFixed(2)]},e.id))})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-sm",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground mb-2",children:"Or Browse Products by Category"}),(0,d.jsx)("div",{className:"space-y-1 max-h-[50vh] overflow-y-auto pr-2",children:k.map(e=>{let[t,r]=e;return(0,d.jsxs)("div",{className:"border-b border-border dark:border-dark-border last:border-b-0",children:[(0,d.jsxs)("button",{onClick:()=>g(b===t?null:t),className:"w-full flex justify-between items-center py-3 text-left font-semibold text-foreground dark:text-dark-foreground","aria-expanded":b===t,children:[(0,d.jsxs)("span",{children:[t," (",r.length,")"]}),(0,d.jsx)("div",{animate:{rotate:b===t?180:0},children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,d.jsx)(n.M,{children:b===t&&(0,d.jsx)("div",{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:(0,d.jsx)("ul",{className:"pb-3 pl-4 space-y-1",children:r.map(e=>(0,d.jsxs)("li",{onClick:()=>N(e),className:"flex justify-between items-center py-1.5 cursor-pointer hover:bg-muted dark:hover:bg-dark-muted rounded px-2",children:[(0,d.jsx)("span",{className:"text-sm text-foreground dark:text-dark-foreground",children:e.name}),(0,d.jsxs)("span",{className:"text-sm font-mono text-primary dark:text-dark-primary",children:["Ksh ",e.price.toFixed(2)]})]},e.id))})})})]},t)})})]}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-6 py-3 text-left",children:"Product"}),(0,d.jsx)("th",{className:"px-6 py-3 text-center",children:"Quantity"}),(0,d.jsx)("th",{className:"px-6 py-3 text-right",children:"Unit Price"}),(0,d.jsx)("th",{className:"px-6 py-3 text-right",children:"Line Total"})]})}),(0,d.jsxs)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:[u.map(e=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"px-6 py-4 font-semibold",children:e.productName}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("input",{type:"number",value:e.quantity,onChange:t=>C(e.productId,parseInt(t.target.value)||1),className:"w-16 text-center bg-background dark:bg-dark-background border rounded-md p-1"})}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono",children:e.price.toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono font-semibold",children:(e.price*e.quantity).toFixed(2)})]},e.productId)),0===u.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:4,className:"text-center py-8 text-foreground-muted dark:text-dark-foreground-muted",children:"No items added to quote."})})]})]})})]}),(0,d.jsx)("div",{className:"lg:col-span-1",children:(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm p-6 space-y-3 sticky top-6",children:[(0,d.jsx)("h3",{className:"text-xl font-bold text-foreground dark:text-dark-foreground mb-4",children:"Summary"}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Gross Subtotal"}),(0,d.jsxs)("span",{className:"font-semibold font-mono",children:["Ksh ",y.toFixed(2)]})]}),w>0&&(0,d.jsxs)("div",{className:"flex justify-between text-sm text-danger",children:[(0,d.jsx)("span",{children:"Discounts"}),(0,d.jsxs)("span",{className:"font-semibold font-mono",children:["- Ksh ",w.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsxs)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:["VAT (",s.tax.vatRate,"%)"]}),(0,d.jsxs)("span",{className:"font-semibold font-mono",children:["Ksh ",j.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-xl font-bold border-t border-border dark:border-dark-border pt-3 mt-3",children:[(0,d.jsx)("span",{className:"text-foreground dark:text-dark-foreground",children:"Total"}),(0,d.jsxs)("span",{className:"text-primary dark:text-dark-primary font-mono",children:["Ksh ",v.toFixed(2)]})]})]})})]})]})};let rd=o.forwardRef((e,t)=>{let{quotation:r,settings:a,documentType:s,isPaid:o,linkedSaleId:n}=e;return(0,d.jsxs)("div",{ref:t,className:"relative bg-white p-8 font-sans text-sm text-black w-full max-w-4xl mx-auto shadow-lg border",children:[o&&(0,d.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",color:"rgba(34, 197, 94, 0.15)",fontSize:"8rem",fontWeight:"bold",textTransform:"uppercase",zIndex:0,pointerEvents:"none",userSelect:"none"},children:"Paid"}),(0,d.jsxs)("div",{className:"relative z-10",children:[(0,d.jsxs)("header",{className:"flex justify-between items-start pb-4 border-b",children:[(0,d.jsxs)("div",{children:[a.businessInfo.logoUrl&&(0,d.jsx)("img",{src:a.businessInfo.logoUrl,alt:"Company Logo",className:"h-16 max-w-xs object-contain mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:a.businessInfo.name}),(0,d.jsx)("p",{className:"text-slate-600",children:a.businessInfo.location}),(0,d.jsxs)("p",{className:"text-slate-600",children:["Tel: ",a.businessInfo.phone]}),a.tax.etimsEnabled&&a.businessInfo.kraPin&&(0,d.jsxs)("p",{className:"text-slate-600",children:["PIN: ",a.businessInfo.kraPin]})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold uppercase text-slate-700 tracking-wide",children:s.replace("-"," ")}),(0,d.jsxs)("div",{className:"mt-2 text-xs",children:[(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Number:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:r.quoteNumber})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Date:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(r.createdDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Expires:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(r.expiryDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]}),o&&n&&(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Invoice Ref:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:n})]})]})]})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Bill To"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:r.customerName})]}),(0,d.jsx)("section",{className:"mt-8",children:(0,d.jsxs)("table",{className:"w-full text-left",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-slate-100 text-slate-600 uppercase text-xs",children:[(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Item Description"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-center",children:"Qty"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Unit Price"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Total"})]})}),(0,d.jsx)("tbody",{children:r.items.map(e=>(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-3",children:e.productName}),(0,d.jsx)("td",{className:"p-3 text-center",children:e.quantity}),(0,d.jsx)("td",{className:"p-3 text-right font-mono",children:e.price.toFixed(2)}),(0,d.jsx)("td",{className:"p-3 text-right font-mono font-semibold",children:(e.price*e.quantity).toFixed(2)})]},e.productId))})]})}),(0,d.jsx)("section",{className:"flex justify-end mt-8",children:(0,d.jsxs)("div",{className:"w-full max-w-xs space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Subtotal"}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:r.subtotal.toFixed(2)})]}),r.discountAmount>0&&(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Discount"}),(0,d.jsxs)("span",{className:"font-mono text-slate-800",children:["- ",r.discountAmount.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Taxable Amount"}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:(r.subtotal-r.discountAmount).toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsxs)("span",{className:"text-slate-600",children:["VAT (",a.tax.vatRate,"%)"]}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:r.tax.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2 mt-2",children:[(0,d.jsx)("span",{className:"text-slate-800",children:"Total Amount"}),(0,d.jsxs)("span",{className:"font-mono text-slate-800",children:["Ksh ",r.total.toFixed(2)]})]})]})}),(0,d.jsxs)("footer",{className:"mt-16 pt-4 border-t text-xs text-slate-500",children:[a.paymentMethods.enabled&&a.paymentMethods.displayOnDocuments.includes(s)&&(0,d.jsxs)("div",{className:"mb-4 text-left",children:[(0,d.jsx)("h4",{className:"font-bold text-slate-700 uppercase mb-2",children:"How to Pay"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[a.paymentMethods.mpesaPaybill.paybillNumber&&(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("p",{className:"font-bold",children:"M-Pesa Paybill"}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Paybill No:"})," ",a.paymentMethods.mpesaPaybill.paybillNumber]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Account No:"})," ",a.paymentMethods.mpesaPaybill.accountNumber]})]}),a.paymentMethods.mpesaTill.tillNumber&&(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-bold",children:"M-Pesa Till"}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Till No:"})," ",a.paymentMethods.mpesaTill.tillNumber]})]})]}),(0,d.jsx)("div",{className:"space-y-2",children:a.paymentMethods.bank.map(e=>(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-bold",children:e.bankName}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Acc Name:"})," ",e.accountName]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Acc No:"})," ",e.accountNumber]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Branch:"})," ",e.branch]})]},e.id))})]})]}),(0,d.jsx)("p",{className:"text-center",children:a.receipt.footer})]})]})]})}),ro=e=>Promise.all(Array.from(e.getElementsByTagName("img")).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>t(),e.onerror=()=>{console.warn("Could not load image for PDF generation: ".concat(e.src)),t()})})));var rn=e=>{let{quotation:t,settings:r,sales:a,onBack:s,onConvertQuoteToSale:n,permissions:l}=e,i=(0,o.useRef)(null),[c,m]=(0,o.useState)(!1),[u,x]=(0,o.useState)(null),h=l.includes("manage_quotations"),p=(0,o.useMemo)(()=>a.find(e=>e.quotationId===t.id),[a,t.id]),b=async e=>{i.current&&!c&&(m(!0),x(e),requestAnimationFrame(async()=>{try{if(!i.current)throw Error("PDF reference is not available.");await ro(i.current);let r=await eD()(i.current,{scale:2,useCORS:!0}),a=r.toDataURL("image/png"),s=new eC.ZP("p","mm","a4"),d=s.internal.pageSize.getWidth(),o=r.height*d/r.width;s.addImage(a,"PNG",0,0,d,o),s.save("".concat(e,"_").concat(t.quoteNumber,".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF. The logo might be causing an issue.")}finally{m(!1),x(null)}}))},g=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})});return(0,d.jsx)("div",{className:"h-full overflow-y-auto bg-background dark:bg-dark-background",children:(0,d.jsxs)("div",{className:"p-4 md:p-8 space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[(0,d.jsxs)("button",{onClick:s,className:"flex items-center text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to All Quotations"]}),p&&(0,d.jsx)("div",{className:"px-4 py-2 text-lg font-bold rounded-lg text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300 inline-block uppercase tracking-widest",children:"Invoiced"}),h&&(0,d.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[(0,d.jsxs)("button",{onClick:()=>b("Quotation"),whileTap:{scale:.95},disabled:c,className:"bg-primary text-primary-content font-bold px-3 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-sm flex items-center text-sm disabled:bg-slate-400",children:[(0,d.jsx)(g,{})," ",c&&"Quotation"===u?"Downloading...":"Quote PDF"]}),(0,d.jsxs)("button",{onClick:()=>b("Proforma-Invoice"),whileTap:{scale:.95},disabled:c,className:"bg-muted text-foreground dark:bg-dark-muted dark:text-dark-foreground font-bold px-3 py-2 rounded-lg hover:bg-border dark:hover:bg-dark-border transition-colors shadow-sm flex items-center text-sm disabled:bg-slate-400",children:[(0,d.jsx)(g,{})," ",c&&"Proforma-Invoice"===u?"Downloading...":"Pro-forma PDF"]}),!p&&"Expired"!==t.status&&(0,d.jsx)("button",{onClick:()=>n(t),whileTap:{scale:.95},className:"bg-accent text-black font-bold px-4 py-2 rounded-lg hover:opacity-80 transition-opacity shadow-md flex items-center text-sm",children:"Create Invoice"})]})]}),(0,d.jsx)("div",{id:"pdf-content-wrapper",children:(0,d.jsx)(rd,{ref:i,quotation:t,settings:r,documentType:u||"Quotation",isPaid:!!p,linkedSaleId:null==p?void 0:p.id})})]})})};let rl=o.forwardRef((e,t)=>{let{invoice:r,supplier:a,purchaseOrder:s,settings:o}=e;return(0,d.jsxs)("div",{ref:t,className:"relative bg-white p-8 font-sans text-sm text-black w-full max-w-4xl mx-auto shadow-lg border",children:["Paid"===r.status&&(0,d.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",color:"rgba(34, 197, 94, 0.15)",fontSize:"8rem",fontWeight:"bold",textTransform:"uppercase",zIndex:0,pointerEvents:"none",userSelect:"none"},children:"Paid"}),(0,d.jsxs)("div",{className:"relative z-10",children:[(0,d.jsxs)("header",{className:"flex justify-between items-start pb-4 border-b",children:[(0,d.jsxs)("div",{children:[o.businessInfo.logoUrl&&(0,d.jsx)("img",{src:o.businessInfo.logoUrl,alt:"Company Logo",className:"h-16 max-w-xs object-contain mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:o.businessInfo.name}),(0,d.jsx)("p",{className:"text-slate-600",children:o.businessInfo.location}),(0,d.jsxs)("p",{className:"text-slate-600",children:["Tel: ",o.businessInfo.phone]})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold uppercase text-slate-700 tracking-wide",children:"Supplier Invoice"}),(0,d.jsxs)("div",{className:"mt-2 text-xs",children:[(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Invoice #:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:r.invoiceNumber})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"PO Ref:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:null==s?void 0:s.poNumber})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Invoice Date:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(r.invoiceDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Due Date:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(r.dueDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]})]})]})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Supplier"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:null==a?void 0:a.name}),(0,d.jsx)("p",{className:"text-slate-600",children:null==a?void 0:a.contact}),(0,d.jsx)("p",{className:"text-slate-600",children:null==a?void 0:a.email})]}),(0,d.jsx)("section",{className:"mt-8",children:(0,d.jsxs)("table",{className:"w-full text-left",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-slate-100 text-slate-600 uppercase text-xs",children:[(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Item Description"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-center",children:"Qty Received"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Unit Cost"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Total"})]})}),(0,d.jsx)("tbody",{children:null==s?void 0:s.items.map(e=>(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-3",children:e.productName}),(0,d.jsx)("td",{className:"p-3 text-center",children:e.quantity}),(0,d.jsx)("td",{className:"p-3 text-right font-mono",children:e.cost.toFixed(2)}),(0,d.jsx)("td",{className:"p-3 text-right font-mono font-semibold",children:(e.cost*e.quantity).toFixed(2)})]},e.productId))})]})}),(0,d.jsx)("section",{className:"flex justify-end mt-8",children:(0,d.jsxs)("div",{className:"w-full max-w-xs space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Subtotal"}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:r.subtotal.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsxs)("span",{className:"text-slate-600",children:["VAT (",o.tax.vatRate,"%)"]}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:r.taxAmount.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2 mt-2",children:[(0,d.jsx)("span",{className:"text-slate-800",children:"Invoice Total"}),(0,d.jsxs)("span",{className:"font-mono text-slate-800",children:["Ksh ",r.totalAmount.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Amount Paid"}),(0,d.jsxs)("span",{className:"font-mono text-slate-800",children:["- ",r.paidAmount.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-2 mt-2 ".concat("Paid"===r.status?"text-green-600":"text-red-600"),children:[(0,d.jsx)("span",{children:"Balance Due"}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",(r.totalAmount-r.paidAmount).toFixed(2)]})]})]})})]})]})}),ri=e=>Promise.all(Array.from(e.getElementsByTagName("img")).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>t(),e.onerror=()=>{console.warn("Could not load image for PDF generation: ".concat(e.src)),t()})})));var rc=e=>{let{invoice:t,supplier:r,purchaseOrder:a,settings:s,onBack:n}=e,l=(0,o.useRef)(null),[i,c]=(0,o.useState)(!1),m=async()=>{if(l.current&&!i){c(!0);try{await ri(l.current);let e=await eD()(l.current,{scale:2,useCORS:!0}),r=e.toDataURL("image/png"),a=new eC.ZP("p","mm","a4"),s=a.internal.pageSize.getWidth(),d=e.height*s/e.width;a.addImage(r,"PNG",0,0,s,d),a.save("Invoice_".concat(t.invoiceNumber,".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF. The logo might be causing an issue.")}finally{c(!1)}}};return(0,d.jsx)("div",{className:"bg-background dark:bg-dark-background",children:(0,d.jsxs)("div",{className:"p-4 md:p-8 space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[(0,d.jsxs)("button",{onClick:n,className:"flex items-center text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to Accounts Payable"]}),(0,d.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:(0,d.jsxs)("button",{onClick:m,whileTap:{scale:.95},disabled:i,className:"bg-primary text-primary-content font-bold px-3 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-sm flex items-center text-sm disabled:bg-slate-400",children:[(0,d.jsx)(()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),{})," ",i?"Downloading...":"Download PDF"]})})]}),(0,d.jsx)("div",{id:"pdf-content-wrapper",children:(0,d.jsx)(rl,{ref:l,invoice:t,supplier:r,purchaseOrder:a,settings:s})})]})})},rm=e=>{let{mode:t,recipient:r,customers:a=[],documentId:s,onClose:n,onSend:l}=e,[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)(r&&"contact"in r?r.contact:(null==r?void 0:r.phone)||""),[x,h]=(0,o.useState)("");(0,o.useEffect)(()=>{if("receipt"===t&&s&&r){let e="Walk-in Customer"===r.name?"Customer":r.name;c("Dear ".concat(e,",\n\nThank you for your business. Here is your receipt ID: ").concat(s,".\n\nWe appreciate your patronage."))}else"po"===t&&s&&r&&c("Dear ".concat(r.name,",\n\nPlease find our Purchase Order #").concat(s," attached to this message. We look forward to your confirmation.\n\nThank you."))},[t,s,r]);let p=(0,o.useMemo)(()=>a.filter(e=>"cust001"!==e.id&&e.phone&&"N/A"!==e.phone&&/^(0[17]|254[17])\d{8}$/.test(e.phone)),[a]);return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-8",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"receipt"===t?"Send WhatsApp Receipt":"po"===t?"Send PO via WhatsApp":"Send Bulk WhatsApp"}),(0,d.jsx)("button",{onClick:n,className:"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("div",{className:"space-y-4",children:["receipt"===t||"po"===t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"bg-muted dark:bg-dark-muted p-4 rounded-lg",children:(0,d.jsxs)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:["Sending to: ",(0,d.jsx)("span",{className:"font-bold text-foreground dark:text-dark-foreground",children:null==r?void 0:r.name})]})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Recipient Phone Number"}),(0,d.jsx)("input",{type:"tel",name:"phone",id:"phone",value:m,onChange:e=>u(e.target.value),required:!0,autoFocus:!0,className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-lg"})]})]}):(0,d.jsxs)("div",{className:"bg-muted dark:bg-dark-muted p-4 rounded-lg text-center",children:[(0,d.jsxs)("p",{className:"font-bold text-foreground dark:text-dark-foreground",children:["This message will be sent to ",(0,d.jsx)("span",{className:"text-primary dark:text-dark-primary",children:p.length})," customers."]}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"Only customers with valid phone numbers (excluding Walk-in) will be targeted."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Message"}),(0,d.jsx)("textarea",{id:"message",name:"message",value:i,onChange:e=>c(e.target.value),rows:"bulk"===t?6:4,placeholder:"bulk"===t?"Type your promotional message here...":"",className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm"})]}),x&&(0,d.jsx)("p",{className:"text-sm text-danger",children:x})]}),(0,d.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:n,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold px-4 py-2 rounded-lg hover:bg-border dark:hover:bg-dark-border transition-colors",children:"Cancel"}),(0,d.jsxs)("button",{onClick:()=>{if(h(""),"receipt"===t&&r){if(!/^(0[17]|254[17])\d{8}$/.test(m)){h("Please enter a valid Kenyan phone number (e.g., 0712345678).");return}l([{...r,phone:m}],i)}else if("po"===t&&r){if(!/^(0[17]|254[17])\d{8}$/.test(m)){h("Please enter a valid Kenyan phone number (e.g., 0712345678).");return}l([{...r,contact:m}],i)}else if("bulk"===t){if(!i.trim()){h("Message cannot be empty.");return}if(0===p.length){h("No customers with valid phone numbers to send to.");return}l(p,i)}},whileTap:{scale:.95},className:"bg-[#25D366] text-white font-bold px-6 py-2 rounded-lg hover:bg-[#1EAE53] transition-colors shadow-md flex items-center",children:[(0,d.jsx)("div",{className:"w-5 h-5 mr-2",children:N.whatsapp}),"Send Message"]})]})]})})};let ru=e=>{let{type:t,onSelect:r}=e,a=w[t];return(0,d.jsx)("div",{onClick:()=>r(t),className:"p-6 bg-card dark:bg-dark-card rounded-xl cursor-pointer shadow-clay-light dark:shadow-clay-dark border border-border dark:border-dark-border hover:border-primary dark:hover:border-dark-primary transition-all",whileHover:{y:-5,scale:1.02},whileTap:{scale:.98},children:(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsx)("div",{className:"bg-primary-soft dark:bg-dark-primary-soft text-primary dark:text-dark-primary p-3 rounded-lg",children:a.icon}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-white",children:a.name}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:a.description})]})]})})};var rx=e=>{let{settings:t,onUpdateSettings:r,onSetupComplete:a,showToast:s}=e,[l,i]=(0,o.useState)(1),c=e=>{r({businessType:e}),i(2)},m=()=>{i(3)},u={hidden:{opacity:0,x:50},visible:{opacity:1,x:0},exit:{opacity:0,x:-50}};return(0,d.jsx)("div",{className:"h-screen w-screen auth-background flex items-center justify-center p-4",children:(0,d.jsx)("div",{className:"w-full max-w-2xl bg-card dark:bg-dark-card rounded-2xl shadow-clay-dark overflow-hidden border border-dark-border/20",children:(0,d.jsx)(n.M,{mode:"wait",children:(()=>{switch(l){case 1:return(0,d.jsxs)("div",{variants:u,initial:"hidden",animate:"visible",exit:"exit",className:"p-8",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-white text-center",children:"Welcome to Banduka POS™"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted text-center mt-2 mb-8",children:"Let's get your business set up. First, tell us what kind of business you run."}),(0,d.jsx)("div",{className:"space-y-4",children:Object.keys(w).map(e=>(0,d.jsx)(ru,{type:e,onSelect:c},e))})]},"step1");case 2:return(0,d.jsxs)("div",{variants:u,initial:"hidden",animate:"visible",exit:"exit",className:"p-8",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-white mb-1",children:"Tell us about your business"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mb-6",children:"This information will appear on your receipts and official documents."}),(0,d.jsx)(tg,{settings:t,onUpdateSettings:r,showToast:s,isSetupWizard:!0,onWizardNext:m})]},"step2");case 3:return(0,d.jsxs)("div",{variants:u,initial:"hidden",animate:"visible",exit:"exit",className:"p-8 text-center",children:[(0,d.jsx)("div",{className:"mx-auto bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 w-24 h-24 rounded-full flex items-center justify-center mb-6",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-white",children:"All Set!"}),(0,d.jsxs)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2 mb-8",children:["Banduka POS™ is now configured for your ",(0,d.jsx)("span",{className:"font-semibold text-primary dark:text-dark-primary",children:t.businessType})," business. You can change these settings anytime."]}),(0,d.jsx)("button",{onClick:a,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-8 py-3 rounded-lg hover:bg-primary-focus transition-colors shadow-lg text-lg",children:"Finish & Go to Dashboard"})]},"step3");default:return null}})()})})})},rh=e=>{let{onUpdate:t}=e;return(0,d.jsxs)("div",{layout:!0,initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},transition:{type:"spring",stiffness:500,damping:30},className:"fixed bottom-5 right-5 z-50 flex items-center w-full max-w-sm p-4 text-gray-800 bg-white/50 dark:bg-dark-card/50 backdrop-blur-2xl rounded-lg shadow-lg border border-white/20 dark:border-white/10",role:"alert",children:[(0,d.jsxs)("div",{className:"flex-grow",children:[(0,d.jsx)("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:"A new update is available!"}),(0,d.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Refresh the app to get the latest features."})]}),(0,d.jsx)("button",{onClick:t,whileTap:{scale:.95},className:"ml-4 px-4 py-2 text-sm font-bold bg-primary text-white rounded-md hover:bg-primary-focus",children:"Refresh"})]})};let rp=e=>{let{title:t,value:r,icon:a}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm flex items-center space-x-4 border border-border dark:border-dark-border",children:[(0,d.jsx)("div",{className:"p-3 rounded-lg text-primary dark:text-dark-primary bg-muted dark:bg-dark-muted",children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-semibold",children:t}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:r})]})]})},rb=(e,t)=>{if(!t)return"Active";let r=new Date(t).getTime()-new Date(e).getTime();return r<0?"Invalid":"".concat(Math.floor(r/36e5).toString().padStart(2,"0"),"h ").concat(Math.floor(r%36e5/6e4).toString().padStart(2,"0"),"m")};var rg=e=>{let{timeClockEvents:t,users:r,permissions:a,onAddRequest:s,onEditRequest:n,onDeleteRequest:l}=e,[i,c]=(0,o.useState)("all"),[m,u]=(0,o.useState)(""),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)(null),g=a.includes("manage_timesheets"),f=(0,o.useMemo)(()=>{let e=m?new Date(m):null;e&&e.setHours(0,0,0,0);let r=x?new Date(x):null;return r&&r.setHours(23,59,59,999),t.filter(e=>"all"===i||e.userId===i).filter(t=>{let a=new Date(t.clockInTime);return(!e||!(a<e))&&(!r||!(a>r))}).sort((e,t)=>new Date(t.clockInTime).getTime()-new Date(e.clockInTime).getTime())},[t,i,m,x]),{totalHours:k,avgDuration:y,activeStaffCount:j}=(0,o.useMemo)(()=>{let e=0,r=0;return f.forEach(t=>{t.clockOutTime&&(e+=new Date(t.clockOutTime).getTime()-new Date(t.clockInTime).getTime(),r++)}),{totalHours:e/36e5,avgDuration:r>0?e/r/36e5:0,activeStaffCount:t.filter(e=>"clocked-in"===e.status).length}},[f,t]);return(0,d.jsxs)("div",{className:"p-4 md:p-6 bg-muted dark:bg-dark-muted min-h-full",children:[p&&(0,d.jsx)(tR,{title:"Delete Time Entry?",message:"Are you sure you want to delete this time clock entry for ".concat(p.userName,"? This cannot be undone."),onConfirm:()=>{l(p.id),b(null)},onClose:()=>b(null),confirmText:"Delete",isDestructive:!0}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Staff Shifts"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"Track staff clock-in/out times and total hours worked"})]}),g&&(0,d.jsxs)("button",{onClick:s,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-primary-focus transition-colors mt-4 md:mt-0",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:(0,d.jsx)("path",{d:"M12 5v14m-7-7h14"})}),(0,d.jsx)("span",{children:"Add Manual Entry"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,d.jsx)(rp,{title:"Total Hours (Filtered)",value:"".concat(k.toFixed(2)," hrs"),icon:N.timeSheets}),(0,d.jsx)(rp,{title:"Shifts Recorded",value:f.length,icon:N.clipboardList}),(0,d.jsx)(rp,{title:"Avg. Duration",value:"".concat(y.toFixed(2)," hrs"),icon:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),(0,d.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,d.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),(0,d.jsx)(rp,{title:"Staff Active Now",value:j,icon:N.users})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border",children:[(0,d.jsx)("div",{className:"p-4 border-b border-border dark:border-dark-border",children:(0,d.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 w-full",children:[(0,d.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background",children:[(0,d.jsx)("option",{value:"all",children:"All Staff"}),r.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,d.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background"}),(0,d.jsx)("input",{type:"date",value:x,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background"})]})}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted uppercase bg-muted dark:bg-dark-muted/50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"py-3 px-4",children:"Staff Member"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Clock In"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Clock Out"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Duration"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Notes"}),(0,d.jsx)("th",{className:"py-3 px-4",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsxs)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:[f.map(e=>(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted/50",children:[(0,d.jsx)("td",{className:"py-3 px-4 font-semibold text-foreground dark:text-dark-foreground",children:e.userName}),(0,d.jsx)("td",{className:"py-3 px-4",children:new Date(e.clockInTime).toLocaleString("en-GB",{dateStyle:"short",timeStyle:"short"})}),(0,d.jsx)("td",{className:"py-3 px-4",children:e.clockOutTime?new Date(e.clockOutTime).toLocaleString("en-GB",{dateStyle:"short",timeStyle:"short"}):(0,d.jsx)("span",{className:"font-semibold text-primary",children:"Active"})}),(0,d.jsx)("td",{className:"py-3 px-4 font-mono font-semibold",children:rb(e.clockInTime,e.clockOutTime)}),(0,d.jsx)("td",{className:"py-3 px-4 text-xs italic text-foreground-muted",children:e.notes}),(0,d.jsx)("td",{className:"py-3 px-4 text-right",children:g&&(0,d.jsxs)("div",{className:"space-x-4",children:[(0,d.jsx)("button",{onClick:()=>n(e),className:"font-medium text-primary hover:underline",children:"Edit"}),(0,d.jsx)("button",{onClick:()=>b(e),className:"font-medium text-danger hover:underline",children:"Delete"})]})})]},e.id)),0===f.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:6,className:"text-center py-8 text-foreground-muted",children:"No entries found for the selected filters."})})]})]})})]})]})};let rf=e=>{if(!e)return"";let t=new Date(e),r=6e4*t.getTimezoneOffset();return new Date(t.getTime()-r).toISOString().slice(0,16)};var rk=e=>{var t;let{event:r,users:a,onClose:s,onSave:n}=e,l=!r,[i,c]=(0,o.useState)((null==r?void 0:r.userId)||(null===(t=a[0])||void 0===t?void 0:t.id)||""),[m,u]=(0,o.useState)(rf((null==r?void 0:r.clockInTime)||new Date)),[x,h]=(0,o.useState)(rf(null==r?void 0:r.clockOutTime)),[p,b]=(0,o.useState)((null==r?void 0:r.notes)||"");return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-8 border border-border dark:border-dark-border",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:l?"Add Manual Time Entry":"Edit Time Entry"}),(0,d.jsx)("button",{onClick:s,className:"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground",children:"\xd7"})]}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new Date(m),a=x?new Date(x):void 0;if(a&&a<t){alert("Clock out time cannot be before clock in time.");return}n({userId:i,clockInTime:t,clockOutTime:a,notes:p},null==r?void 0:r.id)},className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"user",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Staff Member"}),(0,d.jsx)("select",{id:"user",value:i,onChange:e=>c(e.target.value),disabled:!l,className:"mt-1 block w-full px-3 py-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border text-foreground dark:text-dark-foreground rounded-md disabled:bg-muted dark:disabled:bg-dark-muted",children:a.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"clockInTime",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Clock In"}),(0,d.jsx)("input",{type:"datetime-local",id:"clockInTime",value:m,onChange:e=>u(e.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 border rounded-md bg-background text-foreground border-border dark:border-dark-border dark:text-dark-foreground"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"clockOutTime",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Clock Out"}),(0,d.jsx)("input",{type:"datetime-local",id:"clockOutTime",value:x,onChange:e=>h(e.target.value),className:"mt-1 block w-full px-3 py-2 border rounded-md bg-background text-foreground border-border dark:border-dark-border dark:text-dark-foreground"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:"Notes (Optional)"}),(0,d.jsx)("textarea",{id:"notes",value:p,onChange:e=>b(e.target.value),rows:2,className:"mt-1 block w-full px-3 py-2 border rounded-md bg-background text-foreground border-border dark:border-dark-border dark:text-dark-foreground",placeholder:"e.g., Forgot to clock out, manual entry by admin."})]}),(0,d.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:s,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold px-4 py-2 rounded-xl shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-xl shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset",children:"Save Entry"})]})]})]})})},ry=e=>{let{sales:t,activeShift:r,onProcessReturn:a,onBack:s}=e,[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(null),[m,u]=(0,o.useState)({}),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)("Cash"),[g,f]=(0,o.useState)(""),k=(e,t,r)=>{let a=Math.max(0,Math.min(t,(m[e]||0)+r));u(t=>({...t,[e]:a}))},y=(0,o.useMemo)(()=>i?i.items.filter(e=>m[e.id]>0).map(e=>({...e,quantity:m[e.id]})):[],[i,m]),j=(0,o.useMemo)(()=>y.reduce((e,t)=>e+t.price*t.quantity,0),[y]);return r?(0,d.jsx)("div",{className:"p-4 md:p-8 bg-background dark:bg-dark-background",children:(0,d.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Process a Return"}),(0,d.jsx)("button",{onClick:s,className:"text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:"← Back to POS"})]}),i?(0,d.jsxs)("div",{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsxs)("h3",{className:"text-lg font-bold",children:["Original Sale: ",(0,d.jsx)("span",{className:"font-mono text-primary dark:text-dark-primary",children:i.id})]}),(0,d.jsxs)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:["Date: ",new Date(i.date).toLocaleString()]}),(0,d.jsx)("button",{onClick:()=>c(null),className:"text-sm text-secondary hover:underline mt-2",children:"Find a different receipt"})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-md",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold p-4 border-b border-border dark:border-dark-border",children:"Select Items to Return"}),(0,d.jsx)("div",{className:"max-h-80 overflow-y-auto",children:(0,d.jsx)("ul",{className:"divide-y divide-border dark:divide-dark-border",children:i.items.map(e=>(0,d.jsxs)("li",{className:"p-4 flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-bold",children:e.name}),(0,d.jsxs)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:["Purchased: ",e.quantity," @ Ksh ",e.price.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("button",{onClick:()=>k(e.id,e.quantity,-1),className:"w-8 h-8 rounded-full bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground",children:"-"}),(0,d.jsx)("span",{className:"font-bold w-8 text-center",children:m[e.id]||0}),(0,d.jsx)("button",{onClick:()=>k(e.id,e.quantity,1),className:"w-8 h-8 rounded-full bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground",children:"+"})]})]},e.id))})})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"returnReason",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Reason for Return"}),(0,d.jsx)("input",{type:"text",id:"returnReason",value:x,onChange:e=>h(e.target.value),className:"mt-1 w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background",placeholder:"e.g., Damaged item"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground mb-2",children:"Refund Method"}),(0,d.jsx)("div",{className:"flex gap-4",children:["Cash","Card","M-Pesa"].map(e=>(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"radio",name:"refundMethod",value:e,checked:p===e,onChange:()=>b(e),className:"focus:ring-primary h-4 w-4 text-primary"}),(0,d.jsx)("span",{className:"ml-2 text-sm",children:e})]},e))})]}),(0,d.jsxs)("div",{className:"text-right border-t border-border dark:border-dark-border pt-4 mt-4",children:[(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Total Refund Amount"}),(0,d.jsxs)("p",{className:"text-3xl font-bold text-danger",children:["- Ksh ",j.toFixed(2)]})]}),g&&(0,d.jsx)("p",{className:"text-danger text-sm text-center",children:g}),(0,d.jsx)("button",{onClick:()=>{if(i){if(0===y.length){f("Please select at least one item to return.");return}if(!x.trim()){f("A reason for the return is required.");return}a(i,y,x,p)}},className:"w-full mt-4 bg-danger text-white font-bold py-3 rounded-lg text-lg hover:bg-red-700",children:"Process Refund"})]})]}):(0,d.jsxs)("div",{initial:{opacity:0},animate:{opacity:1},className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Find Original Receipt"}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("input",{type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"Enter Receipt ID to find sale...",className:"flex-grow w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background focus:outline-none focus:ring-2 focus:ring-primary"}),(0,d.jsx)("button",{onClick:()=>{f("");let e=t.find(e=>e.id.toLowerCase()===n.toLowerCase().trim()&&"Return"!==e.type);e?(c(e),u(e.items.reduce((e,t)=>(e[t.id]=0,e),{}))):(f("Sale receipt not found or it is already a return."),c(null))},className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-lg hover:bg-primary-focus",children:"Find"})]}),g&&(0,d.jsx)("p",{className:"text-danger text-sm mt-2",children:g})]})]})}):(0,d.jsxs)("div",{className:"p-8 h-full flex flex-col items-center justify-center text-center",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Shift Not Active"}),(0,d.jsx)("p",{className:"mt-2 text-foreground-muted dark:text-dark-foreground-muted",children:"You must start a shift before you can process a return."}),(0,d.jsx)("button",{onClick:s,className:"mt-6 bg-primary text-primary-content font-bold py-2 px-6 rounded-lg",children:"Back to POS"})]})},rj=r(21548),rv=r(40257),rw=e=>{let{activeShift:t,onProcessExpense:r,onBack:a,sales:s,expenses:n,accountingTransactions:l,chartOfAccounts:i,settings:c,currentUser:m}=e,[u,x]=(0,o.useState)(""),[h,p]=(0,o.useState)(""),[b,g]=(0,o.useState)(""),[f,k]=(0,o.useState)("Miscellaneous"),[y,v]=(0,o.useState)("Cash Drawer"),[w,N]=(0,o.useState)(null),[C,S]=(0,o.useState)(!1),[D,P]=(0,o.useState)(""),T=(0,o.useMemo)(()=>new rj.$D(rv.env.API_KEY),[]),I=(0,o.useMemo)(()=>{let e=s.filter(e=>null==t?void 0:t.salesIds.includes(e.id)),r=e.reduce((e,t)=>{var r;return e+((null===(r=t.payments.find(e=>"Cash"===e.method))||void 0===r?void 0:r.amount)||0)},0),a=e.reduce((e,t)=>e+t.change,0),d=n.filter(e=>{var r;return null==t?void 0:null===(r=t.expenseIds)||void 0===r?void 0:r.includes(e.id)}).reduce((e,t)=>e+t.amount,0),o=((null==t?void 0:t.startingFloat)||0)+r-a-d,m=e=>{let t=i.find(t=>t.id===e);if(!t)return 0;let r=l.flatMap(e=>e.entries).filter(t=>t.accountId===e).reduce((e,t)=>e+t.debit-t.credit,0);return["Assets","Expenses"].includes(t.type)?r:-r};return{"Cash Drawer":o,"M-Pesa":m(c.accounting.defaultMpesaAccountId),Bank:m(c.accounting.defaultBankAccountId)}},[t,s,n,l,i,c]),A=async()=>{if(!h.trim()){P("Please enter a description first to get a suggestion.");return}S(!0),P("");let e="\n            Given the following list of expense categories:\n            ".concat(j.join(", "),'\n\n            Based on the expense description provided below, which single category is the best fit? Respond with only the category name.\n\n            Description: "').concat(h,'"\n        ');try{let t=T.getGenerativeModel({model:"gemini-pro"}),r=await t.generateContent(e),a=(await r.response).text().trim();j.includes(a)&&k(a)}catch(e){console.error("AI Suggestion Error:",e),P("Could not get AI suggestion.")}finally{S(!1)}},M="number"==typeof u&&u>I[y],F=e=>{let{name:t,balance:r}=e;return(0,d.jsxs)("button",{type:"button",onClick:()=>v(t),className:"p-3 rounded-lg text-left transition-all w-full ".concat(y===t?"bg-primary/20 border-primary border-2":"bg-background dark:bg-dark-muted border border-border dark:border-dark-border"),whileTap:{scale:.98},children:[(0,d.jsx)("p",{className:"font-bold text-foreground dark:text-dark-foreground",children:t}),(0,d.jsxs)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:["Available: ",(0,d.jsx)("span",{className:"font-mono",children:r.toFixed(2)})]})]})};return(0,d.jsx)("div",{className:"p-4 md:p-8 h-full overflow-y-auto bg-background dark:bg-dark-background flex items-center justify-center",children:(0,d.jsxs)("div",{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-lg bg-card dark:bg-dark-card p-8 rounded-xl shadow-xl",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Record an Expense"}),(0,d.jsx)("button",{onClick:a,className:"text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:"← Cancel"})]}),(0,d.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),P(""),"number"!=typeof u||u<=0){P("Please enter a valid positive amount.");return}if(!h.trim()){P("A description for the expense is required.");return}if("Cash Drawer"===y&&!t){P("An active shift is required to make an expense from the cash drawer.");return}r(u,h,f,y,b.trim()||void 0,w||void 0)},className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground mb-2",children:"Payment Method"}),(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,d.jsx)(F,{name:"Cash Drawer",balance:I["Cash Drawer"]}),(0,d.jsx)(F,{name:"M-Pesa",balance:I["M-Pesa"]}),(0,d.jsx)(F,{name:"Bank",balance:I.Bank})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Amount (Ksh)"}),(0,d.jsx)("input",{type:"number",id:"amount",value:u,onChange:e=>x(""===e.target.value?"":parseFloat(e.target.value)),min:"0.01",step:"0.01",required:!0,autoFocus:!0,className:"mt-1 w-full px-4 py-2 rounded-lg border text-xl font-bold bg-background dark:bg-dark-background ".concat(M?"border-danger":"border-border dark:border-dark-border")}),M&&(0,d.jsxs)("p",{className:"text-xs text-danger mt-1",children:["Amount exceeds available balance in ",y,"."]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"reason",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Notes / Description"}),(0,d.jsx)("input",{type:"text",id:"reason",value:h,onChange:e=>p(e.target.value),required:!0,className:"mt-1 w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background",placeholder:"e.g., Office supplies, Lunch for staff"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Category"}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,d.jsx)("select",{id:"category",value:f,onChange:e=>k(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background",children:j.map(e=>(0,d.jsx)("option",{value:e,children:e},e))}),(0,d.jsx)("button",{type:"button",onClick:A,disabled:C,whileTap:{scale:.95},className:"px-3 py-2 bg-secondary text-white rounded-lg text-sm whitespace-nowrap disabled:bg-slate-400",children:C?"...":"AI ✨"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"payee",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Payee / Vendor Name (Optional)"}),(0,d.jsx)("input",{type:"text",id:"payee",value:b,onChange:e=>g(e.target.value),className:"mt-1 w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background",placeholder:"e.g., Naivas Supermarket"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"receipt",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Upload Receipt (Optional)"}),(0,d.jsx)("input",{type:"file",id:"receipt",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){let e=new FileReader;e.onloadend=()=>{N(e.result)},e.readAsDataURL(r)}},accept:"image/*",className:"mt-1 block w-full text-sm text-foreground-muted dark:text-dark-foreground-muted file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary dark:file:bg-dark-primary/20 dark:file:text-dark-primary"}),w&&(0,d.jsx)("img",{src:w,alt:"Receipt preview",className:"mt-2 rounded-lg max-h-40 object-contain"})]}),D&&(0,d.jsx)("p",{className:"text-danger text-sm text-center",children:D}),(0,d.jsx)("div",{className:"pt-4",children:(0,d.jsx)("button",{type:"submit",className:"w-full bg-primary text-primary-content font-bold py-3 rounded-lg text-lg hover:bg-primary-focus",children:"Record Expense"})})]})]})})};let rN=e=>{let{expenses:t,onViewExpenseRequest:r,setCurrentView:a}=e,[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(1),[m,u]=(0,o.useState)(""),[x,h]=(0,o.useState)(""),p=(0,o.useMemo)(()=>{let e=m?new Date(m):null;e&&e.setHours(0,0,0,0);let r=x?new Date(x):null;return r&&r.setHours(23,59,59,999),t.filter(t=>{let a=new Date(t.date);return(!e||!(a<e))&&(!r||!(a>r))}).filter(e=>{let t=n.toLowerCase();return e.id.toLowerCase().includes(t)||e.reason.toLowerCase().includes(t)||e.payee&&e.payee.toLowerCase().includes(t)||e.cashierName.toLowerCase().includes(t)}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())},[t,n,m,x]),b=(0,o.useMemo)(()=>{let e=(i-1)*15;return p.slice(e,e+15)},[p,i]),g=Math.ceil(p.length/15),f=(0,o.useMemo)(()=>p.reduce((e,t)=>e+t.amount,0),[p]);return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-4xl font-bold text-foreground dark:text-dark-foreground",children:"Expenditure Management"}),(0,d.jsxs)("button",{onClick:()=>a(s.NewExpense),whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Expense"]})]}),(0,d.jsxs)("div",{className:"my-6 p-4 bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsx)("input",{type:"text",placeholder:"Search by ID, Reason, Payee...",className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary",value:n,onChange:e=>l(e.target.value)}),(0,d.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card"}),(0,d.jsx)("input",{type:"date",value:x,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-card"})]}),(0,d.jsxs)("div",{className:"text-center pt-4 border-t border-border dark:border-dark-border",children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-bold",children:"Total Expenses (Filtered)"}),(0,d.jsxs)("p",{className:"text-2xl font-bold text-danger",children:["Ksh ",f.toFixed(2)]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:[(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-semibold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Expense ID"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Reason"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Paid To"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:"Cashier"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4 text-right",children:"Amount (Ksh)"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-4",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsxs)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:[b.map(e=>(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>r(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-bold text-foreground dark:text-dark-foreground font-mono text-xs",children:e.id}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.date).toLocaleString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.reason}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.payee||"N/A"}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.cashierName}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono font-semibold text-danger",children:e.amount.toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right",children:(0,d.jsx)("button",{className:"font-medium text-primary dark:text-dark-primary hover:underline",children:"View"})})]},e.id)),0===b.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:7,className:"text-center py-10",children:"No expenses found."})})]})]}),g>1&&(0,d.jsxs)("div",{className:"flex justify-between items-center p-4 text-sm border-t border-border dark:border-dark-border",children:[(0,d.jsx)("button",{onClick:()=>c(e=>Math.max(1,e-1)),disabled:1===i,className:"px-3 py-1 border rounded-md disabled:opacity-50 border-border dark:border-dark-border",children:"Previous"}),(0,d.jsxs)("span",{children:["Page ",i," of ",g]}),(0,d.jsx)("button",{onClick:()=>c(e=>Math.min(g,e+1)),disabled:i===g,className:"px-3 py-1 border rounded-md disabled:opacity-50 dark:border-dark-border",children:"Next"})]})]})]})},rC=o.forwardRef((e,t)=>{let{expense:r,settings:a}=e;return(0,d.jsxs)("div",{ref:t,className:"bg-white p-6 font-sans text-sm text-black w-full max-w-lg mx-auto border border-black",children:[(0,d.jsxs)("header",{className:"text-center pb-4 border-b border-black",children:[(0,d.jsx)("h1",{className:"text-xl font-bold uppercase",children:a.businessInfo.name}),(0,d.jsx)("h2",{className:"text-lg font-semibold uppercase",children:"Expense Voucher"})]}),(0,d.jsxs)("section",{className:"my-4 space-y-2 text-base",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"Date:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(r.date).toLocaleString("en-GB")})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"Voucher No:"})," ",(0,d.jsx)("span",{className:"font-mono",children:r.id})]})]}),(0,d.jsxs)("section",{className:"my-4 border-y border-black py-4",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"Paid to:"}),(0,d.jsx)("span",{className:"font-bold border-b border-dotted border-black w-3/4 text-left px-2",children:r.payee||"____________________"})]}),(0,d.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,d.jsx)("span",{children:"For the purpose of:"}),(0,d.jsx)("span",{className:"font-bold border-b border-dotted border-black w-3/4 text-left px-2",children:r.reason})]}),(0,d.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,d.jsx)("span",{children:"Amount in words:"}),(0,d.jsx)("span",{className:"font-bold border-b border-dotted border-black w-3/4 text-left px-2"})]}),(0,d.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,d.jsx)("span",{children:"Category:"}),(0,d.jsx)("span",{className:"font-bold border-b border-dotted border-black w-3/4 text-left px-2",children:r.category})]})]}),(0,d.jsx)("section",{className:"flex justify-end my-4",children:(0,d.jsxs)("div",{className:"border-2 border-black p-2 text-center",children:[(0,d.jsx)("p",{className:"text-xs font-semibold",children:"Amount"}),(0,d.jsxs)("p",{className:"text-lg font-bold",children:["Ksh ",r.amount.toFixed(2)]})]})}),(0,d.jsxs)("footer",{className:"mt-12 grid grid-cols-2 gap-8 text-sm",children:[(0,d.jsx)("div",{children:(0,d.jsxs)("div",{className:"border-t border-black pt-1",children:["Prepared by: ",(0,d.jsx)("span",{className:"font-semibold",children:r.cashierName})]})}),(0,d.jsx)("div",{children:(0,d.jsx)("div",{className:"border-t border-black pt-1",children:"Received by:"})}),(0,d.jsx)("div",{children:(0,d.jsx)("div",{className:"border-t border-black pt-1",children:"Authorized by:"})}),(0,d.jsx)("div",{children:(0,d.jsx)("div",{className:"border-t border-black pt-1",children:"Signature & Stamp"})})]})]})});var rS=e=>{let{expense:t,settings:r,onBack:a}=e,s=(0,o.useRef)(null),[n,l]=(0,o.useState)(!1),i=async()=>{if(s.current&&!n){l(!0);try{let e=await eD()(s.current,{scale:2,useCORS:!0}),r=e.toDataURL("image/png"),a=new eC.ZP("p","mm","a4"),d=a.internal.pageSize.getWidth(),o=e.height*d/e.width;a.addImage(r,"PNG",0,0,d,o),a.save("Expense_".concat(t.id,".pdf"))}catch(e){console.error("Failed to generate PDF:",e)}finally{l(!1)}}};return(0,d.jsx)("div",{className:"h-full bg-background dark:bg-dark-background p-4 md:p-8",children:(0,d.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center mb-6 no-print",children:[(0,d.jsx)("button",{onClick:a,className:"flex items-center text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:"← Back to Expenditures List"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("button",{onClick:()=>{window.print()},className:"bg-foreground/80 dark:bg-dark-border text-white font-semibold px-4 py-2 rounded-lg hover:bg-foreground dark:hover:bg-dark-border/80 text-sm",children:"Print Voucher"}),(0,d.jsx)("button",{onClick:i,disabled:n,className:"bg-primary text-primary-content font-semibold px-4 py-2 rounded-lg hover:bg-primary-focus text-sm disabled:bg-slate-400",children:n?"Downloading...":"Download PDF"})]})]}),t.receiptImageUrl&&(0,d.jsxs)("div",{className:"mb-6 no-print",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground mb-2",children:"Attached Receipt"}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg border border-border dark:border-dark-border",children:(0,d.jsx)("img",{src:t.receiptImageUrl,alt:"Expense Receipt",className:"max-w-full h-auto max-h-96 object-contain rounded-md"})})]}),(0,d.jsx)("div",{id:"pdf-content-wrapper",children:(0,d.jsx)(rC,{ref:s,expense:t,settings:r})})]})})},rD=e=>{var t,r,a,s;let{products:n,customers:l,settings:i,onAddLayaway:c,onBack:m,activeShift:u,initialCartItems:x}=e,h=!!x&&x.length>0,[p,b]=(0,o.useState)(x||[]),[g,f]=(0,o.useState)((null===(t=l.find(e=>"cust001"!==e.id))||void 0===t?void 0:t.id)||(null===(r=l[0])||void 0===r?void 0:r.id)),[k,y]=(0,o.useState)(""),[j,v]=(0,o.useState)("Cash"),[w,N]=(0,o.useState)(()=>{var e;let t=new Date;return t.setDate(t.getDate()+((null===(e=i.layaway)||void 0===e?void 0:e.maxDurationDays)||30)),t.toISOString().split("T")[0]}),[C,S]=(0,o.useState)(""),D=e=>{h||b(t=>t.filter(t=>t.id!==e))},P=(0,o.useMemo)(()=>p.reduce((e,t)=>e+t.price*t.quantity,0),[p]),T=null!==(s=null===(a=i.layaway)||void 0===a?void 0:a.minDepositPercentage)&&void 0!==s?s:20,I=T/100*P,A=async()=>{S("");let e=l.find(e=>e.id===g);if(!e||"cust001"===e.id){S("Please select a valid customer (not Walk-in).");return}if(0===p.length){S("Please add items to the layaway plan.");return}if(""===k||Number(k)<I){S("Deposit must be at least the minimum required of Ksh ".concat(I.toFixed(2),"."));return}if(!w){S("Please set a valid expiry date.");return}try{await c({customerId:e.id,customerName:e.name,items:p,total:P,deposit:Number(k),initialPayment:{amount:Number(k),method:j},status:"Active",createdDate:new Date,expiryDate:new Date(w)})}catch(e){}};return u?(0,d.jsxs)("div",{className:"h-full overflow-hidden ".concat(h?"flex justify-center":"grid grid-cols-1 md:grid-cols-[1fr_auto]"),children:[!h&&(0,d.jsx)("div",{className:"flex-1 p-4 overflow-y-auto",children:(0,d.jsx)(em,{products:n,onAddToCart:e=>{!h&&(e.stock<=0&&"Inventory"===e.productType||b(t=>{let r=t.find(t=>t.id===e.id);return r?r.quantity>=e.stock?t:t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}]}))},settings:i})}),(0,d.jsxs)("div",{className:"w-full ".concat(h?"max-w-xl":"md:w-96"," bg-card dark:bg-dark-card shadow-lg flex flex-col p-4 space-y-4 border-l border-border dark:border-dark-border"),children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:"New Layaway"}),(0,d.jsx)("button",{onClick:m,className:"text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:"← Back to POS"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Customer"}),(0,d.jsx)("div",{className:"mt-1",children:(0,d.jsx)(eu,{customers:l,selectedCustomerId:g,onCustomerChange:f,filter:e=>"cust001"!==e.id})})]}),(0,d.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-b border-border dark:border-dark-border py-2 space-y-2",children:[p.map(e=>(0,d.jsxs)("div",{className:"flex justify-between items-center py-1 group",children:[(0,d.jsxs)("div",{className:"text-sm",children:[(0,d.jsx)("p",{className:"font-semibold text-foreground dark:text-dark-foreground",children:e.name}),(0,d.jsxs)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:[e.quantity," x ",e.price.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"font-mono text-sm text-foreground dark:text-dark-foreground",children:(e.price*e.quantity).toFixed(2)}),!h&&(0,d.jsx)("button",{onClick:()=>D(e.id),className:"text-danger opacity-0 group-hover:opacity-100 transition-opacity",children:"\xd7"})]})]},e.id)),0===p.length&&(0,d.jsx)("p",{className:"text-center text-foreground-muted dark:text-dark-foreground-muted py-4",children:"Add products to start"})]}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,d.jsx)("span",{children:"Total"}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",P.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsxs)("span",{children:["Minimum Deposit (",T,"%)"]}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",I.toFixed(2)]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Deposit Paid"}),(0,d.jsx)("input",{type:"number",value:k,onChange:e=>y(""===e.target.value?"":Number(e.target.value)),className:"mt-1 w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-card",placeholder:I.toFixed(2)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Payment Method"}),(0,d.jsxs)("select",{value:j,onChange:e=>v(e.target.value),className:"mt-1 w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-card",children:[(0,d.jsx)("option",{children:"Cash"}),(0,d.jsx)("option",{children:"M-Pesa"}),(0,d.jsx)("option",{children:"Card"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Expiry Date"}),(0,d.jsx)("input",{type:"date",value:w,onChange:e=>N(e.target.value),className:"mt-1 w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-card"})]}),C&&(0,d.jsx)("p",{className:"text-danger text-sm text-center",children:C}),(0,d.jsx)("div",{className:"pt-2",children:(0,d.jsx)("button",{onClick:A,className:"w-full bg-primary text-primary-content font-bold py-3 rounded-lg hover:bg-primary-focus disabled:bg-slate-400",disabled:0===p.length,children:"Create Layaway"})})]})]}):(0,d.jsxs)("div",{className:"p-8 h-full flex flex-col items-center justify-center text-center",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Shift Not Active"}),(0,d.jsx)("p",{className:"mt-2 text-foreground-muted dark:text-dark-foreground-muted",children:"You must start a shift before you can create a layaway plan."}),(0,d.jsx)("button",{onClick:m,className:"mt-6 bg-primary text-primary-content font-bold py-2 px-6 rounded-lg",children:"Back to POS"})]})};let rP=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),rT=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01"})}),rI=()=>(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),rA=e=>{let{title:t,value:r,icon:a}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border flex items-center space-x-4",children:[(0,d.jsx)("div",{className:"p-3 rounded-lg bg-muted dark:bg-dark-muted text-primary dark:text-dark-primary",children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:r})]})]})},rM=e=>{let{status:t}=e,r="px-2 py-0.5 text-xs font-semibold rounded-full";switch(t){case"Active":return(0,d.jsx)("span",{className:"".concat(r," text-blue-800 bg-blue-100 dark:bg-blue-900/50 dark:text-blue-300"),children:"Active"});case"Completed":return(0,d.jsx)("span",{className:"".concat(r," text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300"),children:"Completed"});case"Defaulted":return(0,d.jsx)("span",{className:"".concat(r," text-red-800 bg-red-100 dark:bg-red-900/50 dark:text-red-300"),children:"Defaulted"});case"Cancelled":return(0,d.jsx)("span",{className:"".concat(r," text-slate-800 bg-slate-100 dark:bg-slate-700 dark:text-slate-300"),children:"Cancelled"});default:return(0,d.jsx)("span",{className:"".concat(r," text-slate-800 bg-slate-100"),children:"Unknown"})}};var rF=e=>{let{layaways:t,onSelectLayaway:r,onCreateRequest:a,onDeleteRequest:s}=e,{activePlans:n,totalOutstanding:l,completed:i}=(0,o.useMemo)(()=>{let e=t.filter(e=>"Active"===e.status);return{activePlans:e.length,totalOutstanding:e.reduce((e,t)=>e+t.balance,0),completed:t.filter(e=>"Completed"===e.status).length}},[t]),c=e=>"KES ".concat(e.toFixed(2));return(0,d.jsxs)("div",{className:"p-4 md:p-8",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Layaway Plans"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"Manage customer payment plans (All prices include VAT)"})]}),(0,d.jsx)("button",{onClick:a,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-md flex items-center",children:"+ Create Layaway"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,d.jsx)(rA,{title:"Active Plans",value:n,icon:(0,d.jsx)(rP,{})}),(0,d.jsx)(rA,{title:"Total Outstanding",value:c(l),icon:(0,d.jsx)(rT,{})}),(0,d.jsx)(rA,{title:"Completed",value:i,icon:(0,d.jsx)(rI,{})})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-hidden",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold p-4",children:"All Layaways"}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Layaway #"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Customer"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Total Amount"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Paid"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Balance"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Due Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Status"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),(0,d.jsxs)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:[t.map(e=>{let t=e.total-e.balance,a=e.total>0?t/e.total*100:0;return(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsx)("td",{className:"px-6 py-4 font-bold text-foreground dark:text-dark-foreground",children:e.id}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.customerName}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono",children:c(e.total)}),(0,d.jsxs)("td",{className:"px-6 py-4",children:[(0,d.jsx)("div",{className:"font-mono",children:c(t)}),(0,d.jsx)("div",{className:"w-full bg-slate-200 rounded-full h-1.5 dark:bg-slate-700 my-1",children:(0,d.jsx)("div",{className:"bg-green-500 h-1.5 rounded-full",style:{width:"".concat(a,"%")}})}),(0,d.jsxs)("div",{className:"text-right text-xs font-semibold text-green-500",children:[a.toFixed(0),"%"]})]}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono font-semibold text-danger",children:c(e.balance)}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.expiryDate).toLocaleDateString()}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)(rM,{status:e.status})}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("button",{onClick:()=>r(e),className:"p-1 hover:bg-border rounded-full",title:"View Details",children:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,d.jsx)("path",{fillRule:"evenodd",d:"M.458 10C3.732 4.943 9.522 3 10 3s6.268 1.943 9.542 7c-3.274 5.057-9.064 7-9.542 7S3.732 15.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})}),(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"p-1 hover:bg-border rounded-full",title:"Delete Layaway",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-danger",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]})})]},e.id)}),0===t.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:8,className:"text-center py-16 text-foreground-muted dark:text-dark-foreground-muted",children:(0,d.jsx)("p",{className:"font-semibold",children:"No layaway plans found."})})})]})]})})]})]})};let rL=e=>{let{status:t}=e,r="px-2.5 py-1 text-xs font-bold rounded-md";switch(t){case"Active":return(0,d.jsx)("span",{className:"".concat(r," text-blue-800 bg-blue-100 dark:bg-blue-900/50 dark:text-blue-300"),children:"Active"});case"Completed":return(0,d.jsx)("span",{className:"".concat(r," text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300"),children:"Completed"});case"Defaulted":return(0,d.jsx)("span",{className:"".concat(r," text-red-800 bg-red-100 dark:bg-red-900/50 dark:text-red-300"),children:"Defaulted"});case"Cancelled":return(0,d.jsx)("span",{className:"".concat(r," text-slate-800 bg-slate-100 dark:bg-slate-700 dark:text-slate-300"),children:"Cancelled"});default:return(0,d.jsx)("span",{className:"".concat(r," text-slate-800 bg-slate-100"),children:"Unknown"})}},rO=e=>{let{layaway:t,onAddPayment:r,onClose:a}=e,[s,n]=(0,o.useState)(""),[l,i]=(0,o.useState)("Cash");return(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"number"==typeof s&&s>0&&s<=t.balance&&(r(t.id,s,l),n(""),a())},className:"mt-4 p-4 bg-muted dark:bg-dark-muted rounded-lg space-y-3",children:[(0,d.jsx)("h4",{className:"font-semibold text-sm",children:"Record New Payment"}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("label",{className:"text-xs font-medium",children:["Amount (Max: ",t.balance.toFixed(2),")"]}),(0,d.jsx)("input",{type:"number",value:s,onChange:e=>n(""===e.target.value?"":parseFloat(e.target.value)),max:t.balance,min:"0.01",step:"0.01",required:!0,className:"w-full mt-1 p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs font-medium",children:"Method"}),(0,d.jsxs)("select",{value:l,onChange:e=>i(e.target.value),className:"w-full mt-1 p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background",children:[(0,d.jsx)("option",{children:"Cash"}),(0,d.jsx)("option",{children:"M-Pesa"}),(0,d.jsx)("option",{children:"Card"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,d.jsx)("button",{type:"button",onClick:a,className:"text-xs font-bold px-3 py-1.5 rounded-md hover:bg-border dark:hover:bg-dark-border",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",className:"text-xs font-bold px-3 py-1.5 bg-primary text-primary-content rounded-md",children:"Confirm Payment"})]})]})};var rR=e=>{let{layaway:t,sales:r,onBack:a,onAddPayment:s,onViewReceiptRequest:l,onUpdate:i}=e,[c,m]=(0,o.useState)(!1),[u,x]=(0,o.useState)(null),h=e=>"KES ".concat(e.toFixed(2)),p=t.total-t.balance,b=t.total>0?p/t.total*100:0;return(0,d.jsxs)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-40 p-4",onClick:a,children:[(0,d.jsx)(n.M,{children:u&&(0,d.jsx)(tR,{title:"".concat("cancel"===u?"Cancel":"Mark as Defaulted","?"),message:"Are you sure you want to ".concat(u," this layaway plan? This action cannot be undone."),onConfirm:()=>{"cancel"===u?i({...t,status:"Cancelled"}):"default"===u&&i({...t,status:"Defaulted"}),x(null)},onClose:()=>x(null),confirmText:"cancel"===u?"Cancel Plan":"Mark as Defaulted",isDestructive:!0})}),(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-card dark:bg-dark-card w-full max-w-2xl max-h-[90vh] rounded-2xl shadow-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("header",{className:"flex justify-between items-center p-4 border-b border-border dark:border-dark-border flex-shrink-0",children:[(0,d.jsx)("h2",{className:"text-lg font-bold",children:"Layaway Details"}),(0,d.jsx)("button",{onClick:a,className:"text-2xl",children:"\xd7"})]}),(0,d.jsxs)("main",{className:"p-6 overflow-y-auto space-y-6",children:[(0,d.jsxs)("section",{className:"grid grid-cols-2 gap-x-8 gap-y-4 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted",children:"Layaway Number:"}),(0,d.jsx)("br",{}),t.id]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted",children:"Customer:"}),(0,d.jsx)("br",{}),t.customerName]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted",children:"Start Date:"}),(0,d.jsx)("br",{}),new Date(t.createdDate).toLocaleDateString()]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted",children:"Due Date:"}),(0,d.jsx)("br",{}),new Date(t.expiryDate).toLocaleDateString()]}),(0,d.jsxs)("div",{className:"col-span-2",children:[(0,d.jsx)("strong",{className:"text-foreground-muted",children:"Status:"})," ",(0,d.jsx)(rL,{status:t.status})]})]}),(0,d.jsxs)("section",{children:[(0,d.jsx)("h3",{className:"font-semibold text-sm mb-2",children:"Payment Progress"}),(0,d.jsxs)("div",{className:"bg-muted dark:bg-dark-muted p-4 rounded-lg space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsxs)("span",{className:"font-semibold text-green-600",children:["Amount Paid: ",h(p)]}),(0,d.jsxs)("span",{className:"font-semibold text-danger",children:["Balance Due: ",h(t.balance)]})]}),(0,d.jsx)("div",{className:"w-full bg-slate-200 rounded-full h-2.5 dark:bg-slate-700",children:(0,d.jsx)("div",{className:"bg-green-500 h-2.5 rounded-full",style:{width:"".concat(b,"%")}})}),(0,d.jsxs)("div",{className:"text-right text-xs font-bold",children:[b.toFixed(0),"% Paid"]})]})]}),(0,d.jsx)("section",{children:(0,d.jsxs)("table",{className:"w-full text-sm",children:[(0,d.jsx)("thead",{className:"text-xs uppercase text-foreground-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"text-left font-semibold pb-2",children:"Product"}),(0,d.jsx)("th",{className:"text-center font-semibold pb-2",children:"Qty"}),(0,d.jsx)("th",{className:"text-right font-semibold pb-2",children:"Unit Price"}),(0,d.jsx)("th",{className:"text-right font-semibold pb-2",children:"Total"})]})}),(0,d.jsx)("tbody",{children:t.items.map(e=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-1",children:e.name}),(0,d.jsx)("td",{className:"text-center py-1",children:e.quantity}),(0,d.jsx)("td",{className:"text-right py-1 font-mono",children:e.price.toFixed(2)}),(0,d.jsx)("td",{className:"text-right py-1 font-mono",children:(e.price*e.quantity).toFixed(2)})]},e.id))}),(0,d.jsx)("tfoot",{className:"border-t-2 border-border dark:border-dark-border",children:(0,d.jsx)("tr",{children:(0,d.jsxs)("td",{colSpan:4,className:"text-right pt-2 font-bold text-base",children:["Total Amount: ",(0,d.jsx)("span",{className:"text-orange-500 font-mono",children:h(t.total)})]})})})]})}),(0,d.jsxs)("section",{children:[(0,d.jsx)("h3",{className:"font-semibold text-sm mb-2",children:"Payment History"}),(0,d.jsx)("div",{className:"border border-border dark:border-dark-border rounded-lg overflow-hidden",children:(0,d.jsxs)("table",{className:"w-full text-xs",children:[(0,d.jsx)("thead",{className:"bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"p-2 text-left font-semibold",children:"Date"}),(0,d.jsx)("th",{className:"p-2 text-right font-semibold",children:"Amount"}),(0,d.jsx)("th",{className:"p-2 text-left font-semibold",children:"Method"}),(0,d.jsx)("th",{className:"p-2 text-left font-semibold",children:"Notes"})]})}),(0,d.jsx)("tbody",{children:t.payments.map((e,t)=>(r.find(t=>t.id===e.saleId),(0,d.jsxs)("tr",{className:"border-t dark:border-dark-border",children:[(0,d.jsx)("td",{className:"p-2",children:new Date(e.date).toLocaleString()}),(0,d.jsx)("td",{className:"p-2 text-right font-mono",children:e.amount.toFixed(2)}),(0,d.jsx)("td",{className:"p-2",children:e.method}),(0,d.jsx)("td",{className:"p-2 italic",children:0===t?"Initial deposit":"Installment"})]},e.saleId)))})]})}),(0,d.jsx)(n.M,{children:c&&(0,d.jsx)(rO,{layaway:t,onAddPayment:s,onClose:()=>m(!1)})})]})]}),(0,d.jsx)("footer",{className:"flex justify-end items-center p-4 border-t border-border dark:border-dark-border gap-2 flex-shrink-0",children:"Active"===t.status&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{onClick:()=>m(!0),whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-4 py-2 rounded-lg text-sm flex items-center gap-2",children:[(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,d.jsx)("path",{d:"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.5 2.5 0 004.5 0V7.15c.22.071.412.164.567.267C15.346 8.046 16 9.233 16 10.5A2.5 2.5 0 0113.5 13h-7A2.5 2.5 0 014 10.5c0-1.267.654-2.454 1.567-3.082z"}),(0,d.jsx)("path",{d:"M10 4a3.5 3.5 0 00-3.5 3.5v.568c0 .416.22.8.568.983A3.504 3.504 0 0010 12a3.5 3.5 0 003.5-3.5V7.5A3.5 3.5 0 0010 4z"})]}),"Add Payment"]}),(0,d.jsx)("button",{onClick:()=>x("default"),whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted font-semibold px-4 py-2 rounded-lg text-sm",children:"Mark as Defaulted"}),(0,d.jsx)("button",{onClick:()=>x("cancel"),whileTap:{scale:.95},className:"bg-danger/80 text-white font-semibold px-4 py-2 rounded-lg text-sm",children:"Cancel Layaway"})]})})]})]})},rB=e=>{var t,r;let{products:a,customers:s,settings:n,onAddSalesOrder:l,onBack:i,activeShift:c}=e,[m,u]=(0,o.useState)((null===(t=s.find(e=>"cust001"!==e.id))||void 0===t?void 0:t.id)||(null===(r=s[0])||void 0===r?void 0:r.id)),[x,h]=(0,o.useState)([]),[p,b]=(0,o.useState)(""),[g,f]=(0,o.useState)(()=>{let e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]}),[k,y]=(0,o.useState)(""),[j,v]=(0,o.useState)(""),[w,N]=(0,o.useState)(""),[C,S]=(0,o.useState)(1),[D,P]=(0,o.useState)(""),[T,I]=(0,o.useState)(""),[A,M]=(0,o.useState)(""),F=(0,o.useMemo)(()=>T?a.filter(e=>e.name.toLowerCase().includes(T.toLowerCase())).slice(0,5):[],[T,a]),L=(0,o.useMemo)(()=>x.reduce((e,t)=>e+(t.unitPrice||0)*(t.quantity||0),0),[x]),O=e=>{h(t=>t.find(t=>t.productId===e.id)?t.map(t=>t.productId===e.id?{...t,quantity:(t.quantity||0)+1}:t):[...t,{id:crypto.randomUUID(),productId:e.id,description:e.name,quantity:1,unitPrice:e.price,pricingType:e.pricingType,status:"Pending",quantityReceived:0}]),I("")},R=(e,t,r)=>{h(a=>a.map(a=>{if(a.id===e){let e=r;return("quantity"===t||"unitPrice"===t)&&isNaN(e=parseFloat(r))&&(e=0),{...a,[t]:e}}return a}).filter(e=>"quantity"!==t||e.quantity>0))},B=e=>{h(t=>t.filter(t=>t.id!==e))},_=async e=>{M("");let t=s.find(e=>e.id===m);if(!t||"cust001"===t.id){M("Please select a valid customer (not Walk-in).");return}if(0===x.length){M("Please add at least one item to the sales order.");return}try{await l({customerId:t.id,customerName:t.name,items:x,total:L,deposit:Number(p)||0,status:e,createdDate:new Date,deliveryDate:g?new Date(g):void 0,shippingAddress:k,notes:j})}catch(e){console.error("Failed to save Sales Order from form:",e)}};return c?(0,d.jsx)("div",{className:"p-4 md:p-8 h-full overflow-y-auto bg-background dark:bg-dark-background flex justify-center",children:(0,d.jsxs)("div",{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-4xl bg-card dark:bg-dark-card p-8 rounded-xl shadow-xl space-y-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"New Sales Order"}),(0,d.jsx)("button",{type:"button",onClick:i,className:"text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:"← Back to POS"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Customer"}),(0,d.jsx)("div",{className:"mt-1",children:(0,d.jsx)(eu,{customers:s,selectedCustomerId:m,onCustomerChange:u,filter:e=>"cust001"!==e.id})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Expected Delivery Date"}),(0,d.jsx)("input",{type:"date",value:g,onChange:e=>f(e.target.value),className:"mt-1 w-full p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-background"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-foreground dark:text-dark-foreground border-b border-border dark:border-dark-border pb-2 mb-4",children:"Items"}),(0,d.jsxs)("div",{className:"relative mb-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Add Existing Product"}),(0,d.jsx)("input",{type:"text",value:T,onChange:e=>I(e.target.value),placeholder:"Type to search products...",className:"mt-1 block w-full px-3 py-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"}),F.length>0&&(0,d.jsx)("ul",{className:"absolute z-10 w-full bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-lg mt-1 max-h-60 overflow-y-auto",children:F.map(e=>(0,d.jsxs)("li",{onClick:()=>O(e),className:"px-4 py-2 hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",children:[e.name," - Ksh ",e.price.toFixed(2)]},e.id))})]}),(0,d.jsx)("div",{className:"space-y-2",children:x.map(e=>(0,d.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-muted dark:bg-dark-muted rounded",children:[(0,d.jsx)("input",{type:"text",value:e.description,onChange:t=>R(e.id,"description",t.target.value),className:"flex-grow p-1 border rounded-md bg-background dark:bg-dark-background border-border dark:border-dark-border",readOnly:!!e.productId}),(0,d.jsx)("input",{type:"number",value:e.quantity,onChange:t=>R(e.id,"quantity",t.target.value),className:"w-20 text-center p-1 border rounded-md bg-background dark:bg-dark-background border-border dark:border-dark-border",min:"1"}),(0,d.jsx)("input",{type:"number",value:e.unitPrice,onChange:t=>R(e.id,"unitPrice",t.target.value),className:"w-24 text-right p-1 border rounded-md bg-background dark:bg-dark-background border-border dark:border-dark-border",min:"0",step:"0.01"}),(0,d.jsx)("p",{className:"w-24 text-right font-mono",children:(e.unitPrice*e.quantity).toFixed(2)}),(0,d.jsx)("button",{type:"button",onClick:()=>B(e.id),className:"text-danger hover:text-red-700 font-bold text-lg",children:"\xd7"})]},e.id))}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),w&&C&&D&&(h(e=>[...e,{id:crypto.randomUUID(),description:w,quantity:Number(C),unitPrice:Number(D),pricingType:"inclusive",status:"Pending",quantityReceived:0}]),N(""),S(1),P(""))},className:"mt-4 grid grid-cols-12 gap-2 p-3 border border-border dark:border-dark-border rounded-lg",children:[(0,d.jsx)("input",{type:"text",value:w,onChange:e=>N(e.target.value),placeholder:"Or Add Custom Item Description",className:"col-span-6 p-2 border rounded-md bg-background dark:bg-dark-background border-border dark:border-dark-border",required:!0}),(0,d.jsx)("input",{type:"number",value:C,onChange:e=>S(""===e.target.value?"":Number(e.target.value)),placeholder:"Qty",className:"col-span-2 p-2 border rounded-md bg-background dark:bg-dark-background border-border dark:border-dark-border",required:!0,min:"1"}),(0,d.jsx)("input",{type:"number",value:D,onChange:e=>P(""===e.target.value?"":Number(e.target.value)),placeholder:"Unit Price",className:"col-span-2 p-2 border rounded-md bg-background dark:bg-dark-background border-border dark:border-dark-border",required:!0,min:"0",step:"0.01"}),(0,d.jsx)("button",{type:"submit",className:"col-span-2 bg-foreground/80 dark:bg-dark-border text-white dark:text-dark-foreground font-bold rounded-lg hover:bg-foreground dark:hover:bg-dark-border/80",children:"Add"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex justify-between font-bold text-lg mb-4",children:[(0,d.jsx)("span",{children:"Total"}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",L.toFixed(2)]})]}),(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Deposit Paid (Optional)"}),(0,d.jsx)("input",{type:"number",value:p,onChange:e=>b(""===e.target.value?"":Number(e.target.value)),className:"mt-1 w-full p-2 border border-border dark:border-dark-border rounded-md bg-background dark:bg-dark-background",placeholder:"0.00"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Notes / Shipping Address"}),(0,d.jsx)("textarea",{value:j,onChange:e=>v(e.target.value),rows:4,className:"mt-1 w-full p-2 border border-border dark:border-dark-border rounded-md bg-background dark:bg-dark-background"})]})]}),A&&(0,d.jsx)("p",{className:"text-danger text-sm text-center",children:A}),(0,d.jsxs)("div",{className:"pt-4 border-t border-border dark:border-dark-border flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:()=>_("Draft"),disabled:0===x.length,whileTap:{scale:.95},className:"bg-foreground/80 text-white font-semibold px-4 py-2 rounded-lg hover:bg-foreground dark:bg-dark-border dark:hover:bg-dark-border/80 disabled:bg-slate-400",children:"Save as Draft"}),(0,d.jsx)("button",{type:"button",onClick:()=>_("Pending"),disabled:0===x.length,whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-6 py-2 rounded-lg hover:bg-primary-focus shadow-md disabled:bg-slate-400",children:"Create Sales Order"})]})]})}):(0,d.jsxs)("div",{className:"p-8 h-full flex flex-col items-center justify-center text-center",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Shift Not Active"}),(0,d.jsx)("p",{className:"mt-2 text-foreground-muted dark:text-dark-foreground-muted",children:"You must start a shift before you can create a sales order."}),(0,d.jsx)("button",{onClick:i,className:"mt-6 bg-primary text-primary-content font-bold py-2 px-6 rounded-lg",children:"Back to POS"})]})};let r_=e=>{let{status:t}=e,r="px-2 py-1 text-xs font-semibold rounded-full";switch(t){case"Draft":return(0,d.jsx)("span",{className:"".concat(r," text-yellow-800 bg-yellow-100 dark:bg-yellow-900/50 dark:text-yellow-300"),children:"Draft"});case"Pending":return(0,d.jsx)("span",{className:"".concat(r," text-yellow-800 bg-yellow-100 dark:bg-yellow-900/50 dark:text-yellow-300"),children:"Pending"});case"Ordered":return(0,d.jsx)("span",{className:"".concat(r," text-indigo-800 bg-indigo-100 dark:bg-indigo-900/50 dark:text-indigo-300"),children:"Ordered"});case"Partially Received":return(0,d.jsx)("span",{className:"".concat(r," text-sky-800 bg-sky-100 dark:bg-sky-900/50 dark:text-sky-300"),children:"Partially Received"});case"Received":return(0,d.jsx)("span",{className:"".concat(r," text-blue-800 bg-blue-100 dark:bg-blue-900/50 dark:text-blue-300"),children:"Received"});case"Completed":return(0,d.jsx)("span",{className:"".concat(r," text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300"),children:"Completed"});case"Cancelled":return(0,d.jsx)("span",{className:"".concat(r," text-red-800 bg-red-100 dark:bg-red-900/50 dark:text-red-300"),children:"Cancelled"});default:return(0,d.jsx)("span",{className:"".concat(r," text-slate-800 bg-slate-100 dark:bg-slate-700 dark:text-slate-300"),children:"Unknown"})}},rE=e=>{let{salesOrder:t,onCancel:r,onCreatePO:a,onPushToPOS:s,onView:l}=e,[i,c]=(0,o.useState)(!1),m=(0,o.useRef)(null),u="Pending"===t.status&&t.items.some(e=>"Pending"===e.status),x="Received"===t.status,h="Pending"===t.status||"Ordered"===t.status;return(0,o.useEffect)(()=>{function e(e){m.current&&!m.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[m]),(0,d.jsxs)("div",{className:"relative",ref:m,children:[(0,d.jsx)("button",{onClick:e=>{e.stopPropagation(),c(!i)},className:"px-2 py-1 rounded-md hover:bg-muted dark:hover:bg-dark-muted",children:"•••"}),(0,d.jsx)(n.M,{children:i&&(0,d.jsx)("div",{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.1},className:"absolute right-0 mt-2 w-48 bg-card dark:bg-dark-card rounded-md shadow-lg z-10 border border-border dark:border-dark-border",children:(0,d.jsxs)("ul",{className:"py-1 text-sm text-foreground dark:text-dark-foreground",children:[(0,d.jsx)("li",{children:(0,d.jsx)("button",{onClick:()=>{l(),c(!1)},className:"w-full text-left px-4 py-2 hover:bg-muted dark:hover:bg-dark-muted",children:"View Details"})}),u&&(0,d.jsx)("li",{children:(0,d.jsx)("button",{onClick:()=>{a(),c(!1)},className:"w-full text-left px-4 py-2 hover:bg-muted dark:hover:bg-dark-muted",children:"Create Purchase Order"})}),x&&(0,d.jsx)("li",{children:(0,d.jsx)("button",{onClick:()=>{s(),c(!1)},className:"w-full text-left px-4 py-2 hover:bg-muted dark:hover:bg-dark-muted",children:"Push to POS"})}),h&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"my-1 border-t border-border dark:border-dark-border"}),(0,d.jsx)("li",{children:(0,d.jsx)("button",{onClick:()=>{r(),c(!1)},className:"w-full text-left px-4 py-2 text-danger hover:bg-danger/10",children:"Cancel Order"})})]})]})})})]})};var rq=e=>{let{salesOrders:t,onViewSalesOrder:r,onCancelRequest:a,onCreatePORequest:s,onPushToPOSRequest:o,onCreateRequest:n}=e;return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Sales Order List"}),(0,d.jsxs)("button",{onClick:n,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-xl transition-shadow shadow-clay dark:shadow-clay-dark active:shadow-clay-inset dark:active:shadow-clay-dark-inset flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Sales Order"]})]}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Order #"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Customer"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Status"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Date Created"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Balance Due"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:(0,d.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,d.jsx)("tbody",{children:0===t.length?(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:6,className:"text-center py-16 text-foreground-muted dark:text-dark-foreground-muted",children:(0,d.jsxs)("div",{className:"flex flex-col items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-foreground-muted dark:text-dark-foreground-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),(0,d.jsx)("p",{className:"mt-2 font-semibold",children:"No sales orders found."}),(0,d.jsx)("p",{className:"text-sm",children:"Create a new sales order to get started."})]})})}):t.map(e=>(0,d.jsxs)("tr",{className:"bg-card dark:bg-dark-card border-b dark:border-dark-border hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>r(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-bold text-foreground dark:text-dark-foreground",children:e.id}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.customerName}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)(r_,{status:e.status})}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.createdDate).toLocaleDateString()}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono font-semibold text-danger",children:e.balance.toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right",children:(0,d.jsx)(rE,{salesOrder:e,onView:()=>r(e),onCancel:()=>a(e),onCreatePO:()=>s(e),onPushToPOS:()=>o(e)})})]},e.id))})]})})]})};let rV=e=>{switch(e){case"Ordered":case"Partially Received":case"Received":return"ORDERED";case"Completed":return"COMPLETED";case"Cancelled":return"CANCELLED";default:return null}},rH=e=>{let{text:t}=e;return(0,d.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",color:"rgba(0, 0, 0, 0.08)",fontSize:"8rem",fontWeight:"bold",textTransform:"uppercase",zIndex:0,pointerEvents:"none",userSelect:"none",whiteSpace:"nowrap"},children:t})},rU=o.forwardRef((e,t)=>{let{salesOrder:r,settings:a}=e,s=rV(r.status);return(0,d.jsxs)("div",{ref:t,className:"relative bg-white p-8 font-sans text-sm text-black w-full max-w-4xl mx-auto shadow-lg border",children:[s&&(0,d.jsx)(rH,{text:s}),(0,d.jsxs)("div",{className:"relative z-10",children:[(0,d.jsxs)("header",{className:"flex justify-between items-start pb-4 border-b",children:[(0,d.jsxs)("div",{children:[a.businessInfo.logoUrl&&(0,d.jsx)("img",{src:a.businessInfo.logoUrl,alt:"Company Logo",className:"h-16 max-w-xs object-contain mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:a.businessInfo.name}),(0,d.jsx)("p",{className:"text-slate-600",children:a.businessInfo.location}),(0,d.jsxs)("p",{className:"text-slate-600",children:["Tel: ",a.businessInfo.phone]})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold uppercase text-slate-700 tracking-wide",children:"Sales Order"}),(0,d.jsxs)("div",{className:"mt-2 text-xs",children:[(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Order #:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:r.id})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Date:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(r.createdDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Delivery By:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:r.deliveryDate?new Date(r.deliveryDate).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"}):"N/A"})]})]})]})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Customer"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:r.customerName})]}),(0,d.jsx)("section",{className:"mt-8",children:(0,d.jsxs)("table",{className:"w-full text-left",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-slate-100 text-slate-600 uppercase text-xs",children:[(0,d.jsx)("th",{className:"p-3 font-semibold",children:"Item Description"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-center",children:"Qty"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Unit Price"}),(0,d.jsx)("th",{className:"p-3 font-semibold text-right",children:"Total"})]})}),(0,d.jsx)("tbody",{children:r.items.map(e=>(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-3",children:e.description}),(0,d.jsx)("td",{className:"p-3 text-center",children:e.quantity}),(0,d.jsx)("td",{className:"p-3 text-right font-mono",children:e.unitPrice.toFixed(2)}),(0,d.jsx)("td",{className:"p-3 text-right font-mono font-semibold",children:(e.unitPrice*e.quantity).toFixed(2)})]},e.id))})]})}),(0,d.jsx)("section",{className:"flex justify-end mt-8",children:(0,d.jsxs)("div",{className:"w-full max-w-xs space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,d.jsx)("span",{className:"text-slate-800",children:"Total"}),(0,d.jsxs)("span",{className:"font-mono text-slate-800",children:["Ksh ",r.total.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Deposit Paid"}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:r.deposit.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2 mt-2 text-red-600",children:[(0,d.jsx)("span",{children:"Balance Due"}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",r.balance.toFixed(2)]})]})]})}),(0,d.jsx)("footer",{className:"mt-16 pt-4 border-t text-xs text-slate-500 text-center",children:(0,d.jsx)("p",{children:"Thank you for your order!"})})]})]})}),rW=e=>{let{balanceDue:t,onClose:r,onConfirm:a}=e,[s,n]=(0,o.useState)(t.toString()),[l,i]=(0,o.useState)("Cash"),c=(0,o.useMemo)(()=>"Cash"!==l||""===s?0:Math.max(0,Number(s)-t),[s,t,l]),m=(0,o.useMemo)(()=>"Cash"!==l||Number(s)>=t,[s,t,l]);return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:r,children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-md p-6",onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:"Complete Payment"}),(0,d.jsxs)("p",{className:"text-2xl font-bold text-primary dark:text-dark-primary mt-2",children:["Balance Due: Ksh ",t.toFixed(2)]}),(0,d.jsxs)("div",{className:"my-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground mb-2",children:"Payment Method"}),(0,d.jsx)("div",{className:"flex bg-muted dark:bg-dark-muted p-1 rounded-lg",children:["Cash","M-Pesa","Card"].map(e=>(0,d.jsx)("button",{onClick:()=>i(e),className:"w-1/3 py-2 text-sm font-bold transition-colors rounded-md ".concat(l===e?"bg-card dark:bg-dark-card shadow text-primary dark:text-dark-primary":"text-foreground-muted dark:text-dark-foreground-muted"),children:e},e))})]}),"Cash"===l&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"cash-received",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Cash Received"}),(0,d.jsx)("input",{type:"number",id:"cash-received",value:s,onChange:e=>n(e.target.value),className:"mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm",autoFocus:!0}),c>0&&(0,d.jsxs)("p",{className:"mt-2 text-primary font-semibold",children:["Change: Ksh ",c.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-bold bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground rounded-md hover:bg-border dark:hover:bg-dark-border",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{let e=[];"Cash"===l?e.push({method:"Cash",amount:Number(s)}):e.push({method:l,amount:t}),a(e)},disabled:!m,className:"px-4 py-2 text-sm font-bold text-white bg-primary rounded-md hover:bg-primary-focus disabled:bg-slate-400",children:"Confirm Payment"})]})]})})},rZ=e=>{switch(e){case"Pending":default:return 0;case"Ordered":return 1;case"Partially Received":return 2;case"Received":return 3;case"Completed":return 4;case"Draft":case"Cancelled":return -1}},rz=e=>{let{currentStatus:t}=e,r=["Pending","Ordered","Receiving","Received","Completed"],a=rZ(t);return"Cancelled"===t||"Draft"===t?(0,d.jsx)("div",{className:"text-center p-4 bg-muted dark:bg-dark-muted/50 rounded-md",children:(0,d.jsxs)("p",{className:"font-bold ".concat("Cancelled"===t?"text-danger":"text-foreground-muted dark:text-dark-foreground-muted"),children:["Order ",t]})}):(0,d.jsx)("div",{className:"flex items-center w-full",children:r.map((e,t)=>{let s=t<a,n=t===a;return(0,d.jsxs)(o.Fragment,{children:[(0,d.jsxs)("div",{className:"flex flex-col items-center text-center flex-shrink-0 w-24",children:[(0,d.jsx)("div",{animate:{scale:n?1.1:1},transition:{type:"spring",stiffness:300},className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold transition-colors duration-300\n                                    ".concat(s?"bg-success":n?"bg-primary animate-pulse":"bg-muted dark:bg-dark-muted"),children:s?"✓":t+1}),(0,d.jsx)("p",{className:"mt-2 text-xs font-semibold transition-colors duration-300\n                                ".concat(n?"text-primary dark:text-dark-primary":s?"text-foreground dark:text-dark-foreground":"text-foreground-muted dark:text-dark-foreground-muted"),children:e})]}),t<r.length-1&&(0,d.jsx)("div",{className:"flex-grow h-1 transition-colors duration-300 ".concat(s?"bg-success":"bg-muted dark:bg-dark-muted")})]},e)})})},rK=e=>Promise.all(Array.from(e.getElementsByTagName("img")).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>t(),e.onerror=()=>{console.warn("Could not load image for PDF generation: ".concat(e.src)),t()})})));var rG=e=>{let{salesOrder:t,onBack:r,onCreatePO:a,onCancelRequest:s,onUpdate:l,settings:i,onDirectComplete:c,sales:m,currentUser:u,onWhatsAppReceiptRequest:x,showToast:h}=e,[p,b]=(0,o.useState)("Draft"===t.status),[g,f]=(0,o.useState)(t),k=(0,o.useRef)(null),[y,j]=(0,o.useState)(!1),[v,w]=(0,o.useState)(!1),[N,C]=(0,o.useState)(null),S=(0,o.useMemo)(()=>"Completed"!==t.status?null:m.find(e=>e.salesOrderId===t.id&&!e.items.some(e=>e.id.startsWith("SO_DEPOSIT"))),[m,t]);(0,o.useEffect)(()=>{f(t),"Draft"===t.status&&b(!0)},[t]);let D=async e=>{w(!1);try{let r=await c(t,e);C(r)}catch(e){console.error("Failed to complete sales order:",e)}},P=async()=>{if(k.current&&!y){j(!0);try{await rK(k.current);let e=await eD()(k.current,{scale:2,useCORS:!0}),r=e.toDataURL("image/png"),a=new eC.ZP("p","mm","a4"),s=a.internal.pageSize.getWidth(),d=e.height*s/e.width;a.addImage(r,"PNG",0,0,s,d),a.save("SalesOrder_".concat(t.id,".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF. The logo might be causing an issue.")}finally{j(!1)}}},T="Pending"===t.status&&t.items.some(e=>"Pending"===e.status),I="Received"===t.status&&t.balance>0,A=["Draft","Pending","Ordered"].includes(t.status),M="Draft"===t.status;return N?(0,d.jsx)(ev,{sale:N,onNewSale:()=>{C(null),S||r()},currentUser:u,settings:i,onWhatsAppReceiptRequest:(e,t)=>x("Receipt",e,t),shouldAutoPrint:!0,showToast:h}):(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto bg-muted dark:bg-dark-muted",children:[(0,d.jsx)("div",{className:"hidden",children:(0,d.jsx)("div",{id:"pdf-content-wrapper",children:(0,d.jsx)(rU,{ref:k,salesOrder:t,settings:i})})}),(0,d.jsx)(n.M,{children:v&&(0,d.jsx)(rW,{balanceDue:t.balance,onClose:()=>w(!1),onConfirm:D})}),(0,d.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Sales Order Details"}),(0,d.jsx)("p",{className:"font-mono text-foreground-muted dark:text-dark-foreground-muted",children:t.id})]}),(0,d.jsx)("button",{onClick:r,className:"text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:"← Back to List"})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold mb-4 text-foreground dark:text-dark-foreground",children:"Order Progress"}),(0,d.jsx)(rz,{currentStatus:t.status})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{className:"lg:col-span-2 bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground mb-4 border-b dark:border-dark-border pb-2",children:"Ordered Items"}),(0,d.jsx)("ul",{className:"divide-y dark:divide-dark-border max-h-96 overflow-y-auto",children:t.items.map(e=>(0,d.jsxs)("li",{className:"p-3 flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-bold text-foreground dark:text-dark-foreground",children:e.description}),(0,d.jsxs)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:[e.quantity," x Ksh ",e.unitPrice.toFixed(2),"Pending"!==e.status&&" | Received: ".concat(e.quantityReceived||0,"/").concat(e.quantity)]})]}),(0,d.jsx)("div",{children:(0,d.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat("Received"===e.status?"bg-success/20 text-success":"Ordered"===e.status?"bg-indigo-500/20 text-indigo-500":"Partially Received"===e.status?"bg-sky-500/20 text-sky-500":"bg-warning/20 text-warning"),children:e.status})})]},e.id))})]}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground",children:"Order Information"}),!p&&("Pending"===t.status||"Draft"===t.status)&&(0,d.jsx)("button",{onClick:()=>b(!0),className:"text-sm font-bold text-primary dark:text-dark-primary hover:underline",children:"Edit"})]}),p?(0,d.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Customer:"})," ",(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:g.customerName})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Date:"})," ",(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:new Date(g.createdDate).toLocaleDateString()})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"deliveryDate",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Delivery By:"}),(0,d.jsx)("input",{type:"date",id:"deliveryDate",name:"deliveryDate",value:(e=>{if(!e)return"";try{return new Date(e).toISOString().split("T")[0]}catch(e){return""}})(g.deliveryDate),onChange:e=>{let{name:t,value:r}=e.target;f(e=>({...e,[t]:r?new Date(r):void 0}))},className:"mt-1 block w-full p-2 border border-border dark:border-dark-border rounded-md bg-background dark:bg-dark-background text-foreground dark:text-dark-foreground"})]}),(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Notes/Address:"}),(0,d.jsx)("textarea",{id:"notes",name:"notes",value:g.notes||"",onChange:e=>{let{name:t,value:r}=e.target;f(e=>({...e,[t]:r}))},rows:3,className:"mt-1 block w-full p-2 border border-border dark:border-dark-border rounded-md bg-background dark:bg-dark-background text-foreground dark:text-dark-foreground"})]})]}):(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Customer:"})," ",(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:t.customerName})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Date:"})," ",(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:new Date(t.createdDate).toLocaleDateString()})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Delivery By:"})," ",(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:t.deliveryDate?new Date(t.deliveryDate).toLocaleDateString():"N/A"})]}),(0,d.jsxs)("div",{className:"mt-4 pt-4 border-t dark:border-dark-border",children:[(0,d.jsx)("strong",{className:"text-foreground-muted dark:text-dark-foreground-muted text-sm",children:"Notes/Address:"}),(0,d.jsx)("p",{className:"text-sm p-2 bg-muted dark:bg-dark-muted/50 rounded mt-1 whitespace-pre-wrap",children:t.notes||"No notes provided."})]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Total"}),(0,d.jsx)("span",{className:"font-mono font-semibold",children:"Ksh ".concat(t.total.toFixed(2))})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Deposit Paid"}),(0,d.jsx)("span",{className:"font-mono font-semibold",children:"Ksh ".concat(t.deposit.toFixed(2))})]}),(0,d.jsxs)("div",{className:"flex justify-between font-bold text-lg text-danger pt-2 border-t dark:border-dark-border",children:[(0,d.jsx)("span",{children:"Balance Due"}),(0,d.jsx)("span",{className:"font-mono",children:"Ksh ".concat(t.balance.toFixed(2))})]})]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md flex justify-end items-center gap-4",children:[(0,d.jsxs)("div",{className:"flex-grow text-sm text-foreground-muted dark:text-dark-foreground-muted",children:[M&&(0,d.jsx)("p",{children:"This is a draft. Finalize to make it a pending order."}),T&&(0,d.jsx)("p",{children:"To be delivered. Create a Purchase Order for required items."}),I&&(0,d.jsx)("p",{children:"Ready for delivery. Complete sale to create an invoice and clear the balance."}),"Completed"===t.status&&(0,d.jsx)("p",{children:"This order is complete."})]}),p?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:()=>{f(t),b(!1)},whileTap:{scale:.95},className:"bg-muted text-foreground dark:bg-dark-muted dark:text-dark-foreground font-bold py-2 px-4 rounded-lg hover:bg-border dark:hover:bg-dark-border text-sm",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{l(g),b(!1)},whileTap:{scale:.95},className:"bg-success text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 text-sm",children:"Save Changes"})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:P,disabled:y,whileTap:{scale:.95},className:"bg-secondary text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-700 text-sm disabled:bg-slate-400",children:y?"Downloading...":"Download PDF"}),A&&(0,d.jsx)("button",{onClick:()=>s(t),whileTap:{scale:.95},className:"bg-danger text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 text-sm",children:"Cancel Order"}),M&&(0,d.jsx)("button",{onClick:()=>{l({...g,status:"Pending"}),b(!1)},whileTap:{scale:.95},className:"bg-success text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 text-sm",children:"Finalize Order"}),T&&(0,d.jsx)("button",{onClick:()=>a(t),whileTap:{scale:.95},className:"bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm",children:"Create PO"}),I&&(0,d.jsx)("button",{onClick:()=>w(!0),whileTap:{scale:.95},className:"bg-success text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 text-sm",children:"Complete Sale"}),S&&(0,d.jsx)("button",{onClick:()=>C(S),whileTap:{scale:.95},className:"bg-muted text-foreground dark:bg-dark-muted dark:text-dark-foreground font-bold py-2 px-4 rounded-lg hover:bg-border dark:hover:bg-dark-border text-sm",children:"Reprint Receipt"})]})]})]})]})},rQ=e=>{let{onConfirm:t,onClose:r}=e,[a,s]=(0,o.useState)("");return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-md p-6",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:"Hold Current Sale"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Enter an optional name to easily identify this sale later."}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(a)},className:"mt-4 space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"hold-name",className:"sr-only",children:"Hold Name"}),(0,d.jsx)("input",{type:"text",id:"hold-name",value:a,onChange:e=>s(e.target.value),placeholder:"e.g., Held at ".concat(new Date().toLocaleTimeString()),className:"block w-full px-3 py-2 bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm",autoFocus:!0})]}),(0,d.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:r,whileTap:{scale:.95},className:"px-4 py-2 text-sm font-bold bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground rounded-md hover:bg-border dark:hover:bg-dark-border",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.95},className:"px-4 py-2 text-sm font-bold text-white bg-primary rounded-md hover:bg-primary-focus",children:"Hold Sale"})]})]})]})})},rY=e=>{let{heldReceipts:t,onRecallReceipt:r,onDeleteReceiptRequest:a}=e,s=e=>e.reduce((e,t)=>e+t.price*t.quantity,0);return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsx)("h1",{className:"text-4xl font-bold text-foreground dark:text-dark-foreground mb-6",children:"Held Receipts"}),0===t.length?(0,d.jsx)("div",{className:"text-center py-10 text-foreground-muted dark:text-dark-foreground-muted",children:(0,d.jsx)("p",{children:"There are no held receipts."})}):(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map(e=>(0,d.jsxs)("div",{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-card dark:bg-dark-card rounded-lg shadow-md flex flex-col border border-border dark:border-dark-border",children:[(0,d.jsxs)("div",{className:"p-4 border-b border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground truncate",children:e.name}),(0,d.jsxs)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:["Held by ",e.cashierName," at ",new Date(e.heldAt).toLocaleTimeString()]})]}),(0,d.jsxs)("div",{className:"p-4 flex-grow",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Items"}),(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:e.items.reduce((e,t)=>e+t.quantity,0)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm mt-1",children:[(0,d.jsx)("span",{className:"text-foreground-muted dark:text-dark-foreground-muted",children:"Total"}),(0,d.jsxs)("span",{className:"font-semibold font-mono text-foreground dark:text-dark-foreground",children:["Ksh ",s(e.items).toFixed(2)]})]})]}),(0,d.jsxs)("div",{className:"p-2 bg-muted dark:bg-dark-muted/50 flex justify-end gap-2 rounded-b-lg",children:[(0,d.jsx)("button",{onClick:()=>a(e),className:"px-3 py-1 text-sm font-semibold text-danger bg-danger/10 hover:bg-danger/20 rounded-md",children:"Delete"}),(0,d.jsx)("button",{onClick:()=>r(e),className:"px-3 py-1 text-sm font-semibold text-primary-content bg-primary hover:bg-primary-focus rounded-md",children:"Recall"})]})]},e.id))})]})};let rX=e=>{let{title:t,value:r,onClick:a,isActive:s,children:o}=e;return(0,d.jsxs)("div",{onClick:a,className:"p-4 rounded-xl shadow-sm border border-border dark:border-dark-border flex items-center space-x-3 cursor-pointer transition-all duration-200 ".concat(s?"bg-primary dark:bg-dark-primary text-primary-content dark:text-dark-primary-content":"bg-card dark:bg-dark-card hover:bg-muted dark:hover:bg-dark-muted"),whileHover:{y:-3,scale:1.02},children:[(0,d.jsx)("div",{className:"p-3 rounded-full ".concat(s?"bg-white/20 text-white":"bg-primary/10 text-primary dark:bg-dark-primary/20 dark:text-dark-primary"),children:o}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-semibold ".concat(s?"text-white/80 dark:text-dark-primary-content/80":"text-foreground-muted dark:text-dark-foreground-muted"),children:t}),(0,d.jsx)("p",{className:"text-2xl font-bold ".concat(s?"text-white dark:text-dark-primary-content":"text-foreground dark:text-dark-foreground"),children:r})]})]})},rJ=(e,t)=>{let r=["date","saleId","method","amount","cashierName"],a=new Blob([[r.join(","),...e.map(e=>r.map(t=>{let r=e[t];return"date"===t&&r instanceof Date?r.toISOString():"string"==typeof r&&r.includes(",")?'"'.concat(r,'"'):r}).join(","))].join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(a),d=document.createElement("a");d.setAttribute("hidden",""),d.setAttribute("href",s),d.setAttribute("download",t),document.body.appendChild(d),d.click(),document.body.removeChild(d)};var r$=e=>{let{sales:t}=e,[r,a]=(0,o.useState)(""),[s,n]=(0,o.useState)(""),[l,i]=(0,o.useState)("All"),[c,m]=(0,o.useState)(1),u=(0,o.useMemo)(()=>t.flatMap(e=>e.payments.map(t=>({...t,saleId:e.id,date:new Date(e.date),cashierName:e.cashierName}))).sort((e,t)=>t.date.getTime()-e.date.getTime()),[t]),x=(0,o.useMemo)(()=>{let e=r?new Date(r):null;e&&e.setHours(0,0,0,0);let t=s?new Date(s):null;return t&&t.setHours(23,59,59,999),u.filter(r=>(!e||!(r.date<e))&&(!t||!(r.date>t)))},[u,r,s]),h=(0,o.useMemo)(()=>x.reduce((e,t)=>(e.All=(e.All||0)+t.amount,e[t.method]=(e[t.method]||0)+t.amount,e),{}),[x]),p=(0,o.useMemo)(()=>(m(1),"All"===l)?x:x.filter(e=>e.method===l),[x,l]),b=(0,o.useMemo)(()=>{let e=(c-1)*20;return p.slice(e,e+20)},[p,c]),g=Math.ceil(p.length/20),f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"Ksh ".concat(e.toFixed(2))};return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsx)("h1",{className:"text-4xl font-bold text-foreground dark:text-dark-foreground",children:"Payment Summary"}),(0,d.jsxs)("div",{className:"my-6 p-4 bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsx)("input",{type:"date",value:r,onChange:e=>a(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-background"}),(0,d.jsx)("input",{type:"date",value:s,onChange:e=>n(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-background"}),(0,d.jsxs)("button",{onClick:()=>rJ(p,"payment_summary_".concat(r,"_").concat(s,".csv")),className:"bg-foreground/80 dark:bg-dark-border text-white font-bold px-4 py-2 rounded-lg hover:bg-foreground dark:hover:bg-dark-border/80 transition-colors shadow-md flex items-center justify-center text-sm",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export to CSV"]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6",children:[(0,d.jsx)(rX,{title:"Total Payments",value:f(h.All),onClick:()=>i("All"),isActive:"All"===l,children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,d.jsx)(rX,{title:"Cash",value:f(h.Cash),onClick:()=>i("Cash"),isActive:"Cash"===l,children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.121 15.536c-1.171 1.952-3.07 1.952-4.242 0-1.172-1.953-1.172-5.119 0-7.072 1.171-1.952 3.07-1.952 4.242 0 1.172 1.953 1.172 5.119 0 7.072z"})})}),(0,d.jsx)(rX,{title:"M-Pesa",value:f(h["M-Pesa"]),onClick:()=>i("M-Pesa"),isActive:"M-Pesa"===l,children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),(0,d.jsx)(rX,{title:"Card",value:f(h.Card),onClick:()=>i("Card"),isActive:"Card"===l,children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),(0,d.jsx)(rX,{title:"Points",value:f(h.Points),onClick:()=>i("Points"),isActive:"Points"===l,children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border overflow-x-auto",children:[(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-bold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Receipt ID"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Method"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Cashier"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Amount"})]})}),(0,d.jsxs)("tbody",{children:[b.map((e,t)=>(0,d.jsxs)("tr",{className:"border-b dark:border-dark-border hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsx)("td",{className:"px-6 py-4",children:e.date.toLocaleString("en-GB",{timeZone:"Africa/Nairobi"})}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono text-xs",children:e.saleId}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("span",{className:"font-semibold",children:e.method})}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.cashierName}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono font-semibold",children:f(e.amount)})]},"".concat(e.saleId,"-").concat(t))),0===p.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:5,className:"text-center py-10 text-foreground-muted dark:text-dark-foreground-muted",children:"No transactions found for the selected criteria."})})]})]}),g>1&&(0,d.jsxs)("div",{className:"flex justify-between items-center p-4 text-sm border-t border-border dark:border-dark-border",children:[(0,d.jsx)("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:1===c,className:"px-3 py-1 border rounded-md disabled:opacity-50 dark:border-dark-border",children:"Previous"}),(0,d.jsxs)("span",{children:["Page ",c," of ",g]}),(0,d.jsx)("button",{onClick:()=>m(e=>Math.min(g,e+1)),disabled:c===g,className:"px-3 py-1 border rounded-md disabled:opacity-50 dark:border-dark-border",children:"Next"})]})]})]})},r0=e=>{let{currentUser:t,onUnlock:r,onForceLogout:a}=e,[s,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)(0);(0,o.useEffect)(()=>{4===s.length&&x()},[s]);let x=()=>{s===t.pin?r():(c("Incorrect PIN. Please try again."),u(e=>e+1),setTimeout(()=>{l(""),c("")},1e3))},h=e=>{s.length<4&&l(t=>t+e)},p=()=>{l(e=>e.slice(0,-1))};return(0,d.jsx)("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-md flex flex-col items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{className:"w-full max-w-sm text-center",children:[(0,d.jsx)("div",{className:"w-20 h-20 rounded-full bg-primary text-primary-content flex items-center justify-center font-bold text-3xl mx-auto mb-4 border-4 border-white/20",children:(0,d.jsx)("span",{children:t.name.charAt(0)})}),(0,d.jsxs)("h1",{className:"text-2xl font-bold text-white",children:["Welcome Back, ",t.name]}),(0,d.jsx)("p",{className:"text-slate-300 mt-2",children:"Enter your 4-digit PIN to unlock."}),(0,d.jsx)("div",{className:"my-8",children:(0,d.jsx)(()=>(0,d.jsx)("div",{className:"flex justify-center space-x-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,d.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat(t<s.length?"bg-green-400 border-green-400":"bg-transparent border-slate-400")},t))}),{})}),(0,d.jsxs)(n.M,{children:[i&&(0,d.jsx)("p",{className:"text-red-400 font-semibold mb-4 h-5",children:i}),!i&&(0,d.jsx)("div",{className:"h-5 mb-4"})]}),(0,d.jsx)("div",{className:"max-w-xs mx-auto",children:(0,d.jsx)(()=>(0,d.jsx)("div",{className:"grid grid-cols-3 gap-4",children:["1","2","3","4","5","6","7","8","9","","0","⌫"].map((e,t)=>(0,d.jsx)("button",{onClick:()=>"⌫"===e?p():e?h(e):null,className:"p-4 bg-white/10 backdrop-blur-sm text-white rounded-full text-2xl font-bold enabled:hover:bg-white/20 disabled:opacity-0 transition-colors",disabled:!e,children:e},t))}),{})}),(0,d.jsx)("div",{className:"mt-8",children:(0,d.jsx)("button",{onClick:a,className:"text-sm font-medium text-primary hover:text-dark-primary-focus",children:"Not you? Logout"})})]})})},r2=r(40257);let r1=e=>{let{salesOrder:t,customerPhone:r,onStartNew:a}=e,s="Hello ".concat(t.customerName,", your order *#").concat(t.id,"* has been confirmed! Total is Ksh ").concat(t.total.toFixed(2),". We will notify you when it's ready for collection/delivery. Thank you!"),o="https://wa.me/".concat(r,"?text=").concat(encodeURIComponent(s));return(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mx-auto bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 w-24 h-24 rounded-full flex items-center justify-center mb-6",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Sales Order Created!"}),(0,d.jsxs)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2",children:["Sales Order ",(0,d.jsx)("span",{className:"font-bold text-foreground dark:text-dark-foreground",children:t.id})," has been successfully created for ",t.customerName,"."]}),(0,d.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row justify-center gap-4",children:[(0,d.jsxs)("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"bg-[#25D366] text-white font-bold py-3 px-6 rounded-lg hover:bg-[#1EAE53] transition-colors shadow-md flex items-center justify-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"mr-2",children:(0,d.jsx)("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.371-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01s-.521.074-.792.372c-.272.296-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"})}),"Send Confirmation"]}),(0,d.jsx)("button",{onClick:a,whileTap:{scale:.95},className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold py-3 px-6 rounded-lg hover:bg-border dark:hover:bg-dark-border",children:"Process New Order"})]})]})};var r4=e=>{let{products:t,customers:r,settings:a,activeShift:s,onAddSalesOrder:l,onBack:i}=e,[c,m]=(0,o.useState)(""),[u,x]=(0,o.useState)(null),[h,p]=(0,o.useState)([]),[b,g]=(0,o.useState)(!1),[f,k]=(0,o.useState)(""),[y,j]=(0,o.useState)(null),v=(0,o.useMemo)(()=>new GoogleGenAI({apiKey:r2.env.API_KEY}),[]),w={type:Type.OBJECT,properties:{customerPhoneNumber:{type:Type.STRING,description:"The customer's phone number in E.164 format (e.g., +254712345678). Infer from message if possible."},customerName:{type:Type.STRING,description:"The customer's name, if mentioned."},items:{type:Type.ARRAY,items:{type:Type.OBJECT,properties:{productName:{type:Type.STRING,description:"The name of the product requested by the customer."},inventoryCode:{type:Type.STRING,description:"The inventoryCode of the matched product from the provided list. If no exact match, leave empty."},quantity:{type:Type.INTEGER,description:"The quantity of the product requested."}}}},unmatchedItems:{type:Type.ARRAY,items:{type:Type.STRING},description:"A list of item descriptions mentioned by the customer that could not be confidently matched to any product in the provided list."}}},N=async()=>{if(!c.trim())return;g(!0),k(""),x(null),p([]);let e=t.map(e=>({inventoryCode:e.inventoryCode,name:e.name,price:e.price})),r="\n            Here is a list of available products with their inventoryCode, name, and price:\n            ".concat(JSON.stringify(e),"\n\n            Here is a WhatsApp conversation from a customer:\n            ---\n            ").concat(c,"\n            ---\n\n            Please parse the conversation and extract the order details. The customer's phone number should be in E.164 format, assuming it's a Kenyan number if no country code is provided (prefix with +254 and remove leading 0).\n        ");try{let e=await v.models.generateContent({model:"gemini-2.5-flash",contents:r,config:{responseMimeType:"application/json",responseSchema:w}}),a=JSON.parse(e.text);x(a);let s=[];for(let e of a.items){let r=t.find(t=>t.inventoryCode===e.inventoryCode||t.name.toLowerCase()===e.productName.toLowerCase());r?s.push({id:crypto.randomUUID(),productId:r.id,description:r.name,quantity:e.quantity,unitPrice:r.price,pricingType:r.pricingType,status:"Pending",quantityReceived:0}):a.unmatchedItems.push("".concat(e.quantity," x ").concat(e.productName))}p(s)}catch(e){console.error("Gemini API Error:",e),k("Failed to parse conversation with AI. Please check the text or try again.")}finally{g(!1)}},C=async()=>{if(!u||0===h.length){k("No valid items to create an order.");return}let e=h.reduce((e,t)=>e+t.unitPrice*t.quantity,0),t=r.find(e=>e.phone.replace(/\s/g,"")===u.customerPhoneNumber.replace(/\s/g,""));t||(t=r.find(e=>"cust001"===e.id));let a={customerId:t.id,customerName:u.customerName||t.name,items:h,total:e,deposit:0,status:"Pending",createdDate:new Date,notes:"Order received via WhatsApp from ".concat(u.customerName," (").concat(u.customerPhoneNumber,"). Unmatched items: ").concat(u.unmatchedItems.join(", ")||"None")};try{let e=await l(a);j(e)}catch(e){k("Failed to create sales order.")}};return s?y&&u?(0,d.jsx)("div",{className:"h-full flex items-center justify-center p-4",children:(0,d.jsx)(r1,{salesOrder:y,customerPhone:u.customerPhoneNumber,onStartNew:()=>{m(""),x(null),p([]),k(""),j(null)}})}):(0,d.jsx)("div",{className:"p-4 md:p-8 h-full overflow-y-auto bg-background dark:bg-dark-background",children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Process WhatsApp Order"}),(0,d.jsx)("button",{onClick:i,className:"text-sm font-bold text-primary dark:text-dark-primary hover:text-primary-focus",children:"← Back to POS"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md space-y-4",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground",children:"1. Paste Conversation"}),(0,d.jsx)("textarea",{value:c,onChange:e=>m(e.target.value),rows:15,placeholder:"Paste the customer's WhatsApp chat here...",className:"w-full p-3 border border-border dark:border-dark-border rounded-md focus:ring-primary focus:border-primary bg-background dark:bg-dark-background"}),(0,d.jsx)("button",{onClick:N,disabled:b,whileTap:{scale:.98},className:"w-full bg-primary text-primary-content font-bold py-3 rounded-lg text-lg hover:bg-primary-focus disabled:bg-slate-400 flex items-center justify-center",children:b?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,d.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,d.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Parsing..."]}):"Parse with AI"}),f&&(0,d.jsx)("p",{className:"text-danger text-sm text-center",children:f})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground",children:"2. Review & Create Order"}),(0,d.jsx)(n.M,{mode:"wait",children:u?(0,d.jsxs)("div",{initial:{opacity:0},animate:{opacity:1},className:"space-y-4 mt-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-bold text-foreground-muted dark:text-dark-foreground-muted",children:"Customer Details"}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Name:"})," ",u.customerName||"N/A"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Phone:"})," ",u.customerPhoneNumber]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-bold text-foreground-muted dark:text-dark-foreground-muted",children:"Matched Items"}),h.length>0?(0,d.jsx)("ul",{className:"divide-y divide-border dark:divide-dark-border",children:h.map(e=>(0,d.jsxs)("li",{className:"py-2 flex justify-between",children:[(0,d.jsxs)("span",{children:[e.quantity," x ",e.description]}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",(e.unitPrice*e.quantity).toFixed(2)]})]},e.id))}):(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"No items were matched to your products."})]}),u.unmatchedItems.length>0&&(0,d.jsxs)("div",{className:"p-3 bg-amber-50 dark:bg-dark-warning/10 border border-amber-200 dark:border-dark-warning/20 rounded-md",children:[(0,d.jsx)("h3",{className:"font-bold text-amber-800 dark:text-dark-warning",children:"Unmatched Items"}),(0,d.jsx)("ul",{className:"text-sm text-amber-700 dark:text-dark-warning/80 list-disc list-inside",children:u.unmatchedItems.map((e,t)=>(0,d.jsx)("li",{children:e},t))})]}),(0,d.jsxs)("div",{className:"border-t dark:border-dark-border pt-2 flex justify-between font-bold text-lg",children:[(0,d.jsx)("span",{children:"Total"}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",h.reduce((e,t)=>e+t.unitPrice*t.quantity,0).toFixed(2)]})]}),(0,d.jsx)("button",{onClick:C,disabled:0===h.length,whileTap:{scale:.98},className:"w-full bg-primary text-primary-content font-bold py-3 rounded-lg text-lg hover:bg-primary-focus disabled:bg-slate-400",children:"Create Sales Order"})]},"preview"):(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center h-full text-foreground-muted dark:text-dark-foreground-muted",children:(0,d.jsx)("p",{children:"AI-parsed order details will appear here."})},"placeholder")})]})]})]})}):(0,d.jsxs)("div",{className:"p-8 h-full flex flex-col items-center justify-center text-center",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Shift Not Active"}),(0,d.jsx)("p",{className:"mt-2 text-foreground-muted dark:text-dark-foreground-muted",children:"You must start a shift before processing WhatsApp orders."}),(0,d.jsx)("button",{onClick:i,className:"mt-6 bg-primary text-primary-content font-bold py-2 px-6 rounded-lg",children:"Back to POS"})]})},r3=e=>{let{onBack:t,onOpenDrawer:r}=e;return(0,d.jsx)("div",{className:"p-4 md:p-8 h-full overflow-y-auto bg-slate-50 dark:bg-dark-background flex items-center justify-center",children:(0,d.jsxs)("div",{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md bg-card dark:bg-dark-card p-8 rounded-xl shadow-xl text-center",children:[(0,d.jsx)("div",{className:"mx-auto bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground w-24 h-24 rounded-full flex items-center justify-center mb-6 border-4 border-card dark:border-dark-card",children:(0,d.jsx)("div",{className:"w-12 h-12",children:N.openDrawer})}),(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Open Cash Drawer"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-4 mb-8",children:"Click the button below to send a signal to the connected receipt printer to open the cash drawer."}),(0,d.jsx)("button",{onClick:r,whileTap:{scale:.95},className:"w-full bg-primary dark:bg-dark-primary text-primary-content font-bold py-4 rounded-lg text-lg hover:bg-primary-focus dark:hover:bg-dark-primary-focus transition-colors shadow-lg",children:"Open Drawer"}),(0,d.jsx)("div",{className:"mt-6 p-3 bg-amber-50 dark:bg-dark-warning/10 border border-amber-200 dark:border-dark-warning/20 rounded-lg text-xs text-amber-800 dark:text-dark-warning",children:(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Security Notice:"})," This action will be recorded in the system's audit log for security and accountability purposes."]})}),(0,d.jsx)("button",{onClick:t,className:"mt-8 text-sm font-bold text-primary dark:text-dark-primary hover:underline",children:"← Back to Point of Sale"})]})})};let r5=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-red-500",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("polyline",{points:"8 12 12 16 16 12"}),(0,d.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"16"})]}),r6=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-green-500",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("polyline",{points:"16 12 12 8 8 12"}),(0,d.jsx)("line",{x1:"12",y1:"16",x2:"12",y2:"8"})]}),r9=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-blue-500",children:[(0,d.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"22"}),(0,d.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),r8=e=>{let{title:t,value:r,icon:a,isWarning:s}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm flex items-center space-x-4 border ".concat(s?"border-red-300 dark:border-red-500/50":"border-border dark:border-dark-border"),children:[(0,d.jsx)("div",{className:"p-3 rounded-lg ".concat(s?"text-red-500 bg-red-100 dark:bg-red-900/50":"text-primary dark:text-dark-primary bg-muted dark:bg-dark-muted"),children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-semibold",children:t}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:r})]})]})},r7=(e,t,r)=>{let a={};return e.forEach(e=>{let s=new Date(e[t]),d="".concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"));a[d]||(a[d]={month:s.toLocaleString("default",{month:"long",year:"numeric"})},r.forEach(e=>a[d][e.key]=0)),r.forEach(t=>{a[d][t.key]+=e[t.key]||0})}),Object.values(a).sort((e,t)=>new Date(t.month).getTime()-new Date(e.month).getTime())},ae=e=>null==e?"":String(e).replace(/[<>&'"]/g,e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return""}}),at=(e,t,r)=>{let a=e.map(e=>{let r=t.map(t=>{let r=e[t.key],a=r;return"date"===t.key&&r instanceof Date?a=r.toLocaleString():"number"!=typeof r||["quantity","itemsSold"].includes(t.key)||(a=r.toFixed(2)),"<td>".concat(ae(a),"</td>")}).join("");return"<tr>".concat(r,"</tr>")}).join(""),s=new Blob(['\n        <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">\n        <head><meta charset="UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Tax Report</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head>\n        <body><table><thead><tr>'.concat(t.map(e=>"<th>".concat(e.label,"</th>")).join(""),"</tr></thead><tbody>").concat(a,"</tbody></table></body></html>")],{type:"application/vnd.ms-excel"}),d=URL.createObjectURL(s),o=document.createElement("a");o.href=d,o.download=r,o.click(),URL.revokeObjectURL(d)};var ar=e=>{let{sales:t,supplierInvoices:r,settings:a}=e,[s,l]=(0,o.useState)("SalesVAT"),[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)(""),x=(0,o.useMemo)(()=>{let e=i?new Date(i):null;e&&e.setHours(0,0,0,0);let r=m?new Date(m):null;return r&&r.setHours(23,59,59,999),t.filter(t=>{let a=new Date(t.date);return(!e||!(a<e))&&(!r||!(a>r))})},[t,i,m]),h=(0,o.useMemo)(()=>{let e=i?new Date(i):null;e&&e.setHours(0,0,0,0);let t=m?new Date(m):null;return t&&t.setHours(23,59,59,999),r.filter(r=>{let a=new Date(r.invoiceDate);return(!e||!(a<e))&&(!t||!(a>t))})},[r,i,m]),p=[{key:"month",label:"Month"},{key:"taxableAmount",label:"Taxable Sales (".concat(a.businessInfo.currency,")")},{key:"tax",label:"VAT Payable (".concat(a.tax.vatRate,"%) (").concat(a.businessInfo.currency,")")},{key:"total",label:"Gross Sales (".concat(a.businessInfo.currency,")")}],b=[{key:"month",label:"Month"},{key:"subtotal",label:"Net Purchases (".concat(a.businessInfo.currency,")")},{key:"taxAmount",label:"VAT Input (".concat(a.tax.vatRate,"%) (").concat(a.businessInfo.currency,")")},{key:"totalAmount",label:"Gross Purchases (".concat(a.businessInfo.currency,")")}],g=(0,o.useMemo)(()=>r7(x,"date",[{key:"taxableAmount",label:""},{key:"tax",label:""},{key:"total",label:""}]),[x]),f=(0,o.useMemo)(()=>r7(h,"invoiceDate",[{key:"subtotal",label:""},{key:"taxAmount",label:""},{key:"totalAmount",label:""}]),[h]),k=e=>"".concat(a.businessInfo.currency," ").concat(e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),y=(0,o.useMemo)(()=>{let e=x.reduce((e,t)=>e+t.tax,0),t=h.reduce((e,t)=>e+t.taxAmount,0);return{totalSalesVat:e,totalInputVat:t,netVatPosition:e-t}},[x,h]),j=e=>{let{tab:t,label:r}=e;return(0,d.jsx)("button",{onClick:()=>l(t),className:"px-4 py-2 font-semibold text-sm ".concat(s===t?"border-b-2 border-primary text-primary":"text-foreground-muted"),children:r})};return(0,d.jsxs)("div",{className:"p-4 md:p-6 h-full overflow-y-auto bg-background dark:bg-dark-background text-foreground dark:text-dark-foreground",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold",children:"Tax Report"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-1",children:"View and export VAT information for tax filing"})]}),(0,d.jsx)("div",{className:"flex items-center space-x-2 mt-4 md:mt-0",children:(0,d.jsxs)("button",{onClick:()=>{let e="SalesVAT"===s?g:f;if(0===e.length){alert("No data to export for the selected filters.");return}at(e,"SalesVAT"===s?p:b,"SalesVAT"===s?"vat_on_sales.xls":"vat_on_purchases.xls")},whileTap:{scale:.95},className:"bg-green-600 text-white font-bold px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-green-700 transition-colors",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),(0,d.jsx)("span",{children:"Export to XLS"})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,d.jsx)(r8,{title:"Total VAT Payable (Output)",value:k(y.totalSalesVat),icon:(0,d.jsx)(r5,{})}),(0,d.jsx)(r8,{title:"Total VAT Claimable (Input)",value:k(y.totalInputVat),icon:(0,d.jsx)(r6,{})}),(0,d.jsx)(r8,{title:"Net VAT Position",value:k(y.netVatPosition),icon:(0,d.jsx)(r9,{}),isWarning:y.netVatPosition>0})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border p-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"dateFrom",className:"text-sm font-medium text-foreground-muted",children:"From"}),(0,d.jsx)("input",{type:"date",id:"dateFrom",value:i,onChange:e=>c(e.target.value),className:"w-full mt-1 px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"dateTo",className:"text-sm font-medium text-foreground-muted",children:"To"}),(0,d.jsx)("input",{type:"date",id:"dateTo",value:m,onChange:e=>u(e.target.value),className:"w-full mt-1 px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-background dark:bg-dark-background"})]})]}),(0,d.jsxs)("div",{className:"flex border-b border-border dark:border-dark-border mb-4",children:[(0,d.jsx)(j,{tab:"SalesVAT",label:"VAT on Sales (Payable)"}),(0,d.jsx)(j,{tab:"InputVAT",label:"VAT on Purchases (Input)"})]}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsx)(n.M,{mode:"wait",children:(0,d.jsx)("div",{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:(()=>{let e="SalesVAT"===s?p:b,t="SalesVAT"===s?g:f;return(0,d.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted uppercase",children:(0,d.jsx)("tr",{children:e.map(e=>(0,d.jsx)("th",{scope:"col",className:"px-4 py-3",children:e.label},e.key))})}),(0,d.jsx)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:t.length>0?t.map(t=>(0,d.jsx)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted",children:e.map(e=>(0,d.jsx)("td",{className:"px-4 py-3 ".concat("month"!==e.key?"font-mono":"font-bold text-foreground dark:text-dark-foreground"),children:"number"==typeof t[e.key]?k(t[e.key]):t[e.key]},e.key))},t.month)):(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:e.length,className:"text-center py-10 text-foreground-muted",children:"No data available for the selected period."})})})]})})()},s)})})]})]})},aa=r(77031),as=r(31699);let ad=e=>{let{title:t,value:r,className:a=""}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-clay-light dark:shadow-clay-dark border border-border dark:border-dark-border ".concat(a),variants:{hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground mt-1",children:r})]})},ao=e=>{let{label:t,range:r,activeRange:a,onClick:s}=e;return(0,d.jsx)("button",{onClick:()=>s(r),className:"px-4 py-1.5 text-sm font-bold rounded-lg transition-colors duration-200 ".concat(a===r?"bg-card dark:bg-dark-card text-primary dark:text-dark-primary shadow-sm":"text-foreground-muted dark:text-dark-foreground-muted hover:text-foreground dark:hover:text-dark-foreground"),children:t})};var an=e=>{let{sales:t,products:r,expenses:a,settings:s,showToast:n}=e,[l]=S(),[i,c]=(0,o.useState)("week"),{filteredSales:m,filteredExpenses:u}=(0,o.useMemo)(()=>{let e=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=new Date;if("today"===i)s=r;else if("week"===i){let t=e.getDay(),r=e.getDate()-t+(0===t?-6:1);(s=new Date(e.setDate(r))).setHours(0,0,0,0)}else"month"===i&&(s=new Date(e.getFullYear(),e.getMonth(),1)).setHours(0,0,0,0);return{filteredSales:t.filter(e=>new Date(e.date)>=s),filteredExpenses:a.filter(e=>new Date(e.date)>=s)}},[t,a,i]),x=(0,o.useMemo)(()=>{let e=m.reduce((e,t)=>e+t.total,0),t=m.reduce((e,t)=>e+t.items.reduce((e,t)=>e+(t.costPrice||0)*Math.abs(t.quantity),0),0),r=u.reduce((e,t)=>e+t.amount,0),a=t+r,s=e-a;return{totalRevenue:e,totalCogs:t,totalPayouts:r,totalExpenses:a,netProfit:s,margin:0!==e?s/Math.abs(e)*100:0}},[m,u]),h=(0,o.useMemo)(()=>{let e,t;let r=new Map,a=new Date;if("today"===i)e=new Date(a.getFullYear(),a.getMonth(),a.getDate()),t=1;else if("week"===i){let r=a.getDay(),s=a.getDate()-r+(0===r?-6:1);(e=new Date(new Date().setDate(s))).setHours(0,0,0,0),t=7}else e=new Date(a.getFullYear(),a.getMonth(),1),t=new Date(a.getFullYear(),a.getMonth()+1,0).getDate();for(let s=0;s<t;s++){let t=new Date(e.getTime());if(t.setDate(t.getDate()+s),t>a)break;let d=t.toLocaleDateString("en-CA");r.set(d,{date:t,profit:0,expenses:0})}for(let e of(m.forEach(e=>{let t=new Date(e.date).toLocaleDateString("en-CA"),a=r.get(t);if(a){let t=e.items.reduce((e,t)=>e+(t.costPrice||0)*Math.abs(t.quantity),0);a.profit+=e.total,a.expenses+=t}}),u.forEach(e=>{let t=new Date(e.date).toLocaleDateString("en-CA"),a=r.get(t);a&&(a.expenses+=e.amount)}),r.values()))e.profit=e.profit-e.expenses;return Array.from(r.values()).map(e=>({name:e.date.toLocaleDateString("en-US",{month:"short",day:"numeric"}),profit:e.profit,expenses:e.expenses}))},[m,u,i]),p=(0,o.useMemo)(()=>{let e=new Map;return m.forEach(t=>{let r=t.subtotal-t.lineItemsDiscountAmount;t.items.forEach(a=>{let s=a.price*Math.abs(a.quantity),d=0;a.discount&&(d="fixed"===a.discount.type?a.discount.value:a.discount.value/100*s);let o=s-d,n=r>0?o/r*t.cartDiscountAmount:0,l=o-n,i=l-(a.costPrice||0)*Math.abs(a.quantity),c=e.get(a.id);c?(c.profit+=i,c.revenue+=l):e.set(a.id,{name:a.name,profit:i,revenue:l,margin:0})})}),Array.from(e.values()).map(e=>({...e,margin:e.revenue>0?e.profit/e.revenue*100:0})).sort((e,t)=>t.profit-e.profit).slice(0,5)},[m]),b=e=>"Ksh ".concat(e.toFixed(2)),g="dark"===l?"#444444":"#E0E0E0",f="dark"===l?"#BDBDBD":"#616161";return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Profit & Loss"}),(0,d.jsxs)("div",{className:"flex space-x-1 bg-muted dark:bg-dark-muted p-1 rounded-lg",children:[(0,d.jsx)(ao,{label:"Today",range:"today",activeRange:i,onClick:c}),(0,d.jsx)(ao,{label:"This Week",range:"week",activeRange:i,onClick:c}),(0,d.jsx)(ao,{label:"This Month",range:"month",activeRange:i,onClick:c})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},initial:"hidden",animate:"visible",children:[(0,d.jsx)(ad,{title:"Total Revenue",value:b(x.totalRevenue)}),(0,d.jsx)(ad,{title:"COGS",value:b(x.totalCogs)}),(0,d.jsx)(ad,{title:"Other Expenses",value:b(x.totalPayouts)}),(0,d.jsx)(ad,{title:"Net Profit",value:b(x.netProfit),className:x.netProfit<0?"text-danger dark:text-dark-danger":"text-success dark:text-dark-success"}),(0,d.jsx)(ad,{title:"Profit Margin",value:"".concat(x.margin.toFixed(2),"%"),className:x.margin<0?"text-danger dark:text-dark-danger":"text-success dark:text-dark-success"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[(0,d.jsxs)("div",{className:"lg:col-span-3 bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground mb-4",children:"Profit vs Expenses"}),(0,d.jsx)(eE.h,{width:"100%",height:300,children:(0,d.jsxs)(aa.v,{data:h,children:[(0,d.jsx)(eV.q,{strokeDasharray:"3 3",stroke:g}),(0,d.jsx)(eH.K,{dataKey:"name",stroke:f,fontSize:12}),(0,d.jsx)(eU.B,{stroke:f,fontSize:12,tickFormatter:e=>"Ksh ".concat(e/1e3,"k")}),(0,d.jsx)(eW.u,{contentStyle:{backgroundColor:"dark"===l?"#333333":"#FFFFFF",border:"1px solid ".concat(g)},formatter:e=>b(e)}),(0,d.jsx)(eZ.D,{}),(0,d.jsx)(as.$,{dataKey:"profit",fill:"dark"===l?"#66BB6A":"#43A047",name:"Net Profit"}),(0,d.jsx)(as.$,{dataKey:"expenses",fill:"dark"===l?"#EF5350":"#D32F2F",name:"Total Expenses"})]})})]}),(0,d.jsxs)("div",{className:"lg:col-span-2 bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border",children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground mb-4",children:"Top 5 Products by Profit"}),(0,d.jsx)(eE.h,{width:"100%",height:300,children:(0,d.jsxs)(aa.v,{data:p,layout:"vertical",margin:{top:0,right:30,left:20,bottom:0},children:[(0,d.jsx)(eV.q,{strokeDasharray:"3 3",stroke:g}),(0,d.jsx)(eH.K,{type:"number",stroke:f,fontSize:12,tickFormatter:e=>"Ksh ".concat(e/1e3,"k")}),(0,d.jsx)(eU.B,{type:"category",dataKey:"name",width:80,stroke:f,fontSize:10,interval:0}),(0,d.jsx)(eW.u,{contentStyle:{backgroundColor:"dark"===l?"#333333":"#FFFFFF",border:"1px solid ".concat(g)},formatter:e=>b(e)}),(0,d.jsx)(as.$,{dataKey:"profit",fill:"dark"===l?"#FF9800":"#FF6F00",name:"Total Profit"})]})})]})]})]})};let al=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"KES";return"".concat(t," ").concat(e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))},ai=e=>{let{title:t,value:r,subValue:a,icon:s,iconBg:o}=e;return(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm border border-border dark:border-dark-border",children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:r}),a&&(0,d.jsx)("p",{className:"text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted",children:a})]}),(0,d.jsx)("div",{className:"p-3 rounded-lg ".concat(o),children:s})]})})},ac=e=>{let{title:t,value:r,icon:a}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm border border-border dark:border-dark-border flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"p-2 rounded-lg bg-muted dark:bg-dark-muted text-primary dark:text-dark-primary",children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:r})]})]})},am=e=>{let{title:t,value:r}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm text-center border border-border dark:border-dark-border",children:[(0,d.jsx)("p",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:r}),(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:t})]})};var au=e=>{let{sales:t,products:r,expenses:a,supplierPayments:s,bankDeposits:n,shifts:l,settings:i,supplierInvoices:c,accountingTransactions:m,chartOfAccounts:u}=e,x=new Date;x.setDate(x.getDate()-30);let[h,p]=(0,o.useState)(x.toISOString().split("T")[0]),[b,g]=(0,o.useState)(new Date().toISOString().split("T")[0]),{periodData:f,closingBalances:k}=(0,o.useMemo)(()=>{let e=new Date(h);e.setHours(0,0,0,0);let r=new Date(b);r.setHours(23,59,59,999);let d=t.filter(t=>{let a=new Date(t.date);return a>=e&&a<=r}),o=a.filter(t=>{let a=new Date(t.date);return a>=e&&a<=r}),c=n.filter(t=>{let a=new Date(t.date);return a>=e&&a<=r}),x=s.filter(t=>{let a=new Date(t.paymentDate);return a>=e&&a<=r}),p=l.filter(t=>t.endTime&&new Date(t.endTime)>=e&&new Date(t.endTime)<=r),g=d.reduce((e,t)=>e+t.total,0),f=g-d.reduce((e,t)=>e+t.items.reduce((e,t)=>e+(t.costPrice||0)*t.quantity,0),0),k=o.reduce((e,t)=>e+t.amount,0),y=d.flatMap(e=>e.payments).reduce((e,t)=>(e[t.method]=(e[t.method]||0)+t.amount,e),{}),j=d.reduce((e,t)=>e+t.change,0),v=(y.Cash||0)-j,w=o.filter(e=>"Cash Drawer"===e.source).reduce((e,t)=>e+t.amount,0)+x.filter(e=>"Cash"===e.method).reduce((e,t)=>e+t.amount,0)+c.reduce((e,t)=>{var r;return e+((null===(r=t.breakdown)||void 0===r?void 0:r.cash)||0)},0),N=d.reduce((e,t)=>e+t.tax,0),C=e=>{if(!e||!u||!m)return 0;let t=u.find(t=>t.id===e);if(!t)return 0;let a=m.filter(e=>new Date(e.date)<=r).flatMap(e=>e.entries).filter(t=>t.accountId===e).reduce((e,t)=>e+t.debit-t.credit,0);return["Assets","Expenses"].includes(t.type)?a:-a},S=C(i.accounting.defaultCashAccountId),D=C(i.accounting.defaultMpesaAccountId),P=C(i.accounting.defaultBankAccountId);return{periodData:{totalRevenue:g,grossProfit:f,totalExpenses:k,netProfit:f-k,margin:g>0?f/g*100:0,paymentBreakdown:y,cashInflows:v,cashOutflows:w,totalTax:N,totalTransactions:d.length,itemsSold:d.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity,0),0),totalShifts:p.length,totalBankDeposits:c.reduce((e,t)=>e+t.amount,0)},closingBalances:{cash:S,mpesa:D,bank:P,total:S+D+P}}},[h,b,t,r,a,s,n,l,i,c,m,u]);return(0,d.jsxs)("div",{className:"p-4 md:p-6 bg-muted dark:bg-dark-muted min-h-full",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Fiscal Period Report"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"Complete financial overview for the selected period"})]}),(0,d.jsxs)("button",{onClick:()=>{let e=encodeURI("data:text/csv;charset=utf-8,"+[["Metric","Amount"],["Start Date",h],["End Date",b],["",""],["Total Revenue",f.totalRevenue.toFixed(2)],["Gross Profit",f.grossProfit.toFixed(2)],["Total Expenses",f.totalExpenses.toFixed(2)],["Net Profit",f.netProfit.toFixed(2)],["Profit Margin (%)",f.margin.toFixed(2)],["",""],["Cash Inflows",f.cashInflows.toFixed(2)],["Cash Outflows",f.cashOutflows.toFixed(2)],["Net Cash Flow",(f.cashInflows-f.cashOutflows).toFixed(2)],["",""],["Closing Cash Balance",k.cash.toFixed(2)],["Closing M-Pesa Balance",k.mpesa.toFixed(2)],["Closing Bank Balance",k.bank.toFixed(2)],["Closing Total Balance",k.total.toFixed(2)]].map(e=>e.join(",")).join("\n")),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","fiscal_report_".concat(h,"_to_").concat(b,".csv")),document.body.appendChild(t),t.click(),document.body.removeChild(t)},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-lg shadow-sm flex items-center",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export Report"]})]}),(0,d.jsxs)("div",{className:"mb-6 p-4 bg-card dark:bg-dark-card rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"from-date",className:"text-sm font-medium text-foreground-muted",children:"From Date"}),(0,d.jsx)("input",{id:"from-date",type:"date",value:h,onChange:e=>p(e.target.value),className:"w-full mt-1 p-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"to-date",className:"text-sm font-medium text-foreground-muted",children:"To Date"}),(0,d.jsx)("input",{id:"to-date",type:"date",value:b,onChange:e=>g(e.target.value),className:"w-full mt-1 p-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,d.jsx)(ai,{title:"Total Revenue",value:al(f.totalRevenue,i.businessInfo.currency),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"$"}),iconBg:"bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-300"}),(0,d.jsx)(ai,{title:"Gross Profit",value:al(f.grossProfit,i.businessInfo.currency),subValue:"".concat(f.margin.toFixed(1),"% margin"),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"↑"}),iconBg:"bg-green-100 text-green-600 dark:bg-green-900/50 dark:text-green-300"}),(0,d.jsx)(ai,{title:"Total Expenses",value:al(f.totalExpenses,i.businessInfo.currency),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"↓"}),iconBg:"bg-orange-100 text-orange-600 dark:bg-orange-900/50 dark:text-orange-300"}),(0,d.jsx)(ai,{title:"Net Profit",value:al(f.netProfit,i.businessInfo.currency),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"⇻"}),iconBg:"bg-purple-100 text-purple-600 dark:bg-purple-900/50 dark:text-purple-300"})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm mb-6",children:[(0,d.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Closing Balances at End of Fiscal Period"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,d.jsx)(ac,{title:"Cash on Hand",value:al(k.cash,i.businessInfo.currency),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"C"})}),(0,d.jsx)(ac,{title:"M-Pesa Balance",value:al(k.mpesa,i.businessInfo.currency),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"M"})}),(0,d.jsx)(ac,{title:"Bank Balance",value:al(k.bank,i.businessInfo.currency),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"B"})}),(0,d.jsx)(ac,{title:"Total Balance",value:al(k.total,i.businessInfo.currency),icon:(0,d.jsx)("span",{className:"font-bold text-lg",children:"$"})})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm",children:[(0,d.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Payment Methods Breakdown"}),(0,d.jsx)("div",{className:"space-y-2 text-sm",children:Object.entries(f.paymentBreakdown).map(e=>{let[t,r]=e;return(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:t}),(0,d.jsx)("span",{className:"font-mono font-semibold",children:al(r,i.businessInfo.currency)})]},t)})})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm",children:[(0,d.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Cash Flow Summary"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-green-600",children:"Cash Inflows"}),(0,d.jsxs)("span",{className:"font-mono font-semibold text-green-600",children:["+",al(f.cashInflows,i.businessInfo.currency)]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-red-500",children:"Cash Outflows"}),(0,d.jsxs)("span",{className:"font-mono font-semibold text-red-500",children:["-",al(f.cashOutflows,i.businessInfo.currency)]})]}),(0,d.jsxs)("div",{className:"flex justify-between border-t border-border dark:border-dark-border mt-2 pt-2 font-bold",children:[(0,d.jsx)("span",{children:"Net Cash Flow"}),(0,d.jsx)("span",{className:"font-mono",children:al(f.cashInflows-f.cashOutflows,i.businessInfo.currency)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-foreground-muted",children:[(0,d.jsx)("span",{children:"Total Bank Deposits"}),(0,d.jsx)("span",{className:"font-mono",children:al(f.totalBankDeposits,i.businessInfo.currency)})]})]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-lg shadow-sm",children:[(0,d.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Additional Metrics"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,d.jsx)(am,{title:"Total Transactions",value:f.totalTransactions}),(0,d.jsx)(am,{title:"Items Sold",value:f.itemsSold}),(0,d.jsx)(am,{title:"Total Shifts",value:f.totalShifts}),(0,d.jsx)(am,{title:"Tax Collected",value:al(f.totalTax,i.businessInfo.currency)})]})]})]})};let ax=e=>{let{transaction:t,accountMap:r}=e,[a,s]=(0,o.useState)(!1),l=(0,o.useMemo)(()=>t.entries.reduce((e,t)=>(e.debit+=t.debit,e.credit+=t.credit,e),{debit:0,credit:0}),[t.entries]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("tr",{onClick:()=>s(!a),className:"cursor-pointer hover:bg-muted dark:hover:bg-dark-muted",children:[(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(t.date).toLocaleString()}),(0,d.jsx)("td",{className:"px-6 py-4",children:t.description}),(0,d.jsxs)("td",{className:"px-6 py-4 text-xs font-mono",children:[t.referenceType,": ",t.referenceId]}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono",children:l.debit.toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4 text-right font-mono",children:l.credit.toFixed(2)})]}),(0,d.jsx)(n.M,{children:a&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:5,className:"p-0 bg-background dark:bg-dark-background",children:(0,d.jsxs)("div",{className:"p-4 m-4 border-l-4 border-primary dark:border-dark-primary bg-muted dark:bg-dark-muted rounded-r-lg",children:[(0,d.jsx)("h4",{className:"font-bold mb-2",children:"Journal Entries"}),(0,d.jsxs)("table",{className:"w-full text-xs",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"border-b dark:border-dark-border",children:[(0,d.jsx)("th",{className:"text-left py-1",children:"Account"}),(0,d.jsx)("th",{className:"text-right py-1",children:"Debit"}),(0,d.jsx)("th",{className:"text-right py-1",children:"Credit"})]})}),(0,d.jsx)("tbody",{children:t.entries.map((e,t)=>{var a;return(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-1",children:(null===(a=r.get(e.accountId))||void 0===a?void 0:a.name)||"Unknown Account"}),(0,d.jsx)("td",{className:"py-1 text-right font-mono",children:e.debit>0?e.debit.toFixed(2):"-"}),(0,d.jsx)("td",{className:"py-1 text-right font-mono",children:e.credit>0?e.credit.toFixed(2):"-"})]},t)})})]})]})})})})]})};var ah=e=>{let{transactions:t,accounts:r}=e,[a,s]=(0,o.useState)(""),[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),m=(0,o.useMemo)(()=>new Map(r.map(e=>[e.id,e])),[r]),u=(0,o.useMemo)(()=>{let e=n?new Date(n):null;e&&e.setHours(0,0,0,0);let r=i?new Date(i):null;return r&&r.setHours(23,59,59,999),t.filter(t=>{let s=new Date(t.date);return(!e||!(s<e))&&(!r||!(s>r))&&(!a||!!(t.description.toLowerCase().includes(a.toLowerCase())||t.referenceId.toLowerCase().includes(a.toLowerCase())))}).sort((e,t)=>t.date.getTime()-e.date.getTime())},[t,a,n,i]);return(0,d.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground mb-6",children:"General Ledger"}),(0,d.jsxs)("div",{className:"my-6 p-4 bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsx)("input",{type:"date",value:n,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-background"}),(0,d.jsx)("input",{type:"date",value:i,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-background"}),(0,d.jsx)("input",{type:"text",placeholder:"Search description or reference...",className:"w-full px-4 py-2 rounded-lg border border-border dark:border-dark-border bg-card dark:bg-dark-background",value:a,onChange:e=>s(e.target.value)})]}),(0,d.jsx)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted font-bold",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Date"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Description"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Reference"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Total Debit"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-right",children:"Total Credit"})]})}),(0,d.jsx)("tbody",{children:u.map(e=>(0,d.jsx)(ax,{transaction:e,accountMap:m},e.id))})]})})]})},ap=e=>{var t;let{onClose:r,onSave:a,settings:s,cashInHand:n,mpesaBalance:l}=e,[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)((null===(t=s.paymentMethods.bank[0])||void 0===t?void 0:t.id)||""),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)(""),[g,f]=(0,o.useState)(new Date().toISOString().split("T")[0]),[k,y]=(0,o.useState)({cash:0,mpesa:0,cheques:0}),[j,v]=(0,o.useState)(""),w=e=>{let t=""===e?"":parseFloat(e);c(t),y({cash:"number"==typeof t?t:0,mpesa:0,cheques:0})},N=(e,t)=>{let r=""===t?0:parseFloat(t);if(isNaN(r)||r<0)return;let a={...k,[e]:r};y(a),c(a.cash+a.mpesa+a.cheques)},C="mt-1 block w-full px-3 py-2 bg-card dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary sm:text-sm",S="block text-sm font-medium text-foreground dark:text-dark-foreground";return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"1rem"},children:(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-lg p-6",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:"Record Bank Deposit"}),(0,d.jsx)("button",{onClick:r,className:"text-foreground-muted hover:text-foreground",children:"\xd7"})]}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),v("");let t="number"==typeof i?i:0;if(t<=0){v("Please enter a valid positive amount.");return}if(Math.abs(k.cash+k.mpesa+k.cheques-t)>.01){v("Breakdown total must equal the total deposit amount.");return}if(k.cash>n){v("Cash amount exceeds available cash in hand (Ksh ".concat(n.toFixed(2),")."));return}if(k.mpesa>l){v("M-Pesa amount exceeds available balance (Ksh ".concat(l.toFixed(2),")."));return}if(!m){v("Please select a bank account.");return}if(!x){v("A receipt or reference number is required.");return}let r=s.paymentMethods.bank.find(e=>e.id===m);if(!r){v("Invalid bank account selected.");return}a({date:new Date(g),amount:t,bankAccountId:m,bankName:"".concat(r.bankName," - ").concat(r.accountNumber),receiptNumber:x,notes:p,breakdown:k})},className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"depositDate",className:S,children:"Deposit Date"}),(0,d.jsx)("input",{type:"date",id:"depositDate",value:g,onChange:e=>f(e.target.value),required:!0,className:C})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"bankAccountId",className:S,children:"Bank Account *"}),(0,d.jsxs)("select",{id:"bankAccountId",value:m,onChange:e=>u(e.target.value),required:!0,className:C,children:[(0,d.jsx)("option",{value:"",disabled:!0,children:"-- Select a Bank --"}),s.paymentMethods.bank.map(e=>(0,d.jsxs)("option",{value:e.id,children:[e.bankName," - ",e.accountNumber]},e.id))]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"receiptNumber",className:S,children:"Receipt Number"}),(0,d.jsx)("input",{type:"text",id:"receiptNumber",value:x,onChange:e=>h(e.target.value),required:!0,className:C})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"amount",className:S,children:"Total Amount *"}),(0,d.jsx)("input",{type:"number",id:"amount",value:i,onChange:e=>w(e.target.value),required:!0,min:"0.01",step:"0.01",className:C})]})]}),(0,d.jsxs)("div",{className:"p-4 bg-muted dark:bg-dark-muted rounded-lg space-y-3",children:[(0,d.jsx)("h4",{className:"text-sm font-bold text-foreground dark:text-dark-foreground",children:"Breakdown (Optional)"}),(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-3 items-end",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"cash",className:"block text-xs font-medium text-foreground-muted",children:"Cash"}),(0,d.jsx)("input",{type:"number",id:"cash",value:k.cash||"",onChange:e=>N("cash",e.target.value),min:"0",step:"0.01",className:C+" text-sm"}),(0,d.jsxs)("span",{className:"text-xs text-foreground-muted",children:["Av: ",n.toFixed(2)]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"mpesa",className:"block text-xs font-medium text-foreground-muted",children:"M-Pesa"}),(0,d.jsx)("input",{type:"number",id:"mpesa",value:k.mpesa||"",onChange:e=>N("mpesa",e.target.value),min:"0",step:"0.01",className:C+" text-sm"}),(0,d.jsxs)("span",{className:"text-xs text-foreground-muted",children:["Av: ",l.toFixed(2)]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"cheques",className:"block text-xs font-medium text-foreground-muted",children:"Cheques"}),(0,d.jsx)("input",{type:"number",id:"cheques",value:k.cheques||"",onChange:e=>N("cheques",e.target.value),min:"0",step:"0.01",className:C+" text-sm"})]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"notes",className:S,children:"Notes (Optional)"}),(0,d.jsx)("textarea",{id:"notes",value:p,onChange:e=>b(e.target.value),rows:2,className:C})]}),j&&(0,d.jsx)("p",{className:"text-sm text-center text-danger",children:j}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,d.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-muted dark:bg-dark-muted rounded-md font-semibold",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",className:"px-4 py-2 bg-primary text-primary-content rounded-md font-semibold",children:"Confirm Deposit"})]})]})]})})},ab=e=>{let{onClose:t,onSave:r,balances:a,settings:s,expenseCategories:l}=e,[i,c]=(0,o.useState)(new Date().toISOString().split("T")[0]),[m,u]=(0,o.useState)("Expense"),[x,h]=(0,o.useState)("Cash Drawer"),[p,b]=(0,o.useState)(""),[g,f]=(0,o.useState)(""),[k,y]=(0,o.useState)(l[0]||"Miscellaneous"),[j,v]=(0,o.useState)(""),[w,N]=(0,o.useState)(""),[C,S]=(0,o.useState)(null),[D,P]=(0,o.useState)(""),T=e=>{if(e.preventDefault(),P(""),"number"!=typeof p||p<=0){P("Please enter a valid amount.");return}"Expense"===m?r({type:m,date:i,amount:p,paymentMethod:x,description:g,payee:j,category:k,notes:w,receiptImageUrl:C}):P('Transaction type "'.concat(m,'" is not yet implemented.'))},I="number"==typeof p&&p>(a[x]||0),A="mt-1 block w-full px-3 py-2 bg-background dark:bg-dark-background border border-border dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary dark:focus:ring-dark-primary text-foreground dark:text-dark-foreground",M="block text-sm font-medium text-foreground-muted dark:text-dark-foreground-muted";return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:t,children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-6 border-b border-border dark:border-dark-border",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:"Record Transaction"}),(0,d.jsx)("button",{onClick:t,className:"text-foreground-muted hover:text-foreground text-2xl",children:"\xd7"})]}),(0,d.jsxs)("form",{onSubmit:T,className:"flex-grow p-6 overflow-y-auto space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"date",className:M,children:"Date"}),(0,d.jsx)("input",{type:"date",id:"date",value:i,onChange:e=>c(e.target.value),required:!0,className:A})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"type",className:M,children:"Type *"}),(0,d.jsxs)("select",{id:"type",value:m,onChange:e=>u(e.target.value),required:!0,className:A,children:[(0,d.jsx)("option",{children:"Expense"}),(0,d.jsx)("option",{disabled:!0,children:"Cash In"}),(0,d.jsx)("option",{disabled:!0,children:"Cash Out"}),(0,d.jsx)("option",{disabled:!0,children:"M-Pesa In"}),(0,d.jsx)("option",{disabled:!0,children:"M-Pesa Out"}),(0,d.jsx)("option",{disabled:!0,children:"Supplier Payment"}),(0,d.jsx)("option",{disabled:!0,children:"Customer Refund"})]})]})]}),(0,d.jsx)(n.M,{children:"Expense"===m&&(0,d.jsxs)("div",{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4 overflow-hidden",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"paymentMethod",className:M,children:"Payment Method *"}),(0,d.jsxs)("select",{id:"paymentMethod",value:x,onChange:e=>h(e.target.value),required:!0,className:A,children:[(0,d.jsxs)("option",{value:"Cash Drawer",children:["Cash (Ksh ",a["Cash Drawer"].toFixed(2),")"]}),(0,d.jsxs)("option",{value:"M-Pesa",children:["M-Pesa (Ksh ",a["M-Pesa"].toFixed(2),")"]}),(0,d.jsxs)("option",{value:"Bank",children:["Bank (Ksh ",a.Bank.toFixed(2),")"]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"amount",className:M,children:"Amount *"}),(0,d.jsx)("input",{type:"number",id:"amount",value:p,onChange:e=>b(""===e.target.value?"":parseFloat(e.target.value)),required:!0,min:"0.01",step:"0.01",className:"".concat(A," ").concat(I?"border-danger":"")}),I&&(0,d.jsx)("p",{className:"text-xs text-danger mt-1",children:"Amount exceeds available balance."})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"description",className:M,children:"Description *"}),(0,d.jsx)("input",{type:"text",id:"description",value:g,onChange:e=>f(e.target.value),required:!0,placeholder:"e.g., Office supplies",className:A})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"payee",className:M,children:"Payee (Optional)"}),(0,d.jsx)("input",{type:"text",id:"payee",value:j,onChange:e=>v(e.target.value),placeholder:"e.g., Naivas",className:A})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"category",className:M,children:"Category *"}),(0,d.jsx)("select",{id:"category",value:k,onChange:e=>y(e.target.value),required:!0,className:A,children:l.map(e=>(0,d.jsx)("option",{value:e,children:e},e))})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"notes",className:M,children:"Notes (Optional)"}),(0,d.jsx)("textarea",{id:"notes",value:w,onChange:e=>N(e.target.value),rows:2,className:A})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"receipt",className:M,children:"Upload Receipt (Optional)"}),(0,d.jsx)("input",{type:"file",id:"receipt",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){let e=new FileReader;e.onloadend=()=>{S(e.result)},e.readAsDataURL(r)}},accept:"image/*",className:"".concat(A," p-0 file:mr-4 file:py-2 file:px-4 file:border-0 file:bg-muted dark:file:bg-dark-muted")}),C&&(0,d.jsx)("img",{src:C,alt:"Receipt preview",className:"mt-2 rounded-lg max-h-40 object-contain border p-1"})]})]})}),D&&(0,d.jsx)("p",{className:"text-sm text-center text-danger",children:D})]}),(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-end gap-2 p-4 border-t border-border dark:border-dark-border",children:[(0,d.jsx)("button",{type:"button",onClick:t,whileTap:{scale:.95},className:"px-4 py-2 bg-muted dark:bg-dark-muted rounded-md font-semibold",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",form:"transaction-form",onClick:T,whileTap:{scale:.95},className:"px-4 py-2 bg-primary text-primary-content rounded-md font-semibold disabled:bg-slate-400",disabled:I,children:"Record Transaction"})]})]})})};let ag=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),(0,d.jsx)("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]}),af=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),(0,d.jsx)("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]}),ak=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,d.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,d.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,d.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,d.jsx)("polyline",{points:"10 9 9 9 8 9"})]}),ay=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,d.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),aj=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-green-500",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("polyline",{points:"16 12 12 8 8 12"}),(0,d.jsx)("line",{x1:"12",y1:"16",x2:"12",y2:"8"})]}),av=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-red-500",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("polyline",{points:"8 12 12 16 16 12"}),(0,d.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"16"})]}),aw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"KES";return"".concat(t," ").concat(e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))},aN=e=>{let{title:t,value:r,icon:a,isWarning:s}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm flex items-center space-x-4 border ".concat(s?"border-red-300 dark:border-red-500/50":"border-border dark:border-dark-border"),children:[(0,d.jsx)("div",{className:"p-3 rounded-lg ".concat(s?"text-red-500 bg-red-100 dark:bg-red-900/50":"text-primary dark:text-dark-primary bg-muted dark:bg-dark-muted"),children:a}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-semibold",children:t}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:r}),s&&(0,d.jsx)("p",{className:"text-xs text-red-500 font-semibold",children:"Insufficient balance"})]})]})};var aC=e=>{let{sales:t,expenses:r,accountingTransactions:a,chartOfAccounts:s,settings:n,activeShift:l,supplierPayments:i,suppliers:c,bankDeposits:m,onAddBankDeposit:u,currentUser:x,customers:h,supplierInvoices:p,onProcessExpense:b}=e,[g,f]=(0,o.useState)("all"),[k,y]=(0,o.useState)(!1),[j,v]=(0,o.useState)(!1),w=(0,o.useMemo)(()=>e=>{let t=s.find(t=>t.id===e);if(!t)return 0;let r=a.flatMap(e=>e.entries).filter(t=>t.accountId===e).reduce((e,t)=>e+t.debit-t.credit,0);return["Assets","Expenses"].includes(t.type)?r:-r},[a,s]),N=w(n.accounting.defaultCashAccountId),C=w(n.accounting.defaultMpesaAccountId),S=w(n.accounting.defaultBankAccountId),D=N+C+S,P=(0,o.useMemo)(()=>{let e=[];return t.forEach(t=>{var r;return e.push({date:new Date(t.date),type:"Sale",description:"Sale to ".concat((null===(r=h.find(e=>e.id===t.customerId))||void 0===r?void 0:r.name)||"N/A"),method:t.payments.map(e=>e.method).join(", "),amount:t.total,staff:t.cashierName,isCredit:!0})}),r.forEach(t=>e.push({date:new Date(t.date),type:"Expense",description:t.reason,method:t.source,amount:t.amount,staff:t.cashierName,isCredit:!1})),m.forEach(t=>e.push({date:new Date(t.date),type:"Bank Deposit",description:"Deposit to ".concat(t.bankName),method:"Bank Transfer",amount:t.amount,staff:t.depositedByName,isCredit:!0})),i.forEach(t=>{let r=p.find(e=>e.id===t.invoiceId),a=c.find(e=>e.id===(null==r?void 0:r.supplierId));e.push({date:new Date(t.paymentDate),type:"Supplier Payment",description:"Payment to ".concat((null==a?void 0:a.name)||"N/A"),method:t.method,amount:t.amount,staff:x.name,isCredit:!1})}),e.sort((e,t)=>t.date.getTime()-e.date.getTime())},[t,r,m,i,h,c,x.name,p]),T=(0,o.useMemo)(()=>"deposits"===g?P.filter(e=>"Bank Deposit"===e.type):P,[P,g]);return(0,d.jsxs)("div",{className:"p-4 md:p-6 h-full overflow-y-auto bg-background dark:bg-dark-background text-foreground dark:text-dark-foreground",children:[k&&(0,d.jsx)(ap,{onClose:()=>y(!1),onSave:e=>{u(e),y(!1)},settings:n,cashInHand:N,mpesaBalance:C}),j&&(0,d.jsx)(ab,{onClose:()=>v(!1),onSave:e=>{"Expense"===e.type&&(b(e.amount,e.description,e.category,e.paymentMethod,e.payee,e.receiptImageUrl),v(!1))},balances:{"Cash Drawer":N,"M-Pesa":C,Bank:S},settings:n,expenseCategories:n.inventory.expenseCategories}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold",children:"Accounts & Finance"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-1",children:"Track all payments, balances, and bank deposits"})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 mt-4 md:mt-0",children:[(0,d.jsxs)("button",{onClick:()=>y(!0),className:"bg-green-600 text-white font-bold px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-green-700 transition-colors",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:(0,d.jsx)("path",{d:"M12 5v14m-7-7h14"})}),(0,d.jsx)("span",{children:"Bank Deposit"})]}),(0,d.jsxs)("button",{onClick:()=>v(!0),className:"bg-orange-500 text-white font-bold px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-orange-600 transition-colors",children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:(0,d.jsx)("path",{d:"M12 5v14m-7-7h14"})}),(0,d.jsx)("span",{children:"Record Transaction"})]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,d.jsx)(aN,{title:"Cash on Hand",value:aw(N,n.businessInfo.currency),icon:(0,d.jsx)(ag,{}),isWarning:N<0}),(0,d.jsx)(aN,{title:"M-Pesa Balance",value:aw(C,n.businessInfo.currency),icon:(0,d.jsx)(af,{}),isWarning:C<0}),(0,d.jsx)(aN,{title:"Bank Balance",value:aw(S,n.businessInfo.currency),icon:(0,d.jsx)(ak,{}),isWarning:S<0}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm flex items-center space-x-4 border border-border dark:border-dark-border",children:[(0,d.jsx)("div",{className:"p-3 rounded-lg text-purple-500 bg-purple-100 dark:bg-purple-900/50",children:(0,d.jsx)(ay,{})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted font-semibold",children:"Total Balance"}),(0,d.jsx)("p",{className:"text-xl font-bold text-foreground dark:text-dark-foreground",children:aw(D,n.businessInfo.currency)})]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-xl shadow-sm border border-border dark:border-dark-border p-6",children:[(0,d.jsxs)("div",{className:"flex border-b border-border dark:border-dark-border mb-4",children:[(0,d.jsx)("button",{onClick:()=>f("all"),className:"px-4 py-2 font-semibold text-sm ".concat("all"===g?"border-b-2 border-primary text-primary":"text-foreground-muted"),children:"All Transactions"}),(0,d.jsx)("button",{onClick:()=>f("deposits"),className:"px-4 py-2 font-semibold text-sm ".concat("deposits"===g?"border-b-2 border-primary text-primary":"text-foreground-muted"),children:"Bank Deposits"})]}),(0,d.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Transaction History"}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted uppercase",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"py-3 px-4",children:"Date"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Type"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Description"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Method"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Amount"}),(0,d.jsx)("th",{className:"py-3 px-4",children:"Staff"})]})}),(0,d.jsxs)("tbody",{children:[T.map((e,t)=>(0,d.jsxs)("tr",{className:"border-b border-border dark:border-dark-border last:border-b-0",children:[(0,d.jsx)("td",{className:"py-3 px-4 whitespace-nowrap",children:e.date.toLocaleString("en-GB",{dateStyle:"short",timeStyle:"short"})}),(0,d.jsx)("td",{className:"py-3 px-4",children:(0,d.jsxs)("span",{className:"flex items-center space-x-2",children:[e.isCredit?(0,d.jsx)(aj,{}):(0,d.jsx)(av,{}),(0,d.jsx)("span",{children:e.type})]})}),(0,d.jsx)("td",{className:"py-3 px-4",children:e.description}),(0,d.jsx)("td",{className:"py-3 px-4",children:e.method}),(0,d.jsxs)("td",{className:"py-3 px-4 font-semibold ".concat(e.isCredit?"text-green-500":"text-red-500"),children:[e.isCredit?"+":"-",aw(e.amount,n.businessInfo.currency)]}),(0,d.jsx)("td",{className:"py-3 px-4",children:e.staff})]},t)),0===T.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:6,className:"text-center py-8 text-foreground-muted",children:"No transactions found."})})]})]})})]})]})},aS=e=>{let{products:t,customers:r,users:a,settings:s,onAddWorkOrder:n,onBack:l,activeShift:i}=e,[c,m]=(0,o.useState)(""),[u,x]=(0,o.useState)(""),[h,p]=(0,o.useState)(""),[b,g]=(0,o.useState)(new Date(Date.now()+864e5).toISOString().split("T")[0]),[f,k]=(0,o.useState)(""),[y,j]=(0,o.useState)(""),[v,w]=(0,o.useState)([]),[N,C]=(0,o.useState)("exclusive"),[S,D]=(0,o.useState)(""),[P,T]=(0,o.useState)(""),[I,A]=(0,o.useState)(""),M=(0,o.useMemo)(()=>I?t.filter(e=>"Inventory"===e.productType&&e.name.toLowerCase().includes(I.toLowerCase())&&!v.some(t=>t.materialId===e.id)):[],[I,t,v]),F=(0,o.useMemo)(()=>{let e=v.reduce((e,t)=>e+t.lineTotal,0),t=Number(y)||0,r=0,a=0,d=t+e;return"exclusive"===N?(r=s.tax.vatRate/100*d,a=d+r):r=(a=d)-a/(1+s.tax.vatRate/100),{materialsSubtotal:e,vatAmount:r,totalCost:a}},[y,v,N,s.tax.vatRate]),L=e=>{w(t=>t.filter(t=>t.materialId!==e))},O=e=>{w(t=>[...t,{materialId:e.id,name:e.name,qty:1,unitPrice:e.price,lineTotal:e.price}]),A("")},R=(e,t)=>{let r=parseFloat(t);w(t=>t.map(t=>{if(t.materialId===e){let e=isNaN(r)||r<0?0:r;return{...t,qty:e,lineTotal:e*t.unitPrice}}return t}))};return i?(0,d.jsx)("div",{className:"p-4 md:p-6 bg-muted dark:bg-dark-muted min-h-full",children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold",children:"New Work Order"}),(0,d.jsx)("button",{onClick:l,className:"text-sm font-semibold hover:underline",children:"Cancel"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{className:"lg:col-span-2 bg-card dark:bg-dark-card p-6 rounded-lg shadow-sm space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Customer *"}),(0,d.jsx)(eu,{customers:r,selectedCustomerId:c,onCustomerChange:m})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Job Title *"}),(0,d.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),required:!0,className:"w-full mt-1 p-2 border rounded-md"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Description"}),(0,d.jsx)("textarea",{value:h,onChange:e=>p(e.target.value),rows:3,className:"w-full mt-1 p-2 border rounded-md"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Promised Date"}),(0,d.jsx)("input",{type:"date",value:b,onChange:e=>g(e.target.value),className:"w-full mt-1 p-2 border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Assign To"}),(0,d.jsxs)("select",{value:f,onChange:e=>k(e.target.value),className:"w-full mt-1 p-2 border rounded-md",children:[(0,d.jsx)("option",{value:"",children:"Unassigned"}),a.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,d.jsxs)("div",{className:"pt-4 border-t",children:[(0,d.jsx)("h3",{className:"font-semibold mb-2",children:"Materials"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("input",{type:"text",value:I,onChange:e=>A(e.target.value),placeholder:"Search to add material...",className:"w-full p-2 border rounded-md"}),I&&(0,d.jsx)("ul",{className:"absolute z-10 w-full bg-card dark:bg-dark-card border border-border dark:border-dark-border rounded-md shadow-lg max-h-40 overflow-y-auto",children:M.map(e=>(0,d.jsxs)("li",{onClick:()=>O(e),className:"p-2 hover:bg-muted dark:hover:bg-dark-muted cursor-pointer flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-semibold",children:e.name}),(0,d.jsxs)("p",{className:"text-xs text-foreground-muted",children:["SKU: ",e.inventoryCode]})]}),(0,d.jsx)("span",{className:"font-mono text-sm text-primary dark:text-dark-primary",children:"Ksh ".concat(e.price.toFixed(2))})]},e.id))})]}),(0,d.jsxs)("div",{className:"mt-2 space-y-2 max-h-48 overflow-y-auto pr-2",children:[v.length>0&&(0,d.jsxs)("div",{className:"flex items-center gap-2 text-xs font-bold text-foreground-muted pr-8",children:[(0,d.jsx)("span",{className:"flex-grow",children:"Product"}),(0,d.jsx)("span",{className:"w-40 text-center",children:"Quantity"}),(0,d.jsx)("span",{className:"w-24 text-right",children:"Line Total"})]}),v.map(e=>(0,d.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded bg-muted dark:bg-dark-muted/50",children:[(0,d.jsx)("span",{className:"flex-grow font-semibold text-sm",children:e.name}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"number",value:e.qty,onChange:t=>R(e.materialId,t.target.value),className:"w-20 p-1 border rounded text-center bg-card dark:bg-dark-background border-border dark:border-dark-border",min:"0",step:"0.1"}),(0,d.jsxs)("span",{className:"text-xs text-foreground-muted",children:["x ",e.unitPrice.toFixed(2)]})]}),(0,d.jsxs)("span",{className:"w-24 text-right font-mono font-semibold",children:["Ksh ",(e.qty*e.unitPrice).toFixed(2)]}),(0,d.jsx)("button",{type:"button",onClick:()=>L(e.materialId),className:"text-danger/70 p-1 rounded-full hover:bg-danger/10 hover:text-danger",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},e.materialId))]})]})]}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-lg shadow-sm space-y-4",children:[(0,d.jsx)("h2",{className:"text-lg font-bold border-b pb-2",children:"Summary"}),(0,d.jsxs)("div",{className:"flex justify-center bg-muted dark:bg-dark-muted p-1 rounded-md",children:[(0,d.jsx)("button",{onClick:()=>C("exclusive"),className:"w-1/2 text-sm py-1 rounded ".concat("exclusive"===N?"bg-white font-bold":""),children:"VAT Exclusive"}),(0,d.jsx)("button",{onClick:()=>C("inclusive"),className:"w-1/2 text-sm py-1 rounded ".concat("inclusive"===N?"bg-white font-bold":""),children:"VAT Inclusive"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Labour Amount"}),(0,d.jsx)("input",{type:"number",value:y,onChange:e=>j(""===e.target.value?"":parseFloat(e.target.value)),className:"w-full mt-1 p-2 border rounded-md"})]}),(0,d.jsxs)("div",{className:"space-y-1 text-sm border-t pt-2",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Labour:"})," ",(0,d.jsx)("span",{className:"font-mono",children:"Ksh ".concat((Number(y)||0).toFixed(2))})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Materials:"})," ",(0,d.jsx)("span",{className:"font-mono",children:"Ksh ".concat(F.materialsSubtotal.toFixed(2))})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsxs)("span",{className:"text-foreground-muted",children:["VAT (",s.tax.vatRate,"%):"]})," ",(0,d.jsx)("span",{className:"font-mono",children:"Ksh ".concat(F.vatAmount.toFixed(2))})]}),(0,d.jsxs)("div",{className:"flex justify-between text-xl font-bold pt-2 border-t mt-2",children:[(0,d.jsx)("span",{className:"",children:"Total:"})," ",(0,d.jsx)("span",{className:"font-mono text-primary",children:"Ksh ".concat(F.totalCost.toFixed(2))})]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-lg shadow-sm space-y-4",children:[(0,d.jsx)("h2",{className:"text-lg font-bold border-b pb-2",children:"Payments"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Deposit Required (Optional)"}),(0,d.jsx)("input",{type:"number",value:S,onChange:e=>D(""===e.target.value?"":parseFloat(e.target.value)),className:"w-full mt-1 p-2 border rounded-md"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Deposit to Pay Now"}),(0,d.jsx)("input",{type:"number",value:P,onChange:e=>T(""===e.target.value?"":parseFloat(e.target.value)),className:"w-full mt-1 p-2 border rounded-md"})]}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-2 border-t mt-2 text-danger",children:[(0,d.jsx)("span",{children:"Balance Due:"})," ",(0,d.jsx)("span",{className:"font-mono",children:"Ksh ".concat((F.totalCost-(Number(P)||0)).toFixed(2))})]})]}),(0,d.jsx)("button",{type:"button",onClick:()=>{if(!c||!u){alert("Please select a customer and enter a job title.");return}let e=r.find(e=>e.id===c);e&&n({customerId:c,customerName:e.name,jobTitle:u,description:h,status:"Pending",promisedDate:b?new Date(b).toISOString():void 0,assignedTo:f,labourAmount:Number(y)||0,materialsSubtotal:F.materialsSubtotal,vatAmount:F.vatAmount,totalCost:F.totalCost,depositRequired:Number(S)||void 0,amountPaid:0,balanceDue:F.totalCost,vatMode:N},v,Number(P)||0)},whileTap:{scale:.98},className:"w-full bg-primary text-primary-content font-bold py-3 rounded-lg text-lg",children:"Create & Proceed to POS"})]})]})]})}):(0,d.jsxs)("div",{className:"p-8 text-center",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",children:"Shift Not Active"}),(0,d.jsx)("p",{children:"You must start a shift to create a work order."}),(0,d.jsx)("button",{onClick:l,className:"mt-4 bg-primary text-white px-4 py-2 rounded",children:"Back"})]})};let aD=e=>{let{title:t,count:r,className:a}=e;return(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-4 rounded-xl shadow-sm border border-border dark:border-dark-border ".concat(a),children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground-muted dark:text-dark-foreground-muted",children:t}),(0,d.jsx)("p",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:r})]})},aP=e=>{let{status:t}=e,r="text-slate-800 bg-slate-100 dark:bg-slate-700 dark:text-slate-300";switch(t){case"Pending":r="text-yellow-800 bg-yellow-100 dark:bg-yellow-900/50 dark:text-yellow-300";break;case"In Progress":r="text-sky-800 bg-sky-100 dark:bg-sky-900/50 dark:text-sky-300";break;case"Awaiting Parts":r="text-indigo-800 bg-indigo-100 dark:bg-indigo-900/50 dark:text-indigo-300";break;case"Ready for Pickup":r="text-blue-800 bg-blue-100 dark:bg-blue-900/50 dark:text-blue-300";break;case"Completed":r="text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300";break;case"Delivered":r="text-violet-800 bg-violet-100 dark:bg-violet-900/50 dark:text-violet-300";break;case"Cancelled":r="text-red-800 bg-red-100 dark:bg-red-900/50 dark:text-red-300"}return(0,d.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full capitalize ".concat(r),children:t.toLowerCase()})};var aT=e=>{let{workOrders:t,onViewWorkOrder:r,onCreateRequest:a}=e,s=(0,o.useMemo)(()=>[...t].sort((e,t)=>new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime()),[t]),n=(0,o.useMemo)(()=>{let e={Pending:0,"In Progress":0,Completed:0,Delivered:0};return t.forEach(t=>{"Pending"===t.status&&e.Pending++,"In Progress"===t.status&&e["In Progress"]++,"Completed"===t.status&&e.Completed++,"Delivered"===t.status&&e.Delivered++}),e},[t]);return(0,d.jsxs)("div",{className:"p-4 md:p-6 bg-muted dark:bg-dark-muted min-h-full",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Work Orders"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"Manage repair, service, and custom work orders"})]}),(0,d.jsx)("button",{onClick:a,whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold px-4 py-2 rounded-lg hover:bg-primary-focus transition-colors shadow-sm flex items-center",children:"+ Create Work Order"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,d.jsx)(aD,{title:"Pending",count:n.Pending,className:"border-l-4 border-yellow-500"}),(0,d.jsx)(aD,{title:"In Progress",count:n["In Progress"],className:"border-l-4 border-sky-500"}),(0,d.jsx)(aD,{title:"Completed",count:n.Completed,className:"border-l-4 border-green-500"}),(0,d.jsx)(aD,{title:"Delivered",count:n.Delivered,className:"border-l-4 border-violet-500"})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card rounded-lg shadow-sm overflow-hidden border border-border dark:border-dark-border",children:[(0,d.jsx)("div",{className:"p-4 border-b border-border dark:border-dark-border",children:(0,d.jsx)("h2",{className:"text-lg font-semibold text-foreground dark:text-dark-foreground",children:"All Work Orders"})}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-left text-foreground-muted dark:text-dark-foreground-muted",children:[(0,d.jsx)("thead",{className:"text-xs text-foreground dark:text-dark-foreground uppercase bg-muted dark:bg-dark-muted",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-6 py-3",children:"WO #"}),(0,d.jsx)("th",{className:"px-6 py-3",children:"Customer"}),(0,d.jsx)("th",{className:"px-6 py-3",children:"Title"}),(0,d.jsx)("th",{className:"px-6 py-3",children:"Promised By"}),(0,d.jsx)("th",{className:"px-6 py-3 text-right",children:"Balance Due"}),(0,d.jsx)("th",{className:"px-6 py-3 text-center",children:"Status"}),(0,d.jsx)("th",{className:"px-6 py-3 text-center",children:"Actions"})]})}),(0,d.jsxs)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:[s.map(e=>(0,d.jsxs)("tr",{className:"hover:bg-muted dark:hover:bg-dark-muted cursor-pointer",onClick:()=>r(e),children:[(0,d.jsx)("td",{className:"px-6 py-4 font-bold text-foreground dark:text-dark-foreground",children:e.id}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.customerName}),(0,d.jsx)("td",{className:"px-6 py-4",children:e.jobTitle}),(0,d.jsx)("td",{className:"px-6 py-4",children:new Date(e.promisedDate).toLocaleDateString()||"-"}),(0,d.jsx)("td",{className:"px-6 py-4 font-mono text-right font-semibold text-danger",children:e.balanceDue.toFixed(2)}),(0,d.jsx)("td",{className:"px-6 py-4 text-center",children:(0,d.jsx)(aP,{status:e.status})}),(0,d.jsx)("td",{className:"px-6 py-4 text-center",children:(0,d.jsx)("button",{className:"font-medium text-primary dark:text-dark-primary hover:underline",children:"View"})})]},e.id)),0===s.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:7,className:"text-center py-10",children:"No work orders found."})})]})]})})]})]})};let aI=o.forwardRef((e,t)=>{let{workOrder:r,materials:a,users:s,settings:o}=e,n=s.find(e=>e.id===r.assignedTo);return(0,d.jsxs)("div",{ref:t,className:"bg-white p-8 font-sans text-sm text-black w-full max-w-4xl mx-auto shadow-lg border",children:[(0,d.jsxs)("header",{className:"flex justify-between items-start pb-4 border-b border-black",children:[(0,d.jsxs)("div",{children:[o.businessInfo.logoUrl&&(0,d.jsx)("img",{src:o.businessInfo.logoUrl,alt:"Company Logo",className:"h-16 max-w-xs object-contain mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:o.businessInfo.name}),(0,d.jsx)("p",{className:"text-slate-600",children:o.businessInfo.location}),(0,d.jsxs)("p",{className:"text-slate-600",children:["Tel: ",o.businessInfo.phone]}),o.tax.etimsEnabled&&o.businessInfo.kraPin&&(0,d.jsxs)("p",{className:"text-slate-600",children:["PIN: ",o.businessInfo.kraPin]})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold uppercase text-slate-700 tracking-wide",children:"Job Card"}),(0,d.jsxs)("div",{className:"mt-2 text-xs",children:[(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Job Card #:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:r.id})]}),(0,d.jsxs)("p",{className:"flex justify-end gap-2",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Date:"})," ",(0,d.jsx)("span",{className:"font-semibold",children:new Date(r.createdAt).toLocaleDateString("en-GB",{timeZone:"Africa/Nairobi"})})]})]})]})]}),(0,d.jsxs)("section",{className:"mt-8 grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Customer Details"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:r.customerName})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Promised Date"}),(0,d.jsx)("p",{className:"font-bold text-slate-800",children:r.promisedDate?new Date(r.promisedDate).toLocaleDateString("en-GB"):"N/A"})]})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Service Details"}),(0,d.jsxs)("div",{className:"p-3 border rounded-md",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{className:"font-semibold",children:"Item to be Serviced:"})," ",r.jobTitle]}),(0,d.jsx)("p",{className:"mt-2",children:(0,d.jsx)("span",{className:"font-semibold",children:"Customer Complaint / Description of Work:"})}),(0,d.jsx)("p",{className:"text-slate-600 whitespace-pre-wrap pl-2",children:r.description})]})]}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Materials & Labor"}),(0,d.jsxs)("table",{className:"w-full text-left",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-slate-100 text-slate-600 uppercase text-xs",children:[(0,d.jsx)("th",{className:"p-2 font-semibold",children:"Description"}),(0,d.jsx)("th",{className:"p-2 font-semibold text-center",children:"Qty"}),(0,d.jsx)("th",{className:"p-2 font-semibold text-right",children:"Unit Price"}),(0,d.jsx)("th",{className:"p-2 font-semibold text-right",children:"Total"})]})}),(0,d.jsxs)("tbody",{children:[a.map(e=>(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-2",children:e.name}),(0,d.jsx)("td",{className:"p-2 text-center",children:e.qty}),(0,d.jsx)("td",{className:"p-2 text-right font-mono",children:e.unitPrice.toFixed(2)}),(0,d.jsx)("td",{className:"p-2 text-right font-mono font-semibold",children:e.lineTotal.toFixed(2)})]},e.id)),(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("td",{className:"p-2",children:"Labor Charges"}),(0,d.jsx)("td",{className:"p-2 text-center",children:"1"}),(0,d.jsx)("td",{className:"p-2 text-right font-mono",children:r.labourAmount.toFixed(2)}),(0,d.jsx)("td",{className:"p-2 text-right font-mono font-semibold",children:r.labourAmount.toFixed(2)})]})]})]})]}),(0,d.jsx)("section",{className:"flex justify-end mt-4",children:(0,d.jsxs)("div",{className:"w-full max-w-xs space-y-1",children:[(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Subtotal:"}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:(r.materialsSubtotal+r.labourAmount).toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsxs)("span",{className:"text-slate-600",children:["VAT (",o.tax.vatRate,"%):"]}),(0,d.jsx)("span",{className:"font-mono text-slate-800",children:r.vatAmount.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-base font-bold border-t pt-1 mt-1",children:[(0,d.jsx)("span",{className:"text-slate-800",children:"Total Cost:"}),(0,d.jsxs)("span",{className:"font-mono text-slate-800",children:["Ksh ",r.totalCost.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Amount Paid:"}),(0,d.jsx)("span",{className:"font-mono text-green-600",children:r.amountPaid.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-1 mt-1 text-red-600",children:[(0,d.jsx)("span",{children:"Balance Due:"}),(0,d.jsxs)("span",{className:"font-mono",children:["Ksh ",r.balanceDue.toFixed(2)]})]})]})}),(0,d.jsxs)("section",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-xs uppercase font-bold text-slate-500 mb-2",children:"Technician's Report / Work Done"}),(0,d.jsx)("div",{className:"h-32 border-2 border-dashed rounded-md p-2 text-slate-600"})]}),(0,d.jsxs)("footer",{className:"mt-12 pt-4 border-t",children:[(0,d.jsx)("p",{className:"text-xs text-center text-slate-600",children:"I, the undersigned, confirm that the service described above has been completed to my satisfaction."}),(0,d.jsxs)("div",{className:"mt-8 grid grid-cols-2 gap-8 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"border-b border-black pb-1 mt-8"}),(0,d.jsx)("p",{className:"mt-1 font-semibold",children:"Client Signature"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"border-b border-black pb-1 mt-8",children:(null==n?void 0:n.name)||""}),(0,d.jsx)("p",{className:"mt-1 font-semibold",children:"Technician Signature"})]})]})]})]})}),aA=e=>{let{label:t,isActive:r,onClick:a}=e;return(0,d.jsxs)("button",{onClick:a,className:"px-4 py-2 font-semibold text-sm relative transition-colors ".concat(r?"text-primary dark:text-dark-primary":"text-foreground-muted dark:text-dark-foreground-muted"),children:[t,r&&(0,d.jsx)("div",{layoutId:"wo-detail-tab-underline",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary dark:bg-dark-primary"})]})},aM=e=>Promise.all(Array.from(e.getElementsByTagName("img")).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>t(),e.onerror=()=>{console.warn("Could not load image for PDF generation: ".concat(e.src)),t()})}))),aF=e=>{let{workOrder:t,materials:r,users:a,sales:s,settings:n,onBack:l,onUpdate:i,onPushToPOS:c}=e,[m,u]=(0,o.useState)(t.status),[x,h]=(0,o.useState)(t.assignedTo||""),[p,b]=(0,o.useState)("details"),g=(0,o.useRef)(null),[f,k]=(0,o.useState)(!1),y=t.balanceDue<=0,j=m!==t.status||x!==(t.assignedTo||""),v=s.filter(e=>e.workOrderId===t.id).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),w=e=>{if("Completed"===e&&!y){alert("This work order has an outstanding balance and cannot be marked as completed.");return}u(e)},N=async()=>{b("job_card"),setTimeout(async()=>{if(g.current&&!f){k(!0);try{await aM(g.current);let e=await eD()(g.current,{scale:2,useCORS:!0,backgroundColor:"#ffffff"}),r=e.toDataURL("image/png"),a=new eC.ZP("p","mm","a4"),s=a.internal.pageSize.getWidth(),d=e.height*s/e.width;a.addImage(r,"PNG",0,0,s,d),a.save("JobCard_".concat(t.id,".pdf"))}catch(e){console.error("Failed to generate PDF:",e),alert("Sorry, there was an error generating the PDF. The logo might be causing an issue.")}finally{k(!1)}}},100)};return(0,d.jsx)("div",{className:"p-4 md:p-6 bg-muted dark:bg-dark-muted min-h-full",children:(0,d.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center no-print",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Work Order Details"}),(0,d.jsx)("p",{className:"font-mono text-sm text-foreground-muted dark:text-dark-foreground-muted",children:t.id})]}),(0,d.jsx)("button",{onClick:l,className:"text-sm font-bold text-primary dark:text-dark-primary hover:underline self-end md:self-center",children:"← Back to List"})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center no-print",children:[(0,d.jsxs)("div",{className:"flex space-x-1 border-b border-border dark:border-dark-border",children:[(0,d.jsx)(aA,{label:"Details & Status",isActive:"details"===p,onClick:()=>b("details")}),(0,d.jsx)(aA,{label:"Job Card",isActive:"job_card"===p,onClick:()=>b("job_card")})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("button",{onClick:()=>{b("job_card"),setTimeout(()=>{window.print()},100)},whileTap:{scale:.95},className:"bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground font-semibold px-4 py-2 rounded-lg border border-border dark:border-dark-border",children:"Print"}),(0,d.jsx)("button",{onClick:N,disabled:f,whileTap:{scale:.95},className:"bg-primary text-primary-content font-semibold px-4 py-2 rounded-lg disabled:bg-slate-400",children:f?"Downloading...":"Download PDF"}),!y&&(0,d.jsxs)("button",{onClick:()=>c(t),whileTap:{scale:.95},className:"bg-primary text-primary-content font-bold py-2 px-4 rounded-lg",children:["Pay Balance (Ksh ",t.balanceDue.toFixed(2),")"]})]})]}),(0,d.jsx)("div",{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:"details"===p?(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs font-semibold text-foreground-muted",children:"Customer"}),(0,d.jsx)("p",{className:"font-bold",children:t.customerName})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs font-semibold text-foreground-muted",children:"Job Title"}),(0,d.jsx)("p",{className:"font-bold",children:t.jobTitle})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs font-semibold text-foreground-muted",children:"Promised By"}),(0,d.jsx)("p",{className:"font-bold",children:t.promisedDate?new Date(t.promisedDate).toLocaleDateString():"N/A"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs font-semibold text-foreground-muted",children:"Description"}),(0,d.jsx)("p",{className:"p-2 bg-muted dark:bg-dark-muted rounded mt-1 whitespace-pre-wrap text-sm",children:t.description})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-dark-border",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Status"}),(0,d.jsx)("select",{value:m,onChange:e=>w(e.target.value),className:"w-full mt-1 p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-card",children:["Pending","InProgress","Completed","Cancelled"].map(e=>(0,d.jsx)("option",{value:e,children:e},e))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium",children:"Assign to Technician"}),(0,d.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"w-full mt-1 p-2 border border-border dark:border-dark-border rounded-md bg-card dark:bg-dark-card",children:[(0,d.jsx)("option",{value:"",children:"Unassigned"}),a.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),j&&(0,d.jsx)("div",{className:"flex justify-end",children:(0,d.jsx)("button",{onClick:()=>{if("Completed"===m&&t.balanceDue>0){alert("Cannot save as 'Completed' while a balance is due. Please clear the balance first."),u(t.status);return}i({...t,status:m,assignedTo:x||void 0,updatedAt:new Date().toISOString()})},className:"bg-primary text-primary-content font-bold py-2 px-6 rounded-lg",children:"Save Changes"})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Financial Breakdown"}),(0,d.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Payment Status:"})," ",y?(0,d.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full text-green-800 bg-green-100 dark:bg-green-900/50 dark:text-green-300",children:"Fully Paid"}):t.amountPaid>0?(0,d.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full text-yellow-800 bg-yellow-100 dark:bg-yellow-900/50 dark:text-yellow-300",children:"Partially Paid"}):(0,d.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full text-red-800 bg-red-100 dark:bg-red-900/50 dark:text-red-300",children:"Unpaid"})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Labor Cost:"})," ",(0,d.jsx)("span",{className:"font-mono",children:t.labourAmount.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Materials Cost:"})," ",(0,d.jsx)("span",{className:"font-mono",children:t.materialsSubtotal.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsxs)("span",{className:"text-foreground-muted",children:["VAT (",n.tax.vatRate,"%):"]})," ",(0,d.jsx)("span",{className:"font-mono",children:t.vatAmount.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between font-bold border-t pt-1 mt-1",children:[(0,d.jsx)("span",{children:"Total Cost:"})," ",(0,d.jsx)("span",{className:"font-mono",children:t.totalCost.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-foreground-muted",children:"Total Paid:"})," ",(0,d.jsx)("span",{className:"font-mono text-green-600",children:t.amountPaid.toFixed(2)})]}),t.balanceDue>0?(0,d.jsxs)("div",{className:"flex justify-between font-bold text-lg text-danger pt-1 mt-1",children:[(0,d.jsx)("span",{children:"Balance Due:"})," ",(0,d.jsx)("span",{className:"font-mono",children:t.balanceDue.toFixed(2)})]}):t.balanceDue<0?(0,d.jsxs)("div",{className:"flex justify-between font-bold text-lg text-green-600 pt-1 mt-1",children:[(0,d.jsx)("span",{children:"Credit:"})," ",(0,d.jsx)("span",{className:"font-mono",children:Math.abs(t.balanceDue).toFixed(2)})]}):(0,d.jsxs)("div",{className:"flex justify-between font-bold text-lg text-green-600 pt-1 mt-1",children:[(0,d.jsx)("span",{children:"Balance:"})," ",(0,d.jsx)("span",{className:"font-mono",children:"0.00"})]})]})]}),(0,d.jsxs)("div",{className:"bg-card dark:bg-dark-card p-6 rounded-xl shadow-md",children:[(0,d.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Payment History"}),v.length>0?(0,d.jsx)("ul",{className:"divide-y dark:divide-dark-border text-sm",children:v.map(e=>(0,d.jsxs)("li",{className:"py-2",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:new Date(e.date).toLocaleDateString()}),(0,d.jsx)("span",{className:"font-mono font-semibold",children:e.total.toFixed(2)})]}),(0,d.jsx)("p",{className:"text-xs text-foreground-muted",children:e.items[0].name})]},e.id))}):(0,d.jsx)("p",{className:"text-sm text-foreground-muted",children:"No payments recorded for this work order yet."})]})]})]}):(0,d.jsx)("div",{className:"print-area",children:(0,d.jsx)(aI,{ref:g,workOrder:t,materials:r,users:a,settings:n})})},p)]})})},aL=e=>{let{label:t,value:r,valueClassName:a,isBold:s}=e;return(0,d.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 ".concat(s?"font-bold":""),children:[(0,d.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,d.jsx)("span",{className:"text-sm text-gray-800 ".concat(a||""),children:r})]})};var aO=e=>{let{payment:t,invoice:r,po:a,supplier:s,user:o,settings:n}=e,l=r.paidAmount-t.amount,i=r.totalAmount-r.paidAmount,c="#2EAF7D";return(0,d.jsxs)("div",{className:"bg-white p-8 font-sans text-gray-800 w-full max-w-2xl mx-auto my-4 border border-gray-200 shadow-md",children:[(0,d.jsxs)("header",{className:"text-center mb-8",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold uppercase",style:{color:c},children:n.businessInfo.name||"CRENEN LOGISTICS"}),(0,d.jsx)("p",{className:"text-xs text-gray-500",children:n.businessInfo.location||"MTWAPA - KILIFI"}),(0,d.jsxs)("p",{className:"text-xs text-gray-500",children:["Tel: ",n.businessInfo.phone," | Email: ",n.businessInfo.email]}),(0,d.jsx)("h2",{className:"text-lg font-semibold mt-4 tracking-wider border-b-2 pb-2",style:{borderColor:c},children:"SUPPLIER PAYMENT RECONCILIATION"})]}),(0,d.jsxs)("section",{className:"mb-6 p-4 border rounded-md border-gray-300",children:[(0,d.jsx)("h3",{className:"text-md font-semibold mb-2",style:{color:c,borderBottom:"2px solid ".concat(c),paddingBottom:"0.5rem"},children:"Payment Details"}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(aL,{label:"Transaction Number:",value:t.id}),(0,d.jsx)(aL,{label:"Payment Date:",value:new Date(t.paymentDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}),(0,d.jsx)(aL,{label:"Purchase Order:",value:a.poNumber}),(0,d.jsx)(aL,{label:"Supplier:",value:s.businessName||s.name}),(0,d.jsx)(aL,{label:"Payment Method:",value:t.method}),(0,d.jsx)(aL,{label:"Reference Number:",value:t.referenceNumber||"N/A"}),(0,d.jsx)(aL,{label:"Processed By:",value:t.processedByName})]})]}),(0,d.jsxs)("section",{className:"mb-6 p-4 border rounded-md",style:{borderColor:c,backgroundColor:"rgba(46, 175, 125, 0.1)"},children:[(0,d.jsx)("p",{className:"text-sm font-semibold uppercase text-center",style:{color:c},children:"Amount Paid"}),(0,d.jsxs)("p",{className:"text-3xl font-bold text-center mt-1",style:{color:c},children:[n.businessInfo.currency," ",t.amount.toFixed(2)]}),(0,d.jsx)("p",{className:"text-xs text-gray-600 text-center mt-2",children:"This payment has been recorded and applied to the account"})]}),(0,d.jsxs)("section",{className:"p-4 border-2 rounded-md",style:{borderColor:"#E95E4D",backgroundColor:"rgba(233, 94, 77, 0.05)"},children:[(0,d.jsx)("h3",{className:"text-md font-semibold mb-2",style:{color:c,borderBottom:"2px solid ".concat(c),paddingBottom:"0.5rem"},children:"Account Balance Summary"}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(aL,{label:"Original PO Total:",value:"".concat(n.businessInfo.currency," ").concat(a.totalCost.toFixed(2))}),(0,d.jsx)(aL,{label:"Previous Payments:",value:"".concat(n.businessInfo.currency," ").concat(l.toFixed(2)),valueClassName:"text-red-500"}),(0,d.jsx)(aL,{label:"This Payment:",value:"".concat(n.businessInfo.currency," ").concat(t.amount.toFixed(2))}),(0,d.jsx)("div",{className:"border-t border-gray-600 my-2"}),(0,d.jsx)(aL,{label:"New Balance Due:",value:"".concat(n.businessInfo.currency," ").concat(i.toFixed(2)),isBold:!0,valueClassName:"text-xl"})]}),i<=0&&(0,d.jsx)("div",{className:"mt-4 p-3 text-center rounded-md font-bold text-white",style:{backgroundColor:c},children:"✓ ACCOUNT FULLY PAID"})]}),(0,d.jsx)("section",{className:"mt-16 flex justify-end",children:(0,d.jsxs)("div",{className:"w-1/2 text-center",children:[(0,d.jsx)("div",{className:"border-b border-gray-400"}),(0,d.jsx)("p",{className:"text-sm font-semibold mt-2",children:"Authorized Signature"}),(0,d.jsxs)("p",{className:"text-xs text-gray-500",children:[n.businessInfo.name," - Accounts Department"]})]})}),(0,d.jsxs)("footer",{className:"text-center mt-16 text-xs text-gray-500",children:[(0,d.jsx)("p",{className:"font-bold",children:n.businessInfo.name}),(0,d.jsx)("p",{children:n.businessInfo.location}),(0,d.jsx)("div",{className:"my-4 border-t border-gray-200"}),(0,d.jsx)("p",{children:"This is an official payment reconciliation document"}),(0,d.jsxs)("p",{children:["Generated on ",new Date().toLocaleString()]}),(0,d.jsx)("p",{className:"mt-2",children:"This document serves as proof of payment and account reconciliation."}),(0,d.jsx)("p",{className:"mt-1 font-semibold",children:"Powered by Banduka POS™"})]})]})},aR=e=>{let{info:t,user:r,settings:a,onDone:s}=e;return(0,d.jsx)("div",{className:"h-full flex flex-col bg-background dark:bg-dark-background p-4 md:p-8 md:items-center md:justify-center",children:(0,d.jsxs)("div",{className:"w-full max-w-5xl flex flex-col md:flex-row gap-8 h-full md:h-auto",children:[(0,d.jsxs)("div",{className:"flex-shrink-0 md:flex-grow bg-card dark:bg-dark-card p-8 rounded-2xl shadow-lg text-center flex flex-col items-center justify-center no-print",children:[(0,d.jsx)("div",{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20,delay:.2},className:"bg-success/10 dark:bg-dark-success/10 rounded-full p-4 mb-4",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-success dark:text-dark-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"Payment Recorded!"}),(0,d.jsxs)("p",{className:"text-foreground/70 dark:text-dark-foreground/70 mt-2",children:["Payment of ",a.businessInfo.currency," ",t.payment.amount.toFixed(2)," to ",t.supplier.name," has been successfully recorded."]}),(0,d.jsxs)("div",{className:"mt-8 flex flex-wrap justify-center gap-4",children:[(0,d.jsx)("button",{onClick:s,whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-primary dark:bg-dark-primary text-primary-content dark:text-dark-primary-content font-bold py-3 px-8 rounded-xl",children:"Done"}),(0,d.jsx)("button",{onClick:()=>{window.print()},whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-foreground/80 dark:bg-dark-border text-white font-bold py-3 px-6 rounded-lg hover:bg-foreground dark:hover:bg-dark-border/80",children:"Print Reconciliation"})]})]}),(0,d.jsx)("div",{className:"flex-grow w-full md:w-auto md:flex-grow-0 flex-shrink-0 overflow-y-auto print-area",children:(0,d.jsx)("div",{id:"receipt-container",style:{width:"210mm"},children:(0,d.jsx)("div",{id:"receipt-to-print",children:(0,d.jsx)(aO,{...t,user:r,settings:a})})})})]})})};let aB=[{key:"name",label:"Product Name",required:!0,aliases:["name","productname","title","item"]},{key:"price",label:"Selling Price",required:!0,aliases:["price","sellingprice","saleprice","rate"]},{key:"stock",label:"Stock Quantity",required:!0,aliases:["stock","quantity","qty","onhand","stockonhand"]},{key:"costPrice",label:"Cost Price",required:!1,aliases:["cost","costprice","unitcost","purchaseprice"]},{key:"inventoryCode",label:"SKU / Inventory Code",required:!1,aliases:["sku","inventorycode","code","itemcode"]},{key:"upc",label:"UPC / Barcode",required:!1,aliases:["upc","barcode","ean"]},{key:"category",label:"Category",required:!1,aliases:["category","type","department"]},{key:"description",label:"Description",required:!1,aliases:["description","desc"]},{key:"unitOfMeasure",label:"Unit of Measure",required:!1,aliases:["unit","unitofmeasure","uom"]}];var a_=e=>{let{onClose:t,onImportConfirm:r,csvHeaders:a,csvPreview:s}=e,n=(0,o.useMemo)(()=>{let e={},t=a.map(e=>e.toLowerCase().replace(/[\s_-]/g,""));return aB.forEach(r=>{for(let s of r.aliases){let d=t.indexOf(s);if(-1!==d){e[r.key]=a[d];break}}}),e},[a]),[l,i]=(0,o.useState)(n),c=(e,t)=>{i(r=>({...r,[e]:t}))},m=(0,o.useMemo)(()=>aB.every(e=>!e.required||l[e.key]&&"__do_not_import__"!==l[e.key]),[l]);return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:t,children:(0,d.jsxs)("div",{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-card dark:bg-dark-card rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex-shrink-0 p-6 border-b border-border dark:border-dark-border",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Map CSV Columns to Product Fields"}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mt-1",children:"Match the columns from your uploaded file to the required fields in the application."})]}),(0,d.jsxs)("div",{className:"flex-grow p-6 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h3",{className:"font-semibold text-lg",children:"Field Mapping"}),aB.map(e=>(0,d.jsxs)("div",{children:[(0,d.jsxs)("label",{className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:[e.label," ",e.required&&(0,d.jsx)("span",{className:"text-danger",children:"*"})]}),(0,d.jsxs)("select",{value:l[e.key]||"__do_not_import__",onChange:t=>c(e.key,t.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-border dark:border-dark-border bg-background dark:bg-dark-background focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",children:[(0,d.jsx)("option",{value:"__do_not_import__",children:"-- Do not import --"}),a.map(e=>(0,d.jsx)("option",{value:e,children:e},e))]})]},e.key))]}),(0,d.jsxs)("div",{className:"overflow-x-auto",children:[(0,d.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Data Preview"}),(0,d.jsx)("div",{className:"border border-border dark:border-dark-border rounded-lg overflow-hidden",children:(0,d.jsxs)("table",{className:"w-full text-xs text-left",children:[(0,d.jsx)("thead",{className:"bg-muted dark:bg-dark-muted",children:(0,d.jsx)("tr",{children:a.map((e,t)=>(0,d.jsx)("th",{className:"p-2 font-semibold truncate",children:e},t))})}),(0,d.jsx)("tbody",{className:"divide-y divide-border dark:divide-dark-border",children:s.map((e,t)=>(0,d.jsx)("tr",{children:e.map((e,t)=>(0,d.jsx)("td",{className:"p-2 truncate",children:e},t))},t))})]})}),(0,d.jsxs)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted mt-2",children:["Showing first ",s.length," rows of your file."]})]})]}),(0,d.jsxs)("div",{className:"flex-shrink-0 flex justify-between items-center p-6 border-t border-border dark:border-dark-border",children:[(0,d.jsx)("p",{className:"text-xs text-foreground-muted dark:text-dark-foreground-muted",children:"* Required fields"}),(0,d.jsxs)("div",{className:"flex space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:t,className:"bg-muted dark:bg-dark-muted text-foreground dark:text-dark-foreground font-bold px-4 py-2 rounded-lg",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>r(l),disabled:!m,className:"bg-primary text-primary-content font-bold px-6 py-2 rounded-lg disabled:bg-slate-400",children:"Confirm & Import"})]})]})]})})},aE=e=>{let{message:t}=e;return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",style:{zIndex:9999},children:(0,d.jsxs)("div",{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{type:"spring",stiffness:400,damping:30},className:"bg-card dark:bg-dark-card rounded-2xl shadow-2xl w-full max-w-md p-6 text-center",children:[(0,d.jsx)("h3",{className:"text-xl font-bold text-foreground dark:text-dark-foreground mb-4",children:"Processing..."}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted mb-6",children:t}),(0,d.jsx)("div",{className:"w-full bg-muted dark:bg-dark-muted rounded-full h-4 overflow-hidden border border-border dark:border-dark-border",children:(0,d.jsx)("div",{className:"bg-primary h-4 rounded-full",initial:{width:"0%"},animate:{width:"100%"},transition:{duration:2.5,ease:"easeInOut"}})})]})})};y.E.div;let aq=e=>{let t=[],r="",a=!1;for(let s=0;s<e.length;s++){let d=e[s];a?'"'===d?s+1<e.length&&'"'===e[s+1]?(r+='"',s++):a=!1:r+=d:'"'===d?a=!0:","===d?(t.push(r),r=""):r+=d}return t.push(r),t},aV=e=>{let{currentUser:t,onLogout:r,allUsers:a,onAddUser:l,onUpdateUser:i,onDeleteUser:c}=e,[m]=S(),[u,x]=(0,o.useState)(!0),[h,y]=(0,o.useState)(s.Dashboard),[j,w]=(0,o.useState)(!1),[N,C]=(0,o.useState)([]),[D,P]=(0,o.useState)(null),[T,I]=(0,o.useState)(null),[A,M]=(0,o.useState)(!1),[F,L]=(0,o.useState)(!1),[O,R]=(0,o.useState)([]),[B,E]=(0,o.useState)([]),[q,V]=(0,o.useState)([]),[H,U]=(0,o.useState)([]),[W,Z]=(0,o.useState)([]),[z,G]=(0,o.useState)([]),[Q,Y]=(0,o.useState)([]),[X,J]=(0,o.useState)([]),[ee,et]=(0,o.useState)(a),[er,ea]=(0,o.useState)(v),[es,ed]=(0,o.useState)([]),[en,el]=(0,o.useState)([]),[ei,ec]=(0,o.useState)([]),[em,eu]=(0,o.useState)([]),[ex,eh]=(0,o.useState)([]),[ep,eb]=(0,o.useState)([]),[eg,ef]=(0,o.useState)([]),[ek,ey]=(0,o.useState)([]),[ej,ew]=(0,o.useState)([]),[eN,eC]=(0,o.useState)([]),[eS,eD]=(0,o.useState)([]),[eP,eT]=(0,o.useState)([]),[eI,eA]=(0,o.useState)([]),[eM,eF]=(0,o.useState)(""),[eL,eO]=(0,o.useState)(null),[eR,e_]=(0,o.useState)(null),[eE,eq]=(0,o.useState)(!1),[eV,eH]=(0,o.useState)(null),[eU,eW]=(0,o.useState)(null),[eZ,ez]=(0,o.useState)(null),[eK,eG]=(0,o.useState)(null),[eQ,eY]=(0,o.useState)(null),[eX,eJ]=(0,o.useState)(null),[e$,e2]=(0,o.useState)(null),[e1,e4]=(0,o.useState)(null),[e3,e6]=(0,o.useState)(null),[e9,e8]=(0,o.useState)(null),[e7,te]=(0,o.useState)(!1),[tr,ta]=(0,o.useState)(null),[ts,td]=(0,o.useState)(null),[to,tn]=(0,o.useState)(null),[tl,ti]=(0,o.useState)(null),[tm,tu]=(0,o.useState)(null),[tp,tg]=(0,o.useState)(null),[tf,tk]=(0,o.useState)(null),[ty,tj]=(0,o.useState)(!1),[tv,tw]=(0,o.useState)(null),[tN,tC]=(0,o.useState)(null),[tS,tD]=(0,o.useState)(null),[tP,tT]=(0,o.useState)(!1),[tI,tA]=(0,o.useState)(null),[tM,tF]=(0,o.useState)(!1),[tL,tO]=(0,o.useState)(!1),[tB,t_]=(0,o.useState)(null),[tE,tq]=(0,o.useState)(null),[tH,tW]=(0,o.useState)(null),[tZ,tz]=(0,o.useState)(null),[tK,tG]=(0,o.useState)(null),[tY,tX]=(0,o.useState)(!1),[tJ,t$]=(0,o.useState)(!1),[t0,t1]=(0,o.useState)(!1),[t3,t5]=(0,o.useState)(null),[t6,t9]=(0,o.useState)(null),[t8,t7]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{let e;if(!(null==t?void 0:t.pin)){M(!1);return}let r=()=>{clearTimeout(e),e=setTimeout(()=>M(!0),3e5)},a=["mousemove","mousedown","keypress","touchstart"];return a.forEach(e=>window.addEventListener(e,r)),r(),()=>{clearTimeout(e),a.forEach(e=>window.removeEventListener(e,r))}},[t]),(0,o.useEffect)(()=>{et(a)},[a]);let rd=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r={id:Date.now(),message:e,type:t};C(e=>[r]),setTimeout(()=>{C(e=>e.filter(e=>e.id!==r.id))},3e3)},[]);(0,o.useEffect)(()=>{let e=e=>{P(e.detail)};window.addEventListener("new-sw-update",e);let t=e=>{e.preventDefault(),I(e)};return window.addEventListener("beforeinstallprompt",t),()=>{window.removeEventListener("new-sw-update",e),window.removeEventListener("beforeinstallprompt",t)}},[]),(0,o.useEffect)(()=>{(async()=>{try{var e,r,a,s,d,o;let[n,l,i,c,m,u,x,h,f,k,y,j,w,N,C,S,D,P,T,I,A]=await Promise.all([p("products"),p("customers"),p("sales"),p("suppliers"),p("purchaseOrders"),p("supplierInvoices"),p("supplierPayments"),p("quotations"),b("settings",v.id),p("auditLogs"),p("shifts"),p("timeClockEvents"),p("payouts"),p("layaways"),p("workOrders"),p("salesOrders"),p("heldReceipts"),p("workOrderMaterials"),p("chartOfAccounts"),p("accountingTransactions"),p("bankDeposits")]),M=l.find(e=>"cust001"===e.id);M||(M={id:"cust001",name:"Walk-in Customer",phone:"N/A",email:"walkin@example.com",address:"N/A",city:"N/A",dateAdded:new Date,loyaltyPoints:0},await g("customers",M),l.unshift(M)),R(n),E(l),V(i),U(c),Z(m),G(u),Y(x),J(h),ed(k.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())),el(y),eu(j),ec(w),eh(N),eb(C),ef(S),ey(D),ew(P),eD(I),eT(A);let F=T;if(0===F.length){let e=[{id:"acc_cash",code:"1010",name:"Cash on Hand",type:"Assets",isEditable:!1},{id:"acc_mpesa",code:"1020",name:"M-Pesa Till",type:"Assets",isEditable:!1},{id:"acc_card",code:"1030",name:"Card/Bank Payments",type:"Assets",isEditable:!1},{id:"acc_inventory",code:"1200",name:"Inventory Asset",type:"Assets",isEditable:!1},{id:"acc_vat_receivable",code:"1300",name:"VAT Receivable",type:"Assets",isEditable:!1},{id:"acc_ap",code:"2010",name:"Accounts Payable",type:"Liabilities",isEditable:!1},{id:"acc_cust_deposits",code:"2200",name:"Customer Deposits",type:"Liabilities",isEditable:!1},{id:"acc_vat_payable",code:"2310",name:"VAT Payable",type:"Liabilities",isEditable:!1},{id:"acc_shift_clearing",code:"2500",name:"Shift Float Clearing",type:"Liabilities",isEditable:!1},{id:"acc_sales",code:"4010",name:"Sales Revenue",type:"Revenue",isEditable:!1},{id:"acc_sales_returns",code:"4510",name:"Sales Returns & Allowances",type:"Contra Revenue",isEditable:!1},{id:"acc_cogs",code:"5010",name:"Cost of Goods Sold",type:"Expenses",isEditable:!1}];for(let t of e)await g("chartOfAccounts",t);F=e}eC(F);let L=f;if(L?L={...v,...L,businessInfo:{...v.businessInfo,...L.businessInfo||{}},tax:{...v.tax,...L.tax||{}},discount:{...v.discount,...L.discount||{}},receipt:{...v.receipt,...L.receipt||{}},layaway:{...v.layaway,...L.layaway||{}},hardware:{...v.hardware,...L.hardware||{},printer:{...v.hardware.printer,...(null===(s=L.hardware)||void 0===s?void 0:s.printer)||{}},barcodeScanner:{...v.hardware.barcodeScanner,...(null===(d=L.hardware)||void 0===d?void 0:d.barcodeScanner)||{}},barcodePrinter:{...v.hardware.barcodePrinter,...(null===(o=L.hardware)||void 0===o?void 0:o.barcodePrinter)||{}}},loyalty:{...v.loyalty,...L.loyalty||{}},measurements:{...v.measurements,...L.measurements||{}},permissions:{...v.permissions,...L.permissions||{}},paymentMethods:{...v.paymentMethods,...L.paymentMethods||{}},inventory:{...v.inventory,...L.inventory||{}},accounting:{...v.accounting,...L.accounting||{}}}:(L=v,await g("settings",v)),!(null===(e=L.accounting)||void 0===e?void 0:e.defaultCashAccountId)||!(null===(r=L.accounting)||void 0===r?void 0:r.defaultShiftClearingId)||!(null===(a=L.accounting)||void 0===a?void 0:a.defaultCustomerDepositsId)){let e={...L.accounting,defaultCashAccountId:"acc_cash",defaultMpesaAccountId:"acc_mpesa",defaultCardAccountId:"acc_card",defaultBankAccountId:"acc_card",defaultSalesAccountId:"acc_sales",defaultVatPayableAccountId:"acc_vat_payable",defaultVatReceivableAccountId:"acc_vat_receivable",defaultCogsAccountId:"acc_cogs",defaultInventoryAccountId:"acc_inventory",defaultSalesReturnAccountId:"acc_sales_returns",defaultAccountsPayableId:"acc_ap",defaultCustomerDepositsId:"acc_cust_deposits",defaultShiftClearingId:"acc_shift_clearing"};L={...L,accounting:e},await g("settings",L)}ea(L);let O=y.find(e=>e.userId===t.id&&"active"===e.status);eO(O||null);let B=j.find(e=>e.userId===t.id&&"clocked-in"===e.status);e_(B||null),eF(M.id)}catch(e){console.error("Error loading data:",e),rd("Error loading data from the database.","error")}finally{x(!1)}})()},[t.id,rd]);let ro=(0,o.useMemo)(()=>er.permissions[t.role]||[],[er.permissions,t.role]),rl=e=>{ez(null),eG(null),eY(null),eJ(null),td(null),tu(null),tg(null),y(e),w(!1)},ri=(0,o.useCallback)(()=>{var e;eA([]),tC(null),tq(null),tW(null),eF((null===(e=B.find(e=>"cust001"===e.id))||void 0===e?void 0:e.id)||"")},[B]),ru=async e=>{try{let t={...er,...e};ea(t),await g("settings",t)}catch(e){console.error("Failed to update settings",e),rd("Failed to save settings.","error")}},rp=(0,o.useCallback)(async(e,r)=>{if(t)try{let a={id:"log_".concat(Date.now()),timestamp:new Date,userId:t.id,userName:t.name,action:e,details:r};await g("auditLogs",a),ed(e=>[a,...e])}catch(t){console.error("Failed to write to audit log.",{action:e,details:r,error:t})}},[t]),rb=(0,o.useCallback)(async()=>{if("ESC/POS"!==er.hardware.printer.type){rd("Open Drawer is only available for ESC/POS direct printers.","info");return}try{await _(er.hardware.printer),rd("Open drawer signal sent!","success"),t&&await rp("Cash Drawer Opened","User ".concat(t.name," opened the cash drawer manually."))}catch(e){console.error("Open drawer error:",e),rd(e.message||"Failed to open drawer.","error")}},[er.hardware.printer,rd,rp,t]),rf=(0,o.useCallback)(e=>{if("Inventory"===e.productType&&e.stock<=0){rd("".concat(e.name," is out of stock."),"error");return}eA(t=>{let r=t.find(t=>t.id===e.id);return r?"Inventory"===e.productType&&r.quantity>=e.stock?(rd("No more stock available for ".concat(e.name,"."),"error"),t):t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}]})},[O,rd]),rj=(0,o.useCallback)((e,t)=>{eA(r=>{if(!r.find(t=>t.id===e))return r;let a=O.find(t=>t.id===e);return(a&&"Inventory"===a.productType&&t>a.stock&&(rd("Only ".concat(a.stock," units of ").concat(a.name," available."),"info"),t=a.stock),t<=0)?r.filter(t=>t.id!==e):r.map(r=>r.id===e?{...r,quantity:t}:r)})},[O,rd]),rv=(0,o.useCallback)((e,t)=>{eA(r=>r.map(r=>r.id===e?{...r,discount:t}:r))},[]),rC=(0,o.useCallback)(e=>{eA(t=>t.filter(t=>t.id!==e))},[]),rP=(0,o.useCallback)(async(e,t,r,a)=>{try{let s=a.reduce((e,t)=>e+t.debit,0),d=a.reduce((e,t)=>e+t.credit,0);if(Math.abs(s-d)>.01){console.error("Accounting transaction does not balance!",{description:e,entries:a,totalDebits:s,totalCredits:d}),rd("Critical accounting error: ".concat(e," does not balance."),"error");return}let o={id:"trans_".concat(Date.now()),date:new Date,description:e,referenceId:t,referenceType:r,entries:a};await g("accountingTransactions",o),eD(e=>[...e,o])}catch(t){console.error("Failed to create accounting transaction.",{description:e,error:t}),rd("Failed to record transaction in General Ledger.","error")}},[rd]),rT=async e=>{if(eL){rd("A shift is already active.","error");return}if(!t){rd("Cannot start shift, no user logged in.","error");return}let r={id:"shift_".concat(Date.now(),"_").concat(t.id),userId:t.id,userName:t.name,startTime:new Date,status:"active",startingFloat:e,salesIds:[],expenseIds:[]};try{await g("shifts",r),el(e=>[...e,r]),eO(r);let{accounting:a}=er;a.defaultCashAccountId&&a.defaultShiftClearingId&&e>0&&await rP("Starting Float for Shift ".concat(r.id),r.id,"ShiftFloat",[{accountId:a.defaultCashAccountId,debit:e,credit:0},{accountId:a.defaultShiftClearingId,debit:0,credit:e}]);let s={id:"tc_".concat(Date.now(),"_").concat(t.id),userId:t.id,userName:t.name,clockInTime:new Date,status:"clocked-in"};await g("timeClockEvents",s),eu(e=>[...e,s]),e_(s),await rp("Shift Started","User ".concat(t.name," started a new shift with a float of KES ").concat(e,".")),rd("Shift started for ".concat(t.name,"."),"success")}catch(e){console.error("Failed to start shift:",e),rd("Failed to start a new shift.","error")}},rI=async(e,r)=>{if(!eL||!eR){rd("No active shift or clock-in event to end.","error");return}let a=q.filter(e=>eL.salesIds.includes(e.id)),s=ei.filter(e=>{var t;return null===(t=eL.expenseIds)||void 0===t?void 0:t.includes(e.id)}),d={},o=0;a.forEach(e=>{e.payments.forEach(e=>{d[e.method]=(d[e.method]||0)+e.amount}),o+=e.change});let n=a.reduce((e,t)=>e+t.total,0),l=s.reduce((e,t)=>e+t.amount,0),i=(d.Cash||0)-o,c=eL.startingFloat+i-l,m=e-c,u={...eL,endTime:new Date,status:"closed",salesIds:a.map(e=>e.id),expenseIds:s.map(e=>e.id),paymentBreakdown:d,totalSales:n,totalPayouts:l,expectedCashInDrawer:c,actualCashInDrawer:e,cashVariance:m};try{await g("shifts",u);let{accounting:e}=er,a=u.startingFloat;e.defaultCashAccountId&&e.defaultShiftClearingId&&a>0&&await rP("Ending Float for Shift ".concat(u.id),u.id,"ShiftFloat",[{accountId:e.defaultShiftClearingId,debit:a,credit:0},{accountId:e.defaultCashAccountId,debit:0,credit:a}]),el(e=>e.map(e=>e.id===u.id?u:e)),eO(null),eH(u),eq(!1);let s={...eR,clockOutTime:new Date,status:"clocked-out",notes:r};await g("timeClockEvents",s),eu(e=>e.map(e=>e.id===s.id?s:e)),e_(null),await rp("Shift Ended","User ".concat(t.name," ended shift ").concat(u.id," with a variance of KES ").concat(m,".")),rd("Shift ended successfully.","success")}catch(e){console.error("Failed to end shift:",e),rd("An error occurred while ending the shift.","error")}},rA=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let r=ep.find(t=>t.id===e.id);if(r&&"Cancelled"===e.status&&"Cancelled"!==r.status){let e=[...O],t=!1;for(let a of ej.filter(e=>e.workOrderId===r.id)){let r=e.findIndex(e=>e.id===a.materialId);if(-1!==r&&"Inventory"===e[r].productType){let s=e[r];e[r]={...s,reservedStock:Math.max(0,(s.reservedStock||0)-a.qty)},await g("products",e[r]),t=!0}}t&&R(e)}eb(t=>t.map(t=>t.id===e.id?e:t)),await g("workOrders",e),t||rd("Work Order #".concat(e.id," updated."),"success"),tu(e)}catch(t){console.error("Failed to update work order:",{workOrderId:e.id,error:t}),rd("Error updating work order.","error")}},rM=async e=>{if(!eL||!t)throw Error("Cannot complete sale. No active shift or user.");try{var r;let{accounting:a}=er,s=er.loyalty.enabled?Math.floor((e.total+(e.depositApplied||0))/er.loyalty.pointsPerKsh):0,d={quotationId:tH||void 0,workOrderId:e.workOrderId||tN||void 0,salesOrderId:e.salesOrderId||tE||void 0,layawayId:e.layawayId||void 0},o={...e,...d,id:"".concat(er.receipt.invoicePrefix).concat(Date.now()),synced:!1,cashierId:t.id,cashierName:t.name,shiftId:eL.id,pointsEarned:s,pointsBalanceAfter:0},n=[...O],l=eg.find(e=>e.id===o.salesOrderId&&!o.items.some(e=>e.id.startsWith("SO_DEPOSIT"))),i=ep.find(e=>e.id===o.workOrderId&&!o.items.some(e=>e.id.startsWith("WO_DEPOSIT_")));if(l){for(let e of l.items)if(e.productId&&e.quantity>0){let t=n.findIndex(t=>t.id===e.productId);if(-1!==t&&"Inventory"===n[t].productType){let r=n[t],a=r.stock-e.quantity,s=(r.reservedStock||0)-e.quantity;n[t]={...r,stock:a,reservedStock:Math.max(0,s)},await g("products",n[t])}}}else if(i){for(let e of ej.filter(e=>e.workOrderId===i.id))if(e.materialId){let t=n.findIndex(t=>t.id===e.materialId);if(-1!==t&&"Inventory"===n[t].productType){let r=n[t],a=r.stock-e.qty,s=(r.reservedStock||0)-e.qty;n[t]={...r,stock:a,reservedStock:Math.max(0,s)},await g("products",n[t])}}}else for(let e of o.items)if("Inventory"===e.productType){let t=n.findIndex(t=>t.id===e.id);if(-1!==t){let r=n[t],a=r.stock-e.quantity;n[t]={...r,stock:a},await g("products",n[t])}}if(R(n),er.loyalty.enabled&&"cust001"!==o.customerId){let e=B.findIndex(e=>e.id===o.customerId);if(-1!==e){let t=B[e],r=t.loyaltyPoints+s-o.pointsUsed;o.pointsBalanceAfter=r;let a={...t,loyaltyPoints:r},d=[...B];d[e]=a,E(d),await g("customers",a)}}if(o.quotationId){let e=X.find(e=>e.id===o.quotationId);if(e){let t={...e,status:"Invoiced"};await ac(t)}}if(o.salesOrderId){let e=eg.find(e=>e.id===o.salesOrderId);if(e){if(o.items.some(e=>e.id.startsWith("SO_DEPOSIT")))o.grandTotal=e.total,o.depositApplied=0,o.balanceDue=e.balance;else{o.grandTotal=e.total,o.depositApplied=e.deposit,o.balanceDue=0;let t={...e,balance:0,status:"Completed"};await r8(t)}}}else if(o.workOrderId){let e=ep.find(e=>e.id===o.workOrderId);if(e){if(o.items.some(e=>e.id.startsWith("WO_DEPOSIT_"))){o.grandTotal=e.totalCost,o.depositApplied=0;let t=e.amountPaid+o.total;o.balanceDue=e.totalCost-t;let r={...e,amountPaid:t,balanceDue:o.balanceDue};if(await rA(r,!0),a.defaultCustomerDepositsId){let t=[];o.payments.forEach(e=>{let r="";if("Cash"===e.method&&(r=a.defaultCashAccountId),"M-Pesa"===e.method&&(r=a.defaultMpesaAccountId),"Card"===e.method&&(r=a.defaultCardAccountId),"Points"===e.method&&o.pointsValue>0)t.push({accountId:a.defaultSalesAccountId,debit:o.pointsValue,credit:0});else if(r){let a="Cash"===e.method?e.amount-o.change:e.amount;a>0&&t.push({accountId:r,debit:a,credit:0})}});let r=o.total+o.pointsValue;await rP("Deposit for Work Order ".concat(e.id),o.id,"WorkOrderDeposit",[...t,{accountId:a.defaultCustomerDepositsId,debit:0,credit:r}])}}else{let t=o.total,r=e.amountPaid+t,s=e.totalCost-r;o.grandTotal=e.totalCost,o.depositApplied=e.amountPaid,o.balanceDue=s;let d=s<=0,n={...e,status:d?"Completed":e.status,updatedAt:new Date().toISOString(),amountPaid:r,balanceDue:s};if(await rA(n,!0),a.defaultCustomerDepositsId&&a.defaultSalesAccountId){let r=[];o.payments.forEach(e=>{let t="";if("Cash"===e.method&&(t=a.defaultCashAccountId),"M-Pesa"===e.method&&(t=a.defaultMpesaAccountId),"Card"===e.method&&(t=a.defaultCardAccountId),"Points"===e.method&&o.pointsValue>0)r.push({accountId:a.defaultSalesAccountId,debit:o.pointsValue,credit:0});else if(t){let a="Cash"===e.method?e.amount-o.change:e.amount;a>0&&r.push({accountId:t,debit:a,credit:0})}}),d?await rP("Final Payment for Work Order ".concat(e.id),o.id,"Sale",[...r,{accountId:a.defaultCustomerDepositsId,debit:e.amountPaid,credit:0},{accountId:a.defaultSalesAccountId,debit:0,credit:e.totalCost}]):await rP("Partial Payment for Work Order ".concat(e.id),o.id,"Sale",[...r,{accountId:a.defaultSalesAccountId,debit:0,credit:t}])}}}}await g("sales",o),V(e=>[o,...e]);let c={...eL,salesIds:[...eL.salesIds,o.id]};if(eO(c),el(e=>e.map(e=>e.id===c.id?c:e)),await g("shifts",c),!o.workOrderId||!o.items.some(e=>e.id.startsWith("WO_DEPOSIT_"))){let e=o.items.reduce((e,t)=>"Inventory"===t.productType?e+(t.costPrice||0)*t.quantity:e,0);if(!o.workOrderId){let t=[];o.payments.forEach(e=>{let r="";switch(e.method){case"Cash":r=a.defaultCashAccountId;break;case"M-Pesa":r=a.defaultMpesaAccountId;break;case"Card":r=a.defaultCardAccountId;break;case"Points":return}if(r){let a="Cash"===e.method?e.amount-o.change:e.amount;a>0&&t.push({accountId:r,debit:a,credit:0})}}),o.pointsValue>0&&t.push({accountId:a.defaultSalesAccountId,debit:o.pointsValue,credit:0}),t.push({accountId:a.defaultSalesAccountId,debit:0,credit:o.taxableAmount}),o.tax>0&&t.push({accountId:a.defaultVatPayableAccountId,debit:0,credit:o.tax}),e>0&&(t.push({accountId:a.defaultCogsAccountId,debit:e,credit:0}),t.push({accountId:a.defaultInventoryAccountId,debit:0,credit:e})),await rP("Sale: ".concat(o.id),o.id,"Sale",t)}}return await rp("Sale Completed","Sale ".concat(o.id," for KES ").concat(o.total.toFixed(2)," to ").concat(null===(r=B.find(e=>e.id===o.customerId))||void 0===r?void 0:r.name,".")),o}catch(t){throw console.error("Critical error during sale completion process:",{saleData:e,error:t}),Error("Failed to save the sale. Please check for errors and try again.")}},rL=async(e,r,a,d,o,n)=>{try{let l={id:"exp_".concat(Date.now()),cashierId:t.id,cashierName:t.name,date:new Date,amount:e,reason:r,payee:o,category:a,source:d,receiptImageUrl:n};if("Cash Drawer"===d){if(!eL){rd("Cannot process expense from drawer. No active shift.","error");return}l.shiftId=eL.id;let e={...eL,expenseIds:[...eL.expenseIds||[],l.id]};eO(e),el(t=>t.map(t=>t.id===e.id?e:t)),await g("shifts",e)}await g("payouts",l),ec(e=>[l,...e]);let i=er.accounting.defaultCogsAccountId,c="";switch(d){case"Cash Drawer":c=er.accounting.defaultCashAccountId;break;case"M-Pesa":c=er.accounting.defaultMpesaAccountId;break;case"Bank":c=er.accounting.defaultBankAccountId}i&&c?await rP("Expense: ".concat(r),l.id,"Expense",[{accountId:i,debit:e,credit:0},{accountId:c,debit:0,credit:e}]):rd("Accounting accounts not fully configured. Transaction not recorded in General Ledger.","info"),await rp("Expense Recorded","Expense of KES ".concat(e.toFixed(2)," for ").concat(r," from ").concat(d,".")),rd("Expense recorded successfully.","success"),rl(s.Expenditures)}catch(t){console.error("Failed to process expense:",{amount:e,reason:r,payee:o,error:t}),rd("Error recording expense. Please try again.","error")}},rO=async e=>{if(!t){rd("Cannot record deposit, no user logged in.","error");return}let r={id:"dep_".concat(Date.now()),...e,depositedById:t.id,depositedByName:t.name,shiftId:null==eL?void 0:eL.id};try{await g("bankDeposits",r),eT(e=>[r,...e].sort((e,t)=>t.date.getTime()-e.date.getTime()));let{defaultCashAccountId:e,defaultMpesaAccountId:t,defaultBankAccountId:a}=er.accounting;if(a){let s=[{accountId:a,debit:r.amount,credit:0}];r.breakdown.cash>0&&e&&s.push({accountId:e,debit:0,credit:r.breakdown.cash}),r.breakdown.mpesa>0&&t&&s.push({accountId:t,debit:0,credit:r.breakdown.mpesa}),await rP("Bank Deposit - Ref: ".concat(r.receiptNumber),r.id,"Bank Deposit",s)}else rd("Accounting accounts for bank not configured.","info");await rp("Bank Deposit Recorded","Recorded deposit of KES ".concat(r.amount," to ").concat(r.bankName,".")),rd("Bank deposit recorded successfully.","success")}catch(e){console.error("Failed to record bank deposit:",e),rd("Error recording bank deposit.","error")}},r_=async(e,r)=>{let{amount:a,method:s,paymentDate:d}=r,o=z.findIndex(t=>t.id===e);if(-1===o){rd("Invoice not found.","error");return}try{let d=z[o],n=d.paidAmount+a,l=n>=d.totalAmount?"Paid":"Partially Paid",i={...d,paidAmount:n,status:l},c={id:"spay_".concat(Date.now()),invoiceId:e,processedById:t.id,processedByName:t.name,shiftId:"Cash"===s&&eL?eL.id:void 0,...r};await g("supplierInvoices",i),await g("supplierPayments",c);let m=[...z];m[o]=i,G(m),Y(e=>[...e,c]);let{accounting:u}=er,x="";switch(s){case"Cash":x=u.defaultCashAccountId;break;case"M-Pesa":x=u.defaultMpesaAccountId;break;case"Bank Transfer":x=u.defaultBankAccountId}x&&u.defaultAccountsPayableId?await rP("Payment for invoice ".concat(d.invoiceNumber),c.id,"Supplier Payment",[{accountId:u.defaultAccountsPayableId,debit:a,credit:0},{accountId:x,debit:0,credit:a}]):rd("Accounting accounts not fully configured. Transaction not recorded in General Ledger.","info"),await rp("Supplier Payment Recorded","Recorded payment of KES ".concat(a," for invoice ").concat(d.invoiceNumber," via ").concat(s,".")),rd("Supplier payment recorded successfully.","success")}catch(e){console.error("Failed to record supplier payment:",e),rd("Error recording payment.","error")}},rE=async e=>{if(!e){rd("No file selected.","error");return}let t=new FileReader;t.onload=async e=>{try{var t;let r=null===(t=e.target)||void 0===t?void 0:t.result;if(!r){rd("Could not read file content.","error");return}let a=r.split(/\r\n|\n/).filter(e=>""!==e.trim());if(a.length<2){rd("CSV file must have a header and at least one data row.","error");return}let s=aq(a[0].trim()),d=a.slice(1,6).map(e=>aq(e.trim()));t9({content:r,headers:s,preview:d})}catch(e){console.error("Error reading CSV file:",e),rd("Failed to read CSV file.","error")}},t.readAsText(e)},rV=async(e,t)=>{try{let r=t.split(/\r\n|\n/).filter(e=>""!==e.trim()),a=r.shift(),s=aq(a.trim()),d={};for(let t in s.forEach((e,t)=>{d[e]=t}),e){let r=e[t];if(r&&"__do_not_import__"!==r&&!d.hasOwnProperty(r)){rd('Mapped header "'.concat(r,'" not found in CSV file.'),"error"),t9(null);return}}let o=[],n=[],l=0,i=await p("products");for(let t of r){if(!t.trim())continue;let r=aq(t.trim()),a=t=>{let a=e[t];if(a&&"__do_not_import__"!==a)return r[d[a]]},s=a("name"),c=a("price"),m=a("stock");if(!s||!c||!m){l++;continue}let u=parseFloat(c),x=parseInt(m,10);if(isNaN(u)||isNaN(x)){l++;continue}let h=a("inventoryCode"),p=a("upc"),b=null;h&&(b=i.find(e=>e.inventoryCode===h)),!b&&p&&(b=i.find(e=>e.upc===p));let g={name:s,price:u,stock:x,costPrice:parseFloat(a("costPrice")||"0")||0,upc:a("upc")||"",description:a("description")||"",category:a("category")||"Uncategorized",unitOfMeasure:a("unitOfMeasure")||"pc(s)",pricingType:"inclusive",productType:"Inventory",imageUrl:""};if(b)o.push({...b,...g});else{let e={...g,id:"prod_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),reservedStock:0,inventoryCode:h||"IC-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,5))};n.push(e)}}for(let e of o)await g("products",e);for(let e of n)await g("products",e);R(await p("products"));let c="";n.length>0&&(c+="".concat(n.length," new products added. ")),o.length>0&&(c+="".concat(o.length," products updated. ")),l>0&&(c+="".concat(l," rows skipped due to missing required data.")),rd(c||"Import complete, no changes made.","success"),await rp("Inventory Imported","Imported via CSV mapping. ".concat(c))}catch(e){console.error("Error processing mapped CSV:",e),rd("Failed to process imported products. Check data format.","error")}finally{t9(null)}},rH=async e=>{try{let t=(e.name.substring(0,3).toUpperCase()+String(Date.now()).slice(-4)).replace(/\s/g,""),r=t,a=1;for(;O.some(e=>e.inventoryCode===r);)r="".concat(t,"-").concat(a++);let s={...e,id:"prod_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),stock:0,reservedStock:0,inventoryCode:r};return await g("products",s),R(e=>[...e,s].sort((e,t)=>e.name.localeCompare(t.name))),await rp("Product Added","Added new product: ".concat(s.name)),rd("Product added successfully!","success"),s}catch(e){throw console.error("Failed to add product:",e),rd("Failed to add product.","error"),e}},rU=async e=>{try{await g("products",e),R(t=>t.map(t=>t.id===e.id?e:t).sort((e,t)=>e.name.localeCompare(t.name))),await rp("Product Updated","Updated product: ".concat(e.name," (ID: ").concat(e.id,")")),rd("Product updated successfully!","success")}catch(e){console.error("Failed to update product:",e),rd("Failed to update product.","error")}},rW=async()=>{if(eU)try{await f("products",eU.id),R(e=>e.filter(e=>e.id!==eU.id)),await rp("Product Deleted","Deleted product: ".concat(eU.name," (ID: ").concat(eU.id,")")),rd("Product deleted successfully.","success"),eW(null)}catch(e){console.error("Failed to delete product:",e),rd("Failed to delete product.","error")}},rZ=async e=>{try{let t={...e,id:"cust_".concat(Date.now()),dateAdded:new Date,loyaltyPoints:0};await g("customers",t),E(e=>[...e,t].sort((e,t)=>e.name.localeCompare(t.name))),await rp("Customer Added","Added new customer: ".concat(t.name)),rd("Customer added successfully!","success")}catch(e){console.error("Failed to add customer:",e),rd("Failed to add customer.","error")}},rz=async e=>{try{await g("customers",e),E(t=>t.map(t=>t.id===e.id?e:t).sort((e,t)=>e.name.localeCompare(t.name))),await rp("Customer Updated","Updated customer: ".concat(e.name," (ID: ").concat(e.id,")")),rd("Customer updated successfully!","success")}catch(e){console.error("Failed to update customer:",e),rd("Failed to update customer.","error")}},rK=async e=>{try{if(q.some(t=>t.customerId===e)){rd("Cannot delete customer. They are linked to existing sales records.","error");return}let t=B.find(t=>t.id===e);await f("customers",e),E(t=>t.filter(t=>t.id!==e)),t&&await rp("Customer Deleted","Deleted customer: ".concat(t.name)),rd("Customer deleted successfully.","success")}catch(e){console.error("Failed to delete customer:",e),rd("Failed to delete customer.","error")}},rX=async e=>{try{let t={...e,id:"supp_".concat(Date.now())};return await g("suppliers",t),U(e=>[...e,t].sort((e,t)=>(e.businessName||e.name).localeCompare(t.businessName||t.name))),await rp("Supplier Added","Added new supplier: ".concat(t.businessName||t.name)),rd("Supplier added successfully!","success"),t}catch(e){return console.error("Failed to add supplier:",e),rd("Failed to add supplier.","error"),null}},rJ=async e=>{try{await g("suppliers",e),U(t=>t.map(t=>t.id===e.id?e:t).sort((e,t)=>(e.businessName||e.name).localeCompare(t.businessName||t.name))),await rp("Supplier Updated","Updated supplier: ".concat(e.businessName||e.name)),rd("Supplier updated successfully!","success")}catch(e){console.error("Failed to update supplier:",e),rd("Failed to update supplier.","error")}},r2=async e=>{try{let t=W.some(t=>t.supplierId===e),r=z.some(t=>t.supplierId===e);if(t||r){rd("Cannot delete supplier. They are linked to existing purchase orders or invoices.","error");return}let a=H.find(t=>t.id===e);await f("suppliers",e),U(t=>t.filter(t=>t.id!==e)),await rp("Supplier Deleted","Deleted supplier: ".concat((null==a?void 0:a.businessName)||(null==a?void 0:a.name))),rd("Supplier deleted successfully.","success")}catch(e){console.error("Failed to delete supplier:",e),rd("Failed to delete supplier.","error")}},r1=async e=>{try{var t;let r="".concat(er.receipt.poNumberPrefix).concat(Date.now()),a=e.items.reduce((e,t)=>e+t.cost*t.quantity,0),{orderDate:s,...d}=e,o={id:"po_".concat(Date.now()),poNumber:r,...d,items:e.items.map(e=>({...e,quantityReceived:0})),createdDate:s?new Date(s):new Date,totalCost:a};if(e.salesOrderId){let t=eg.find(t=>t.id===e.salesOrderId);if(t){let r=t.items.map(t=>e.items.find(e=>e.salesOrderItemId===t.id)?{...t,status:"Ordered",purchaseOrderId:o.id}:t),a=r.every(e=>"Pending"!==e.status),s={...t,items:r,status:a?"Ordered":"Pending"};await r8(s)}}return await g("purchaseOrders",o),Z(e=>[o,...e].sort((e,t)=>t.createdDate.getTime()-e.createdDate.getTime())),await rp("Purchase Order Created","Created PO #".concat(o.poNumber," for supplier ").concat(null===(t=H.find(e=>e.id===o.supplierId))||void 0===t?void 0:t.name,". Status: ").concat(o.status)),rd("Purchase Order ".concat(o.poNumber," created."),"success"),o}catch(e){throw console.error("Failed to create purchase order:",e),rd("Failed to create purchase order.","error"),e}},r5=async e=>{let t=W.find(t=>t.id===e);if(!t){rd("Purchase Order not found.","error");return}if("Draft"!==t.status){rd("Only Draft purchase orders can be sent.","info");return}let r={...t,status:"Sent"};try{await g("purchaseOrders",r),Z(t=>t.map(t=>t.id===e?r:t)),await rp("Purchase Order Sent","PO #".concat(t.poNumber," was marked as Sent.")),rd("Purchase Order ".concat(t.poNumber," marked as Sent."),"success")}catch(e){console.error("Failed to send purchase order:",e),rd("Failed to update PO status.","error")}},r6=async e=>{if(e$)try{let{accounting:t}=er,r=W.find(e=>e.id===e$.id);if(!r)throw Error("Purchase Order not found");let a=[],s=e.reduce((e,t)=>e+t.cost*t.quantityReceived,0);for(let t of e)if(t.productId){let e=O.find(e=>e.id===t.productId);if(e&&"Inventory"===e.productType){let r=er.tax.vatRate/100,s=t.cost/(1+r),d={...e,stock:e.stock+t.quantityReceived,upc:t.upc,category:t.category,costPrice:s};a.push(d),await g("products",d)}}if(s>0){let e=er.tax.vatRate/100,a=s/(1+e),d=s-a,o={id:"sinv_".concat(Date.now()),invoiceNumber:"INV-".concat(r.poNumber,"-").concat(Date.now()),purchaseOrderId:r.id,supplierId:r.supplierId,invoiceDate:new Date,dueDate:new Date(new Date().setDate(new Date().getDate()+30)),subtotal:a,taxAmount:d,totalAmount:s,paidAmount:0,status:"Unpaid"};if(await g("supplierInvoices",o),G(e=>[o,...e]),await rp("Supplier Invoice Created","Invoice #".concat(o.invoiceNumber," created for PO #").concat(r.poNumber,".")),t.defaultInventoryAccountId&&t.defaultAccountsPayableId){let e=[{accountId:t.defaultInventoryAccountId,debit:a,credit:0},{accountId:t.defaultAccountsPayableId,debit:0,credit:s}];d>0&&t.defaultVatReceivableAccountId&&e.push({accountId:t.defaultVatReceivableAccountId,debit:d,credit:0}),await rP("Stock Receipt for PO ".concat(r.poNumber),o.id,"Stock Receipt",e)}}let d=!0,o=r.items.map(t=>{let r=e.find(e=>e.productId?e.productId===t.productId:e.productName===t.productName);if(r){let e=(t.quantityReceived||0)+r.quantityReceived;return e<t.quantity&&(d=!1),{...t,quantityReceived:e}}return(t.quantityReceived||0)<t.quantity&&(d=!1),t}),n=e.length>0?d?"Received":"Partially Received":r.status,l={...r,items:o,status:n,receivedDate:new Date},i=eg.find(e=>e.id===r.salesOrderId);if(i){let t=[...i.items];for(let r of e)r.salesOrderItemId&&(t=t.map(e=>{if(e.id===r.salesOrderItemId){let t=(e.quantityReceived||0)+r.quantityReceived,a="Partially Received";return t>=e.quantity&&(a="Received"),{...e,quantityReceived:t,status:a}}return e}));let r=t.every(e=>"Received"===e.status),a=t.some(e=>"Received"===e.status||"Partially Received"===e.status),s=i.status;r?s="Received":a&&(s="Partially Received");let d={...i,items:t,status:s};await r8(d)}R(e=>{let t=new Map(e.map(e=>[e.id,e]));return a.forEach(e=>t.set(e.id,e)),Array.from(t.values())}),Z(e=>e.map(e=>e.id===l.id?l:e)),await g("purchaseOrders",l),await rp("Stock Received","Received stock for PO #".concat(l.poNumber,".")),rd("Stock received and supplier invoice created.","success"),e2(null)}catch(e){console.error("Failed to receive stock:",e),rd("Error receiving stock. Please try again.","error")}},r9=async e=>{if(!eL||!t)throw rd("Cannot create sales order. No active shift.","error"),Error("No active shift for sales order.");try{let r={id:"".concat(er.receipt.salesOrderPrefix).concat(Date.now()),cashierId:t.id,cashierName:t.name,shiftId:eL.id,...e,balance:e.total-e.deposit},a=[...O],d=!1;for(let e of r.items)if(e.productId){let t=a.findIndex(t=>t.id===e.productId);if(-1!==t&&"Inventory"===a[t].productType){let r=a[t];a[t]={...r,reservedStock:(r.reservedStock||0)+e.quantity},await g("products",a[t]),d=!0}}return d&&R(a),await g("salesOrders",r),ef(e=>[r,...e].sort((e,t)=>t.createdDate.getTime()-e.createdDate.getTime())),await rp("Sales Order Created","Created SO #".concat(r.id," for ").concat(r.customerName,". Status: ").concat(r.status)),rd("Sales Order ".concat(r.id," created successfully."),"success"),rl(s.SalesOrderList),r}catch(e){throw console.error("Failed to create sales order:",e),rd("Error creating sales order.","error"),e}},r8=async e=>{try{ef(t=>t.map(t=>t.id===e.id?e:t)),await g("salesOrders",e),tg(e),rd("Sales Order #".concat(e.id," updated."),"success")}catch(t){console.error("Failed to update sales order:",{salesOrderId:e.id,error:t}),rd("Error updating sales order.","error")}},r7=async(e,r)=>{if(!eL||!t)throw rd("Cannot complete sale. No active shift or user.","error"),Error("No active shift or user.");let a=e.items.map(e=>{let t=O.find(t=>t.id===e.productId);return{id:(null==t?void 0:t.id)||e.id,name:e.description,inventoryCode:(null==t?void 0:t.inventoryCode)||"SO-".concat(e.id),upc:null==t?void 0:t.upc,description:null==t?void 0:t.description,category:(null==t?void 0:t.category)||"Sales Order Item",price:e.unitPrice,pricingType:e.pricingType,productType:(null==t?void 0:t.productType)||"Inventory",costPrice:null==t?void 0:t.costPrice,stock:(null==t?void 0:t.stock)||0,reservedStock:(null==t?void 0:t.reservedStock)||0,imageUrl:(null==t?void 0:t.imageUrl)||"",unitOfMeasure:(null==t?void 0:t.unitOfMeasure)||"pc(s)",quantity:e.quantity}}),{subtotal:s,tax:d,totalDiscountAmount:o,taxableAmount:n,lineItemsDiscountAmount:l,cartDiscountAmount:i}=K(a,{type:"fixed",value:0},er.tax.vatRate/100),c=r.reduce((e,t)=>e+t.amount,0);return rM({items:a,subtotal:s,lineItemsDiscountAmount:l,cartDiscountAmount:i,discountAmount:o,taxableAmount:n,tax:d,total:c,payments:r,change:Math.max(0,c-e.balance),customerId:e.customerId,date:new Date,pointsUsed:0,pointsValue:0,salesOrderId:e.id,grandTotal:e.total,depositApplied:e.deposit,balanceDue:0})},ae=e=>{r8({...e,status:"Cancelled"})},at=e=>{t_(e),tg(null),rl(s.Purchases)},aa=e=>{if(e.balance<=0){rd("Sales order is fully paid.","info");return}eA([{id:"SO_PAYMENT_".concat(e.id),inventoryCode:"SO-".concat(e.id),name:"Payment for Sales Order #".concat(e.id),price:e.balance,pricingType:"inclusive",stock:9999,quantity:1,productType:"Service",category:"Sales Order",reservedStock:0,imageUrl:"",unitOfMeasure:"payment"}]),eF(e.customerId),tq(e.id),tg(null),rl(s.POS)},as=async e=>{if(!eL||!t)throw rd("Cannot create layaway. No active shift.","error"),Error("No active shift for layaway.");try{let r="".concat(er.receipt.layawayPrefix).concat(Date.now()),a={id:"LAYAWAY_DEPOSIT_".concat(r),name:"Layaway Deposit for #".concat(r),inventoryCode:"DEPOSIT",price:e.deposit,pricingType:"inclusive",productType:"Service",stock:9999,imageUrl:"",unitOfMeasure:"unit",category:"Layaway",quantity:1,reservedStock:0},{subtotal:s,tax:d,total:o,taxableAmount:n,lineItemsDiscountAmount:l,cartDiscountAmount:i,totalDiscountAmount:c}=K([a],{type:"fixed",value:0},er.tax.vatRate/100),m={items:[a],subtotal:s,lineItemsDiscountAmount:l,cartDiscountAmount:i,discountAmount:c,taxableAmount:n,tax:d,total:o,payments:[{...e.initialPayment}],change:0,customerId:e.customerId,date:new Date,pointsUsed:0,pointsValue:0,layawayId:r},u=await rM(m),x={id:r,cashierId:t.id,cashierName:t.name,shiftId:eL.id,...e,balance:e.total-e.deposit,payments:[{saleId:u.id,date:u.date,amount:e.deposit,method:e.initialPayment.method,cashierId:t.id}]};return await g("layaways",x),eh(e=>[...e,x]),tz({sale:u,layaway:x}),t8&&(ri(),t7(void 0)),x}catch(e){throw console.error("Failed to create layaway:",e),rd("Error creating layaway. The deposit sale may have failed.","error"),e}},ad=async(e,r,a)=>{let s=ex.find(t=>t.id===e);if(!s||!eL||!t){rd("Cannot process payment. No layaway or active shift found.","error");return}try{let d={id:"LAYAWAY_PAYMENT_".concat(e,"_").concat(Date.now()),name:"Layaway Payment for #".concat(e),inventoryCode:"PAYMENT",price:r,pricingType:"inclusive",productType:"Service",stock:9999,imageUrl:"",unitOfMeasure:"unit",category:"Layaway",quantity:1,reservedStock:0},{subtotal:o,tax:n,total:l,taxableAmount:i,lineItemsDiscountAmount:c,cartDiscountAmount:m,totalDiscountAmount:u}=K([d],{type:"fixed",value:0},er.tax.vatRate/100),x={items:[d],subtotal:o,lineItemsDiscountAmount:c,cartDiscountAmount:m,discountAmount:u,taxableAmount:i,tax:n,total:l,payments:[{method:a,amount:r,details:{}}],change:0,customerId:s.customerId,date:new Date,pointsUsed:0,pointsValue:0,layawayId:s.id},h=await rM(x),p={saleId:h.id,date:h.date,amount:r,method:a,cashierId:t.id},b=s.balance-r,f=b<=0?"Completed":s.status,k={...s,payments:[...s.payments,p],balance:b,status:f};await g("layaways",k),eh(t=>t.map(t=>t.id===e?k:t)),tz({sale:h,layaway:k}),rd("Layaway payment recorded successfully.","success")}catch(e){console.error("Failed to add layaway payment:",e),rd("Error recording layaway payment.","error")}},ao=async e=>{try{await g("layaways",e),eh(t=>t.map(t=>t.id===e.id?e:t)),td(e),rd("Layaway plan updated.","success")}catch(e){console.error("Failed to update layaway plan:",e),rd("Failed to update layaway plan.","error")}},al=async()=>{if(to)try{await f("layaways",to.id),eh(e=>e.filter(e=>e.id!==to.id)),await rp("Layaway Deleted","Deleted layaway plan: ".concat(to.id," for ").concat(to.customerName)),rd("Layaway plan deleted successfully.","success")}catch(e){console.error("Failed to delete layaway:",e),rd("Failed to delete layaway plan.","error")}finally{tn(null)}},ai=async(e,t)=>{try{let r=B.find(t=>t.id===e.customerId);if(!r){rd("Customer not found.","error");return}let{subtotal:a,tax:d,total:o,totalDiscountAmount:n}=K(e.items,{type:"percentage",value:0},er.tax.vatRate/100),l={id:"quo_".concat(Date.now()),quoteNumber:"".concat(er.receipt.quotePrefix).concat(Date.now()),customerId:e.customerId,customerName:r.name,items:e.items,status:t,createdDate:new Date,expiryDate:new Date(new Date().setDate(new Date().getDate()+30)),subtotal:a,discountAmount:n,tax:d,total:o};await g("quotations",l),J(e=>[l,...e].sort((e,t)=>t.createdDate.getTime()-e.createdDate.getTime())),await rp("Quotation Created","Created quotation ".concat(l.quoteNumber," for ").concat(r.name,".")),rd("Quotation ".concat(l.quoteNumber," saved as ").concat(t,"."),"success"),rl(s.Quotations),eG(l)}catch(e){console.error("Failed to create quotation:",e),rd("Failed to create quotation.","error")}},ac=async e=>{try{await g("quotations",e),J(t=>t.map(t=>t.id===e.id?e:t)),await rp("Quotation Updated","Updated quotation ".concat(e.quoteNumber,".")),rd("Quotation ".concat(e.quoteNumber," updated."),"success"),(null==eK?void 0:eK.id)===e.id&&eG(e)}catch(e){console.error("Failed to update quotation:",e),rd("Failed to update quotation.","error")}},am=e=>{let t=e.items.map(e=>{let t=O.find(t=>t.id===e.productId);return t?{...t,quantity:e.quantity,discount:e.discount}:(rd('Product "'.concat(e.productName,'" not found in inventory.'),"error"),null)}).filter(e=>null!==e);t.length!==e.items.length&&rd("Some items from the quotation could not be added to the cart.","info"),eA(t),eF(e.customerId),tW(e.id),rl(s.POS)},ax=async e=>{if(!eL){rd("Cannot hold a sale without an active shift.","error");return}if(0===eI.length){rd("Cart is empty.","info");return}try{let r={id:"held_".concat(Date.now()),name:e||"Held at ".concat(new Date().toLocaleTimeString("en-GB",{timeZone:"Africa/Nairobi"})),items:eI,customerId:eM,heldAt:new Date,cashierId:t.id,cashierName:t.name};await g("heldReceipts",r),ey(e=>[r,...e].sort((e,t)=>t.heldAt.getTime()-e.heldAt.getTime())),ri(),tj(!1),rd("Sale held successfully.","success"),await rp("Sale Held",'Held sale "'.concat(r.name,'"'))}catch(e){console.error("Failed to hold receipt:",e),rd("Error holding sale.","error")}},ap=async e=>{try{if(eI.length>0&&!await new Promise(e=>{e(!!window.confirm("Recalling this sale will overwrite your current cart. Proceed?"))}))return;eA(e.items),eF(e.customerId),await f("heldReceipts",e.id),ey(t=>t.filter(t=>t.id!==e.id)),rl(s.POS),rd('Recalled sale "'.concat(e.name,'".'),"success"),await rp("Sale Recalled",'Recalled held sale "'.concat(e.name,'"'))}catch(e){console.error("Failed to recall receipt:",e),rd("Error recalling sale.","error")}},ab=async()=>{if(tv)try{await f("heldReceipts",tv.id),ey(e=>e.filter(e=>e.id!==tv.id)),await rp("Held Sale Deleted",'Deleted held sale "'.concat(tv.name,'"')),rd("Held receipt deleted.","success")}catch(e){console.error("Failed to delete held receipt:",e),rd("Error deleting held receipt.","error")}finally{tw(null)}},ag=async(e,r,a)=>{if(!eL||!t){rd("Cannot create work order. No active shift.","error");return}try{let d=[...O];for(let e of r){let t=d.findIndex(t=>t.id===e.materialId);if(-1!==t&&"Inventory"===d[t].productType){let r=d[t];if(r.stock-(r.reservedStock||0)<e.qty){rd("Insufficient available stock for ".concat(r.name,"."),"error");return}d[t]={...r,reservedStock:(r.reservedStock||0)+e.qty}}}let o={id:"".concat(er.receipt.workOrderPrefix).concat(Date.now()),cashierId:t.id,cashierName:t.name,shiftId:eL.id,...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await g("workOrders",o);let n=r.map(e=>({...e,id:"wom_".concat(o.id,"_").concat(e.materialId),workOrderId:o.id}));for(let e of n)await g("workOrderMaterials",e);for(let e of(ew(e=>[...e,...n]),eb(e=>[o,...e].sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())),d)){let t=O.find(t=>t.id===e.id);t&&t.reservedStock!==e.reservedStock&&await g("products",e)}if(R(d),await rp("Work Order Created","Created WO #".concat(o.id," for ").concat(o.customerName,".")),rd("Work Order ".concat(o.id," created successfully."),"success"),a>0){let e={id:"WO_DEPOSIT_".concat(o.id),inventoryCode:"WO-".concat(o.id),name:"Deposit for Work Order #".concat(o.id),price:a,pricingType:"inclusive",stock:9999,quantity:1,productType:"Service",category:"Work Order",reservedStock:0,imageUrl:"",unitOfMeasure:"deposit"};eA([e]),eF(o.customerId),tC(o.id),rl(s.POS)}else rl(s.WorkOrderList)}catch(e){console.error("Failed to create work order:",e),rd("Error creating work order.","error")}},af=e=>{if(e.balanceDue<=0){rd("Work Order is fully paid.","info"),rA({...e,status:"Completed",updatedAt:new Date().toISOString()});return}eA([{id:"WO_BALANCE_".concat(e.id),inventoryCode:"WO-".concat(e.id),name:"Balance for Work Order #".concat(e.id),price:e.balanceDue,pricingType:"inclusive",stock:9999,quantity:1,productType:"Service",category:"Work Order",reservedStock:0,imageUrl:"",unitOfMeasure:"payment"}]),eF(e.customerId),tC(e.id),tu(null),rl(s.POS)},ak=async()=>{tF(!1),tO(!0);try{await new Promise(e=>setTimeout(e,500)),await k(),localStorage.clear(),await new Promise(e=>setTimeout(e,2500)),window.location.reload()}catch(e){console.error("Factory reset failed:",e),rd("Factory reset failed. Please clear browser data manually.","error"),tO(!1)}};if(!er.isSetupComplete)return(0,d.jsx)(rx,{settings:er,onUpdateSettings:ru,showToast:rd,onSetupComplete:()=>{ru({isSetupComplete:!0})}});if(u)return(0,d.jsx)("div",{className:"h-screen w-screen flex items-center justify-center",children:"Loading Application..."});if(A)return(0,d.jsx)(r0,{currentUser:t,onUnlock:()=>M(!1),onForceLogout:r});let ay=(e,t,r)=>e8({type:e,id:t,customerId:r}),aj={products:O,cart:eI,customers:B,selectedCustomerId:eM,onCustomerChange:eF,addToCart:rf,updateCartItemQuantity:rj,updateCartItemDiscount:rv,removeFromCart:rC,clearCart:ri,completeSale:rM,isOnline:!0,currentUser:t,settings:er,sales:q,expenses:ei,activeShift:eL,onStartShift:rT,onEndShiftRequest:()=>eq(!0),isEndingShift:eE,onConfirmEndShift:rI,onCancelEndShift:()=>eq(!1),shiftReportToShow:eV,onCloseShiftReport:()=>eH(null),onEmailReceiptRequest:(e,t)=>{},onWhatsAppReceiptRequest:(e,t)=>ay("Receipt",e,t),onHoldRequest:()=>tj(!0),onLayawayRequest:()=>{if(0===eI.length){rd("Add items to the cart to create a layaway.","info");return}t7(eI),rl(s.Layaway)},workOrders:ep,originatingWorkOrderId:tN,salesOrders:eg,originatingSalesOrderId:tE,showToast:rd,payouts:ei,supplierPayments:Q,bankDeposits:eP};return(0,d.jsxs)("div",{className:"theme-".concat(m," h-screen w-screen bg-background dark:bg-dark-background text-foreground dark:text-dark-foreground flex overflow-hidden"),children:[(0,d.jsx)($,{currentView:h,setCurrentView:rl,isOpen:j,setIsOpen:w,currentUser:t,onLogout:r,permissions:ro,settings:er}),(0,d.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,d.jsx)(eo,{isOnline:!0,isSyncing:!1,queuedSalesCount:0,onMenuClick:()=>w(e=>!e),currentUser:t,products:O,settings:er,onInstallClick:()=>{T&&(T.prompt(),T.userChoice.then(e=>{"accepted"===e.outcome?rd("Banduka POS installed successfully!","success"):rd("Installation cancelled.","info"),I(null)}))},installPromptEvent:T,activeTimeClockEvent:eR,onLogout:r}),(0,d.jsx)("main",{className:"flex-1 overflow-y-auto",children:(0,d.jsx)(n.M,{mode:"wait",children:(0,d.jsx)("div",{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-15},transition:{duration:.2},style:{height:"100%"},children:(()=>{switch(h){case s.POS:return tZ?(0,d.jsx)(ev,{sale:tZ.sale,layaway:tZ.layaway,onNewSale:()=>{tz(null),ri()},currentUser:t,settings:er,onWhatsAppReceiptRequest:(e,t)=>ay("Receipt",e,t),showToast:rd}):(0,d.jsx)(eB,{...aj});case s.Dashboard:return(0,d.jsx)(e0,{sales:q,products:O,suppliers:H,supplierInvoices:z,expenses:ei,settings:er,workOrders:ep});case s.Inventory:return(0,d.jsx)(e5,{products:O,purchaseOrders:W,suppliers:H,onAddProduct:rH,onUpdateProduct:rU,onDeleteProductRequest:eW,permissions:ro,onImportProducts:rE,onPrintBarcodeRequest:e6,onAddToPORequest:e4,settings:er});case s.Purchases:return(0,d.jsx)(tt,{purchaseOrders:W,suppliers:H,products:O,permissions:ro,onReceivePORequest:e2,onAddPurchaseOrder:r1,onAddSupplier:rX,onSendPO:r5,onWhatsAppPORequest:(e,t)=>e8({type:"PurchaseOrder",id:e,customerId:t}),settings:er,salesOrderForPO:tB,onClearSalesOrderForPO:()=>t_(null)});case s.Suppliers:return(0,d.jsx)(t2,{suppliers:H,purchaseOrders:W,supplierInvoices:z,supplierPayments:Q,onAddSupplier:rX,onUpdateSupplier:rJ,onDeleteSupplier:r2,permissions:ro,settings:er});case s.AccountsPayable:if(tK)return(0,d.jsx)(aR,{info:tK,user:t,settings:er,onDone:()=>{tG(null),eY(null)}});return eQ?(0,d.jsx)(rc,{invoice:eQ,supplier:H.find(e=>e.id===eQ.supplierId),purchaseOrder:W.find(e=>e.id===eQ.purchaseOrderId),settings:er,onBack:()=>eY(null)}):(0,d.jsx)(tc,{invoices:z,suppliers:H,onRecordPayment:r_,onViewInvoice:eY,activeShift:eL,sales:q,payouts:ei,accountingTransactions:eS,chartOfAccounts:eN,settings:er});case s.TaxReport:return(0,d.jsx)(ar,{sales:q,supplierInvoices:z,settings:er});case s.ProfitReport:return(0,d.jsx)(an,{sales:q,products:O,expenses:ei,settings:er,showToast:rd});case s.FiscalPeriodReport:return(0,d.jsx)(au,{sales:q,products:O,expenses:ei,supplierPayments:Q,bankDeposits:eP,shifts:en,settings:er,supplierInvoices:z,accountingTransactions:eS,chartOfAccounts:eN});case s.PaymentSummary:return(0,d.jsx)(r$,{sales:q,users:ee});case s.ShiftReport:return(0,d.jsx)(tx,{shifts:en,sales:q,expenses:ei,supplierPayments:Q,bankDeposits:eP,settings:er});case s.SalesHistory:return eZ?(0,d.jsx)(tb,{sale:eZ,layaway:tl||void 0,onBack:()=>{ez(null),ti(null)},currentUser:t,settings:er,onWhatsAppReceiptRequest:(e,t,r)=>ay(e,t,r),showToast:rd}):(0,d.jsx)(th,{sales:q,customers:B,users:ee,onViewSaleRequest:e=>{if(ex.some(t=>t.payments.some(t=>t.saleId===e.id))){let t=ex.find(t=>t.payments.some(t=>t.saleId===e.id));t&&ti(t)}ez(e)}});case s.Customers:return(0,d.jsx)(tQ,{customers:B,sales:q,onAddCustomer:rZ,onUpdateCustomer:rz,onDeleteCustomer:rK,permissions:ro,settings:er});case s.Quotations:return eK?(0,d.jsx)(rn,{quotation:eK,settings:er,sales:q,onBack:()=>eG(null),onConvertQuoteToSale:am,permissions:ro}):(0,d.jsx)(t4,{quotations:X,sales:q,onSelectQuotation:eG,onCreateQuoteRequest:()=>y(s.CreateQuotation),permissions:ro});case s.CreateQuotation:return(0,d.jsx)(rs,{customers:B,products:O,settings:er,onSave:ai,onCancel:()=>y(s.Quotations)});case s.Staff:return(0,d.jsx)(re,{users:ee,permissions:ro,onAddUser:l,onUpdateUser:i,onDeleteUser:c,onManagePermissionsRequest:()=>{tD("users-perms"),rl(s.Settings)}});case s.TimeSheets:return(0,d.jsx)(rg,{timeClockEvents:em,users:ee,permissions:ro,onAddRequest:()=>{ta(null),te(!0)},onEditRequest:e=>{ta(e),te(!0)},onDeleteRequest:()=>{}});case s.Settings:return(0,d.jsx)(tV,{settings:er,onUpdateSettings:ru,users:ee,auditLogs:es,showToast:rd,onBackup:()=>{},onRestoreRequest:e=>{tA(e),tT(!0)},onFactoryResetRequest:()=>tF(!0),openModalId:tS,onModalOpened:()=>tD(null),onTestBarcodePrint:()=>{},onInitDrive:()=>{},isDriveReady:tY,isDriveInitializing:tJ,isDriveAuthenticated:t0,driveUser:t3,onDriveSignIn:()=>{},onDriveSignOut:()=>{},onDriveBackup:()=>{},onDriveRestore:()=>{},onDriveBackupAuditLogs:()=>{},isDriveConfigured:!1});case s.ReturnReceipt:return(0,d.jsx)(ry,{sales:q,activeShift:eL,onProcessReturn:()=>{},onBack:()=>rl(s.POS)});case s.NewExpense:return(0,d.jsx)(rw,{activeShift:eL,onProcessExpense:rL,onBack:()=>rl(s.POS),sales:q,expenses:ei,accountingTransactions:eS,chartOfAccounts:eN,settings:er,currentUser:t});case s.Expenditures:return eX?(0,d.jsx)(rS,{expense:eX,settings:er,onBack:()=>eJ(null)}):(0,d.jsx)(rN,{expenses:ei,onViewExpenseRequest:eJ,setCurrentView:y});case s.Layaway:return tZ?(0,d.jsx)(ev,{sale:tZ.sale,layaway:tZ.layaway,onNewSale:()=>{tz(null),rl(s.LayawayList)},currentUser:t,settings:er,onWhatsAppReceiptRequest:(e,t)=>ay("Receipt",e,t),showToast:rd}):(0,d.jsx)(rD,{products:O,customers:B,settings:er,onAddLayaway:as,onBack:()=>{rl(s.POS),t7(void 0)},activeShift:eL,initialCartItems:t8});case s.WorkOrder:return(0,d.jsx)(aS,{products:O,customers:B,users:ee,settings:er,onAddWorkOrder:ag,onBack:()=>rl(s.WorkOrderList),activeShift:eL});case s.SalesOrder:return(0,d.jsx)(rB,{products:O,customers:B,settings:er,onAddSalesOrder:r9,onBack:()=>rl(s.POS),activeShift:eL});case s.LayawayList:return tZ?(0,d.jsx)(ev,{sale:tZ.sale,layaway:tZ.layaway,onNewSale:()=>{tz(null),tZ.layaway&&td(tZ.layaway)},currentUser:t,settings:er,onWhatsAppReceiptRequest:(e,t)=>ay("Receipt",e,t),showToast:rd}):ts?(0,d.jsx)(rR,{layaway:ts,sales:q,onBack:()=>td(null),onAddPayment:ad,onViewReceiptRequest:(e,t)=>{ez(e),ti(t),rl(s.SalesHistory)},onUpdate:ao}):(0,d.jsx)(rF,{layaways:ex,onSelectLayaway:td,onCreateRequest:()=>rl(s.Layaway),onDeleteRequest:tn});case s.WorkOrderList:return tm?(0,d.jsx)(aF,{workOrder:tm,materials:ej.filter(e=>e.workOrderId===tm.id),users:ee,sales:q,settings:er,onBack:()=>tu(null),onUpdate:rA,onPushToPOS:af}):(0,d.jsx)(aT,{workOrders:ep,users:ee,customers:B,onViewWorkOrder:tu,onCreateRequest:()=>rl(s.WorkOrder)});case s.SalesOrderList:return tp?(0,d.jsx)(rG,{salesOrder:tp,onBack:()=>tg(null),onCreatePO:at,onCancelRequest:tk,onUpdate:r8,settings:er,onDirectComplete:r7,sales:q,currentUser:t,onWhatsAppReceiptRequest:(e,t,r)=>ay(e,t,r),showToast:rd}):(0,d.jsx)(rq,{salesOrders:eg,onViewSalesOrder:tg,onCancelRequest:tk,onCreatePORequest:at,onPushToPOSRequest:aa,onCreateRequest:()=>rl(s.SalesOrder)});case s.HeldReceipts:return(0,d.jsx)(rY,{heldReceipts:ek,onRecallReceipt:ap,onDeleteReceiptRequest:tw});case s.OpenCashDrawer:return(0,d.jsx)(r3,{onBack:()=>rl(s.POS),onOpenDrawer:rb});case s.WhatsAppOrders:return(0,d.jsx)(r4,{products:O,customers:B,settings:er,activeShift:eL,onAddSalesOrder:async()=>({}),onBack:()=>rl(s.POS)});case s.Accounts:return(0,d.jsx)(aC,{accountingTransactions:eS,chartOfAccounts:eN,settings:er,sales:q,expenses:ei,activeShift:eL,bankDeposits:eP,onAddBankDeposit:rO,currentUser:t,customers:B,supplierPayments:Q,suppliers:H,supplierInvoices:z,onProcessExpense:rL});case s.GeneralLedger:return(0,d.jsx)(ah,{transactions:eS,accounts:eN});default:return(0,d.jsx)("div",{children:"View not implemented yet."})}})()},h)})})]}),(0,d.jsxs)(n.M,{children:[N.map(e=>(0,d.jsx)(tU,{...e},e.id)),D&&(0,d.jsx)(rh,{onUpdate:()=>{D&&D.waiting&&D.waiting.postMessage({type:"SKIP_WAITING"}),P(null)}}),eU&&(0,d.jsx)(tR,{title:"Delete ".concat(eU.name,"?"),message:"Are you sure? This action cannot be undone and may affect historical sales reports.",onConfirm:rW,onClose:()=>eW(null),confirmText:"Delete",isDestructive:!0}),e$&&(0,d.jsx)(rt,{purchaseOrder:e$,supplier:H.find(e=>e.id===e$.supplierId),products:O,onConfirm:r6,onClose:()=>e2(null)}),e1&&(0,d.jsx)(rr,{product:e1,purchaseOrders:W,suppliers:H,onConfirm:()=>{},onClose:()=>e4(null)}),e3&&(0,d.jsx)(ra,{product:e3,onClose:()=>e6(null)}),e9&&(0,d.jsx)(rm,{mode:"PurchaseOrder"===e9.type?"po":"receipt",recipient:B.find(e=>e.id===e9.customerId)||H.find(e=>e.id===e9.customerId),documentId:e9.id,onSend:()=>{},onClose:()=>e8(null)}),e7&&(0,d.jsx)(rk,{event:tr,users:ee,onClose:()=>te(!1),onSave:()=>{}}),tf&&(0,d.jsx)(tR,{title:"Cancel Sales Order ".concat(tf.id,"?"),message:"Are you sure? This will mark the order as cancelled. This action cannot be undone.",onConfirm:()=>{ae(tf),tk(null)},onClose:()=>tk(null),confirmText:"Cancel Order",isDestructive:!0}),ty&&(0,d.jsx)(rQ,{onConfirm:ax,onClose:()=>tj(!1)}),tv&&(0,d.jsx)(tR,{title:"Delete Held Receipt?",message:'Are you sure you want to delete the held receipt "'.concat(tv.name,'"? This action cannot be undone.'),onConfirm:ab,onClose:()=>tw(null),confirmText:"Delete",isDestructive:!0}),tP&&tI&&(0,d.jsx)(tR,{title:"Restore from Backup?",message:"This will replace all current data with the data from the file '".concat(tI.name,"'. This action cannot be undone."),onConfirm:()=>{tT(!1),tA(null)},onClose:()=>{tT(!1),tA(null)},confirmText:"Restore Data",isDestructive:!0}),tM&&(0,d.jsx)(tR,{title:"Factory Reset Confirmation",message:"This will permanently delete ALL data in the application and cannot be undone. You will be logged out and taken to the setup screen.",onConfirm:ak,onClose:()=>tF(!1),confirmText:"RESET",isDestructive:!0,requiresConfirmationText:!0}),tL&&(0,d.jsx)(aE,{message:"Clearing all application data... The app will reload shortly."}),to&&(0,d.jsx)(tR,{title:"Delete Layaway ".concat(to.id,"?"),message:"Are you sure you want to permanently delete this layaway plan? This action cannot be undone.",onConfirm:al,onClose:()=>tn(null),confirmText:"Delete",isDestructive:!0}),t6&&(0,d.jsx)(a_,{onClose:()=>t9(null),csvHeaders:t6.headers,csvPreview:t6.preview,onImportConfirm:e=>rV(e,t6.content)})]})]})},aH={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},aU={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};var aW=e=>{let{onLogin:t,onForgotPassword:r,onNavigateToSignUp:a,onBack:s}=e,[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)(!0),[x,h]=(0,o.useState)(!1),p=async e=>{e.preventDefault(),h(!0),await t(n,i,m),h(!1)};return(0,d.jsx)("div",{className:"min-h-screen flex flex-col justify-center py-12 sm:px-6 lg:px-8 auth-background",children:(0,d.jsx)("div",{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.5,ease:"easeOut"},className:"sm:mx-auto sm:w-full sm:max-w-md",children:(0,d.jsx)("div",{className:"bg-card/60 dark:bg-dark-card/60 backdrop-blur-2xl border border-white/20 dark:border-dark-border/50 py-12 px-4 shadow-2xl rounded-2xl sm:px-10",children:(0,d.jsxs)("div",{variants:aH,initial:"hidden",animate:"visible",children:[(0,d.jsxs)("div",{variants:aU,className:"mb-6 text-center",children:[(0,d.jsx)("h2",{className:"text-center text-3xl font-extrabold text-foreground dark:text-dark-foreground",children:"Admin Sign In"}),(0,d.jsx)("p",{className:"mt-2 text-center text-sm text-foreground-muted dark:text-dark-foreground-muted",children:"Access the system with administrator privileges."})]}),(0,d.jsxs)("form",{className:"mt-6 space-y-6",onSubmit:p,children:[(0,d.jsxs)("div",{variants:aU,children:[(0,d.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Admin Email"}),(0,d.jsx)("div",{className:"mt-1",children:(0,d.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,placeholder:"Enter your admin email",value:n,onChange:e=>l(e.target.value),className:"appearance-none block w-full px-4 py-3 rounded-lg bg-background/50 dark:bg-dark-background/50 border border-border dark:border-dark-border"})})]}),(0,d.jsxs)("div",{variants:aU,children:[(0,d.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Password"}),(0,d.jsx)("div",{className:"mt-1",children:(0,d.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,placeholder:"Enter your password",value:i,onChange:e=>c(e.target.value),className:"appearance-none block w-full px-4 py-3 rounded-lg bg-background/50 dark:bg-dark-background/50 border border-border dark:border-dark-border"})})]}),(0,d.jsxs)("div",{variants:aU,className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",checked:m,onChange:e=>u(e.target.checked),className:"h-4 w-4 text-primary focus:ring-primary border-border rounded"}),(0,d.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-foreground dark:text-dark-foreground",children:"Remember me"})]}),(0,d.jsx)("div",{className:"text-sm",children:(0,d.jsx)("button",{type:"button",onClick:r,className:"font-medium text-primary hover:text-primary-focus",children:"Forgot your password?"})})]}),(0,d.jsx)("div",{variants:aU,children:(0,d.jsx)("button",{type:"submit",disabled:x,whileTap:{scale:.98},className:"w-full flex justify-center py-3 px-4 rounded-lg text-base font-bold text-primary-content bg-primary hover:bg-primary-focus transition-all shadow-md disabled:bg-slate-400 dark:disabled:bg-slate-600",children:x?"Signing In...":"Sign In"})})]}),s&&(0,d.jsx)("div",{variants:aU,className:"mt-6 text-center",children:(0,d.jsx)("button",{type:"button",onClick:s,className:"text-sm font-medium text-primary hover:text-primary-focus",children:"← Back to Staff Login"})})]})})})})};let aZ=e=>{let{children:t}=e;return(0,d.jsx)("div",{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3,ease:"easeInOut"},children:t})};var az=e=>{let{onFindUser:t,onResetPassword:r,onBackToLogin:a}=e,[s,l]=(0,o.useState)("email"),[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)(null),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)(""),[g,f]=(0,o.useState)(""),[k,y]=(0,o.useState)(""),[j,v]=(0,o.useState)(""),[w,N]=(0,o.useState)(!1),C=async e=>{e.preventDefault(),v(""),N(!0);let r=await t(i);if(N(!1),r){u(r);let e=Math.floor(1e5+9e5*Math.random()).toString();b(e),alert("DEMO: Your recovery code is ".concat(e)),l("otp")}else v("No user found with that email address.")},S=e=>{e.preventDefault(),v(""),x===p?l("reset"):v("Invalid OTP. Please try again.")},D=e=>{if(e.preventDefault(),v(""),g.length<6){v("Passcode must be at least 6 characters.");return}if(g!==k){v("Passcodes do not match.");return}m&&r(g,m)},P="mt-1 block w-full px-4 py-3 rounded-lg bg-background/50 dark:bg-dark-background/50 border border-border dark:border-dark-border",T="w-full flex justify-center py-3 px-4 rounded-lg text-base font-bold text-primary-content bg-primary hover:bg-primary-focus disabled:bg-slate-400 dark:disabled:bg-slate-600";return(0,d.jsx)("div",{className:"h-screen w-screen auth-background flex items-center justify-center p-4",children:(0,d.jsxs)("div",{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-sm bg-card/60 dark:bg-dark-card/60 backdrop-blur-2xl rounded-2xl shadow-2xl p-8 border border-white/20 dark:border-dark-border/50",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)(n.M,{mode:"wait",children:(()=>{switch(s){case"email":return(0,d.jsxs)(aZ,{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Reset Passcode"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Enter your email to receive a recovery code."}),(0,d.jsxs)("form",{onSubmit:C,className:"mt-8 space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"email-forgot",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Email Address"}),(0,d.jsx)("input",{id:"email-forgot",type:"email",required:!0,value:i,onChange:e=>c(e.target.value),className:P})]}),(0,d.jsx)("button",{type:"submit",disabled:w,whileTap:{scale:.98},className:T,children:w?"Searching...":"Send Code"})]})]},"email");case"otp":return(0,d.jsxs)(aZ,{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Enter Code"}),(0,d.jsxs)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2",children:["A 6-digit recovery code has been sent to ",(0,d.jsx)("span",{className:"font-semibold text-foreground dark:text-dark-foreground",children:i}),"."]}),(0,d.jsxs)("form",{onSubmit:S,className:"mt-8 space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"otp",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"One-Time Password"}),(0,d.jsx)("input",{id:"otp",type:"text",required:!0,value:x,onChange:e=>h(e.target.value),className:"".concat(P," tracking-widest text-center text-lg")})]}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.98},className:T,children:"Verify Code"})]})]},"otp");case"reset":return(0,d.jsxs)(aZ,{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:"Create New Passcode"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Please enter a new passcode for your account."}),(0,d.jsxs)("form",{onSubmit:D,className:"mt-8 space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"password-reset",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"New Passcode"}),(0,d.jsx)("input",{id:"password-reset",type:"password",required:!0,value:g,onChange:e=>f(e.target.value),className:P})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"confirmPassword-reset",className:"block text-sm font-medium text-foreground dark:text-dark-foreground",children:"Confirm New Passcode"}),(0,d.jsx)("input",{id:"confirmPassword-reset",type:"password",required:!0,value:k,onChange:e=>y(e.target.value),className:P})]}),(0,d.jsx)("button",{type:"submit",whileTap:{scale:.98},className:T,children:"Set New Passcode"})]})]},"reset");default:return null}})()}),j&&(0,d.jsx)("p",{className:"text-center text-sm text-danger mt-4",children:j})]}),(0,d.jsx)("div",{className:"mt-6 text-center",children:(0,d.jsx)("button",{onClick:a,className:"text-sm font-medium text-primary hover:text-primary-focus",children:"← Back to Login"})})]})})};let aK=e=>{let{user:t,onClick:r}=e,a="Admin"===t.role||!!t.email,s=t.name.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()||t.name[0];return(0,d.jsxs)("div",{onClick:r,variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{y:-5,scale:1.03},whileTap:{scale:.98},className:"bg-card/60 dark:bg-dark-card/60 backdrop-blur-lg p-6 rounded-2xl shadow-lg border border-white/20 dark:border-dark-border/50 cursor-pointer flex flex-col items-center text-center relative hover:border-primary/50 dark:hover:border-dark-primary/50 transition-colors",children:[a&&(0,d.jsx)("div",{className:"absolute top-3 right-3 text-warning",title:"Admin Account",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{fillRule:"evenodd",d:"M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 1 1 0 000-2z",clipRule:"evenodd"})})}),(0,d.jsx)("div",{className:"w-20 h-20 mb-4 rounded-full bg-primary text-primary-content flex items-center justify-center font-bold text-4xl border-4 border-card dark:border-dark-card shadow-lg",children:(0,d.jsx)("span",{children:s})}),(0,d.jsx)("h3",{className:"text-lg font-bold text-foreground dark:text-dark-foreground",children:t.name}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:t.role})]})};var aG=e=>{let{users:t,onUserSelect:r}=e,a=t.filter(e=>!e.email),s=t.find(e=>!!e.email);return(0,d.jsxs)("div",{className:"min-h-screen auth-background flex flex-col items-center justify-center p-4",children:[(0,d.jsxs)("div",{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[(0,d.jsx)("h1",{className:"text-4xl font-extrabold text-foreground dark:text-dark-foreground",children:"Banduka POS™"}),(0,d.jsx)("p",{className:"text-lg text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Select your profile to sign in"})]}),(0,d.jsxs)("div",{className:"w-full max-w-4xl",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.08,delayChildren:.2}}},initial:"hidden",animate:"visible",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[s&&(0,d.jsx)(aK,{user:s,onClick:()=>r(s)}),a.map(e=>(0,d.jsx)(aK,{user:e,onClick:()=>r(e)},e.id))]}),0===a.length&&s&&(0,d.jsx)("div",{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},className:"mt-8 text-center p-4 bg-primary/10 border border-primary/20 rounded-lg text-sm text-primary/80 dark:text-dark-primary/80",children:(0,d.jsx)("p",{children:"No staff profiles found. Log in as Admin to add staff members from the Settings menu."})})]})]})},aQ=e=>{let{user:t,onPinSubmit:r,onBack:a}=e,[s,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[m,u]=(0,o.useState)(0);(0,o.useEffect)(()=>{4===s.length&&x()},[s]);let x=async()=>{await r(s)||(c("Incorrect PIN. Please try again."),u(e=>e+1),setTimeout(()=>{l(""),c("")},1e3))},h=e=>{s.length<4&&l(t=>t+e)},p=()=>{l(e=>e.slice(0,-1))};return(0,d.jsx)("div",{className:"fixed inset-0 auth-background flex flex-col items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{className:"w-full max-w-sm text-center",children:[(0,d.jsx)("div",{className:"w-24 h-24 rounded-full bg-primary text-primary-content flex items-center justify-center font-bold text-5xl mx-auto mb-4 border-4 border-card dark:border-dark-card shadow-lg",children:(0,d.jsx)("span",{children:t.name.charAt(0)})}),(0,d.jsxs)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:["Welcome, ",t.name]}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Enter your 4-digit PIN to sign in."}),(0,d.jsx)("div",{className:"my-8",children:(0,d.jsx)(()=>(0,d.jsx)("div",{className:"flex justify-center space-x-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,d.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat(t<s.length?"bg-success border-success":"bg-transparent border-border")},t))}),{})}),(0,d.jsxs)(n.M,{children:[i&&(0,d.jsx)("p",{className:"text-danger font-semibold mb-4 h-5",children:i}),!i&&(0,d.jsx)("div",{className:"h-5 mb-4"})]}),(0,d.jsx)("div",{className:"max-w-xs mx-auto",children:(0,d.jsx)(()=>(0,d.jsx)("div",{className:"grid grid-cols-3 gap-4",children:["1","2","3","4","5","6","7","8","9","","0","⌫"].map((e,t)=>(0,d.jsx)("button",{onClick:()=>"⌫"===e?p():e?h(e):null,className:"p-4 bg-card/80 dark:bg-dark-card/80 text-foreground dark:text-dark-foreground rounded-2xl text-2xl font-bold enabled:hover:bg-muted dark:enabled:hover:bg-dark-muted disabled:opacity-0 transition-colors shadow-sm border border-border dark:border-dark-border",disabled:!e,children:e},t))}),{})}),(0,d.jsx)("div",{className:"mt-8",children:(0,d.jsx)("button",{onClick:a,className:"text-sm font-medium text-primary hover:text-primary-focus",children:"← Switch User"})})]})})},aY=e=>{let{user:t,onLogin:r,onBack:a}=e,[s,n]=(0,o.useState)(""),[l,i]=(0,o.useState)(!1),[c,m]=(0,o.useState)(""),u=async e=>{e.preventDefault(),m(""),i(!0),await r(t.username,s)||m("Invalid passcode. Please try again."),i(!1)};return(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 auth-background flex flex-col items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{className:"w-full max-w-sm text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,d.jsx)("div",{className:"w-24 h-24 rounded-full bg-primary text-primary-content flex items-center justify-center font-bold text-5xl mx-auto mb-4 border-4 border-card dark:border-dark-card shadow-lg",children:(0,d.jsx)("span",{children:t.name.charAt(0)})}),(0,d.jsxs)("h1",{className:"text-2xl font-bold text-foreground dark:text-dark-foreground",children:["Welcome, ",t.name]}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Enter your passcode to sign in."}),(0,d.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:u,children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"username",className:"sr-only",children:"Username"}),(0,d.jsx)("input",{id:"username",type:"text",value:t.username,readOnly:!0,className:"appearance-none block w-full px-3 py-2 border border-border dark:border-dark-border rounded-md shadow-sm bg-muted dark:bg-dark-muted text-foreground-muted dark:text-dark-foreground-muted sm:text-sm"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Passcode"}),(0,d.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,placeholder:"Enter your passcode",value:s,onChange:e=>n(e.target.value),autoFocus:!0,className:"appearance-none block w-full px-4 py-3 rounded-lg bg-background/50 dark:bg-dark-background/50 border border-border dark:border-dark-border"})]}),c&&(0,d.jsx)("p",{className:"text-sm text-danger",children:c}),(0,d.jsx)("button",{type:"submit",disabled:l,whileTap:{scale:.98},className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-bold text-primary-content bg-primary hover:bg-primary-focus focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:bg-slate-400 dark:disabled:bg-slate-600",children:l?"Signing In...":"Sign In"})]}),(0,d.jsx)("div",{className:"mt-8",children:(0,d.jsx)("button",{onClick:a,className:"text-sm font-medium text-primary hover:text-primary-focus",children:"← Switch User"})})]})})};let aX=e=>{let{type:t,onSelect:r,isSelected:a}=e,s=w[t];return(0,d.jsx)("div",{onClick:r,className:"p-4 rounded-xl cursor-pointer transition-all ".concat(a?"bg-card shadow-inner border border-primary":"bg-muted/50 dark:bg-dark-muted/50 hover:bg-muted dark:hover:bg-dark-muted border border-transparent hover:border-border"),whileHover:{y:-5},whileTap:{scale:.98},children:(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsx)("div",{className:"p-3 rounded-lg ".concat(a?"bg-primary/20 text-primary":"bg-background dark:bg-dark-background text-foreground-muted"),children:s.icon}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-bold text-foreground dark:text-dark-foreground",children:s.name}),(0,d.jsx)("p",{className:"text-sm text-foreground-muted dark:text-dark-foreground-muted",children:s.description})]})]})})};var aJ=e=>{let{onComplete:t}=e,[r,a]=(0,o.useState)(1),[s,l]=(0,o.useState)({name:"",location:"",phone:"",logoUrl:""}),[i,c]=(0,o.useState)(null),[m,u]=(0,o.useState)(""),[x,h]=(0,o.useState)(""),[p,b]=(0,o.useState)(""),g="w-full p-2 border rounded-md bg-background dark:bg-dark-background shadow-sm border-border dark:border-dark-border text-foreground dark:text-dark-foreground placeholder-foreground-muted dark:placeholder-dark-foreground-muted focus:outline-none focus:ring-2 focus:ring-primary",f=e=>{let{name:t,value:r}=e.target;l(e=>({...e,[t]:r}))};return(0,d.jsx)("div",{className:"min-h-screen auth-background flex flex-col items-center justify-center p-4",children:(0,d.jsx)("div",{className:"w-full max-w-4xl",children:(0,d.jsx)("div",{className:"bg-card/80 dark:bg-dark-card/80 backdrop-blur-2xl rounded-2xl shadow-2xl border border-white/20 dark:border-dark-border/50",children:(0,d.jsx)(n.M,{mode:"wait",children:1===r?(0,d.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),b(""),!s.name){b("Business Name is required.");return}if(!i){b("Please select a business type.");return}if(!m||!x){b("Admin email and password are required.");return}if(x.length<6){b("Password must be at least 6 characters long.");return}t({businessInfo:s,businessType:i,adminEmail:m,adminPass:x}),a(2)},className:"p-8 space-y-8",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("h1",{className:"text-3xl font-extrabold text-foreground dark:text-dark-foreground font-neural",children:"Welcome to Banduka POS™"}),(0,d.jsx)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2",children:"Let's get your business set up. Built by Eruns Technologies."})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h2",{className:"font-bold text-lg text-foreground dark:text-dark-foreground",children:"1. Your Business"}),(0,d.jsx)("input",{name:"name",value:s.name,onChange:f,placeholder:"Business Name",required:!0,className:g}),(0,d.jsx)("input",{name:"location",value:s.location,onChange:f,placeholder:"Location (e.g., Mombasa)",className:g}),(0,d.jsx)("input",{name:"phone",value:s.phone,onChange:f,placeholder:"Phone Number",className:g}),(0,d.jsx)("h2",{className:"font-bold text-lg text-foreground dark:text-dark-foreground pt-4",children:"2. Administrator Account"}),(0,d.jsx)("input",{type:"email",value:m,onChange:e=>u(e.target.value),placeholder:"Admin Email",required:!0,className:g}),(0,d.jsx)("input",{type:"password",value:x,onChange:e=>h(e.target.value),placeholder:"Admin Password (min. 6 chars)",required:!0,className:g})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h2",{className:"font-bold text-lg text-foreground dark:text-dark-foreground",children:"3. Business Type"}),(0,d.jsx)("div",{className:"space-y-2",children:Object.keys(w).map(e=>(0,d.jsx)(aX,{type:e,onSelect:()=>c(e),isSelected:i===e},e))})]})]}),p&&(0,d.jsx)("p",{className:"text-center text-sm text-danger",children:p}),(0,d.jsx)("div",{children:(0,d.jsx)("button",{type:"submit",whileTap:{scale:.98},className:"w-full py-3 px-4 rounded-xl text-primary-content bg-primary font-bold text-lg transition-all shadow-md",children:"Complete Setup & Launch"})})]},"step1"):(0,d.jsxs)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"p-12 text-center",children:[(0,d.jsx)("div",{className:"mx-auto bg-success/10 text-success w-24 h-24 rounded-full flex items-center justify-center mb-6",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,d.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-dark-foreground",children:"All Set!"}),(0,d.jsxs)("p",{className:"text-foreground-muted dark:text-dark-foreground-muted mt-2 mb-8",children:["Banduka POS™ is now configured for your ",(0,d.jsx)("span",{className:"font-semibold text-primary",children:s.name}),"."]}),(0,d.jsx)("p",{className:"font-semibold",children:"The application will now load..."})]},"step2")})})})})},a$=()=>{let[e,t]=(0,o.useState)("loading"),[r,a]=(0,o.useState)(null),[s,l]=(0,o.useState)(null),[i,c]=(0,o.useState)(null),[m,u]=(0,o.useState)([]),[h,b]=(0,o.useState)([]),k=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r={id:Date.now(),message:e,type:t};b(e=>[r]),setTimeout(()=>{b(e=>e.filter(e=>e.id!==r.id))},3e3)},[]);(0,o.useEffect)(()=>{(async()=>{try{await x();let e=await p("users");if(0===e.length){t("setup");return}u(e);let r=localStorage.getItem("banduka_pos_remembered_user");if(r){let s=e.find(e=>e.id===r);if(s){a(s),t("app");return}localStorage.removeItem("banduka_pos_remembered_user")}t("user_selection")}catch(e){console.error("Error during initial application load:",e),k("Failed to load application data. Please refresh.","error"),t("loading")}})()},[k]);let y=async e=>{try{let r={id:"user_admin_".concat(Date.now()),name:"Admin",username:e.adminEmail,email:e.adminEmail,password:e.adminPass,role:"Admin"};await g("users",r);let s={...v,isSetupComplete:!0,businessType:e.businessType,businessInfo:{...v.businessInfo,...e.businessInfo,email:e.adminEmail}};return await g("settings",s),u([r]),a(r),t("app"),localStorage.setItem("banduka_pos_remembered_user",r.id),k("Welcome to Banduka POS, ".concat(e.businessInfo.name,"!"),"success"),!0}catch(e){return console.error("Failed during initial setup:",e),k("An error occurred during setup. Please try again.","error"),!1}},j=async(e,r,s)=>{let d=m.find(t=>t.username&&t.username.toLowerCase()===e.toLowerCase());return d&&d.password===r?(a(d),t("app"),s?localStorage.setItem("banduka_pos_remembered_user",d.id):localStorage.removeItem("banduka_pos_remembered_user"),!0):(k("Invalid admin credentials.","error"),!1)},w=e=>{if("Admin"===e.role||e.email){t("admin_login");return}e.pin&&4===e.pin.length?(l(e),t("pin_entry")):e.password?(c(e),t("staff_login")):k("".concat(e.name," does not have a PIN or Passcode set up. Please ask an admin to set one."),"error")},N=async e=>!!s&&s.pin===e&&(a(s),t("app"),localStorage.removeItem("banduka_pos_remembered_user"),!0),C=async(e,r)=>!!i&&i.username.toLowerCase()===e.toLowerCase()&&i.password===r&&(a(i),t("app"),localStorage.removeItem("banduka_pos_remembered_user"),!0),S=()=>{a(null),localStorage.removeItem("banduka_pos_remembered_user"),t("user_selection")},D=async e=>m.find(t=>t.email&&t.email.toLowerCase()===e.toLowerCase())||null,P=async(e,r)=>{try{let a={...r,password:e};await g("users",a),u(e=>e.map(e=>e.id===a.id?a:e)),k("Password for ".concat(r.name," has been reset successfully."),"success"),t("admin_login")}catch(e){console.error("Failed to reset password:",{userId:r.id,error:e}),k("An error occurred while resetting the password.","error")}},T=async e=>{try{let t={...e,id:"user_".concat(Date.now())};u(e=>[...e,t]),await g("users",t)}catch(t){throw console.error("Failed to add new user:",{userData:e,error:t}),k("Error adding new user. Please try again.","error"),t}},I=async e=>{try{u(t=>t.map(t=>t.id===e.id?e:t)),await g("users",e)}catch(t){throw console.error("Failed to update user:",{user:e,error:t}),k("Error updating user. Please try again.","error"),t}},A=async e=>{try{u(t=>t.filter(t=>t.id!==e)),await f("users",e)}catch(t){throw console.error("Failed to delete user:",{userId:e,error:t}),k("Error deleting user. Please try again.","error"),t}};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.M,{mode:"wait",children:(0,d.jsx)("div",{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:(()=>{switch(e){case"loading":return(0,d.jsx)("div",{className:"h-screen w-screen flex items-center justify-center text-foreground-muted",children:"Loading Application..."});case"setup":return(0,d.jsx)(aJ,{onComplete:y});case"user_selection":return(0,d.jsx)(aG,{users:m,onUserSelect:w});case"pin_entry":if(s)return(0,d.jsx)(aQ,{user:s,onPinSubmit:N,onBack:()=>{l(null),t("user_selection")}});return t("user_selection"),null;case"staff_login":if(i)return(0,d.jsx)(aY,{user:i,onLogin:C,onBack:()=>{c(null),t("user_selection")}});return t("user_selection"),null;case"admin_login":return(0,d.jsx)(aW,{onLogin:j,onForgotPassword:()=>t("forgot_password"),onNavigateToSignUp:()=>0===m.length?t("setup"):k("Admin can add new users from Settings.","info"),onBack:m.length>1?()=>t("user_selection"):void 0});case"forgot_password":return(0,d.jsx)(az,{onFindUser:D,onResetPassword:P,onBackToLogin:()=>t("admin_login")});case"app":if(r)return(0,d.jsx)(aV,{currentUser:r,onLogout:S,allUsers:m,onAddUser:T,onUpdateUser:I,onDeleteUser:A});return t("user_selection"),null}})()},e)}),(0,d.jsx)(n.M,{children:h.map(e=>(0,d.jsx)(tU,{...e},e.id))})]})};function a0(){return(0,d.jsx)(a$,{})}}},function(e){e.O(0,[505,337,576,971,117,744],function(){return e(e.s=96643)}),_N_E=e.O()}]);